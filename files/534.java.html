<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">
<!--
generated by Pygments <https://pygments.org/>
Copyright 2006-2022 by the Pygments team.
Licensed under the BSD license, see LICENSE for details.
-->
<html>
<head>
  <title></title>
  <meta http-equiv="content-type" content="text/html; charset=None">
  <style type="text/css">
/*
generated by Pygments <https://pygments.org/>
Copyright 2006-2022 by the Pygments team.
Licensed under the BSD license, see LICENSE for details.
*/
pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
body .hll { background-color: #ffffcc }
body { background: #f8f8f8; }
body .c { color: #3D7B7B; font-style: italic } /* Comment */
body .err { border: 1px solid #FF0000 } /* Error */
body .k { color: #008000; font-weight: bold } /* Keyword */
body .o { color: #666666 } /* Operator */
body .ch { color: #3D7B7B; font-style: italic } /* Comment.Hashbang */
body .cm { color: #3D7B7B; font-style: italic } /* Comment.Multiline */
body .cp { color: #9C6500 } /* Comment.Preproc */
body .cpf { color: #3D7B7B; font-style: italic } /* Comment.PreprocFile */
body .c1 { color: #3D7B7B; font-style: italic } /* Comment.Single */
body .cs { color: #3D7B7B; font-style: italic } /* Comment.Special */
body .gd { color: #A00000 } /* Generic.Deleted */
body .ge { font-style: italic } /* Generic.Emph */
body .gr { color: #E40000 } /* Generic.Error */
body .gh { color: #000080; font-weight: bold } /* Generic.Heading */
body .gi { color: #008400 } /* Generic.Inserted */
body .go { color: #717171 } /* Generic.Output */
body .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
body .gs { font-weight: bold } /* Generic.Strong */
body .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
body .gt { color: #0044DD } /* Generic.Traceback */
body .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
body .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
body .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
body .kp { color: #008000 } /* Keyword.Pseudo */
body .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
body .kt { color: #B00040 } /* Keyword.Type */
body .m { color: #666666 } /* Literal.Number */
body .s { color: #BA2121 } /* Literal.String */
body .na { color: #687822 } /* Name.Attribute */
body .nb { color: #008000 } /* Name.Builtin */
body .nc { color: #0000FF; font-weight: bold } /* Name.Class */
body .no { color: #880000 } /* Name.Constant */
body .nd { color: #AA22FF } /* Name.Decorator */
body .ni { color: #717171; font-weight: bold } /* Name.Entity */
body .ne { color: #CB3F38; font-weight: bold } /* Name.Exception */
body .nf { color: #0000FF } /* Name.Function */
body .nl { color: #767600 } /* Name.Label */
body .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
body .nt { color: #008000; font-weight: bold } /* Name.Tag */
body .nv { color: #19177C } /* Name.Variable */
body .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
body .w { color: #bbbbbb } /* Text.Whitespace */
body .mb { color: #666666 } /* Literal.Number.Bin */
body .mf { color: #666666 } /* Literal.Number.Float */
body .mh { color: #666666 } /* Literal.Number.Hex */
body .mi { color: #666666 } /* Literal.Number.Integer */
body .mo { color: #666666 } /* Literal.Number.Oct */
body .sa { color: #BA2121 } /* Literal.String.Affix */
body .sb { color: #BA2121 } /* Literal.String.Backtick */
body .sc { color: #BA2121 } /* Literal.String.Char */
body .dl { color: #BA2121 } /* Literal.String.Delimiter */
body .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
body .s2 { color: #BA2121 } /* Literal.String.Double */
body .se { color: #AA5D1F; font-weight: bold } /* Literal.String.Escape */
body .sh { color: #BA2121 } /* Literal.String.Heredoc */
body .si { color: #A45A77; font-weight: bold } /* Literal.String.Interpol */
body .sx { color: #008000 } /* Literal.String.Other */
body .sr { color: #A45A77 } /* Literal.String.Regex */
body .s1 { color: #BA2121 } /* Literal.String.Single */
body .ss { color: #19177C } /* Literal.String.Symbol */
body .bp { color: #008000 } /* Name.Builtin.Pseudo */
body .fm { color: #0000FF } /* Name.Function.Magic */
body .vc { color: #19177C } /* Name.Variable.Class */
body .vg { color: #19177C } /* Name.Variable.Global */
body .vi { color: #19177C } /* Name.Variable.Instance */
body .vm { color: #19177C } /* Name.Variable.Magic */
body .il { color: #666666 } /* Literal.Number.Integer.Long */

  </style>
</head>
<body>
<h2></h2>

<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">   1</span>
<span class="normal">   2</span>
<span class="normal">   3</span>
<span class="normal">   4</span>
<span class="normal">   5</span>
<span class="normal">   6</span>
<span class="normal">   7</span>
<span class="normal">   8</span>
<span class="normal">   9</span>
<span class="normal">  10</span>
<span class="normal">  11</span>
<span class="normal">  12</span>
<span class="normal">  13</span>
<span class="normal">  14</span>
<span class="normal">  15</span>
<span class="normal">  16</span>
<span class="normal">  17</span>
<span class="normal">  18</span>
<span class="normal">  19</span>
<span class="normal">  20</span>
<span class="normal">  21</span>
<span class="normal">  22</span>
<span class="normal">  23</span>
<span class="normal">  24</span>
<span class="normal">  25</span>
<span class="normal">  26</span>
<span class="normal">  27</span>
<span class="normal">  28</span>
<span class="normal">  29</span>
<span class="normal">  30</span>
<span class="normal">  31</span>
<span class="normal">  32</span>
<span class="normal">  33</span>
<span class="normal">  34</span>
<span class="normal">  35</span>
<span class="normal">  36</span>
<span class="normal">  37</span>
<span class="normal">  38</span>
<span class="normal">  39</span>
<span class="normal">  40</span>
<span class="normal">  41</span>
<span class="normal">  42</span>
<span class="normal">  43</span>
<span class="normal">  44</span>
<span class="normal">  45</span>
<span class="normal">  46</span>
<span class="normal">  47</span>
<span class="normal">  48</span>
<span class="normal">  49</span>
<span class="normal">  50</span>
<span class="normal">  51</span>
<span class="normal">  52</span>
<span class="normal">  53</span>
<span class="normal">  54</span>
<span class="normal">  55</span>
<span class="normal">  56</span>
<span class="normal">  57</span>
<span class="normal">  58</span>
<span class="normal">  59</span>
<span class="normal">  60</span>
<span class="normal">  61</span>
<span class="normal">  62</span>
<span class="normal">  63</span>
<span class="normal">  64</span>
<span class="normal">  65</span>
<span class="normal">  66</span>
<span class="normal">  67</span>
<span class="normal">  68</span>
<span class="normal">  69</span>
<span class="normal">  70</span>
<span class="normal">  71</span>
<span class="normal">  72</span>
<span class="normal">  73</span>
<span class="normal">  74</span>
<span class="normal">  75</span>
<span class="normal">  76</span>
<span class="normal">  77</span>
<span class="normal">  78</span>
<span class="normal">  79</span>
<span class="normal">  80</span>
<span class="normal">  81</span>
<span class="normal">  82</span>
<span class="normal">  83</span>
<span class="normal">  84</span>
<span class="normal">  85</span>
<span class="normal">  86</span>
<span class="normal">  87</span>
<span class="normal">  88</span>
<span class="normal">  89</span>
<span class="normal">  90</span>
<span class="normal">  91</span>
<span class="normal">  92</span>
<span class="normal">  93</span>
<span class="normal">  94</span>
<span class="normal">  95</span>
<span class="normal">  96</span>
<span class="normal">  97</span>
<span class="normal">  98</span>
<span class="normal">  99</span>
<span class="normal"> 100</span>
<span class="normal"> 101</span>
<span class="normal"> 102</span>
<span class="normal"> 103</span>
<span class="normal"> 104</span>
<span class="normal"> 105</span>
<span class="normal"> 106</span>
<span class="normal"> 107</span>
<span class="normal"> 108</span>
<span class="normal"> 109</span>
<span class="normal"> 110</span>
<span class="normal"> 111</span>
<span class="normal"> 112</span>
<span class="normal"> 113</span>
<span class="normal"> 114</span>
<span class="normal"> 115</span>
<span class="normal"> 116</span>
<span class="normal"> 117</span>
<span class="normal"> 118</span>
<span class="normal"> 119</span>
<span class="normal"> 120</span>
<span class="normal"> 121</span>
<span class="normal"> 122</span>
<span class="normal"> 123</span>
<span class="normal"> 124</span>
<span class="normal"> 125</span>
<span class="normal"> 126</span>
<span class="normal"> 127</span>
<span class="normal"> 128</span>
<span class="normal"> 129</span>
<span class="normal"> 130</span>
<span class="normal"> 131</span>
<span class="normal"> 132</span>
<span class="normal"> 133</span>
<span class="normal"> 134</span>
<span class="normal"> 135</span>
<span class="normal"> 136</span>
<span class="normal"> 137</span>
<span class="normal"> 138</span>
<span class="normal"> 139</span>
<span class="normal"> 140</span>
<span class="normal"> 141</span>
<span class="normal"> 142</span>
<span class="normal"> 143</span>
<span class="normal"> 144</span>
<span class="normal"> 145</span>
<span class="normal"> 146</span>
<span class="normal"> 147</span>
<span class="normal"> 148</span>
<span class="normal"> 149</span>
<span class="normal"> 150</span>
<span class="normal"> 151</span>
<span class="normal"> 152</span>
<span class="normal"> 153</span>
<span class="normal"> 154</span>
<span class="normal"> 155</span>
<span class="normal"> 156</span>
<span class="normal"> 157</span>
<span class="normal"> 158</span>
<span class="normal"> 159</span>
<span class="normal"> 160</span>
<span class="normal"> 161</span>
<span class="normal"> 162</span>
<span class="normal"> 163</span>
<span class="normal"> 164</span>
<span class="normal"> 165</span>
<span class="normal"> 166</span>
<span class="normal"> 167</span>
<span class="normal"> 168</span>
<span class="normal"> 169</span>
<span class="normal"> 170</span>
<span class="normal"> 171</span>
<span class="normal"> 172</span>
<span class="normal"> 173</span>
<span class="normal"> 174</span>
<span class="normal"> 175</span>
<span class="normal"> 176</span>
<span class="normal"> 177</span>
<span class="normal"> 178</span>
<span class="normal"> 179</span>
<span class="normal"> 180</span>
<span class="normal"> 181</span>
<span class="normal"> 182</span>
<span class="normal"> 183</span>
<span class="normal"> 184</span>
<span class="normal"> 185</span>
<span class="normal"> 186</span>
<span class="normal"> 187</span>
<span class="normal"> 188</span>
<span class="normal"> 189</span>
<span class="normal"> 190</span>
<span class="normal"> 191</span>
<span class="normal"> 192</span>
<span class="normal"> 193</span>
<span class="normal"> 194</span>
<span class="normal"> 195</span>
<span class="normal"> 196</span>
<span class="normal"> 197</span>
<span class="normal"> 198</span>
<span class="normal"> 199</span>
<span class="normal"> 200</span>
<span class="normal"> 201</span>
<span class="normal"> 202</span>
<span class="normal"> 203</span>
<span class="normal"> 204</span>
<span class="normal"> 205</span>
<span class="normal"> 206</span>
<span class="normal"> 207</span>
<span class="normal"> 208</span>
<span class="normal"> 209</span>
<span class="normal"> 210</span>
<span class="normal"> 211</span>
<span class="normal"> 212</span>
<span class="normal"> 213</span>
<span class="normal"> 214</span>
<span class="normal"> 215</span>
<span class="normal"> 216</span>
<span class="normal"> 217</span>
<span class="normal"> 218</span>
<span class="normal"> 219</span>
<span class="normal"> 220</span>
<span class="normal"> 221</span>
<span class="normal"> 222</span>
<span class="normal"> 223</span>
<span class="normal"> 224</span>
<span class="normal"> 225</span>
<span class="normal"> 226</span>
<span class="normal"> 227</span>
<span class="normal"> 228</span>
<span class="normal"> 229</span>
<span class="normal"> 230</span>
<span class="normal"> 231</span>
<span class="normal"> 232</span>
<span class="normal"> 233</span>
<span class="normal"> 234</span>
<span class="normal"> 235</span>
<span class="normal"> 236</span>
<span class="normal"> 237</span>
<span class="normal"> 238</span>
<span class="normal"> 239</span>
<span class="normal"> 240</span>
<span class="normal"> 241</span>
<span class="normal"> 242</span>
<span class="normal"> 243</span>
<span class="normal"> 244</span>
<span class="normal"> 245</span>
<span class="normal"> 246</span>
<span class="normal"> 247</span>
<span class="normal"> 248</span>
<span class="normal"> 249</span>
<span class="normal"> 250</span>
<span class="normal"> 251</span>
<span class="normal"> 252</span>
<span class="normal"> 253</span>
<span class="normal"> 254</span>
<span class="normal"> 255</span>
<span class="normal"> 256</span>
<span class="normal"> 257</span>
<span class="normal"> 258</span>
<span class="normal"> 259</span>
<span class="normal"> 260</span>
<span class="normal"> 261</span>
<span class="normal"> 262</span>
<span class="normal"> 263</span>
<span class="normal"> 264</span>
<span class="normal"> 265</span>
<span class="normal"> 266</span>
<span class="normal"> 267</span>
<span class="normal"> 268</span>
<span class="normal"> 269</span>
<span class="normal"> 270</span>
<span class="normal"> 271</span>
<span class="normal"> 272</span>
<span class="normal"> 273</span>
<span class="normal"> 274</span>
<span class="normal"> 275</span>
<span class="normal"> 276</span>
<span class="normal"> 277</span>
<span class="normal"> 278</span>
<span class="normal"> 279</span>
<span class="normal"> 280</span>
<span class="normal"> 281</span>
<span class="normal"> 282</span>
<span class="normal"> 283</span>
<span class="normal"> 284</span>
<span class="normal"> 285</span>
<span class="normal"> 286</span>
<span class="normal"> 287</span>
<span class="normal"> 288</span>
<span class="normal"> 289</span>
<span class="normal"> 290</span>
<span class="normal"> 291</span>
<span class="normal"> 292</span>
<span class="normal"> 293</span>
<span class="normal"> 294</span>
<span class="normal"> 295</span>
<span class="normal"> 296</span>
<span class="normal"> 297</span>
<span class="normal"> 298</span>
<span class="normal"> 299</span>
<span class="normal"> 300</span>
<span class="normal"> 301</span>
<span class="normal"> 302</span>
<span class="normal"> 303</span>
<span class="normal"> 304</span>
<span class="normal"> 305</span>
<span class="normal"> 306</span>
<span class="normal"> 307</span>
<span class="normal"> 308</span>
<span class="normal"> 309</span>
<span class="normal"> 310</span>
<span class="normal"> 311</span>
<span class="normal"> 312</span>
<span class="normal"> 313</span>
<span class="normal"> 314</span>
<span class="normal"> 315</span>
<span class="normal"> 316</span>
<span class="normal"> 317</span>
<span class="normal"> 318</span>
<span class="normal"> 319</span>
<span class="normal"> 320</span>
<span class="normal"> 321</span>
<span class="normal"> 322</span>
<span class="normal"> 323</span>
<span class="normal"> 324</span>
<span class="normal"> 325</span>
<span class="normal"> 326</span>
<span class="normal"> 327</span>
<span class="normal"> 328</span>
<span class="normal"> 329</span>
<span class="normal"> 330</span>
<span class="normal"> 331</span>
<span class="normal"> 332</span>
<span class="normal"> 333</span>
<span class="normal"> 334</span>
<span class="normal"> 335</span>
<span class="normal"> 336</span>
<span class="normal"> 337</span>
<span class="normal"> 338</span>
<span class="normal"> 339</span>
<span class="normal"> 340</span>
<span class="normal"> 341</span>
<span class="normal"> 342</span>
<span class="normal"> 343</span>
<span class="normal"> 344</span>
<span class="normal"> 345</span>
<span class="normal"> 346</span>
<span class="normal"> 347</span>
<span class="normal"> 348</span>
<span class="normal"> 349</span>
<span class="normal"> 350</span>
<span class="normal"> 351</span>
<span class="normal"> 352</span>
<span class="normal"> 353</span>
<span class="normal"> 354</span>
<span class="normal"> 355</span>
<span class="normal"> 356</span>
<span class="normal"> 357</span>
<span class="normal"> 358</span>
<span class="normal"> 359</span>
<span class="normal"> 360</span>
<span class="normal"> 361</span>
<span class="normal"> 362</span>
<span class="normal"> 363</span>
<span class="normal"> 364</span>
<span class="normal"> 365</span>
<span class="normal"> 366</span>
<span class="normal"> 367</span>
<span class="normal"> 368</span>
<span class="normal"> 369</span>
<span class="normal"> 370</span>
<span class="normal"> 371</span>
<span class="normal"> 372</span>
<span class="normal"> 373</span>
<span class="normal"> 374</span>
<span class="normal"> 375</span>
<span class="normal"> 376</span>
<span class="normal"> 377</span>
<span class="normal"> 378</span>
<span class="normal"> 379</span>
<span class="normal"> 380</span>
<span class="normal"> 381</span>
<span class="normal"> 382</span>
<span class="normal"> 383</span>
<span class="normal"> 384</span>
<span class="normal"> 385</span>
<span class="normal"> 386</span>
<span class="normal"> 387</span>
<span class="normal"> 388</span>
<span class="normal"> 389</span>
<span class="normal"> 390</span>
<span class="normal"> 391</span>
<span class="normal"> 392</span>
<span class="normal"> 393</span>
<span class="normal"> 394</span>
<span class="normal"> 395</span>
<span class="normal"> 396</span>
<span class="normal"> 397</span>
<span class="normal"> 398</span>
<span class="normal"> 399</span>
<span class="normal"> 400</span>
<span class="normal"> 401</span>
<span class="normal"> 402</span>
<span class="normal"> 403</span>
<span class="normal"> 404</span>
<span class="normal"> 405</span>
<span class="normal"> 406</span>
<span class="normal"> 407</span>
<span class="normal"> 408</span>
<span class="normal"> 409</span>
<span class="normal"> 410</span>
<span class="normal"> 411</span>
<span class="normal"> 412</span>
<span class="normal"> 413</span>
<span class="normal"> 414</span>
<span class="normal"> 415</span>
<span class="normal"> 416</span>
<span class="normal"> 417</span>
<span class="normal"> 418</span>
<span class="normal"> 419</span>
<span class="normal"> 420</span>
<span class="normal"> 421</span>
<span class="normal"> 422</span>
<span class="normal"> 423</span>
<span class="normal"> 424</span>
<span class="normal"> 425</span>
<span class="normal"> 426</span>
<span class="normal"> 427</span>
<span class="normal"> 428</span>
<span class="normal"> 429</span>
<span class="normal"> 430</span>
<span class="normal"> 431</span>
<span class="normal"> 432</span>
<span class="normal"> 433</span>
<span class="normal"> 434</span>
<span class="normal"> 435</span>
<span class="normal"> 436</span>
<span class="normal"> 437</span>
<span class="normal"> 438</span>
<span class="normal"> 439</span>
<span class="normal"> 440</span>
<span class="normal"> 441</span>
<span class="normal"> 442</span>
<span class="normal"> 443</span>
<span class="normal"> 444</span>
<span class="normal"> 445</span>
<span class="normal"> 446</span>
<span class="normal"> 447</span>
<span class="normal"> 448</span>
<span class="normal"> 449</span>
<span class="normal"> 450</span>
<span class="normal"> 451</span>
<span class="normal"> 452</span>
<span class="normal"> 453</span>
<span class="normal"> 454</span>
<span class="normal"> 455</span>
<span class="normal"> 456</span>
<span class="normal"> 457</span>
<span class="normal"> 458</span>
<span class="normal"> 459</span>
<span class="normal"> 460</span>
<span class="normal"> 461</span>
<span class="normal"> 462</span>
<span class="normal"> 463</span>
<span class="normal"> 464</span>
<span class="normal"> 465</span>
<span class="normal"> 466</span>
<span class="normal"> 467</span>
<span class="normal"> 468</span>
<span class="normal"> 469</span>
<span class="normal"> 470</span>
<span class="normal"> 471</span>
<span class="normal"> 472</span>
<span class="normal"> 473</span>
<span class="normal"> 474</span>
<span class="normal"> 475</span>
<span class="normal"> 476</span>
<span class="normal"> 477</span>
<span class="normal"> 478</span>
<span class="normal"> 479</span>
<span class="normal"> 480</span>
<span class="normal"> 481</span>
<span class="normal"> 482</span>
<span class="normal"> 483</span>
<span class="normal"> 484</span>
<span class="normal"> 485</span>
<span class="normal"> 486</span>
<span class="normal"> 487</span>
<span class="normal"> 488</span>
<span class="normal"> 489</span>
<span class="normal"> 490</span>
<span class="normal"> 491</span>
<span class="normal"> 492</span>
<span class="normal"> 493</span>
<span class="normal"> 494</span>
<span class="normal"> 495</span>
<span class="normal"> 496</span>
<span class="normal"> 497</span>
<span class="normal"> 498</span>
<span class="normal"> 499</span>
<span class="normal"> 500</span>
<span class="normal"> 501</span>
<span class="normal"> 502</span>
<span class="normal"> 503</span>
<span class="normal"> 504</span>
<span class="normal"> 505</span>
<span class="normal"> 506</span>
<span class="normal"> 507</span>
<span class="normal"> 508</span>
<span class="normal"> 509</span>
<span class="normal"> 510</span>
<span class="normal"> 511</span>
<span class="normal"> 512</span>
<span class="normal"> 513</span>
<span class="normal"> 514</span>
<span class="normal"> 515</span>
<span class="normal"> 516</span>
<span class="normal"> 517</span>
<span class="normal"> 518</span>
<span class="normal"> 519</span>
<span class="normal"> 520</span>
<span class="normal"> 521</span>
<span class="normal"> 522</span>
<span class="normal"> 523</span>
<span class="normal"> 524</span>
<span class="normal"> 525</span>
<span class="normal"> 526</span>
<span class="normal"> 527</span>
<span class="normal"> 528</span>
<span class="normal"> 529</span>
<span class="normal"> 530</span>
<span class="normal"> 531</span>
<span class="normal"> 532</span>
<span class="normal"> 533</span>
<span class="normal"> 534</span>
<span class="normal"> 535</span>
<span class="normal"> 536</span>
<span class="normal"> 537</span>
<span class="normal"> 538</span>
<span class="normal"> 539</span>
<span class="normal"> 540</span>
<span class="normal"> 541</span>
<span class="normal"> 542</span>
<span class="normal"> 543</span>
<span class="normal"> 544</span>
<span class="normal"> 545</span>
<span class="normal"> 546</span>
<span class="normal"> 547</span>
<span class="normal"> 548</span>
<span class="normal"> 549</span>
<span class="normal"> 550</span>
<span class="normal"> 551</span>
<span class="normal"> 552</span>
<span class="normal"> 553</span>
<span class="normal"> 554</span>
<span class="normal"> 555</span>
<span class="normal"> 556</span>
<span class="normal"> 557</span>
<span class="normal"> 558</span>
<span class="normal"> 559</span>
<span class="normal"> 560</span>
<span class="normal"> 561</span>
<span class="normal"> 562</span>
<span class="normal"> 563</span>
<span class="normal"> 564</span>
<span class="normal"> 565</span>
<span class="normal"> 566</span>
<span class="normal"> 567</span>
<span class="normal"> 568</span>
<span class="normal"> 569</span>
<span class="normal"> 570</span>
<span class="normal"> 571</span>
<span class="normal"> 572</span>
<span class="normal"> 573</span>
<span class="normal"> 574</span>
<span class="normal"> 575</span>
<span class="normal"> 576</span>
<span class="normal"> 577</span>
<span class="normal"> 578</span>
<span class="normal"> 579</span>
<span class="normal"> 580</span>
<span class="normal"> 581</span>
<span class="normal"> 582</span>
<span class="normal"> 583</span>
<span class="normal"> 584</span>
<span class="normal"> 585</span>
<span class="normal"> 586</span>
<span class="normal"> 587</span>
<span class="normal"> 588</span>
<span class="normal"> 589</span>
<span class="normal"> 590</span>
<span class="normal"> 591</span>
<span class="normal"> 592</span>
<span class="normal"> 593</span>
<span class="normal"> 594</span>
<span class="normal"> 595</span>
<span class="normal"> 596</span>
<span class="normal"> 597</span>
<span class="normal"> 598</span>
<span class="normal"> 599</span>
<span class="normal"> 600</span>
<span class="normal"> 601</span>
<span class="normal"> 602</span>
<span class="normal"> 603</span>
<span class="normal"> 604</span>
<span class="normal"> 605</span>
<span class="normal"> 606</span>
<span class="normal"> 607</span>
<span class="normal"> 608</span>
<span class="normal"> 609</span>
<span class="normal"> 610</span>
<span class="normal"> 611</span>
<span class="normal"> 612</span>
<span class="normal"> 613</span>
<span class="normal"> 614</span>
<span class="normal"> 615</span>
<span class="normal"> 616</span>
<span class="normal"> 617</span>
<span class="normal"> 618</span>
<span class="normal"> 619</span>
<span class="normal"> 620</span>
<span class="normal"> 621</span>
<span class="normal"> 622</span>
<span class="normal"> 623</span>
<span class="normal"> 624</span>
<span class="normal"> 625</span>
<span class="normal"> 626</span>
<span class="normal"> 627</span>
<span class="normal"> 628</span>
<span class="normal"> 629</span>
<span class="normal"> 630</span>
<span class="normal"> 631</span>
<span class="normal"> 632</span>
<span class="normal"> 633</span>
<span class="normal"> 634</span>
<span class="normal"> 635</span>
<span class="normal"> 636</span>
<span class="normal"> 637</span>
<span class="normal"> 638</span>
<span class="normal"> 639</span>
<span class="normal"> 640</span>
<span class="normal"> 641</span>
<span class="normal"> 642</span>
<span class="normal"> 643</span>
<span class="normal"> 644</span>
<span class="normal"> 645</span>
<span class="normal"> 646</span>
<span class="normal"> 647</span>
<span class="normal"> 648</span>
<span class="normal"> 649</span>
<span class="normal"> 650</span>
<span class="normal"> 651</span>
<span class="normal"> 652</span>
<span class="normal"> 653</span>
<span class="normal"> 654</span>
<span class="normal"> 655</span>
<span class="normal"> 656</span>
<span class="normal"> 657</span>
<span class="normal"> 658</span>
<span class="normal"> 659</span>
<span class="normal"> 660</span>
<span class="normal"> 661</span>
<span class="normal"> 662</span>
<span class="normal"> 663</span>
<span class="normal"> 664</span>
<span class="normal"> 665</span>
<span class="normal"> 666</span>
<span class="normal"> 667</span>
<span class="normal"> 668</span>
<span class="normal"> 669</span>
<span class="normal"> 670</span>
<span class="normal"> 671</span>
<span class="normal"> 672</span>
<span class="normal"> 673</span>
<span class="normal"> 674</span>
<span class="normal"> 675</span>
<span class="normal"> 676</span>
<span class="normal"> 677</span>
<span class="normal"> 678</span>
<span class="normal"> 679</span>
<span class="normal"> 680</span>
<span class="normal"> 681</span>
<span class="normal"> 682</span>
<span class="normal"> 683</span>
<span class="normal"> 684</span>
<span class="normal"> 685</span>
<span class="normal"> 686</span>
<span class="normal"> 687</span>
<span class="normal"> 688</span>
<span class="normal"> 689</span>
<span class="normal"> 690</span>
<span class="normal"> 691</span>
<span class="normal"> 692</span>
<span class="normal"> 693</span>
<span class="normal"> 694</span>
<span class="normal"> 695</span>
<span class="normal"> 696</span>
<span class="normal"> 697</span>
<span class="normal"> 698</span>
<span class="normal"> 699</span>
<span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span></pre></div></td><td class="code"><div><pre><span></span><span class="cm">/*</span>
<span class="cm"> * Copyright (c) 2001-2017, Zoltan Farkas All Rights Reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * This library is free software; you can redistribute it and/or</span>
<span class="cm"> * modify it under the terms of the GNU Lesser General Public</span>
<span class="cm"> * License as published by the Free Software Foundation; either</span>
<span class="cm"> * version 2.1 of the License, or (at your option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> * This library is distributed in the hope that it will be useful,</span>
<span class="cm"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> * GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU Lesser General Public</span>
<span class="cm"> * License along with this program; if not, write to the Free Software</span>
<span class="cm"> * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.</span>
<span class="cm"> *</span>
<span class="cm"> * Additionally licensed with:</span>
<span class="cm"> *</span>
<span class="cm"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="cm"> * you may not use this file except in compliance with the License.</span>
<span class="cm"> * You may obtain a copy of the License at</span>
<span class="cm"> *</span>
<span class="cm"> *      http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="cm"> *</span>
<span class="cm"> * Unless required by applicable law or agreed to in writing, software</span>
<span class="cm"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="cm"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="cm"> * See the License for the specific language governing permissions and</span>
<span class="cm"> * limitations under the License.</span>
<span class="cm"> */</span><span class="w"></span>
<span class="kn">package</span><span class="w"> </span><span class="nn">org.spf4j.text</span><span class="p">;</span><span class="w"></span>
<span class="c1">//CHECKSTYLE:OFF</span><span class="w"></span>
<span class="cm">/*</span>
<span class="cm"> * Copyright (c) 1996, 2013, Oracle and/or its affiliates. All rights reserved.</span>
<span class="cm"> * ORACLE PROPRIETARY/CONFIDENTIAL. Use is subject to license terms.</span>
<span class="cm"> */</span><span class="w"></span>

<span class="w"> </span><span class="cm">/*</span>
<span class="cm"> * (C) Copyright Taligent, Inc. 1996, 1997 - All Rights Reserved</span>
<span class="cm"> * (C) Copyright IBM Corp. 1996 - 1998 - All Rights Reserved</span>
<span class="cm"> *</span>
<span class="cm"> *   The original version of this source code and documentation is copyrighted</span>
<span class="cm"> * and owned by Taligent, Inc., a wholly-owned subsidiary of IBM. These</span>
<span class="cm"> * materials are provided under terms of a License Agreement between Taligent</span>
<span class="cm"> * and Sun. This technology is protected by multiple US and International</span>
<span class="cm"> * patents. This notice and attribution to Taligent may not be removed.</span>
<span class="cm"> *   Taligent is a registered trademark of Taligent, Inc.</span>
<span class="cm"> *</span>
<span class="cm"> */</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">edu.umd.cs.findbugs.annotations.SuppressFBWarnings</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.io.InvalidObjectException</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.io.IOException</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.io.ObjectInputStream</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.io.UncheckedIOException</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.text.AttributedCharacterIterator</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.text.CharacterIterator</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.text.ChoiceFormat</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.text.DateFormat</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.text.DecimalFormat</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.text.DecimalFormatSymbols</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.text.FieldPosition</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.text.Format</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.text.NumberFormat</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.text.ParseException</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.text.ParsePosition</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.text.SimpleDateFormat</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.ArrayList</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Arrays</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.BitSet</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Date</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.List</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Locale</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">javax.annotation.Nonnull</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">javax.annotation.Nullable</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">javax.annotation.concurrent.NotThreadSafe</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.spf4j.base.CharSequences</span><span class="p">;</span><span class="w"></span>

<span class="cm">/**</span>
<span class="cm"> * Performance mutation of the JDK message formatter.</span>
<span class="cm"> * Lots things of things have been done:</span>
<span class="cm"> * 1) reduced the amount of garbage generated during formatting.</span>
<span class="cm"> * 2) made some method invocations static.</span>
<span class="cm"> * 3) made this more flexible and usable against StringBuilder not only StringBuffer...</span>
<span class="cm"> * 4) thrown exceptions provide more detail on what went wrong.</span>
<span class="cm"> * 5) cleaned up lots of static analisys reported issues.</span>
<span class="cm"> *</span>
<span class="cm"> * &lt;code&gt;MessageFormat&lt;/code&gt; provides a means to produce concatenated messages in a language-neutral way. Use this to</span>
<span class="cm"> * construct messages displayed for end users.</span>
<span class="cm"> *</span>
<span class="cm"> * this implementation is based on java.text.MessageFormat with the goal to be a faster and more flexible implementation</span>
<span class="cm"> *</span>
<span class="cm"> * &lt;p&gt;</span>
<span class="cm"> * &lt;code&gt;MessageFormat&lt;/code&gt; takes a set of objects, formats them, then inserts the formatted strings into the pattern</span>
<span class="cm"> * at the appropriate places.</span>
<span class="cm"> *</span>
<span class="cm"> * &lt;p&gt;</span>
<span class="cm"> * &lt;strong&gt;Note:&lt;/strong&gt;</span>
<span class="cm"> * &lt;code&gt;MessageFormat&lt;/code&gt; differs from the other &lt;code&gt;Format&lt;/code&gt; classes in that you create a</span>
<span class="cm"> * &lt;code&gt;MessageFormat&lt;/code&gt; object with one of its constructors (not with a &lt;code&gt;getInstance&lt;/code&gt; style factory</span>
<span class="cm"> * method). The factory methods aren&#39;t necessary because &lt;code&gt;MessageFormat&lt;/code&gt; itself doesn&#39;t implement locale</span>
<span class="cm"> * specific behavior. Any locale specific behavior is defined by the pattern that you provide as well as the sub-formats</span>
<span class="cm"> * used for inserted arguments.</span>
<span class="cm"> *</span>
<span class="cm"> * &lt;h3&gt;&lt;a name=&quot;patterns&quot;&gt;Patterns and Their Interpretation&lt;/a&gt;&lt;/h3&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * &lt;code&gt;MessageFormat&lt;/code&gt; uses patterns of the following form:</span>
<span class="cm"> * &lt;blockquote&gt;&lt;pre&gt;</span>
<span class="cm"> * &lt;i&gt;MessageFormatPattern:&lt;/i&gt;</span>
<span class="cm"> *         &lt;i&gt;String&lt;/i&gt;</span>
<span class="cm"> *         &lt;i&gt;MessageFormatPattern&lt;/i&gt; &lt;i&gt;FormatElement&lt;/i&gt; &lt;i&gt;String&lt;/i&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * &lt;i&gt;FormatElement:&lt;/i&gt;</span>
<span class="cm"> *         { &lt;i&gt;ArgumentIndex&lt;/i&gt; }</span>
<span class="cm"> *         { &lt;i&gt;ArgumentIndex&lt;/i&gt; , &lt;i&gt;FormatType&lt;/i&gt; }</span>
<span class="cm"> *         { &lt;i&gt;ArgumentIndex&lt;/i&gt; , &lt;i&gt;FormatType&lt;/i&gt; , &lt;i&gt;FormatStyle&lt;/i&gt; }</span>
<span class="cm"> *</span>
<span class="cm"> * &lt;i&gt;FormatType: one of &lt;/i&gt;</span>
<span class="cm"> *         number date time choice</span>
<span class="cm"> *</span>
<span class="cm"> * &lt;i&gt;FormatStyle:&lt;/i&gt;</span>
<span class="cm"> *         short</span>
<span class="cm"> *         medium</span>
<span class="cm"> *         long</span>
<span class="cm"> *         full</span>
<span class="cm"> *         integer</span>
<span class="cm"> *         currency</span>
<span class="cm"> *         percent</span>
<span class="cm"> *         &lt;i&gt;SubformatPattern&lt;/i&gt;</span>
<span class="cm"> * &lt;/pre&gt;&lt;/blockquote&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * &lt;p&gt;</span>
<span class="cm"> * Within a &lt;i&gt;String&lt;/i&gt;, a pair of single quotes can be used to quote any arbitrary characters except single quotes.</span>
<span class="cm"> * For example, pattern string &lt;code&gt;&quot;&#39;{0}&#39;&quot;&lt;/code&gt; represents string &lt;code&gt;&quot;{0}&quot;&lt;/code&gt;, not a &lt;i&gt;FormatElement&lt;/i&gt;. A</span>
<span class="cm"> * single quote itself must be represented by doubled single quotes {@code &#39;&#39;} throughout a</span>
<span class="cm"> * &lt;i&gt;String&lt;/i&gt;. For example, pattern string &lt;code&gt;&quot;&#39;{&#39;&#39;}&#39;&quot;&lt;/code&gt; is interpreted as a sequence of &lt;code&gt;&#39;{&lt;/code&gt;</span>
<span class="cm"> * (start of quoting and a left curly brace), &lt;code&gt;&#39;&#39;&lt;/code&gt; (a single quote), and &lt;code&gt;}&#39;&lt;/code&gt; (a right curly brace</span>
<span class="cm"> * and end of quoting),</span>
<span class="cm"> * &lt;em&gt;not&lt;/em&gt; &lt;code&gt;&#39;{&#39;&lt;/code&gt; and &lt;code&gt;&#39;}&#39;&lt;/code&gt; (quoted left and right curly braces): representing string</span>
<span class="cm"> * &lt;code&gt;&quot;{&#39;}&quot;&lt;/code&gt;,</span>
<span class="cm"> * &lt;em&gt;not&lt;/em&gt; &lt;code&gt;&quot;{}&quot;&lt;/code&gt;.</span>
<span class="cm"> *</span>
<span class="cm"> * &lt;p&gt;</span>
<span class="cm"> * A &lt;i&gt;SubformatPattern&lt;/i&gt; is interpreted by its corresponding sub-format, and sub-format-dependent pattern rules</span>
<span class="cm"> * apply. For example, pattern string &lt;code&gt;&quot;{1,number,&lt;u&gt;$&#39;#&#39;,##&lt;/u&gt;}&quot;&lt;/code&gt; (&lt;i&gt;SubformatPattern&lt;/i&gt; with underline)</span>
<span class="cm"> * will produce a number format with the pound-sign quoted, with a result such as: {@code</span>
<span class="cm"> * &quot;$#31,45&quot;}. Refer to each {@code Format} subclass documentation for details.</span>
<span class="cm"> *</span>
<span class="cm"> * &lt;p&gt;</span>
<span class="cm"> * Any unmatched quote is treated as closed at the end of the given pattern. For example, pattern string {@code &quot;&#39;{0}&quot;}</span>
<span class="cm"> * is treated as pattern {@code &quot;&#39;{0}&#39;&quot;}.</span>
<span class="cm"> *</span>
<span class="cm"> * &lt;p&gt;</span>
<span class="cm"> * Any curly braces within an unquoted pattern must be balanced. For example, &lt;code&gt;&quot;ab {0} de&quot;&lt;/code&gt; and</span>
<span class="cm"> * &lt;code&gt;&quot;ab &#39;}&#39; de&quot;&lt;/code&gt; are valid patterns, but &lt;code&gt;&quot;ab {0&#39;}&#39; de&quot;&lt;/code&gt;, &lt;code&gt;&quot;ab } de&quot;&lt;/code&gt; and</span>
<span class="cm"> * &lt;code&gt;&quot;&#39;&#39;{&#39;&#39;&quot;&lt;/code&gt; are not.</span>
<span class="cm"> *</span>
<span class="cm"> * &lt;dl&gt;&lt;dt&gt;&lt;b&gt;Warning:&lt;/b&gt;&lt;dd&gt;The rules for using quotes within message format patterns unfortunately have shown to be</span>
<span class="cm"> * somewhat confusing. In particular, it isn&#39;t always obvious to localizers whether single quotes need to be doubled or</span>
<span class="cm"> * not. Make sure to inform localizers about the rules, and tell them (for example, by using comments in resource bundle</span>
<span class="cm"> * source files) which strings will be processed by {@code MessageFormat}. Note that localizers may need to use single</span>
<span class="cm"> * quotes in translated strings where the original version doesn&#39;t have them.</span>
<span class="cm"> * &lt;/dl&gt;</span>
<span class="cm"> * &lt;p&gt;</span>
<span class="cm"> * The &lt;i&gt;ArgumentIndex&lt;/i&gt; value is a non-negative integer written using the digits {@code &#39;0&#39;} through {@code &#39;9&#39;},</span>
<span class="cm"> * and represents an index into the {@code arguments} array passed to the {@code format} methods or the result array</span>
<span class="cm"> * returned by the {@code parse} methods.</span>
<span class="cm"> * &lt;p&gt;</span>
<span class="cm"> * The &lt;i&gt;FormatType&lt;/i&gt; and &lt;i&gt;FormatStyle&lt;/i&gt; values are used to create a {@code Format} instance for the format</span>
<span class="cm"> * element. The following table shows how the values map to {@code Format} instances. Combinations not shown in the</span>
<span class="cm"> * table are illegal. A &lt;i&gt;SubformatPattern&lt;/i&gt; must be a valid pattern string for the {@code Format} subclass used.</span>
<span class="cm"> *</span>
<span class="cm"> * &lt;table border=1 summary=&quot;Shows how FormatType and FormatStyle values map to Format instances&quot;&gt;</span>
<span class="cm"> * &lt;tr&gt;</span>
<span class="cm"> * &lt;th id=&quot;ft&quot; class=&quot;TableHeadingColor&quot;&gt;FormatType</span>
<span class="cm"> * &lt;th id=&quot;fs&quot; class=&quot;TableHeadingColor&quot;&gt;FormatStyle</span>
<span class="cm"> * &lt;th id=&quot;sc&quot; class=&quot;TableHeadingColor&quot;&gt;Subformat Created</span>
<span class="cm"> * &lt;tr&gt;</span>
<span class="cm"> * &lt;td headers=&quot;ft&quot;&gt;&lt;i&gt;(none)&lt;/i&gt;</span>
<span class="cm"> * &lt;td headers=&quot;fs&quot;&gt;&lt;i&gt;(none)&lt;/i&gt;</span>
<span class="cm"> * &lt;td headers=&quot;sc&quot;&gt;&lt;code&gt;null&lt;/code&gt;</span>
<span class="cm"> * &lt;tr&gt;</span>
<span class="cm"> * &lt;td headers=&quot;ft&quot; rowspan=5&gt;&lt;code&gt;number&lt;/code&gt;</span>
<span class="cm"> * &lt;td headers=&quot;fs&quot;&gt;&lt;i&gt;(none)&lt;/i&gt;</span>
<span class="cm"> * &lt;td headers=&quot;sc&quot;&gt;{@link NumberFormat#getInstance(Locale) NumberFormat.getInstance}{@code (getLocale())}</span>
<span class="cm"> * &lt;tr&gt;</span>
<span class="cm"> * &lt;td headers=&quot;fs&quot;&gt;&lt;code&gt;integer&lt;/code&gt;</span>
<span class="cm"> * &lt;td headers=&quot;sc&quot;&gt;{@link NumberFormat#getIntegerInstance(Locale) NumberFormat.getIntegerInstance}{@code (getLocale())}</span>
<span class="cm"> * &lt;tr&gt;</span>
<span class="cm"> * &lt;td headers=&quot;fs&quot;&gt;&lt;code&gt;currency&lt;/code&gt;</span>
<span class="cm"> * &lt;td headers=&quot;sc&quot;&gt;{@link NumberFormat#getCurrencyInstance(Locale) NumberFormat.getCurrencyInstance}</span>
<span class="cm"> * {@code (getLocale())}</span>
<span class="cm"> * &lt;tr&gt;</span>
<span class="cm"> * &lt;td headers=&quot;fs&quot;&gt;&lt;code&gt;percent&lt;/code&gt;</span>
<span class="cm"> * &lt;td headers=&quot;sc&quot;&gt;{@link NumberFormat#getPercentInstance(Locale) NumberFormat.getPercentInstance}{@code (getLocale())}</span>
<span class="cm"> * &lt;tr&gt;</span>
<span class="cm"> * &lt;td headers=&quot;fs&quot;&gt;&lt;i&gt;SubformatPattern&lt;/i&gt;</span>
<span class="cm"> * &lt;td headers=&quot;sc&quot;&gt;{@code new}</span>
<span class="cm"> * {@link DecimalFormat#DecimalFormat(String,DecimalFormatSymbols) DecimalFormat}{@code (subformatPattern,}</span>
<span class="cm"> * {@link DecimalFormatSymbols#getInstance(Locale) DecimalFormatSymbols.getInstance}{@code (getLocale()))}</span>
<span class="cm"> * &lt;tr&gt;</span>
<span class="cm"> * &lt;td headers=&quot;ft&quot; rowspan=6&gt;&lt;code&gt;date&lt;/code&gt;</span>
<span class="cm"> * &lt;td headers=&quot;fs&quot;&gt;&lt;i&gt;(none)&lt;/i&gt;</span>
<span class="cm"> * &lt;td headers=&quot;sc&quot;&gt;{@link DateFormat#getDateInstance(int,Locale) DateFormat.getDateInstance}</span>
<span class="cm"> * {@code (}{@link DateFormat#DEFAULT}{@code , getLocale())}</span>
<span class="cm"> * &lt;tr&gt;</span>
<span class="cm"> * &lt;td headers=&quot;fs&quot;&gt;&lt;code&gt;short&lt;/code&gt;</span>
<span class="cm"> * &lt;td headers=&quot;sc&quot;&gt;{@link DateFormat#getDateInstance(int,Locale) DateFormat.getDateInstance}</span>
<span class="cm"> * {@code (}{@link DateFormat#SHORT}{@code , getLocale())}</span>
<span class="cm"> * &lt;tr&gt;</span>
<span class="cm"> * &lt;td headers=&quot;fs&quot;&gt;&lt;code&gt;medium&lt;/code&gt;</span>
<span class="cm"> * &lt;td headers=&quot;sc&quot;&gt;{@link DateFormat#getDateInstance(int,Locale) DateFormat.getDateInstance}</span>
<span class="cm"> * {@code (}{@link DateFormat#DEFAULT}{@code , getLocale())}</span>
<span class="cm"> * &lt;tr&gt;</span>
<span class="cm"> * &lt;td headers=&quot;fs&quot;&gt;&lt;code&gt;long&lt;/code&gt;</span>
<span class="cm"> * &lt;td headers=&quot;sc&quot;&gt;{@link DateFormat#getDateInstance(int,Locale) DateFormat.getDateInstance}</span>
<span class="cm"> * {@code (}{@link DateFormat#LONG}{@code , getLocale())}</span>
<span class="cm"> * &lt;tr&gt;</span>
<span class="cm"> * &lt;td headers=&quot;fs&quot;&gt;&lt;code&gt;full&lt;/code&gt;</span>
<span class="cm"> * &lt;td headers=&quot;sc&quot;&gt;{@link DateFormat#getDateInstance(int,Locale) DateFormat.getDateInstance}</span>
<span class="cm"> * {@code (}{@link DateFormat#FULL}{@code , getLocale())}</span>
<span class="cm"> * &lt;tr&gt;</span>
<span class="cm"> * &lt;td headers=&quot;fs&quot;&gt;&lt;i&gt;SubformatPattern&lt;/i&gt;</span>
<span class="cm"> * &lt;td headers=&quot;sc&quot;&gt;{@code new}</span>
<span class="cm"> * {@link SimpleDateFormat#SimpleDateFormat(String,Locale) SimpleDateFormat}{@code (subformatPattern, getLocale())}</span>
<span class="cm"> * &lt;tr&gt;</span>
<span class="cm"> * &lt;td headers=&quot;ft&quot; rowspan=6&gt;&lt;code&gt;time&lt;/code&gt;</span>
<span class="cm"> * &lt;td headers=&quot;fs&quot;&gt;&lt;i&gt;(none)&lt;/i&gt;</span>
<span class="cm"> * &lt;td headers=&quot;sc&quot;&gt;{@link DateFormat#getTimeInstance(int,Locale) DateFormat.getTimeInstance}</span>
<span class="cm"> * {@code (}{@link DateFormat#DEFAULT}{@code , getLocale())}</span>
<span class="cm"> * &lt;tr&gt;</span>
<span class="cm"> * &lt;td headers=&quot;fs&quot;&gt;&lt;code&gt;short&lt;/code&gt;</span>
<span class="cm"> * &lt;td headers=&quot;sc&quot;&gt;{@link DateFormat#getTimeInstance(int,Locale) DateFormat.getTimeInstance}</span>
<span class="cm"> * {@code (}{@link DateFormat#SHORT}{@code , getLocale())}</span>
<span class="cm"> * &lt;tr&gt;</span>
<span class="cm"> * &lt;td headers=&quot;fs&quot;&gt;&lt;code&gt;medium&lt;/code&gt;</span>
<span class="cm"> * &lt;td headers=&quot;sc&quot;&gt;{@link DateFormat#getTimeInstance(int,Locale) DateFormat.getTimeInstance}</span>
<span class="cm"> * {@code (}{@link DateFormat#DEFAULT}{@code , getLocale())}</span>
<span class="cm"> * &lt;tr&gt;</span>
<span class="cm"> * &lt;td headers=&quot;fs&quot;&gt;&lt;code&gt;long&lt;/code&gt;</span>
<span class="cm"> * &lt;td headers=&quot;sc&quot;&gt;{@link DateFormat#getTimeInstance(int,Locale) DateFormat.getTimeInstance}</span>
<span class="cm"> * {@code (}{@link DateFormat#LONG}{@code , getLocale())}</span>
<span class="cm"> * &lt;tr&gt;</span>
<span class="cm"> * &lt;td headers=&quot;fs&quot;&gt;&lt;code&gt;full&lt;/code&gt;</span>
<span class="cm"> * &lt;td headers=&quot;sc&quot;&gt;{@link DateFormat#getTimeInstance(int,Locale) DateFormat.getTimeInstance}</span>
<span class="cm"> * {@code (}{@link DateFormat#FULL}{@code , getLocale())}</span>
<span class="cm"> * &lt;tr&gt;</span>
<span class="cm"> * &lt;td headers=&quot;fs&quot;&gt;&lt;i&gt;SubformatPattern&lt;/i&gt;</span>
<span class="cm"> * &lt;td headers=&quot;sc&quot;&gt;{@code new}</span>
<span class="cm"> * {@link SimpleDateFormat#SimpleDateFormat(String,Locale) SimpleDateFormat}{@code (subformatPattern, getLocale())}</span>
<span class="cm"> * &lt;tr&gt;</span>
<span class="cm"> * &lt;td headers=&quot;ft&quot;&gt;&lt;code&gt;choice&lt;/code&gt;</span>
<span class="cm"> * &lt;td headers=&quot;fs&quot;&gt;&lt;i&gt;SubformatPattern&lt;/i&gt;</span>
<span class="cm"> * &lt;td headers=&quot;sc&quot;&gt;{@code new} {@link ChoiceFormat#ChoiceFormat(String) ChoiceFormat}{@code (subformatPattern)}</span>
<span class="cm"> * &lt;/table&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * &lt;h4&gt;Usage Information&lt;/h4&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * &lt;p&gt;</span>
<span class="cm"> * Here are some examples of usage. In real internationalized programs, the message format pattern and other static</span>
<span class="cm"> * strings will, of course, be obtained from resource bundles. Other parameters will be dynamically determined at</span>
<span class="cm"> * runtime.</span>
<span class="cm"> * &lt;p&gt;</span>
<span class="cm"> * The first example uses the static method &lt;code&gt;MessageFormat.format&lt;/code&gt;, which internally creates a</span>
<span class="cm"> * &lt;code&gt;MessageFormat&lt;/code&gt; for one-time use:</span>
<span class="cm"> * &lt;blockquote&gt;&lt;pre&gt;</span>
<span class="cm"> * int planet = 7;</span>
<span class="cm"> * String event = &quot;a disturbance in the Force&quot;;</span>
<span class="cm"> *</span>
<span class="cm"> * String result = MessageFormat.format(</span>
<span class="cm"> *     &quot;At {1,time} on {1,date}, there was {2} on planet {0,number,integer}.&quot;,</span>
<span class="cm"> *     planet, new Date(), event);</span>
<span class="cm"> * &lt;/pre&gt;&lt;/blockquote&gt;</span>
<span class="cm"> * The output is:</span>
<span class="cm"> * &lt;blockquote&gt;&lt;pre&gt;</span>
<span class="cm"> * At 12:30 PM on Jul 3, 2053, there was a disturbance in the Force on planet 7.</span>
<span class="cm"> * &lt;/pre&gt;&lt;/blockquote&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * &lt;p&gt;</span>
<span class="cm"> * The following example creates a &lt;code&gt;MessageFormat&lt;/code&gt; instance that can be used repeatedly:</span>
<span class="cm"> * &lt;blockquote&gt;&lt;pre&gt;</span>
<span class="cm"> * int fileCount = 1273;</span>
<span class="cm"> * String diskName = &quot;MyDisk&quot;;</span>
<span class="cm"> * Object[] testArgs = {new Long(fileCount), diskName};</span>
<span class="cm"> *</span>
<span class="cm"> * MessageFormat form = new MessageFormat(</span>
<span class="cm"> *     &quot;The disk \&quot;{1}\&quot; contains {0} file(s).&quot;);</span>
<span class="cm"> *</span>
<span class="cm"> * System.out.println(form.format(testArgs));</span>
<span class="cm"> * &lt;/pre&gt;&lt;/blockquote&gt;</span>
<span class="cm"> * The output with different values for &lt;code&gt;fileCount&lt;/code&gt;:</span>
<span class="cm"> * &lt;blockquote&gt;&lt;pre&gt;</span>
<span class="cm"> * The disk &quot;MyDisk&quot; contains 0 file(s).</span>
<span class="cm"> * The disk &quot;MyDisk&quot; contains 1 file(s).</span>
<span class="cm"> * The disk &quot;MyDisk&quot; contains 1,273 file(s).</span>
<span class="cm"> * &lt;/pre&gt;&lt;/blockquote&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * &lt;p&gt;</span>
<span class="cm"> * For more sophisticated patterns, you can use a &lt;code&gt;ChoiceFormat&lt;/code&gt; to produce correct forms for singular and</span>
<span class="cm"> * plural:</span>
<span class="cm"> * &lt;blockquote&gt;&lt;pre&gt;</span>
<span class="cm"> * MessageFormat form = new MessageFormat(&quot;The disk \&quot;{1}\&quot; contains {0}.&quot;);</span>
<span class="cm"> * double[] filelimits = {0,1,2};</span>
<span class="cm"> * String[] filepart = {&quot;no files&quot;,&quot;one file&quot;,&quot;{0,number} files&quot;};</span>
<span class="cm"> * ChoiceFormat fileform = new ChoiceFormat(filelimits, filepart);</span>
<span class="cm"> * form.setFormatByArgumentIndex(0, fileform);</span>
<span class="cm"> *</span>
<span class="cm"> * int fileCount = 1273;</span>
<span class="cm"> * String diskName = &quot;MyDisk&quot;;</span>
<span class="cm"> * Object[] testArgs = {new Long(fileCount), diskName};</span>
<span class="cm"> *</span>
<span class="cm"> * System.out.println(form.format(testArgs));</span>
<span class="cm"> * &lt;/pre&gt;&lt;/blockquote&gt;</span>
<span class="cm"> * The output with different values for &lt;code&gt;fileCount&lt;/code&gt;:</span>
<span class="cm"> * &lt;blockquote&gt;&lt;pre&gt;</span>
<span class="cm"> * The disk &quot;MyDisk&quot; contains no files.</span>
<span class="cm"> * The disk &quot;MyDisk&quot; contains one file.</span>
<span class="cm"> * The disk &quot;MyDisk&quot; contains 1,273 files.</span>
<span class="cm"> * &lt;/pre&gt;&lt;/blockquote&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * &lt;p&gt;</span>
<span class="cm"> * You can create the &lt;code&gt;ChoiceFormat&lt;/code&gt; programmatically, as in the above example, or by using a pattern. See</span>
<span class="cm"> * {@link ChoiceFormat} for more information.</span>
<span class="cm"> * &lt;blockquote&gt;&lt;pre&gt;{@code</span>
<span class="cm"> * form.applyPattern(</span>
<span class="cm"> *    &quot;There {0,choice,0#are no files|1#is one file|1&lt;are {0,number,integer} files}.&quot;);</span>
<span class="cm"> * }&lt;/pre&gt;&lt;/blockquote&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * &lt;p&gt;</span>
<span class="cm"> * &lt;strong&gt;Note:&lt;/strong&gt; As we see above, the string produced by a &lt;code&gt;ChoiceFormat&lt;/code&gt; in</span>
<span class="cm"> * &lt;code&gt;MessageFormat&lt;/code&gt; is treated as special; occurrences of &#39;{&#39; are used to indicate subformats, and cause</span>
<span class="cm"> * recursion. If you create both a &lt;code&gt;MessageFormat&lt;/code&gt; and &lt;code&gt;ChoiceFormat&lt;/code&gt; programmatically (instead of</span>
<span class="cm"> * using the string patterns), then be careful not to produce a format that recurses on itself, which will cause an</span>
<span class="cm"> * infinite loop.</span>
<span class="cm"> * &lt;p&gt;</span>
<span class="cm"> * When a single argument is parsed more than once in the string, the last match will be the final result of the</span>
<span class="cm"> * parsing. For example,</span>
<span class="cm"> * &lt;blockquote&gt;&lt;pre&gt;</span>
<span class="cm"> * MessageFormat mf = new MessageFormat(&quot;{0,number,#.##}, {0,number,#.#}&quot;);</span>
<span class="cm"> * Object[] objs = {new Double(3.1415)};</span>
<span class="cm"> * String result = mf.format( objs );</span>
<span class="cm"> * // result now equals &quot;3.14, 3.1&quot;</span>
<span class="cm"> * objs = null;</span>
<span class="cm"> * objs = mf.parse(result, new ParsePosition(0));</span>
<span class="cm"> * // objs now equals {new Double(3.1)}</span>
<span class="cm"> * &lt;/pre&gt;&lt;/blockquote&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * &lt;p&gt;</span>
<span class="cm"> * Likewise, parsing with a {@code MessageFormat} object using patterns containing multiple occurrences of the same</span>
<span class="cm"> * argument would return the last match. For example,</span>
<span class="cm"> * &lt;blockquote&gt;&lt;pre&gt;</span>
<span class="cm"> * MessageFormat mf = new MessageFormat(&quot;{0}, {0}, {0}&quot;);</span>
<span class="cm"> * String forParsing = &quot;x, y, z&quot;;</span>
<span class="cm"> * Object[] objs = mf.parse(forParsing, new ParsePosition(0));</span>
<span class="cm"> * // result now equals {new String(&quot;z&quot;)}</span>
<span class="cm"> * &lt;/pre&gt;&lt;/blockquote&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * &lt;h4&gt;&lt;a name=&quot;synchronization&quot;&gt;Synchronization&lt;/a&gt;&lt;/h4&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * &lt;p&gt;</span>
<span class="cm"> * Message formats are not synchronized. It is recommended to create separate format instances for each thread. If</span>
<span class="cm"> * multiple threads access a format concurrently, it must be synchronized externally.</span>
<span class="cm"> *</span>
<span class="cm"> * @see java.util.Locale</span>
<span class="cm"> * @see Format</span>
<span class="cm"> * @see NumberFormat</span>
<span class="cm"> * @see DecimalFormat</span>
<span class="cm"> * @see DecimalFormatSymbols</span>
<span class="cm"> * @see ChoiceFormat</span>
<span class="cm"> * @see DateFormat</span>
<span class="cm"> * @see SimpleDateFormat</span>
<span class="cm"> *</span>
<span class="cm"> * @author Mark Davis</span>
<span class="cm"> */</span><span class="w"></span>
<span class="nd">@SuppressFBWarnings</span><span class="p">(</span><span class="s">&quot;IMC_IMMATURE_CLASS_WRONG_FIELD_ORDER&quot;</span><span class="p">)</span><span class="w"></span>
<span class="nd">@NotThreadSafe</span><span class="w"></span>
<span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MessageFormat</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Format</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">serialVersionUID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1L</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="c1">// Indices for segments</span><span class="w"></span>
<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">SEG_RAW</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">SEG_INDEX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">SEG_TYPE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">SEG_MODIFIER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="c1">// modifier or subformat</span><span class="w"></span>

<span class="w">  </span><span class="c1">// Indices for type keywords</span><span class="w"></span>
<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">TYPE_NULL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">TYPE_NUMBER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">TYPE_DATE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">TYPE_TIME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">TYPE_CHOICE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">TYPE_KEYWORDS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="s">&quot;number&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="s">&quot;date&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="s">&quot;time&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="s">&quot;choice&quot;</span><span class="w"></span>
<span class="w">  </span><span class="p">};</span><span class="w"></span>

<span class="w">  </span><span class="c1">// Indices for number modifiers</span><span class="w"></span>
<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">MODIFIER_DEFAULT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// common in number and date-time</span><span class="w"></span>
<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">MODIFIER_CURRENCY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">MODIFIER_PERCENT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">MODIFIER_INTEGER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">NUMBER_MODIFIER_KEYWORDS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="s">&quot;currency&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="s">&quot;percent&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="s">&quot;integer&quot;</span><span class="w"></span>
<span class="w">  </span><span class="p">};</span><span class="w"></span>

<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">DATE_TIME_MODIFIER_KEYWORDS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="s">&quot;short&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="s">&quot;medium&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="s">&quot;long&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="s">&quot;full&quot;</span><span class="w"></span>
<span class="w">  </span><span class="p">};</span><span class="w"></span>

<span class="w">  </span><span class="c1">// Date-time style values corresponding to the date-time modifiers.</span><span class="w"></span>
<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="o">[]</span><span class="w"> </span><span class="n">DATE_TIME_MODIFIERS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">DateFormat</span><span class="p">.</span><span class="na">DEFAULT</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">DateFormat</span><span class="p">.</span><span class="na">SHORT</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">DateFormat</span><span class="p">.</span><span class="na">MEDIUM</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">DateFormat</span><span class="p">.</span><span class="na">LONG</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">DateFormat</span><span class="p">.</span><span class="na">FULL</span><span class="p">,};</span><span class="w"></span>



<span class="w">  </span><span class="c1">// ===========================privates============================</span><span class="w"></span>
<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * The locale to use for formatting numbers and dates.</span>
<span class="cm">   *</span>
<span class="cm">   * @serial</span>
<span class="cm">   */</span><span class="w"></span>
<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="n">Locale</span><span class="w"> </span><span class="n">locale</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * The string that the formatted values are to be plugged into. In other words, this is the pattern supplied on</span>
<span class="cm">   * construction with all of the {} expressions taken out.</span>
<span class="cm">   *</span>
<span class="cm">   * @serial</span>
<span class="cm">   */</span><span class="w"></span>
<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">transient</span><span class="w"> </span><span class="n">CharSequence</span><span class="w"> </span><span class="n">pattern</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * An array of formatters, which are used to format the arguments.</span>
<span class="cm">   *</span>
<span class="cm">   * @serial</span>
<span class="cm">   */</span><span class="w"></span>
<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="n">FormatInfo</span><span class="o">[]</span><span class="w"> </span><span class="n">formats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span><span class="w"></span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * One less than the number of entries in &lt;code&gt;offsets&lt;/code&gt;. Can also be thought of as the index of the</span>
<span class="cm">   * highest-numbered element in &lt;code&gt;offsets&lt;/code&gt; that is being used. All of these arrays should have the same</span>
<span class="cm">   * number of elements being used as &lt;code&gt;offsets&lt;/code&gt; does, and so this variable suffices to tell us how many</span>
<span class="cm">   * entries are in all of them.</span>
<span class="cm">   *</span>
<span class="cm">   * @serial</span>
<span class="cm">   */</span><span class="w"></span>
<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">maxOffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">;</span><span class="w"></span>


<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">hash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>


<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * Constructs a FastMessageFormat for the default {@link java.util.Locale.Category#FORMAT FORMAT} locale and the</span>
<span class="cm">   * specified pattern. The constructor first sets the locale, then parses the pattern and creates a list of subformats</span>
<span class="cm">   * for the format elements contained in it. Patterns and their interpretation are specified in the</span>
<span class="cm">   * &lt;a href=&quot;#patterns&quot;&gt;class description&lt;/a&gt;.</span>
<span class="cm">   *</span>
<span class="cm">   * @param pattern the pattern for this message format</span>
<span class="cm">   * @exception IllegalArgumentException if the pattern is invalid</span>
<span class="cm">   */</span><span class="w"></span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="nf">MessageFormat</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">pattern</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="na">locale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Locale</span><span class="p">.</span><span class="na">getDefault</span><span class="p">(</span><span class="n">Locale</span><span class="p">.</span><span class="na">Category</span><span class="p">.</span><span class="na">FORMAT</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">applyPattern</span><span class="p">(</span><span class="n">pattern</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * Constructs a FastMessageFormat for the specified locale and pattern. The constructor first sets the locale, then</span>
<span class="cm">   * parses the pattern and creates a list of sub-formats for the format elements contained in it. Patterns and their</span>
<span class="cm">   * interpretation are specified in the</span>
<span class="cm">   * &lt;a href=&quot;#patterns&quot;&gt;class description&lt;/a&gt;.</span>
<span class="cm">   *</span>
<span class="cm">   * @param pattern the pattern for this message format</span>
<span class="cm">   * @param locale the locale for this message format</span>
<span class="cm">   * @exception IllegalArgumentException if the pattern is invalid</span>
<span class="cm">   * @since 1.4</span>
<span class="cm">   */</span><span class="w"></span>
<span class="w">  </span><span class="nd">@SuppressFBWarnings</span><span class="p">(</span><span class="s">&quot;EI_EXPOSE_REP2&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="nf">MessageFormat</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">pattern</span><span class="p">,</span><span class="w"> </span><span class="n">Locale</span><span class="w"> </span><span class="n">locale</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="na">locale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">locale</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">applyPattern</span><span class="p">(</span><span class="n">pattern</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * Sets the locale to be used when creating or comparing subformats. This affects subsequent calls</span>
<span class="cm">   * &lt;ul&gt;</span>
<span class="cm">   * &lt;li&gt;to the {@link #applyPattern applyPattern} and {@link #toPattern toPattern} methods if format elements specify a</span>
<span class="cm">   * format type and therefore have the subformats created in the &lt;code&gt;applyPattern&lt;/code&gt; method, as well as</span>
<span class="cm">   * &lt;li&gt;to the &lt;code&gt;format&lt;/code&gt; and {@link #formatToCharacterIterator formatToCharacterIterator} methods if format</span>
<span class="cm">   * elements do not specify a format type and therefore have the subformats created in the formatting methods.</span>
<span class="cm">   * &lt;/ul&gt;</span>
<span class="cm">   * Subformats that have already been created are not affected.</span>
<span class="cm">   *</span>
<span class="cm">   * @param locale the locale to be used when creating or comparing subformats</span>
<span class="cm">   */</span><span class="w"></span>
<span class="w">  </span><span class="nd">@SuppressFBWarnings</span><span class="p">(</span><span class="s">&quot;EI_EXPOSE_REP2&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setLocale</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">Locale</span><span class="w"> </span><span class="n">locale</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="na">locale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">locale</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * Gets the locale that&#39;s used when creating or comparing subformats.</span>
<span class="cm">   *</span>
<span class="cm">   * @return the locale used when creating or comparing subformats</span>
<span class="cm">   */</span><span class="w"></span>
<span class="w">  </span><span class="nd">@SuppressFBWarnings</span><span class="p">(</span><span class="s">&quot;EI_EXPOSE_REP&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">Locale</span><span class="w"> </span><span class="nf">getLocale</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">locale</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * Sets the pattern used by this message format. The method parses the pattern and creates a list of subformats for</span>
<span class="cm">   * the format elements contained in it. Patterns and their interpretation are specified in the</span>
<span class="cm">   * &lt;a href=&quot;#patterns&quot;&gt;class description&lt;/a&gt;.</span>
<span class="cm">   *</span>
<span class="cm">   * @param pattern the pattern for this message format</span>
<span class="cm">   * @exception IllegalArgumentException if the pattern is invalid</span>
<span class="cm">   */</span><span class="w"></span>
<span class="w">  </span><span class="nd">@SuppressWarnings</span><span class="p">(</span><span class="s">&quot;fallthrough&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// fallthrough in switch is expected, suppress it</span><span class="w"></span>
<span class="w">  </span><span class="nd">@SuppressFBWarnings</span><span class="p">(</span><span class="s">&quot;CLI_CONSTANT_LIST_INDEX&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">applyPattern</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">pattern</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">StringBuilder</span><span class="o">[]</span><span class="w"> </span><span class="n">segments</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StringBuilder</span><span class="o">[</span><span class="mi">4</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Allocate only segments[SEG_RAW] here. The rest are</span><span class="w"></span>
<span class="w">    </span><span class="c1">// allocated on demand.</span><span class="w"></span>
<span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pattern</span><span class="p">.</span><span class="na">length</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="n">segments</span><span class="o">[</span><span class="n">SEG_RAW</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StringBuilder</span><span class="p">(</span><span class="n">length</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">part</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SEG_RAW</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">formatNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">boolean</span><span class="w"> </span><span class="n">inQuote</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">braceStack</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">maxOffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">length</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="kt">char</span><span class="w"> </span><span class="n">ch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pattern</span><span class="p">.</span><span class="na">charAt</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">part</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">SEG_RAW</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ch</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;\&#39;&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="kt">int</span><span class="w"> </span><span class="n">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">next</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">length</span><span class="w"></span>
<span class="w">                  </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">pattern</span><span class="p">.</span><span class="na">charAt</span><span class="p">(</span><span class="n">next</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;\&#39;&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">segments</span><span class="o">[</span><span class="n">part</span><span class="o">]</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">ch</span><span class="p">);</span><span class="w">  </span><span class="c1">// handle doubles</span><span class="w"></span>
<span class="w">            </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">next</span><span class="p">;</span><span class="w"></span>
<span class="w">          </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">inQuote</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">!</span><span class="n">inQuote</span><span class="p">;</span><span class="w"></span>
<span class="w">          </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ch</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;{&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">inQuote</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="n">part</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SEG_INDEX</span><span class="p">;</span><span class="w"></span>
<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">segments</span><span class="o">[</span><span class="n">part</span><span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">segments</span><span class="o">[</span><span class="n">part</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StringBuilder</span><span class="p">();</span><span class="w"></span>
<span class="w">          </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="n">segments</span><span class="o">[</span><span class="n">part</span><span class="o">]</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">ch</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">inQuote</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">              </span><span class="c1">// just copy quotes in parts</span><span class="w"></span>
<span class="w">        </span><span class="n">segments</span><span class="o">[</span><span class="n">part</span><span class="o">]</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">ch</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ch</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;\&#39;&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="n">inQuote</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">ch</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="k">case</span><span class="w"> </span><span class="sc">&#39;,&#39;</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">part</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">SEG_MODIFIER</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">segments</span><span class="o">[++</span><span class="n">part</span><span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">segments</span><span class="o">[</span><span class="n">part</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StringBuilder</span><span class="p">();</span><span class="w"></span>
<span class="w">              </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">              </span><span class="n">segments</span><span class="o">[</span><span class="n">part</span><span class="o">]</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">ch</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">          </span><span class="k">case</span><span class="w"> </span><span class="sc">&#39;{&#39;</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="o">++</span><span class="n">braceStack</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">segments</span><span class="o">[</span><span class="n">part</span><span class="o">]</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">ch</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">          </span><span class="k">case</span><span class="w"> </span><span class="sc">&#39;}&#39;</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">braceStack</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">              </span><span class="n">part</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SEG_RAW</span><span class="p">;</span><span class="w"></span>
<span class="w">              </span><span class="n">makeFormat</span><span class="p">(</span><span class="n">formatNumber</span><span class="p">,</span><span class="w"> </span><span class="n">segments</span><span class="p">);</span><span class="w"></span>
<span class="w">              </span><span class="n">formatNumber</span><span class="o">++</span><span class="p">;</span><span class="w"></span>
<span class="w">              </span><span class="c1">// throw away other segments</span><span class="w"></span>
<span class="w">              </span><span class="n">segments</span><span class="o">[</span><span class="n">SEG_INDEX</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>
<span class="w">              </span><span class="n">segments</span><span class="o">[</span><span class="n">SEG_TYPE</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>
<span class="w">              </span><span class="n">segments</span><span class="o">[</span><span class="n">SEG_MODIFIER</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">              </span><span class="o">--</span><span class="n">braceStack</span><span class="p">;</span><span class="w"></span>
<span class="w">              </span><span class="n">segments</span><span class="o">[</span><span class="n">part</span><span class="o">]</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">ch</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">          </span><span class="k">case</span><span class="w"> </span><span class="sc">&#39; &#39;</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="c1">// Skip any leading space chars for SEG_TYPE.</span><span class="w"></span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">part</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">SEG_TYPE</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">segments</span><span class="o">[</span><span class="n">SEG_TYPE</span><span class="o">]</span><span class="p">.</span><span class="na">length</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">              </span><span class="n">segments</span><span class="o">[</span><span class="n">part</span><span class="o">]</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">ch</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">          </span><span class="k">case</span><span class="w"> </span><span class="sc">&#39;\&#39;&#39;</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="n">inQuote</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"></span>
<span class="w">          </span><span class="c1">// fall through, so we keep quotes in other parts</span><span class="w"></span>
<span class="w">          </span><span class="k">default</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="n">segments</span><span class="o">[</span><span class="n">part</span><span class="o">]</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">ch</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">braceStack</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">part</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">maxOffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">&quot;Unmatched braces in the pattern: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pattern</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="na">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">segments</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * Returns a pattern representing the current state of the message format. The string is constructed from internal</span>
<span class="cm">   * information and therefore does not necessarily equal the previously applied pattern.</span>
<span class="cm">   *</span>
<span class="cm">   * @return a pattern representing the current state of the message format</span>
<span class="cm">   */</span><span class="w"></span>
<span class="w">  </span><span class="nd">@SuppressFBWarnings</span><span class="p">({</span><span class="s">&quot;CLI_CONSTANT_LIST_INDEX&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ITC_INHERITANCE_TYPE_CHECKING&quot;</span><span class="p">})</span><span class="w"></span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">toPattern</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// later, make this more extensible</span><span class="w"></span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">lastOffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">StringBuilder</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StringBuilder</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">maxOffset</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">FormatInfo</span><span class="w"> </span><span class="n">finfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">formats</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="kt">int</span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">finfo</span><span class="p">.</span><span class="na">getOffset</span><span class="p">();</span><span class="w"></span>
<span class="w">      </span><span class="n">copyAndFixQuotes</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span><span class="w"> </span><span class="n">lastOffset</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">lastOffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">offset</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">result</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="sc">&#39;{&#39;</span><span class="p">).</span><span class="na">append</span><span class="p">(</span><span class="n">finfo</span><span class="p">.</span><span class="na">getArgumentNumber</span><span class="p">());</span><span class="w"></span>
<span class="w">      </span><span class="n">Format</span><span class="w"> </span><span class="n">fmt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">finfo</span><span class="p">.</span><span class="na">getFormat</span><span class="p">();</span><span class="w"></span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fmt</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">NumberFormat</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fmt</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">NumberFormat</span><span class="p">.</span><span class="na">getInstance</span><span class="p">(</span><span class="n">locale</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="n">result</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">&quot;,number&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fmt</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">NumberFormat</span><span class="p">.</span><span class="na">getCurrencyInstance</span><span class="p">(</span><span class="n">locale</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="n">result</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">&quot;,number,currency&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fmt</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">NumberFormat</span><span class="p">.</span><span class="na">getPercentInstance</span><span class="p">(</span><span class="n">locale</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="n">result</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">&quot;,number,percent&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fmt</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">NumberFormat</span><span class="p">.</span><span class="na">getIntegerInstance</span><span class="p">(</span><span class="n">locale</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="n">result</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">&quot;,number,integer&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fmt</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">DecimalFormat</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="n">result</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">&quot;,number,&quot;</span><span class="p">).</span><span class="na">append</span><span class="p">(((</span><span class="n">DecimalFormat</span><span class="p">)</span><span class="w"> </span><span class="n">fmt</span><span class="p">).</span><span class="na">toPattern</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fmt</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">ChoiceFormat</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="n">result</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">&quot;,choice,&quot;</span><span class="p">).</span><span class="na">append</span><span class="p">(((</span><span class="n">ChoiceFormat</span><span class="p">)</span><span class="w"> </span><span class="n">fmt</span><span class="p">).</span><span class="na">toPattern</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UnsupportedOperationException</span><span class="p">(</span><span class="s">&quot;Unsupported format &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">fmt</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fmt</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">DateFormat</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">index</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MODIFIER_DEFAULT</span><span class="p">;</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">DATE_TIME_MODIFIERS</span><span class="p">.</span><span class="na">length</span><span class="p">;</span><span class="w"> </span><span class="n">index</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="n">DateFormat</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DateFormat</span><span class="p">.</span><span class="na">getDateInstance</span><span class="p">(</span><span class="n">DATE_TIME_MODIFIERS</span><span class="o">[</span><span class="n">index</span><span class="o">]</span><span class="p">,</span><span class="w"></span>
<span class="w">                  </span><span class="n">locale</span><span class="p">);</span><span class="w"></span>
<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fmt</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">df</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">result</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">&quot;,date&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">          </span><span class="p">}</span><span class="w"></span>
<span class="w">          </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DateFormat</span><span class="p">.</span><span class="na">getTimeInstance</span><span class="p">(</span><span class="n">DATE_TIME_MODIFIERS</span><span class="o">[</span><span class="n">index</span><span class="o">]</span><span class="p">,</span><span class="w"></span>
<span class="w">                  </span><span class="n">locale</span><span class="p">);</span><span class="w"></span>
<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fmt</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">df</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">result</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">&quot;,time&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">          </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">index</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">DATE_TIME_MODIFIERS</span><span class="p">.</span><span class="na">length</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fmt</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">SimpleDateFormat</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">result</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">&quot;,date,&quot;</span><span class="p">).</span><span class="na">append</span><span class="p">(((</span><span class="n">SimpleDateFormat</span><span class="p">)</span><span class="w"> </span><span class="n">fmt</span><span class="p">).</span><span class="na">toPattern</span><span class="p">());</span><span class="w"></span>
<span class="w">          </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UnsupportedOperationException</span><span class="p">(</span><span class="s">&quot;Unsupported format &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">fmt</span><span class="p">);</span><span class="w"></span>
<span class="w">          </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">index</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">MODIFIER_DEFAULT</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="n">result</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="sc">&#39;,&#39;</span><span class="p">).</span><span class="na">append</span><span class="p">(</span><span class="n">DATE_TIME_MODIFIER_KEYWORDS</span><span class="o">[</span><span class="n">index</span><span class="o">]</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fmt</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UnsupportedOperationException</span><span class="p">(</span><span class="s">&quot;Unsupported format &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">fmt</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="n">result</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="sc">&#39;}&#39;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">copyAndFixQuotes</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span><span class="w"> </span><span class="n">lastOffset</span><span class="p">,</span><span class="w"> </span><span class="n">pattern</span><span class="p">.</span><span class="na">length</span><span class="p">(),</span><span class="w"> </span><span class="n">result</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="na">toString</span><span class="p">();</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * Sets the formats to use for the values passed into &lt;code&gt;format&lt;/code&gt; methods or returned from &lt;code&gt;parse&lt;/code&gt;</span>
<span class="cm">   * methods. The indices of elements in &lt;code&gt;newFormats&lt;/code&gt; correspond to the argument indices used in the</span>
<span class="cm">   * previously set pattern string. The order of formats in &lt;code&gt;newFormats&lt;/code&gt; thus corresponds to the order of</span>
<span class="cm">   * elements in the &lt;code&gt;arguments&lt;/code&gt; array passed to the &lt;code&gt;format&lt;/code&gt; methods or the result array returned</span>
<span class="cm">   * by the &lt;code&gt;parse&lt;/code&gt; methods.</span>
<span class="cm">   * &lt;p&gt;</span>
<span class="cm">   * If an argument index is used for more than one format element in the pattern string, then the corresponding new</span>
<span class="cm">   * format is used for all such format elements. If an argument index is not used for any format element in the pattern</span>
<span class="cm">   * string, then the corresponding new format is ignored. If fewer formats are provided than needed, then only the</span>
<span class="cm">   * formats for argument indices less than &lt;code&gt;newFormats.length&lt;/code&gt; are replaced.</span>
<span class="cm">   *</span>
<span class="cm">   * @param newFormats the new formats to use</span>
<span class="cm">   * @exception NullPointerException if &lt;code&gt;newFormats&lt;/code&gt; is null</span>
<span class="cm">   * @since 1.4</span>
<span class="cm">   */</span><span class="w"></span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setFormatsByArgumentIndex</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">Format</span><span class="o">[]</span><span class="w"> </span><span class="n">newFormats</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">maxOffset</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="kd">final</span><span class="w"> </span><span class="n">FormatInfo</span><span class="w"> </span><span class="n">finfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">formats</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">finfo</span><span class="p">.</span><span class="na">getArgumentNumber</span><span class="p">();</span><span class="w"></span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">newFormats</span><span class="p">.</span><span class="na">length</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">formats</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FormatInfo</span><span class="p">(</span><span class="n">newFormats</span><span class="o">[</span><span class="n">j</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">finfo</span><span class="p">.</span><span class="na">getOffset</span><span class="p">(),</span><span class="w"> </span><span class="n">j</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * Sets the formats to use for the format elements in the previously set pattern string. The order of formats in</span>
<span class="cm">   * &lt;code&gt;newFormats&lt;/code&gt; corresponds to the order of format elements in the pattern string.</span>
<span class="cm">   * &lt;p&gt;</span>
<span class="cm">   * If more formats are provided than needed by the pattern string, the remaining ones are ignored. If fewer formats</span>
<span class="cm">   * are provided than needed, then only the first &lt;code&gt;newFormats.length&lt;/code&gt; formats are replaced.</span>
<span class="cm">   * &lt;p&gt;</span>
<span class="cm">   * Since the order of format elements in a pattern string often changes during localization, it is generally better to</span>
<span class="cm">   * use the {@link #setFormatsByArgumentIndex setFormatsByArgumentIndex} method, which assumes an order of formats</span>
<span class="cm">   * corresponding to the order of elements in the &lt;code&gt;arguments&lt;/code&gt; array passed to the &lt;code&gt;format&lt;/code&gt;</span>
<span class="cm">   * methods or the result array returned by the &lt;code&gt;parse&lt;/code&gt; methods.</span>
<span class="cm">   *</span>
<span class="cm">   * @param newFormats the new formats to use</span>
<span class="cm">   * @exception NullPointerException if &lt;code&gt;newFormats&lt;/code&gt; is null</span>
<span class="cm">   */</span><span class="w"></span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setFormats</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">Format</span><span class="o">[]</span><span class="w"> </span><span class="n">newFormats</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">runsToCopy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newFormats</span><span class="p">.</span><span class="na">length</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">runsToCopy</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">maxOffset</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">runsToCopy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">maxOffset</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">runsToCopy</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">FormatInfo</span><span class="w"> </span><span class="n">finfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">formats</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">formats</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FormatInfo</span><span class="p">(</span><span class="n">newFormats</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">finfo</span><span class="p">.</span><span class="na">getOffset</span><span class="p">(),</span><span class="w"> </span><span class="n">finfo</span><span class="p">.</span><span class="na">getArgumentNumber</span><span class="p">());</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * Sets the format to use for the format elements within the previously set pattern string that use the given argument</span>
<span class="cm">   * index. The argument index is part of the format element definition and represents an index into the</span>
<span class="cm">   * &lt;code&gt;arguments&lt;/code&gt; array passed to the &lt;code&gt;format&lt;/code&gt; methods or the result array returned by the</span>
<span class="cm">   * &lt;code&gt;parse&lt;/code&gt; methods.</span>
<span class="cm">   * &lt;p&gt;</span>
<span class="cm">   * If the argument index is used for more than one format element in the pattern string, then the new format is used</span>
<span class="cm">   * for all such format elements. If the argument index is not used for any format element in the pattern string, then</span>
<span class="cm">   * the new format is ignored.</span>
<span class="cm">   *</span>
<span class="cm">   * @param argumentIndex the argument index for which to use the new format</span>
<span class="cm">   * @param newFormat the new format to use</span>
<span class="cm">   * @since 1.4</span>
<span class="cm">   */</span><span class="w"></span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setFormatByArgumentIndex</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argumentIndex</span><span class="p">,</span><span class="w"> </span><span class="n">Format</span><span class="w"> </span><span class="n">newFormat</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">maxOffset</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">FormatInfo</span><span class="w"> </span><span class="n">finfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">formats</span><span class="o">[</span><span class="n">j</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="kt">int</span><span class="w"> </span><span class="n">argNr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">finfo</span><span class="p">.</span><span class="na">getArgumentNumber</span><span class="p">();</span><span class="w"></span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">argNr</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">argumentIndex</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">formats</span><span class="o">[</span><span class="n">j</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FormatInfo</span><span class="p">(</span><span class="n">newFormat</span><span class="p">,</span><span class="w"> </span><span class="n">finfo</span><span class="p">.</span><span class="na">getOffset</span><span class="p">(),</span><span class="w"> </span><span class="n">argNr</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * Sets the format to use for the format element with the given format element index within the previously set pattern</span>
<span class="cm">   * string. The format element index is the zero-based number of the format element counting from the start of the</span>
<span class="cm">   * pattern string.</span>
<span class="cm">   * &lt;p&gt;</span>
<span class="cm">   * Since the order of format elements in a pattern string often changes during localization, it is generally better to</span>
<span class="cm">   * use the {@link #setFormatByArgumentIndex setFormatByArgumentIndex} method, which accesses format elements based on</span>
<span class="cm">   * the argument index they specify.</span>
<span class="cm">   *</span>
<span class="cm">   * @param formatElementIndex the index of a format element within the pattern</span>
<span class="cm">   * @param newFormat the format to use for the specified format element</span>
<span class="cm">   * @exception ArrayIndexOutOfBoundsException if {@code formatElementIndex} is equal to or larger than the number of</span>
<span class="cm">   * format elements in the pattern string</span>
<span class="cm">   */</span><span class="w"></span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setFormat</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">formatElementIndex</span><span class="p">,</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Format</span><span class="w"> </span><span class="n">newFormat</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">FormatInfo</span><span class="w"> </span><span class="n">finfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">formats</span><span class="o">[</span><span class="n">formatElementIndex</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">formats</span><span class="o">[</span><span class="n">formatElementIndex</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FormatInfo</span><span class="p">(</span><span class="n">newFormat</span><span class="p">,</span><span class="w"> </span><span class="n">finfo</span><span class="p">.</span><span class="na">getOffset</span><span class="p">(),</span><span class="w"> </span><span class="n">finfo</span><span class="p">.</span><span class="na">getArgumentNumber</span><span class="p">());</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * Gets the formats used for the values passed into &lt;code&gt;format&lt;/code&gt; methods or returned from &lt;code&gt;parse&lt;/code&gt;</span>
<span class="cm">   * methods. The indices of elements in the returned array correspond to the argument indices used in the previously</span>
<span class="cm">   * set pattern string. The order of formats in the returned array thus corresponds to the order of elements in the</span>
<span class="cm">   * &lt;code&gt;arguments&lt;/code&gt; array passed to the &lt;code&gt;format&lt;/code&gt; methods or the result array returned by the</span>
<span class="cm">   * &lt;code&gt;parse&lt;/code&gt; methods.</span>
<span class="cm">   * &lt;p&gt;</span>
<span class="cm">   * If an argument index is used for more than one format element in the pattern string, then the format used for the</span>
<span class="cm">   * last such format element is returned in the array. If an argument index is not used for any format element in the</span>
<span class="cm">   * pattern string, then null is returned in the array.</span>
<span class="cm">   *</span>
<span class="cm">   * @return the formats used for the arguments within the pattern</span>
<span class="cm">   * @since 1.4</span>
<span class="cm">   */</span><span class="w"></span>
<span class="c1">//    public Format[] getFormatsByArgumentIndex() {</span><span class="w"></span>
<span class="c1">//        int maximumArgumentNumber = -1;</span><span class="w"></span>
<span class="c1">//        for (int i = 0; i &lt;= maxOffset; i++) {</span><span class="w"></span>
<span class="c1">//            if (argumentNumbers[i] &gt; maximumArgumentNumber) {</span><span class="w"></span>
<span class="c1">//                maximumArgumentNumber = argumentNumbers[i];</span><span class="w"></span>
<span class="c1">//            }</span><span class="w"></span>
<span class="c1">//        }</span><span class="w"></span>
<span class="c1">//        Format[] resultArray = new Format[maximumArgumentNumber + 1];</span><span class="w"></span>
<span class="c1">//        for (int i = 0; i &lt;= maxOffset; i++) {</span><span class="w"></span>
<span class="c1">//            resultArray[argumentNumbers[i]] = formats[i];</span><span class="w"></span>
<span class="c1">//        }</span><span class="w"></span>
<span class="c1">//        return resultArray;</span><span class="w"></span>
<span class="c1">//    }</span><span class="w"></span>
<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * Gets the formats used for the format elements in the previously set pattern string. The order of formats in the</span>
<span class="cm">   * returned array corresponds to the order of format elements in the pattern string.</span>
<span class="cm">   * &lt;p&gt;</span>
<span class="cm">   * Since the order of format elements in a pattern string often changes during localization, it&#39;s generally better to</span>
<span class="cm">   * use the {@link #getFormatsByArgumentIndex getFormatsByArgumentIndex} method, which assumes an order of formats</span>
<span class="cm">   * corresponding to the order of elements in the &lt;code&gt;arguments&lt;/code&gt; array passed to the &lt;code&gt;format&lt;/code&gt;</span>
<span class="cm">   * methods or the result array returned by the &lt;code&gt;parse&lt;/code&gt; methods.</span>
<span class="cm">   *</span>
<span class="cm">   * @return the formats used for the format elements in the pattern</span>
<span class="cm">   */</span><span class="w"></span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">Format</span><span class="o">[]</span><span class="w"> </span><span class="nf">getFormats</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">Format</span><span class="o">[]</span><span class="w"> </span><span class="n">resultArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Format</span><span class="o">[</span><span class="n">maxOffset</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">arraycopy</span><span class="p">(</span><span class="n">formats</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">resultArray</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">maxOffset</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">resultArray</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * Formats an array of objects and appends the &lt;code&gt;MessageFormat&lt;/code&gt;&#39;s pattern, with format elements replaced by</span>
<span class="cm">   * the formatted objects, to the provided &lt;code&gt;StringBuffer&lt;/code&gt;.</span>
<span class="cm">   * &lt;p&gt;</span>
<span class="cm">   * The text substituted for the individual format elements is derived from the current subformat of the format element</span>
<span class="cm">   * and the &lt;code&gt;arguments&lt;/code&gt; element at the format element&#39;s argument index as indicated by the first matching</span>
<span class="cm">   * line of the following table. An argument is &lt;i&gt;unavailable&lt;/i&gt; if &lt;code&gt;arguments&lt;/code&gt; is &lt;code&gt;null&lt;/code&gt; or</span>
<span class="cm">   * has fewer than argumentIndex+1 elements.</span>
<span class="cm">   *</span>
<span class="cm">   * &lt;table border=1 summary=&quot;Examples of subformat,argument,and formatted text&quot;&gt;</span>
<span class="cm">   * &lt;tr&gt;</span>
<span class="cm">   * &lt;th&gt;Subformat</span>
<span class="cm">   * &lt;th&gt;Argument</span>
<span class="cm">   * &lt;th&gt;Formatted Text</span>
<span class="cm">   * &lt;tr&gt;</span>
<span class="cm">   * &lt;td&gt;&lt;i&gt;any&lt;/i&gt;</span>
<span class="cm">   * &lt;td&gt;&lt;i&gt;unavailable&lt;/i&gt;</span>
<span class="cm">   * &lt;td&gt;&lt;code&gt;&quot;{&quot; + argumentIndex + &quot;}&quot;&lt;/code&gt;</span>
<span class="cm">   * &lt;tr&gt;</span>
<span class="cm">   * &lt;td&gt;&lt;i&gt;any&lt;/i&gt;</span>
<span class="cm">   * &lt;td&gt;&lt;code&gt;null&lt;/code&gt;</span>
<span class="cm">   * &lt;td&gt;&lt;code&gt;&quot;null&quot;&lt;/code&gt;</span>
<span class="cm">   * &lt;tr&gt;</span>
<span class="cm">   * &lt;td&gt;&lt;code&gt;instanceof ChoiceFormat&lt;/code&gt;</span>
<span class="cm">   * &lt;td&gt;&lt;i&gt;any&lt;/i&gt;</span>
<span class="cm">   * &lt;td&gt;&lt;code&gt;subformat.format(argument).indexOf(&#39;{&#39;) &amp;gt;= 0 ?&lt;br&gt;</span>
<span class="cm">   * (new MessageFormat(subformat.format(argument), getLocale())).format(argument) : subformat.format(argument)&lt;/code&gt;</span>
<span class="cm">   * &lt;tr&gt;</span>
<span class="cm">   * &lt;td&gt;&lt;code&gt;!= null&lt;/code&gt;</span>
<span class="cm">   * &lt;td&gt;&lt;i&gt;any&lt;/i&gt;</span>
<span class="cm">   * &lt;td&gt;&lt;code&gt;subformat.format(argument)&lt;/code&gt;</span>
<span class="cm">   * &lt;tr&gt;</span>
<span class="cm">   * &lt;td&gt;&lt;code&gt;null&lt;/code&gt;</span>
<span class="cm">   * &lt;td&gt;&lt;code&gt;instanceof Number&lt;/code&gt;</span>
<span class="cm">   * &lt;td&gt;&lt;code&gt;NumberFormat.getInstance(getLocale()).format(argument)&lt;/code&gt;</span>
<span class="cm">   * &lt;tr&gt;</span>
<span class="cm">   * &lt;td&gt;&lt;code&gt;null&lt;/code&gt;</span>
<span class="cm">   * &lt;td&gt;&lt;code&gt;instanceof Date&lt;/code&gt;</span>
<span class="cm">   * &lt;td&gt;&lt;code&gt;DateFormat.getDateTimeInstance(DateFormat.SHORT, DateFormat.SHORT, getLocale()).format(argument)&lt;/code&gt;</span>
<span class="cm">   * &lt;tr&gt;</span>
<span class="cm">   * &lt;td&gt;&lt;code&gt;null&lt;/code&gt;</span>
<span class="cm">   * &lt;td&gt;&lt;code&gt;instanceof String&lt;/code&gt;</span>
<span class="cm">   * &lt;td&gt;&lt;code&gt;argument&lt;/code&gt;</span>
<span class="cm">   * &lt;tr&gt;</span>
<span class="cm">   * &lt;td&gt;&lt;code&gt;null&lt;/code&gt;</span>
<span class="cm">   * &lt;td&gt;&lt;i&gt;any&lt;/i&gt;</span>
<span class="cm">   * &lt;td&gt;&lt;code&gt;argument.toString()&lt;/code&gt;</span>
<span class="cm">   * &lt;/table&gt;</span>
<span class="cm">   * &lt;p&gt;</span>
<span class="cm">   * If &lt;code&gt;pos&lt;/code&gt; is non-null, and refers to &lt;code&gt;Field.ARGUMENT&lt;/code&gt;, the location of the first formatted</span>
<span class="cm">   * string will be returned.</span>
<span class="cm">   *</span>
<span class="cm">   * @param arguments an array of objects to be formatted and substituted.</span>
<span class="cm">   * @param result where text is appended.</span>
<span class="cm">   * @param pos On input: an alignment field, if desired. On output: the offsets of the alignment field.</span>
<span class="cm">   * @return the string buffer passed in as {@code result}, with formatted text appended</span>
<span class="cm">   * @exception IllegalArgumentException if an argument in the &lt;code&gt;arguments&lt;/code&gt; array is not of the type expected</span>
<span class="cm">   * by the format element(s) that use it.</span>
<span class="cm">   */</span><span class="w"></span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="o">&lt;</span><span class="n">T</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">CharSequence</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">Appendable</span><span class="o">&gt;</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">format</span><span class="p">(</span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">arguments</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="n">result</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="nd">@Nullable</span><span class="w"> </span><span class="n">FieldPosition</span><span class="w"> </span><span class="n">pos</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">subformat</span><span class="p">(</span><span class="n">arguments</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="o">&lt;</span><span class="n">T</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">CharSequence</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">Appendable</span><span class="o">&gt;</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">format</span><span class="p">(</span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">arguments</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="n">result</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">format</span><span class="p">(</span><span class="n">arguments</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * Creates a MessageFormat with the given pattern and uses it to format the given arguments. This is equivalent to</span>
<span class="cm">   * &lt;blockquote&gt;</span>
<span class="cm">   * &lt;code&gt;(new {@link #MessageFormat(String) MessageFormat}(pattern)).</span>
<span class="cm">   * {@link #format(java.lang.Object[], java.lang.StringBuffer, java.text.FieldPosition) format}(arguments,</span>
<span class="cm">   * new StringBuffer(), null).toString()&lt;/code&gt;</span>
<span class="cm">   * &lt;/blockquote&gt;</span>
<span class="cm">   *</span>
<span class="cm">   * @param pattern the pattern string</span>
<span class="cm">   * @param arguments object(s) to format</span>
<span class="cm">   * @return the formatted string</span>
<span class="cm">   * @exception IllegalArgumentException if the pattern is invalid, or if an argument in the &lt;code&gt;arguments&lt;/code&gt;</span>
<span class="cm">   * array is not of the type expected by the format element(s) that use it.</span>
<span class="cm">   */</span><span class="w"></span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">format</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">pattern</span><span class="p">,</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="p">...</span><span class="w"> </span><span class="n">arguments</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">MessageFormat</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MessageFormat</span><span class="p">(</span><span class="n">pattern</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">temp</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="n">arguments</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="c1">// Overrides</span><span class="w"></span>
<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * Formats an array of objects and appends the &lt;code&gt;MessageFormat&lt;/code&gt;&#39;s pattern, with format elements replaced by</span>
<span class="cm">   * the formatted objects, to the provided &lt;code&gt;StringBuffer&lt;/code&gt;. This is equivalent to</span>
<span class="cm">   * &lt;blockquote&gt;</span>
<span class="cm">   * &lt;code&gt;{@link #format(java.lang.Object[], java.lang.StringBuffer, java.text.FieldPosition) format}((Object[])</span>
<span class="cm">   * arguments, result, pos)&lt;/code&gt;</span>
<span class="cm">   * &lt;/blockquote&gt;</span>
<span class="cm">   *</span>
<span class="cm">   * @param arguments an array of objects to be formatted and substituted.</span>
<span class="cm">   * @param result where text is appended.</span>
<span class="cm">   * @param pos On input: an alignment field, if desired. On output: the offsets of the alignment field.</span>
<span class="cm">   * @exception IllegalArgumentException if an argument in the &lt;code&gt;arguments&lt;/code&gt; array is not of the type expected</span>
<span class="cm">   * by the format element(s) that use it.</span>
<span class="cm">   */</span><span class="w"></span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="o">&lt;</span><span class="n">T</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">CharSequence</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">Appendable</span><span class="o">&gt;</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">format</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">arguments</span><span class="p">,</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="n">result</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="kd">final</span><span class="w"> </span><span class="n">FieldPosition</span><span class="w"> </span><span class="n">pos</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">arguments</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">subformat</span><span class="p">((</span><span class="n">Object</span><span class="o">[]</span><span class="p">)</span><span class="w"> </span><span class="n">arguments</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">subformat</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="o">[]</span><span class="w"> </span><span class="p">{</span><span class="n">arguments</span><span class="p">},</span><span class="w"> </span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * Formats an array of objects and inserts them into the &lt;code&gt;MessageFormat&lt;/code&gt;&#39;s pattern, producing an</span>
<span class="cm">   * &lt;code&gt;AttributedCharacterIterator&lt;/code&gt;. You can use the returned &lt;code&gt;AttributedCharacterIterator&lt;/code&gt; to</span>
<span class="cm">   * build the resulting String, as well as to determine information about the resulting String.</span>
<span class="cm">   * &lt;p&gt;</span>
<span class="cm">   * The text of the returned &lt;code&gt;AttributedCharacterIterator&lt;/code&gt; is the same that would be returned by</span>
<span class="cm">   * &lt;blockquote&gt;</span>
<span class="cm">   * &lt;code&gt;{@link #format(java.lang.Object[], java.lang.StringBuffer, java.text.FieldPosition) format}(arguments, new</span>
<span class="cm">   * StringBuffer(), null).toString()&lt;/code&gt;</span>
<span class="cm">   * &lt;/blockquote&gt;</span>
<span class="cm">   * &lt;p&gt;</span>
<span class="cm">   * In addition, the &lt;code&gt;AttributedCharacterIterator&lt;/code&gt; contains at least attributes indicating where text was</span>
<span class="cm">   * generated from an argument in the &lt;code&gt;arguments&lt;/code&gt; array. The keys of these attributes are of type</span>
<span class="cm">   * &lt;code&gt;MessageFormat.Field&lt;/code&gt;, their values are &lt;code&gt;Integer&lt;/code&gt; objects indicating the index in the</span>
<span class="cm">   * &lt;code&gt;arguments&lt;/code&gt; array of the argument from which the text was generated.</span>
<span class="cm">   * &lt;p&gt;</span>
<span class="cm">   * The attributes/value from the underlying &lt;code&gt;Format&lt;/code&gt; instances that &lt;code&gt;MessageFormat&lt;/code&gt; uses will</span>
<span class="cm">   * also be placed in the resulting &lt;code&gt;AttributedCharacterIterator&lt;/code&gt;. This allows you to not only find where an</span>
<span class="cm">   * argument is placed in the resulting String, but also which fields it contains in turn.</span>
<span class="cm">   *</span>
<span class="cm">   * @param arguments an array of objects to be formatted and substituted.</span>
<span class="cm">   * @return AttributedCharacterIterator describing the formatted value.</span>
<span class="cm">   * @exception NullPointerException if &lt;code&gt;arguments&lt;/code&gt; is null.</span>
<span class="cm">   * @exception IllegalArgumentException if an argument in the &lt;code&gt;arguments&lt;/code&gt; array is not of the type expected</span>
<span class="cm">   * by the format element(s) that use it.</span>
<span class="cm">   * @since 1.4</span>
<span class="cm">   */</span><span class="w"></span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">AttributedCharacterIterator</span><span class="w"> </span><span class="nf">formatToCharacterIterator</span><span class="p">(</span><span class="nd">@Nonnull</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">arguments</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">StringBuilder</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StringBuilder</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">AttributedCharacterIterator</span><span class="o">&gt;</span><span class="w"> </span><span class="n">iterators</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">subformat</span><span class="p">((</span><span class="n">Object</span><span class="o">[]</span><span class="p">)</span><span class="w"> </span><span class="n">arguments</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="n">iterators</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="n">ex</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UncheckedIOException</span><span class="p">(</span><span class="n">ex</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">iterators</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">createAttributedCharacterIterator</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AttributedString</span><span class="p">(</span><span class="w"></span>
<span class="w">            </span><span class="n">iterators</span><span class="p">.</span><span class="na">toArray</span><span class="p">(</span><span class="w"></span>
<span class="w">                    </span><span class="k">new</span><span class="w"> </span><span class="n">AttributedCharacterIterator</span><span class="o">[</span><span class="n">iterators</span><span class="p">.</span><span class="na">size</span><span class="p">()</span><span class="o">]</span><span class="p">)).</span><span class="na">getIterator</span><span class="p">();</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * Parses the string.</span>
<span class="cm">   *</span>
<span class="cm">   * &lt;p&gt;</span>
<span class="cm">   * Caveats: The parse may fail in a number of circumstances. For example:</span>
<span class="cm">   * &lt;ul&gt;</span>
<span class="cm">   * &lt;li&gt;If one of the arguments does not occur in the pattern.</span>
<span class="cm">   * &lt;li&gt;If the format of an argument loses information, such as with a choice format where a large number formats to</span>
<span class="cm">   * &quot;many&quot;.</span>
<span class="cm">   * &lt;li&gt;Does not yet handle recursion (where the substituted strings contain {n} references.)</span>
<span class="cm">   * &lt;li&gt;Will not always find a match (or the correct match) if some part of the parse is ambiguous. For example, if the</span>
<span class="cm">   * pattern &quot;{1},{2}&quot; is used with the string arguments {&quot;a,b&quot;, &quot;c&quot;}, it will format as &quot;a,b,c&quot;. When the result is</span>
<span class="cm">   * parsed, it will return {&quot;a&quot;, &quot;b,c&quot;}.</span>
<span class="cm">   * &lt;li&gt;If a single argument is parsed more than once in the string, then the later parse wins.</span>
<span class="cm">   * &lt;/ul&gt;</span>
<span class="cm">   * When the parse fails, use ParsePosition.getErrorIndex() to find out where in the string the parsing failed. The</span>
<span class="cm">   * returned error index is the starting offset of the sub-patterns that the string is comparing with. For example, if</span>
<span class="cm">   * the parsing string &quot;AAA {0} BBB&quot; is comparing against the pattern &quot;AAD {0} BBB&quot;, the error index is 0. When an</span>
<span class="cm">   * error occurs, the call to this method will return null. If the source is null, return an empty array. (zoltan:</span>
<span class="cm">   * yuck)</span>
<span class="cm">   *</span>
<span class="cm">   *</span>
<span class="cm">   * @param source the string to parse</span>
<span class="cm">   * @param pos the parse position</span>
<span class="cm">   * @return an array of parsed objects</span>
<span class="cm">   */</span><span class="w"></span>
<span class="w">  </span><span class="nd">@Nullable</span><span class="w"></span>
<span class="w">  </span><span class="nd">@SuppressFBWarnings</span><span class="p">({</span><span class="s">&quot;PZLA_PREFER_ZERO_LENGTH_ARRAYS&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;STT_STRING_PARSING_A_FIELD&quot;</span><span class="p">})</span><span class="w"> </span><span class="c1">// maintaining JDK behavior</span><span class="w"></span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="nf">parse</span><span class="p">(</span><span class="nd">@Nullable</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">source</span><span class="p">,</span><span class="w"> </span><span class="nd">@Nonnull</span><span class="w"> </span><span class="n">ParsePosition</span><span class="w"> </span><span class="n">pos</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">source</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">org</span><span class="p">.</span><span class="na">spf4j</span><span class="p">.</span><span class="na">base</span><span class="p">.</span><span class="na">Arrays</span><span class="p">.</span><span class="na">EMPTY_OBJ_ARRAY</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">maximumArgumentNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">maxOffset</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">FormatInfo</span><span class="w"> </span><span class="n">finfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">formats</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">argumentNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">finfo</span><span class="p">.</span><span class="na">getArgumentNumber</span><span class="p">();</span><span class="w"></span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">argumentNumber</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">maximumArgumentNumber</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">maximumArgumentNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">argumentNumber</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">resultArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="n">maximumArgumentNumber</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="o">]</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">patternOffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">sourceOffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pos</span><span class="p">.</span><span class="na">getIndex</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="n">ParsePosition</span><span class="w"> </span><span class="n">tempStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ParsePosition</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">maxOffset</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="c1">// match up to format</span><span class="w"></span>
<span class="w">      </span><span class="n">FormatInfo</span><span class="w"> </span><span class="n">finfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">formats</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="kt">int</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">finfo</span><span class="p">.</span><span class="na">getOffset</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">patternOffset</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">len</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">CharSequences</span><span class="p">.</span><span class="na">regionMatches</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span><span class="w"> </span><span class="n">patternOffset</span><span class="p">,</span><span class="w"> </span><span class="n">source</span><span class="p">,</span><span class="w"> </span><span class="n">sourceOffset</span><span class="p">,</span><span class="w"> </span><span class="n">len</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">sourceOffset</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">len</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">patternOffset</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">len</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">pos</span><span class="p">.</span><span class="na">setErrorIndex</span><span class="p">(</span><span class="n">sourceOffset</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>

<span class="w">      </span><span class="c1">// now use format</span><span class="w"></span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">finfo</span><span class="p">.</span><span class="na">getFormat</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">   </span><span class="c1">// string format</span><span class="w"></span>
<span class="w">        </span><span class="c1">// if at end, use longest possible match</span><span class="w"></span>
<span class="w">        </span><span class="c1">// otherwise uses first match to intervening string</span><span class="w"></span>
<span class="w">        </span><span class="c1">// does NOT recursively try all possibilities</span><span class="w"></span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">tempLength</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">maxOffset</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">formats</span><span class="o">[</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="o">]</span><span class="p">.</span><span class="na">getOffset</span><span class="p">()</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">pattern</span><span class="p">.</span><span class="na">length</span><span class="p">();</span><span class="w"></span>

<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">next</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">patternOffset</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">tempLength</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="n">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">source</span><span class="p">.</span><span class="na">length</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="n">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">source</span><span class="p">.</span><span class="na">indexOf</span><span class="p">(</span><span class="n">pattern</span><span class="p">.</span><span class="na">subSequence</span><span class="p">(</span><span class="n">patternOffset</span><span class="p">,</span><span class="w"> </span><span class="n">tempLength</span><span class="p">).</span><span class="na">toString</span><span class="p">(),</span><span class="w"> </span><span class="n">sourceOffset</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">next</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="n">pos</span><span class="p">.</span><span class="na">setErrorIndex</span><span class="p">(</span><span class="n">sourceOffset</span><span class="p">);</span><span class="w"></span>
<span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="n">String</span><span class="w"> </span><span class="n">strValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">source</span><span class="p">.</span><span class="na">substring</span><span class="p">(</span><span class="n">sourceOffset</span><span class="p">,</span><span class="w"> </span><span class="n">next</span><span class="p">);</span><span class="w"></span>
<span class="w">          </span><span class="kt">int</span><span class="w"> </span><span class="n">argNr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">finfo</span><span class="p">.</span><span class="na">getArgumentNumber</span><span class="p">();</span><span class="w"></span>
<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">strValue</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="s">&quot;{&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">argNr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;}&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">resultArray</span><span class="o">[</span><span class="n">argNr</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">source</span><span class="p">.</span><span class="na">substring</span><span class="p">(</span><span class="n">sourceOffset</span><span class="p">,</span><span class="w"> </span><span class="n">next</span><span class="p">);</span><span class="w"></span>
<span class="w">          </span><span class="p">}</span><span class="w"></span>
<span class="w">          </span><span class="n">sourceOffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">next</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">tempStatus</span><span class="p">.</span><span class="na">setIndex</span><span class="p">(</span><span class="n">sourceOffset</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">resultArray</span><span class="o">[</span><span class="n">finfo</span><span class="p">.</span><span class="na">getArgumentNumber</span><span class="p">()</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">finfo</span><span class="p">.</span><span class="na">getFormat</span><span class="p">().</span><span class="na">parseObject</span><span class="p">(</span><span class="n">source</span><span class="p">,</span><span class="w"> </span><span class="n">tempStatus</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tempStatus</span><span class="p">.</span><span class="na">getIndex</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">sourceOffset</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="n">pos</span><span class="p">.</span><span class="na">setErrorIndex</span><span class="p">(</span><span class="n">sourceOffset</span><span class="p">);</span><span class="w"></span>
<span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"> </span><span class="c1">// leave index as is to signal error</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="n">sourceOffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tempStatus</span><span class="p">.</span><span class="na">getIndex</span><span class="p">();</span><span class="w"> </span><span class="c1">// update</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pattern</span><span class="p">.</span><span class="na">length</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">patternOffset</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">len</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">CharSequences</span><span class="p">.</span><span class="na">regionMatches</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span><span class="w"> </span><span class="n">patternOffset</span><span class="p">,</span><span class="w"> </span><span class="n">source</span><span class="p">,</span><span class="w"> </span><span class="n">sourceOffset</span><span class="p">,</span><span class="w"> </span><span class="n">len</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">pos</span><span class="p">.</span><span class="na">setIndex</span><span class="p">(</span><span class="n">sourceOffset</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">len</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">pos</span><span class="p">.</span><span class="na">setErrorIndex</span><span class="p">(</span><span class="n">sourceOffset</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">resultArray</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * Parses text from the beginning of the given string to produce an object array. The method may not use the entire</span>
<span class="cm">   * text of the given string.</span>
<span class="cm">   * &lt;p&gt;</span>
<span class="cm">   * See the {@link #parse(String, ParsePosition)} method for more information on message parsing.</span>
<span class="cm">   *</span>
<span class="cm">   * @param source A &lt;code&gt;String&lt;/code&gt; whose beginning should be parsed.</span>
<span class="cm">   * @return An &lt;code&gt;Object&lt;/code&gt; array parsed from the string.</span>
<span class="cm">   * @exception ParseException if the beginning of the specified string cannot be parsed.</span>
<span class="cm">   */</span><span class="w"></span>
<span class="w">  </span><span class="nd">@Nullable</span><span class="w"></span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="nf">parse</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">source</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">ParseException</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">ParsePosition</span><span class="w"> </span><span class="n">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ParsePosition</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parse</span><span class="p">(</span><span class="n">source</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pos</span><span class="p">.</span><span class="na">getIndex</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="c1">// unchanged, returned object is null</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ParseException</span><span class="p">(</span><span class="s">&quot;MessageFormat source = &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">source</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; parse error!&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">.</span><span class="na">getErrorIndex</span><span class="p">());</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * Parses text from a string to produce an object array.</span>
<span class="cm">   * &lt;p&gt;</span>
<span class="cm">   * The method attempts to parse text starting at the index given by &lt;code&gt;pos&lt;/code&gt;. If parsing succeeds, then the</span>
<span class="cm">   * index of &lt;code&gt;pos&lt;/code&gt; is updated to the index after the last character used (parsing does not necessarily use</span>
<span class="cm">   * all characters up to the end of the string), and the parsed object array is returned. The updated &lt;code&gt;pos&lt;/code&gt;</span>
<span class="cm">   * can be used to indicate the starting point for the next call to this method. If an error occurs, then the index of</span>
<span class="cm">   * &lt;code&gt;pos&lt;/code&gt; is not changed, the error index of &lt;code&gt;pos&lt;/code&gt; is set to the index of the character where the</span>
<span class="cm">   * error occurred, and null is returned.</span>
<span class="cm">   * &lt;p&gt;</span>
<span class="cm">   * See the {@link #parse(String, ParsePosition)} method for more information on message parsing.</span>
<span class="cm">   *</span>
<span class="cm">   * @param source A &lt;code&gt;String&lt;/code&gt;, part of which should be parsed.</span>
<span class="cm">   * @param pos A &lt;code&gt;ParsePosition&lt;/code&gt; object with index and error index information as described above.</span>
<span class="cm">   * @return An &lt;code&gt;Object&lt;/code&gt; array parsed from the string. In case of error, returns null.</span>
<span class="cm">   * @exception NullPointerException if &lt;code&gt;pos&lt;/code&gt; is null.</span>
<span class="cm">   */</span><span class="w"></span>
<span class="w">  </span><span class="nd">@Nullable</span><span class="w"></span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">parseObject</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">source</span><span class="p">,</span><span class="w"> </span><span class="n">ParsePosition</span><span class="w"> </span><span class="n">pos</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">parse</span><span class="p">(</span><span class="n">source</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * Creates and returns a copy of this object.</span>
<span class="cm">   *</span>
<span class="cm">   * @return a clone of this instance.</span>
<span class="cm">   */</span><span class="w"></span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">MessageFormat</span><span class="w"> </span><span class="nf">clone</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">MessageFormat</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">MessageFormat</span><span class="p">)</span><span class="w"> </span><span class="kd">super</span><span class="p">.</span><span class="na">clone</span><span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="c1">// clone arrays. Can&#39;t do with utility because of bug in Cloneable</span><span class="w"></span>
<span class="w">    </span><span class="n">other</span><span class="p">.</span><span class="na">formats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">formats</span><span class="p">.</span><span class="na">clone</span><span class="p">();</span><span class="w"> </span><span class="c1">// shallow clone</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">formats</span><span class="p">.</span><span class="na">length</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">FormatInfo</span><span class="w"> </span><span class="n">finfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">formats</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">finfo</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">other</span><span class="p">.</span><span class="na">formats</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">finfo</span><span class="p">.</span><span class="na">clone</span><span class="p">();</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">other</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * Equality comparison between two message format objects</span>
<span class="cm">   */</span><span class="w"></span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">equals</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">obj</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">obj</span><span class="p">)</span><span class="w"> </span><span class="c1">// quick check</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">obj</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">getClass</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">obj</span><span class="p">.</span><span class="na">getClass</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">MessageFormat</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">MessageFormat</span><span class="p">)</span><span class="w"> </span><span class="n">obj</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">maxOffset</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="na">maxOffset</span><span class="w"></span>
<span class="w">            </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">CharSequences</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="na">pattern</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">((</span><span class="n">locale</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">locale</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="na">locale</span><span class="p">))</span><span class="w"></span>
<span class="w">            </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="n">locale</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="na">locale</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">))</span><span class="w"></span>
<span class="w">            </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">formats</span><span class="p">,</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="na">formats</span><span class="p">));</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * Generates a hash code for the message format object.</span>
<span class="cm">   */</span><span class="w"></span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">hashCode</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hash</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">h</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CharSequences</span><span class="p">.</span><span class="na">hashcode</span><span class="p">(</span><span class="n">pattern</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">hash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">h</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">h</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="nd">@Override</span><span class="w"></span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">StringBuffer</span><span class="w"> </span><span class="nf">format</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="n">StringBuffer</span><span class="w"> </span><span class="n">toAppendTo</span><span class="p">,</span><span class="w"> </span><span class="n">FieldPosition</span><span class="w"> </span><span class="n">pos</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">syntethicFormat</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="n">toAppendTo</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">toAppendTo</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="n">ex</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UncheckedIOException</span><span class="p">(</span><span class="n">ex</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="o">&lt;</span><span class="n">T</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">CharSequence</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">Appendable</span><span class="o">&gt;</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">syntethicFormat</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="n">toAppendTo</span><span class="p">,</span><span class="w"> </span><span class="n">FieldPosition</span><span class="w"> </span><span class="n">pos</span><span class="p">)</span><span class="w"></span>
<span class="w">          </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">format</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="n">toAppendTo</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>


<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * Internal routine used by format. If &lt;code&gt;characterIterators&lt;/code&gt; is non-null, AttributedCharacterIterator will</span>
<span class="cm">   * be created from the sub-formats as necessary. If &lt;code&gt;characterIterators&lt;/code&gt; is null and &lt;code&gt;fp&lt;/code&gt; is</span>
<span class="cm">   * non-null and identifies &lt;code&gt;Field.MESSAGE_ARGUMENT&lt;/code&gt;, the location of the first replaced argument will be</span>
<span class="cm">   * set in it.</span>
<span class="cm">   *</span>
<span class="cm">   * @exception IllegalArgumentException if an argument in the &lt;code&gt;arguments&lt;/code&gt; array is not of the type expected</span>
<span class="cm">   * by the format element(s) that use it.</span>
<span class="cm">   */</span><span class="w"></span>
<span class="w">  </span><span class="nd">@SuppressFBWarnings</span><span class="p">({</span><span class="s">&quot;PRMC_POSSIBLY_REDUNDANT_METHOD_CALLS&quot;</span><span class="p">})</span><span class="w"> </span><span class="c1">// Unfortunately I have no other way to write this</span><span class="w"></span>
<span class="w">  </span><span class="c1">// without code duplication to work for StringBuilder and StringBuffer....</span><span class="w"></span>
<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="o">&lt;</span><span class="n">T</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Appendable</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">CharSequence</span><span class="o">&gt;</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">subformat</span><span class="p">(</span><span class="nd">@Nullable</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">arguments</span><span class="p">,</span><span class="w"> </span><span class="nd">@Nonnull</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="n">result</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="nd">@Nullable</span><span class="w"> </span><span class="n">FieldPosition</span><span class="w"> </span><span class="n">fp</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="nd">@Nullable</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">AttributedCharacterIterator</span><span class="o">&gt;</span><span class="w"> </span><span class="n">characterIterators</span><span class="p">)</span><span class="w"></span>
<span class="w">          </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">lastOffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">last</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="na">length</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">maxOffset</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">FormatInfo</span><span class="w"> </span><span class="n">finfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">formats</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="kt">int</span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">finfo</span><span class="p">.</span><span class="na">getOffset</span><span class="p">();</span><span class="w"></span>
<span class="w">      </span><span class="n">result</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span><span class="w"> </span><span class="n">lastOffset</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">lastOffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">offset</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="kt">int</span><span class="w"> </span><span class="n">argumentNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">finfo</span><span class="p">.</span><span class="na">getArgumentNumber</span><span class="p">();</span><span class="w"></span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">arguments</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">argumentNumber</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">arguments</span><span class="p">.</span><span class="na">length</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">result</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="sc">&#39;{&#39;</span><span class="p">).</span><span class="na">append</span><span class="p">(</span><span class="n">Integer</span><span class="p">.</span><span class="na">toString</span><span class="p">(</span><span class="n">argumentNumber</span><span class="p">)).</span><span class="na">append</span><span class="p">(</span><span class="sc">&#39;}&#39;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">continue</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="n">Object</span><span class="w"> </span><span class="n">obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arguments</span><span class="o">[</span><span class="n">argumentNumber</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">String</span><span class="w"> </span><span class="n">arg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">Format</span><span class="w"> </span><span class="n">subFormatter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">Format</span><span class="w"> </span><span class="n">fmt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">finfo</span><span class="p">.</span><span class="na">getFormat</span><span class="p">();</span><span class="w"></span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">obj</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">arg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;null&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fmt</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">subFormatter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fmt</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">subFormatter</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">ChoiceFormat</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="n">arg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">subFormatter</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="n">obj</span><span class="p">);</span><span class="w"></span>
<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">arg</span><span class="p">.</span><span class="na">indexOf</span><span class="p">(</span><span class="sc">&#39;{&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">subFormatter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MessageFormat</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span><span class="w"> </span><span class="n">locale</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="n">obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arguments</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">arg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>
<span class="w">          </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">obj</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">Number</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// format number if can</span><span class="w"></span>
<span class="w">        </span><span class="n">subFormatter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NumberFormat</span><span class="p">.</span><span class="na">getInstance</span><span class="p">(</span><span class="n">locale</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">obj</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">Date</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// format a Date if can</span><span class="w"></span>
<span class="w">        </span><span class="n">subFormatter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DateFormat</span><span class="p">.</span><span class="na">getDateTimeInstance</span><span class="p">(</span><span class="w"></span>
<span class="w">                </span><span class="n">DateFormat</span><span class="p">.</span><span class="na">SHORT</span><span class="p">,</span><span class="w"> </span><span class="n">DateFormat</span><span class="p">.</span><span class="na">SHORT</span><span class="p">,</span><span class="w"> </span><span class="n">locale</span><span class="p">);</span><span class="c1">//fix</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">obj</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">String</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">arg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">String</span><span class="p">)</span><span class="w"> </span><span class="n">obj</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">arg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obj</span><span class="p">.</span><span class="na">toString</span><span class="p">();</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>

<span class="w">      </span><span class="c1">// At this point we are in two states, either subFormatter</span><span class="w"></span>
<span class="w">      </span><span class="c1">// is non-null indicating we should format obj using it,</span><span class="w"></span>
<span class="w">      </span><span class="c1">// or arg is non-null and we should use it as the value.</span><span class="w"></span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">characterIterators</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// If characterIterators is non-null, it indicates we need</span><span class="w"></span>
<span class="w">        </span><span class="c1">// to get the CharacterIterator from the child formatter.</span><span class="w"></span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">cl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="na">length</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">last</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">cl</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="n">characterIterators</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="w"></span>
<span class="w">                  </span><span class="n">createAttributedCharacterIterator</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">subSequence</span><span class="p">(</span><span class="n">last</span><span class="p">,</span><span class="w"> </span><span class="n">cl</span><span class="p">).</span><span class="na">toString</span><span class="p">()));</span><span class="w"></span>
<span class="w">          </span><span class="n">last</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cl</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">subFormatter</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="n">AttributedCharacterIterator</span><span class="w"> </span><span class="n">subIterator</span><span class="w"></span>
<span class="w">                  </span><span class="o">=</span><span class="w"> </span><span class="n">subFormatter</span><span class="p">.</span><span class="na">formatToCharacterIterator</span><span class="p">(</span><span class="n">obj</span><span class="p">);</span><span class="w"></span>

<span class="w">          </span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="n">subIterator</span><span class="p">);</span><span class="w"></span>
<span class="w">          </span><span class="kt">int</span><span class="w"> </span><span class="n">cl2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="na">length</span><span class="p">();</span><span class="w"></span>
<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">last</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">cl2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">characterIterators</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="w"></span>
<span class="w">                    </span><span class="n">createAttributedCharacterIterator</span><span class="p">(</span><span class="w"></span>
<span class="w">                            </span><span class="n">subIterator</span><span class="p">,</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">text</span><span class="p">.</span><span class="na">MessageFormat</span><span class="p">.</span><span class="na">Field</span><span class="p">.</span><span class="na">ARGUMENT</span><span class="p">,</span><span class="w"></span>
<span class="w">                            </span><span class="n">Integer</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">argumentNumber</span><span class="p">)));</span><span class="w"></span>
<span class="w">            </span><span class="n">last</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cl2</span><span class="p">;</span><span class="w"></span>
<span class="w">          </span><span class="p">}</span><span class="w"></span>
<span class="w">          </span><span class="n">arg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">arg</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">arg</span><span class="p">.</span><span class="na">length</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="n">result</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">arg</span><span class="p">);</span><span class="w"></span>
<span class="w">          </span><span class="n">characterIterators</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="w"></span>
<span class="w">                  </span><span class="n">createAttributedCharacterIterator</span><span class="p">(</span><span class="w"></span>
<span class="w">                          </span><span class="n">arg</span><span class="p">,</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">text</span><span class="p">.</span><span class="na">MessageFormat</span><span class="p">.</span><span class="na">Field</span><span class="p">.</span><span class="na">ARGUMENT</span><span class="p">,</span><span class="w"></span>
<span class="w">                          </span><span class="n">Integer</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">argumentNumber</span><span class="p">)));</span><span class="w"></span>
<span class="w">          </span><span class="n">last</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="na">length</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">subFormatter</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="n">arg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">subFormatter</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="n">obj</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="n">last</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="na">length</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">result</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">arg</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">fp</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">text</span><span class="p">.</span><span class="na">MessageFormat</span><span class="p">.</span><span class="na">Field</span><span class="p">.</span><span class="na">ARGUMENT</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="w"></span>
<span class="w">                </span><span class="n">fp</span><span class="p">.</span><span class="na">getFieldAttribute</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="n">fp</span><span class="p">.</span><span class="na">setBeginIndex</span><span class="p">(</span><span class="n">last</span><span class="p">);</span><span class="w"></span>
<span class="w">          </span><span class="n">fp</span><span class="p">.</span><span class="na">setEndIndex</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">length</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="n">last</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="na">length</span><span class="p">();</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">result</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span><span class="w"> </span><span class="n">lastOffset</span><span class="p">,</span><span class="w"> </span><span class="n">pattern</span><span class="p">.</span><span class="na">length</span><span class="p">());</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">characterIterators</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">last</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="na">length</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">characterIterators</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">createAttributedCharacterIterator</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">subSequence</span><span class="p">(</span><span class="n">last</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="na">length</span><span class="p">()).</span><span class="na">toString</span><span class="p">()));</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>


<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">Slf4jFormat</span><span class="w"> </span><span class="nf">subformatSlf4j</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">     </span><span class="n">StringBuilder</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StringBuilder</span><span class="p">(</span><span class="mi">32</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Slf4jFormatImpl</span><span class="p">.</span><span class="na">ParamConverter</span><span class="o">&gt;</span><span class="w"> </span><span class="n">parameters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">maxOffset</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">lastOffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">maxOffset</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">FormatInfo</span><span class="w"> </span><span class="n">finfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">formats</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="kt">int</span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">finfo</span><span class="p">.</span><span class="na">getOffset</span><span class="p">();</span><span class="w"></span>
<span class="w">      </span><span class="n">result</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span><span class="w"> </span><span class="n">lastOffset</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">lastOffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">offset</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">result</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">parameters</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Slf4jFormatImpl</span><span class="p">.</span><span class="na">FormatInfoParameterConverter</span><span class="p">(</span><span class="n">finfo</span><span class="p">,</span><span class="w"> </span><span class="n">locale</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">result</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span><span class="w"> </span><span class="n">lastOffset</span><span class="p">,</span><span class="w"> </span><span class="n">pattern</span><span class="p">.</span><span class="na">length</span><span class="p">());</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Slf4jFormatImpl</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">toString</span><span class="p">(),</span><span class="w"></span>
<span class="w">            </span><span class="n">parameters</span><span class="p">.</span><span class="na">toArray</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Slf4jFormatImpl</span><span class="p">.</span><span class="na">ParamConverter</span><span class="o">[</span><span class="n">parameters</span><span class="p">.</span><span class="na">size</span><span class="p">()</span><span class="o">]</span><span class="p">));</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>



<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * Convenience method to append all the characters in &lt;code&gt;iterator&lt;/code&gt; to the StringBuffer &lt;code&gt;result&lt;/code&gt;.</span>
<span class="cm">   */</span><span class="w"></span>
<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">append</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">Appendable</span><span class="w"> </span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">CharacterIterator</span><span class="w"> </span><span class="n">iterator</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">first</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iterator</span><span class="p">.</span><span class="na">first</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">first</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">CharacterIterator</span><span class="p">.</span><span class="na">DONE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">result</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">first</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="kt">char</span><span class="w"> </span><span class="n">aChar</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="k">while</span><span class="w"> </span><span class="p">((</span><span class="n">aChar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iterator</span><span class="p">.</span><span class="na">next</span><span class="p">())</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">CharacterIterator</span><span class="p">.</span><span class="na">DONE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">result</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">aChar</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>


<span class="w">  </span><span class="nd">@SuppressFBWarnings</span><span class="p">(</span><span class="s">&quot;CLI_CONSTANT_LIST_INDEX&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">//jdk inherited</span><span class="w"></span>
<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">makeFormat</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">offsetNumber</span><span class="p">,</span><span class="w"> </span><span class="n">StringBuilder</span><span class="o">[]</span><span class="w"> </span><span class="n">textSegments</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">segments</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[</span><span class="n">textSegments</span><span class="p">.</span><span class="na">length</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">textSegments</span><span class="p">.</span><span class="na">length</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">StringBuilder</span><span class="w"> </span><span class="n">oneseg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">textSegments</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">segments</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">oneseg</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">oneseg</span><span class="p">.</span><span class="na">toString</span><span class="p">()</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">// get the argument number</span><span class="w"></span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">argumentNumber</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">argumentNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Integer</span><span class="p">.</span><span class="na">parseInt</span><span class="p">(</span><span class="n">segments</span><span class="o">[</span><span class="n">SEG_INDEX</span><span class="o">]</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">NumberFormatException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">&quot;can&#39;t parse argument number: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">segments</span><span class="o">[</span><span class="n">SEG_INDEX</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">argumentNumber</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">&quot;negative argument number: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">argumentNumber</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">// resize format information arrays if necessary</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">offsetNumber</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">formats</span><span class="p">.</span><span class="na">length</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="kt">int</span><span class="w"> </span><span class="n">newLength</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Math</span><span class="p">.</span><span class="na">max</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="n">formats</span><span class="p">.</span><span class="na">length</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">FormatInfo</span><span class="o">[]</span><span class="w"> </span><span class="n">newFormats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FormatInfo</span><span class="o">[</span><span class="n">newLength</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">System</span><span class="p">.</span><span class="na">arraycopy</span><span class="p">(</span><span class="n">formats</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">newFormats</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">maxOffset</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">formats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newFormats</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">oldMaxOffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">maxOffset</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">maxOffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">offsetNumber</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// now get the format</span><span class="w"></span>
<span class="w">    </span><span class="n">Format</span><span class="w"> </span><span class="n">newFormat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">segments</span><span class="o">[</span><span class="n">SEG_TYPE</span><span class="o">]</span><span class="p">.</span><span class="na">length</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="kt">int</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">findKeyword</span><span class="p">(</span><span class="n">segments</span><span class="o">[</span><span class="n">SEG_TYPE</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">TYPE_KEYWORDS</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="n">TYPE_NULL</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="c1">// Type &quot;&quot; is allowed. e.g., &quot;{0,}&quot;, &quot;{0,,}&quot;, and &quot;{0,,#}&quot;</span><span class="w"></span>
<span class="w">          </span><span class="c1">// are treated as &quot;{0}&quot;.</span><span class="w"></span>
<span class="w">          </span><span class="k">break</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="n">TYPE_NUMBER</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">findKeyword</span><span class="p">(</span><span class="n">segments</span><span class="o">[</span><span class="n">SEG_MODIFIER</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">NUMBER_MODIFIER_KEYWORDS</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">MODIFIER_DEFAULT</span><span class="p">:</span><span class="w"></span>
<span class="w">              </span><span class="n">newFormat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NumberFormat</span><span class="p">.</span><span class="na">getInstance</span><span class="p">(</span><span class="n">locale</span><span class="p">);</span><span class="w"></span>
<span class="w">              </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">MODIFIER_CURRENCY</span><span class="p">:</span><span class="w"></span>
<span class="w">              </span><span class="n">newFormat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NumberFormat</span><span class="p">.</span><span class="na">getCurrencyInstance</span><span class="p">(</span><span class="n">locale</span><span class="p">);</span><span class="w"></span>
<span class="w">              </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">MODIFIER_PERCENT</span><span class="p">:</span><span class="w"></span>
<span class="w">              </span><span class="n">newFormat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NumberFormat</span><span class="p">.</span><span class="na">getPercentInstance</span><span class="p">(</span><span class="n">locale</span><span class="p">);</span><span class="w"></span>
<span class="w">              </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">MODIFIER_INTEGER</span><span class="p">:</span><span class="w"></span>
<span class="w">              </span><span class="n">newFormat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NumberFormat</span><span class="p">.</span><span class="na">getIntegerInstance</span><span class="p">(</span><span class="n">locale</span><span class="p">);</span><span class="w"></span>
<span class="w">              </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="k">default</span><span class="p">:</span><span class="w"> </span><span class="c1">// DecimalFormat pattern</span><span class="w"></span>
<span class="w">              </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">newFormat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DecimalFormat</span><span class="p">(</span><span class="n">segments</span><span class="o">[</span><span class="n">SEG_MODIFIER</span><span class="o">]</span><span class="p">,</span><span class="w"></span>
<span class="w">                        </span><span class="n">DecimalFormatSymbols</span><span class="p">.</span><span class="na">getInstance</span><span class="p">(</span><span class="n">locale</span><span class="p">));</span><span class="w"></span>
<span class="w">              </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IllegalArgumentException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">maxOffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">oldMaxOffset</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="k">throw</span><span class="w"> </span><span class="n">e</span><span class="p">;</span><span class="w"></span>
<span class="w">              </span><span class="p">}</span><span class="w"></span>
<span class="w">              </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">          </span><span class="p">}</span><span class="w"></span>
<span class="w">          </span><span class="k">break</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="n">TYPE_DATE</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="n">TYPE_TIME</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="kt">int</span><span class="w"> </span><span class="n">mod</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">findKeyword</span><span class="p">(</span><span class="n">segments</span><span class="o">[</span><span class="n">SEG_MODIFIER</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">DATE_TIME_MODIFIER_KEYWORDS</span><span class="p">);</span><span class="w"></span>
<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mod</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">mod</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">DATE_TIME_MODIFIER_KEYWORDS</span><span class="p">.</span><span class="na">length</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">TYPE_DATE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">              </span><span class="n">newFormat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DateFormat</span><span class="p">.</span><span class="na">getDateInstance</span><span class="p">(</span><span class="n">DATE_TIME_MODIFIERS</span><span class="o">[</span><span class="n">mod</span><span class="o">]</span><span class="p">,</span><span class="w"></span>
<span class="w">                      </span><span class="n">locale</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">              </span><span class="n">newFormat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DateFormat</span><span class="p">.</span><span class="na">getTimeInstance</span><span class="p">(</span><span class="n">DATE_TIME_MODIFIERS</span><span class="o">[</span><span class="n">mod</span><span class="o">]</span><span class="p">,</span><span class="w"></span>
<span class="w">                      </span><span class="n">locale</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">          </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="c1">// SimpleDateFormat pattern</span><span class="w"></span>
<span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">              </span><span class="n">newFormat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SimpleDateFormat</span><span class="p">(</span><span class="n">segments</span><span class="o">[</span><span class="n">SEG_MODIFIER</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">locale</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IllegalArgumentException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">              </span><span class="n">maxOffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">oldMaxOffset</span><span class="p">;</span><span class="w"></span>
<span class="w">              </span><span class="k">throw</span><span class="w"> </span><span class="n">e</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">          </span><span class="p">}</span><span class="w"></span>
<span class="w">          </span><span class="k">break</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="n">TYPE_CHOICE</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="c1">// ChoiceFormat pattern</span><span class="w"></span>
<span class="w">            </span><span class="n">newFormat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ChoiceFormat</span><span class="p">(</span><span class="n">segments</span><span class="o">[</span><span class="n">SEG_MODIFIER</span><span class="o">]</span><span class="p">);</span><span class="w"></span>
<span class="w">          </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">maxOffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">oldMaxOffset</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">&quot;Choice Pattern incorrect: &quot;</span><span class="w"></span>
<span class="w">                    </span><span class="o">+</span><span class="w"> </span><span class="n">segments</span><span class="o">[</span><span class="n">SEG_MODIFIER</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span><span class="w"></span>
<span class="w">          </span><span class="p">}</span><span class="w"></span>
<span class="w">          </span><span class="k">break</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="k">default</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="n">maxOffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">oldMaxOffset</span><span class="p">;</span><span class="w"></span>
<span class="w">          </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">&quot;unknown format type: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">segments</span><span class="o">[</span><span class="n">SEG_TYPE</span><span class="o">]</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">formats</span><span class="o">[</span><span class="n">offsetNumber</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FormatInfo</span><span class="p">(</span><span class="n">newFormat</span><span class="p">,</span><span class="w"> </span><span class="n">segments</span><span class="o">[</span><span class="n">SEG_RAW</span><span class="o">]</span><span class="p">.</span><span class="na">length</span><span class="p">(),</span><span class="w"> </span><span class="n">argumentNumber</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="nd">@SuppressFBWarnings</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;ES_COMPARING_STRINGS_WITH_EQ&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;IMPROPER_UNICODE&quot;</span><span class="p">},</span><span class="w"></span>
<span class="w">          </span><span class="n">justification</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;optimization&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">findKeyword</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">list</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">list</span><span class="p">.</span><span class="na">length</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">l</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">list</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Try trimmed lowercase.</span><span class="w"></span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">ls</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="na">trim</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ls</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">l</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ls</span><span class="p">.</span><span class="na">equalsIgnoreCase</span><span class="p">(</span><span class="n">list</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">copyAndFixQuotes</span><span class="p">(</span><span class="n">CharSequence</span><span class="w"> </span><span class="n">source</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">start</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">end</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="n">StringBuilder</span><span class="w"> </span><span class="n">target</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">boolean</span><span class="w"> </span><span class="n">quoted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">start</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">end</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="kt">char</span><span class="w"> </span><span class="n">ch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">source</span><span class="p">.</span><span class="na">charAt</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ch</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;{&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">quoted</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="n">target</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="sc">&#39;\&#39;&#39;</span><span class="p">);</span><span class="w"></span>
<span class="w">          </span><span class="n">quoted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="n">target</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">ch</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ch</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="sc">&#39;\&#39;&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">target</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">&quot;&#39;&#39;&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">quoted</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="n">target</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="sc">&#39;\&#39;&#39;</span><span class="p">);</span><span class="w"></span>
<span class="w">          </span><span class="n">quoted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="n">target</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">ch</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">quoted</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">target</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="sc">&#39;\&#39;&#39;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">writeObject</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">io</span><span class="p">.</span><span class="na">ObjectOutputStream</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Write out element count, and any hidden stuff</span><span class="w"></span>
<span class="w">        </span><span class="n">s</span><span class="p">.</span><span class="na">defaultWriteObject</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">s</span><span class="p">.</span><span class="na">writeUTF</span><span class="p">(</span><span class="n">pattern</span><span class="p">.</span><span class="na">toString</span><span class="p">());</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>


<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * After reading an object from the input stream, do a simple verification to maintain class invariants.</span>
<span class="cm">   *</span>
<span class="cm">   * @throws InvalidObjectException if the objects read from the stream is invalid.</span>
<span class="cm">   */</span><span class="w"></span>
<span class="w">  </span><span class="nd">@SuppressFBWarnings</span><span class="p">({</span><span class="s">&quot;WEM_WEAK_EXCEPTION_MESSAGING&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;DESERIALIZATION_GADGET&quot;</span><span class="p">})</span><span class="w"></span>
<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">readObject</span><span class="p">(</span><span class="n">ObjectInputStream</span><span class="w"> </span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="p">,</span><span class="w"> </span><span class="n">ClassNotFoundException</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">in</span><span class="p">.</span><span class="na">defaultReadObject</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">in</span><span class="p">.</span><span class="na">readUTF</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="kt">boolean</span><span class="w"> </span><span class="n">isValid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">maxOffset</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">            </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">formats</span><span class="p">.</span><span class="na">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">maxOffset</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isValid</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="kt">int</span><span class="w"> </span><span class="n">lastOffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pattern</span><span class="p">.</span><span class="na">length</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">maxOffset</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="o">--</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">FormatInfo</span><span class="w"> </span><span class="n">finfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">formats</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">finfo</span><span class="p">.</span><span class="na">getOffset</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">offset</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="n">offset</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">lastOffset</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="n">isValid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>
<span class="w">          </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="n">lastOffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">offset</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">isValid</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">InvalidObjectException</span><span class="p">(</span><span class="s">&quot;Could not reconstruct MessageFormat from corrupt stream&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * Creates an &lt;code&gt;AttributedCharacterIterator&lt;/code&gt; for the String &lt;code&gt;s&lt;/code&gt;.</span>
<span class="cm">   *</span>
<span class="cm">   * @param s String to create AttributedCharacterIterator from</span>
<span class="cm">   * @return AttributedCharacterIterator wrapping s</span>
<span class="cm">   */</span><span class="w"></span>
<span class="w">  </span><span class="kd">static</span><span class="w"> </span><span class="n">AttributedCharacterIterator</span><span class="w"> </span><span class="nf">createAttributedCharacterIterator</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">text</span><span class="p">.</span><span class="na">AttributedString</span><span class="p">(</span><span class="n">s</span><span class="p">).</span><span class="na">getIterator</span><span class="p">();</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>


<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * Returns an AttributedCharacterIterator with the String &lt;code&gt;string&lt;/code&gt; and additional key/value pair</span>
<span class="cm">   * &lt;code&gt;key&lt;/code&gt;, &lt;code&gt;value&lt;/code&gt;.</span>
<span class="cm">   *</span>
<span class="cm">   * @param string String to create AttributedCharacterIterator from</span>
<span class="cm">   * @param key Key for AttributedCharacterIterator</span>
<span class="cm">   * @param value Value associated with key in AttributedCharacterIterator</span>
<span class="cm">   * @return AttributedCharacterIterator wrapping args</span>
<span class="cm">   */</span><span class="w"></span>
<span class="w">  </span><span class="kd">static</span><span class="w"> </span><span class="n">AttributedCharacterIterator</span><span class="w"> </span><span class="nf">createAttributedCharacterIterator</span><span class="p">(</span><span class="w"></span>
<span class="w">          </span><span class="n">String</span><span class="w"> </span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">AttributedCharacterIterator</span><span class="p">.</span><span class="na">Attribute</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="n">Object</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">java</span><span class="p">.</span><span class="na">text</span><span class="p">.</span><span class="na">AttributedString</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">text</span><span class="p">.</span><span class="na">AttributedString</span><span class="p">(</span><span class="n">string</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="n">as</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">as</span><span class="p">.</span><span class="na">getIterator</span><span class="p">();</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="cm">/**</span>
<span class="cm">   * Creates an AttributedCharacterIterator with the contents of &lt;code&gt;iterator&lt;/code&gt; and the additional attribute</span>
<span class="cm">   * &lt;code&gt;key&lt;/code&gt; &lt;code&gt;value&lt;/code&gt;.</span>
<span class="cm">   *</span>
<span class="cm">   * @param iterator Initial AttributedCharacterIterator to add arg to</span>
<span class="cm">   * @param key Key for AttributedCharacterIterator</span>
<span class="cm">   * @param value Value associated with key in AttributedCharacterIterator</span>
<span class="cm">   * @return AttributedCharacterIterator wrapping args</span>
<span class="cm">   */</span><span class="w"></span>
<span class="w">  </span><span class="n">AttributedCharacterIterator</span><span class="w"> </span><span class="nf">createAttributedCharacterIterator</span><span class="p">(</span><span class="w"></span>
<span class="w">          </span><span class="n">AttributedCharacterIterator</span><span class="w"> </span><span class="n">iterator</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="n">AttributedCharacterIterator</span><span class="p">.</span><span class="na">Attribute</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">java</span><span class="p">.</span><span class="na">text</span><span class="p">.</span><span class="na">AttributedString</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">text</span><span class="p">.</span><span class="na">AttributedString</span><span class="p">(</span><span class="n">iterator</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="n">as</span><span class="p">.</span><span class="na">addAttribute</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">as</span><span class="p">.</span><span class="na">getIterator</span><span class="p">();</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="nd">@Override</span><span class="w"></span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">toString</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;MessageFormat{&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;locale=&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">locale</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;, pattern=&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pattern</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="sc">&#39;}&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>
</pre></div></td></tr></table></div>
</body>
</html>
