<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">
<!--
generated by Pygments <https://pygments.org/>
Copyright 2006-2022 by the Pygments team.
Licensed under the BSD license, see LICENSE for details.
-->
<html>
<head>
  <title></title>
  <meta http-equiv="content-type" content="text/html; charset=None">
  <style type="text/css">
/*
generated by Pygments <https://pygments.org/>
Copyright 2006-2022 by the Pygments team.
Licensed under the BSD license, see LICENSE for details.
*/
pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
body .hll { background-color: #ffffcc }
body { background: #f8f8f8; }
body .c { color: #3D7B7B; font-style: italic } /* Comment */
body .err { border: 1px solid #FF0000 } /* Error */
body .k { color: #008000; font-weight: bold } /* Keyword */
body .o { color: #666666 } /* Operator */
body .ch { color: #3D7B7B; font-style: italic } /* Comment.Hashbang */
body .cm { color: #3D7B7B; font-style: italic } /* Comment.Multiline */
body .cp { color: #9C6500 } /* Comment.Preproc */
body .cpf { color: #3D7B7B; font-style: italic } /* Comment.PreprocFile */
body .c1 { color: #3D7B7B; font-style: italic } /* Comment.Single */
body .cs { color: #3D7B7B; font-style: italic } /* Comment.Special */
body .gd { color: #A00000 } /* Generic.Deleted */
body .ge { font-style: italic } /* Generic.Emph */
body .gr { color: #E40000 } /* Generic.Error */
body .gh { color: #000080; font-weight: bold } /* Generic.Heading */
body .gi { color: #008400 } /* Generic.Inserted */
body .go { color: #717171 } /* Generic.Output */
body .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
body .gs { font-weight: bold } /* Generic.Strong */
body .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
body .gt { color: #0044DD } /* Generic.Traceback */
body .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
body .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
body .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
body .kp { color: #008000 } /* Keyword.Pseudo */
body .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
body .kt { color: #B00040 } /* Keyword.Type */
body .m { color: #666666 } /* Literal.Number */
body .s { color: #BA2121 } /* Literal.String */
body .na { color: #687822 } /* Name.Attribute */
body .nb { color: #008000 } /* Name.Builtin */
body .nc { color: #0000FF; font-weight: bold } /* Name.Class */
body .no { color: #880000 } /* Name.Constant */
body .nd { color: #AA22FF } /* Name.Decorator */
body .ni { color: #717171; font-weight: bold } /* Name.Entity */
body .ne { color: #CB3F38; font-weight: bold } /* Name.Exception */
body .nf { color: #0000FF } /* Name.Function */
body .nl { color: #767600 } /* Name.Label */
body .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
body .nt { color: #008000; font-weight: bold } /* Name.Tag */
body .nv { color: #19177C } /* Name.Variable */
body .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
body .w { color: #bbbbbb } /* Text.Whitespace */
body .mb { color: #666666 } /* Literal.Number.Bin */
body .mf { color: #666666 } /* Literal.Number.Float */
body .mh { color: #666666 } /* Literal.Number.Hex */
body .mi { color: #666666 } /* Literal.Number.Integer */
body .mo { color: #666666 } /* Literal.Number.Oct */
body .sa { color: #BA2121 } /* Literal.String.Affix */
body .sb { color: #BA2121 } /* Literal.String.Backtick */
body .sc { color: #BA2121 } /* Literal.String.Char */
body .dl { color: #BA2121 } /* Literal.String.Delimiter */
body .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
body .s2 { color: #BA2121 } /* Literal.String.Double */
body .se { color: #AA5D1F; font-weight: bold } /* Literal.String.Escape */
body .sh { color: #BA2121 } /* Literal.String.Heredoc */
body .si { color: #A45A77; font-weight: bold } /* Literal.String.Interpol */
body .sx { color: #008000 } /* Literal.String.Other */
body .sr { color: #A45A77 } /* Literal.String.Regex */
body .s1 { color: #BA2121 } /* Literal.String.Single */
body .ss { color: #19177C } /* Literal.String.Symbol */
body .bp { color: #008000 } /* Name.Builtin.Pseudo */
body .fm { color: #0000FF } /* Name.Function.Magic */
body .vc { color: #19177C } /* Name.Variable.Class */
body .vg { color: #19177C } /* Name.Variable.Global */
body .vi { color: #19177C } /* Name.Variable.Instance */
body .vm { color: #19177C } /* Name.Variable.Magic */
body .il { color: #666666 } /* Literal.Number.Integer.Long */

  </style>
</head>
<body>
<h2></h2>

<div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm"> * Copyright 2014 Groupon.com</span>
<span class="cm"> *</span>
<span class="cm"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="cm"> * you may not use this file except in compliance with the License.</span>
<span class="cm"> * You may obtain a copy of the License at</span>
<span class="cm"> *</span>
<span class="cm"> *     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="cm"> *</span>
<span class="cm"> * Unless required by applicable law or agreed to in writing, software</span>
<span class="cm"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="cm"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="cm"> * See the License for the specific language governing permissions and</span>
<span class="cm"> * limitations under the License.</span>
<span class="cm"> */</span><span class="w"></span>
<span class="kn">package</span><span class="w"> </span><span class="nn">com.arpnetworking.logback</span><span class="p">;</span><span class="w"></span>

<span class="kn">import</span><span class="w"> </span><span class="nn">ch.qos.logback.classic.Level</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">ch.qos.logback.classic.Logger</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">ch.qos.logback.classic.LoggerContext</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">ch.qos.logback.classic.spi.IThrowableProxy</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">ch.qos.logback.classic.spi.LoggingEvent</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">ch.qos.logback.classic.spi.ThrowableProxy</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.arpnetworking.logback.annotations.LogRedact</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.arpnetworking.logback.annotations.Loggable</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.arpnetworking.logback.widgets.Widget</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.arpnetworking.logback.widgets.WidgetWithLogValue</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.arpnetworking.logback.widgets.WidgetWithLogValueProvidingReference</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.arpnetworking.logback.widgets.WidgetWithLoggable</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.arpnetworking.steno.LogValueMapFactory</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.fasterxml.jackson.core.JsonFactory</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.fasterxml.jackson.core.JsonGenerationException</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.fasterxml.jackson.core.JsonGenerator</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.fasterxml.jackson.databind.Module</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.fasterxml.jackson.databind.ObjectMapper</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.fasterxml.jackson.databind.node.ObjectNode</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.fasterxml.jackson.datatype.jsr310.JavaTimeModule</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.networknt.schema.JsonSchema</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.networknt.schema.JsonSchemaFactory</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.networknt.schema.SpecVersion</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">com.networknt.schema.ValidationMessage</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">edu.umd.cs.findbugs.annotations.SuppressFBWarnings</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.Assert</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.Before</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.Test</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.mockito.Mockito</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.slf4j.MDC</span><span class="p">;</span><span class="w"></span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.io.ByteArrayOutputStream</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.io.IOException</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.io.InputStream</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.io.Writer</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.net.URISyntaxException</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.net.URL</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.nio.charset.StandardCharsets</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.nio.file.Files</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.nio.file.Paths</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.DayOfWeek</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.Instant</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.ZoneId</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.ZonedDateTime</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Arrays</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Collections</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.LinkedHashMap</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Map</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Set</span><span class="p">;</span><span class="w"></span>

<span class="cm">/**</span>
<span class="cm"> * Tests for {@link StenoEncoder}.</span>
<span class="cm"> *</span>
<span class="cm"> * @author Gil Markham (gil at groupon dot com)</span>
<span class="cm"> */</span><span class="w"></span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">StenoEncoderTest</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Before</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setUp</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">_javaTimeModule</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JavaTimeModule</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">_context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggerContext</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">_baos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ByteArrayOutputStream</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StenoEncoder</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setRedactEnabled</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setRedactNull</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setImmediateFlush</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setContext</span><span class="p">(</span><span class="n">_context</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">addJacksonModule</span><span class="p">(</span><span class="n">_javaTimeModule</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">start</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testEncodeArray</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">INFO</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMarker</span><span class="p">(</span><span class="n">StenoMarker</span><span class="p">.</span><span class="na">ARRAY_MARKER</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;logEvent&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="p">{</span><span class="s">&quot;key1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;key2&quot;</span><span class="p">};</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="p">{</span><span class="n">Integer</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="mi">1234</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;foo&quot;</span><span class="p">};</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setArgumentArray</span><span class="p">(</span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testEncodeArray.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testEncodeArrayWithException</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">INFO</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMarker</span><span class="p">(</span><span class="n">StenoMarker</span><span class="p">.</span><span class="na">ARRAY_MARKER</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;logEvent&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setThrowableProxy</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">ThrowableProxy</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">NullPointerException</span><span class="p">(</span><span class="s">&quot;npe!&quot;</span><span class="p">)));</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="p">{};</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="p">{};</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setArgumentArray</span><span class="p">(</span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testEncodeArrayWithException.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testEncodeArrayWithCausedException</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">INFO</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMarker</span><span class="p">(</span><span class="n">StenoMarker</span><span class="p">.</span><span class="na">ARRAY_MARKER</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;logEvent&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setThrowableProxy</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">ThrowableProxy</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">UnsupportedOperationException</span><span class="p">(</span><span class="s">&quot;uoe!&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">NullPointerException</span><span class="p">(</span><span class="s">&quot;npe!&quot;</span><span class="p">))));</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="p">{};</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="p">{};</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setArgumentArray</span><span class="p">(</span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testEncodeArrayWithCausedException.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testEncodeArrayWithSuppressedException</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">INFO</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMarker</span><span class="p">(</span><span class="n">StenoMarker</span><span class="p">.</span><span class="na">ARRAY_MARKER</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;logEvent&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Throwable</span><span class="w"> </span><span class="n">throwable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">NullPointerException</span><span class="p">(</span><span class="s">&quot;npe!&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">throwable</span><span class="p">.</span><span class="na">addSuppressed</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">UnsupportedOperationException</span><span class="p">(</span><span class="s">&quot;uoe!&quot;</span><span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setThrowableProxy</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">ThrowableProxy</span><span class="p">(</span><span class="n">throwable</span><span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="p">{};</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="p">{};</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setArgumentArray</span><span class="p">(</span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testEncodeArrayWithSuppressedException.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="nd">@SuppressFBWarnings</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;SIC_INNER_SHOULD_BE_STATIC_ANON&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testEncodeArrayWithNullSuppressedException</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">INFO</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMarker</span><span class="p">(</span><span class="n">StenoMarker</span><span class="p">.</span><span class="na">ARRAY_MARKER</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;logEvent&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setThrowableProxy</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">ThrowableProxy</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">NullPointerException</span><span class="p">(</span><span class="s">&quot;npe!&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="nd">@Override</span><span class="w"></span>
<span class="w">            </span><span class="nd">@SuppressFBWarnings</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;PZLA_PREFER_ZERO_LENGTH_ARRAYS&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="kd">public</span><span class="w"> </span><span class="n">IThrowableProxy</span><span class="o">[]</span><span class="w"> </span><span class="nf">getSuppressed</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">});</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="p">{};</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="p">{};</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setArgumentArray</span><span class="p">(</span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testEncodeArrayWithNullSuppressedException.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testEncodeArrayComplexValue</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">INFO</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMarker</span><span class="p">(</span><span class="n">StenoMarker</span><span class="p">.</span><span class="na">ARRAY_MARKER</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;logEvent&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">ZonedDateTime</span><span class="w"> </span><span class="n">date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZonedDateTime</span><span class="p">.</span><span class="na">ofInstant</span><span class="p">(</span><span class="n">Instant</span><span class="p">.</span><span class="na">ofEpochMilli</span><span class="p">(</span><span class="mi">1415737981000L</span><span class="p">),</span><span class="w"> </span><span class="n">ZoneId</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="s">&quot;UTC&quot;</span><span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="p">{</span><span class="s">&quot;key1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;redacted&quot;</span><span class="p">};</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="p">{</span><span class="n">date</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Redacted</span><span class="p">(</span><span class="s">&quot;string&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1L</span><span class="p">)};</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setArgumentArray</span><span class="p">(</span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setRedactEnabled</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testEncodeArrayComplexValue.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testEncodeArrayNullValues</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">INFO</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMarker</span><span class="p">(</span><span class="n">StenoMarker</span><span class="p">.</span><span class="na">ARRAY_MARKER</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;logEvent&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="p">{</span><span class="s">&quot;key1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;key2&quot;</span><span class="p">};</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setArgumentArray</span><span class="p">(</span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testEncodeArrayNullValues.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testEncodeArrayNullKeys</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">INFO</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMarker</span><span class="p">(</span><span class="n">StenoMarker</span><span class="p">.</span><span class="na">ARRAY_MARKER</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;logEvent&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="p">{</span><span class="n">Integer</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="mi">1234</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;foo&quot;</span><span class="p">};</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setArgumentArray</span><span class="p">(</span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testEncodeArrayNullKeys.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testEncodeArrayThrowsIOException</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">INFO</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMarker</span><span class="p">(</span><span class="n">StenoMarker</span><span class="p">.</span><span class="na">ARRAY_MARKER</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;logEvent&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="p">{</span><span class="s">&quot;key1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;key2&quot;</span><span class="p">};</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="p">{</span><span class="n">Integer</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="mi">1234</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;foo&quot;</span><span class="p">};</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setArgumentArray</span><span class="p">(</span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">objectMapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Mockito</span><span class="p">.</span><span class="na">mock</span><span class="p">(</span><span class="n">ObjectMapper</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">JsonFactory</span><span class="w"> </span><span class="n">jsonFactory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Mockito</span><span class="p">.</span><span class="na">mock</span><span class="p">(</span><span class="n">JsonFactory</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Mockito</span><span class="p">.</span><span class="na">doThrow</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">IOException</span><span class="p">(</span><span class="s">&quot;Mock Failure&quot;</span><span class="p">)).</span><span class="na">when</span><span class="p">(</span><span class="n">jsonFactory</span><span class="p">).</span><span class="na">createGenerator</span><span class="p">(</span><span class="n">Mockito</span><span class="p">.</span><span class="na">any</span><span class="p">(</span><span class="n">Writer</span><span class="p">.</span><span class="na">class</span><span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StenoEncoder</span><span class="p">(</span><span class="n">jsonFactory</span><span class="p">,</span><span class="w"> </span><span class="n">objectMapper</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testEncodeArrayThrowsIOException.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testEncodeArrayJson</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">INFO</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMarker</span><span class="p">(</span><span class="n">StenoMarker</span><span class="p">.</span><span class="na">ARRAY_JSON_MARKER</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;logEvent&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="p">{</span><span class="s">&quot;key1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;key2&quot;</span><span class="p">};</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="p">{</span><span class="s">&quot;{\&quot;foo\&quot;:\&quot;bar\&quot;}&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;[\&quot;foo\&quot;,\&quot;bar\&quot;]&quot;</span><span class="p">};</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setArgumentArray</span><span class="p">(</span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testEncodeArrayJson.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testEncodeArrayJsonNullValues</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">INFO</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMarker</span><span class="p">(</span><span class="n">StenoMarker</span><span class="p">.</span><span class="na">ARRAY_JSON_MARKER</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;logEvent&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="p">{</span><span class="s">&quot;key1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;key2&quot;</span><span class="p">};</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setArgumentArray</span><span class="p">(</span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testEncodeArrayJsonNullValues.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testEncodeArrayJsonNullKeys</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">INFO</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMarker</span><span class="p">(</span><span class="n">StenoMarker</span><span class="p">.</span><span class="na">ARRAY_JSON_MARKER</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;logEvent&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="p">{</span><span class="s">&quot;{\&quot;foo\&quot;:\&quot;bar\&quot;}&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;[\&quot;foo\&quot;,\&quot;bar\&quot;]&quot;</span><span class="p">};</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setArgumentArray</span><span class="p">(</span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testEncodeArrayJsonNullKeys.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testEncodeArrayJsonThrowsIOException</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">INFO</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMarker</span><span class="p">(</span><span class="n">StenoMarker</span><span class="p">.</span><span class="na">ARRAY_JSON_MARKER</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;logEvent&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="p">{</span><span class="s">&quot;key1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;key2&quot;</span><span class="p">};</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="p">{</span><span class="s">&quot;{\&quot;foo\&quot;:\&quot;bar\&quot;}&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;[\&quot;foo\&quot;,\&quot;bar\&quot;]&quot;</span><span class="p">};</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setArgumentArray</span><span class="p">(</span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">objectMapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Mockito</span><span class="p">.</span><span class="na">mock</span><span class="p">(</span><span class="n">ObjectMapper</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">JsonFactory</span><span class="w"> </span><span class="n">jsonFactory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Mockito</span><span class="p">.</span><span class="na">mock</span><span class="p">(</span><span class="n">JsonFactory</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Mockito</span><span class="p">.</span><span class="na">doThrow</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">IOException</span><span class="p">(</span><span class="s">&quot;Mock Failure&quot;</span><span class="p">)).</span><span class="na">when</span><span class="p">(</span><span class="n">jsonFactory</span><span class="p">).</span><span class="na">createGenerator</span><span class="p">(</span><span class="n">Mockito</span><span class="p">.</span><span class="na">any</span><span class="p">(</span><span class="n">Writer</span><span class="p">.</span><span class="na">class</span><span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StenoEncoder</span><span class="p">(</span><span class="n">jsonFactory</span><span class="p">,</span><span class="w"> </span><span class="n">objectMapper</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testEncodeArrayJsonThrowsIOException.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testEncodeMap</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">INFO</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMarker</span><span class="p">(</span><span class="n">StenoMarker</span><span class="p">.</span><span class="na">MAP_MARKER</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;logEvent&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LinkedHashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">map</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;key1&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Integer</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="mi">1234</span><span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="n">map</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;key2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;foo&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">map</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setArgumentArray</span><span class="p">(</span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testEncodeMap.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testEncodeMapComplexValue</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">INFO</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMarker</span><span class="p">(</span><span class="n">StenoMarker</span><span class="p">.</span><span class="na">MAP_MARKER</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;logEvent&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">ZonedDateTime</span><span class="w"> </span><span class="n">date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZonedDateTime</span><span class="p">.</span><span class="na">ofInstant</span><span class="p">(</span><span class="n">Instant</span><span class="p">.</span><span class="na">ofEpochMilli</span><span class="p">(</span><span class="mi">1415737981000L</span><span class="p">),</span><span class="w"> </span><span class="n">ZoneId</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="s">&quot;UTC&quot;</span><span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LinkedHashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">map</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;key1&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">date</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">map</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setArgumentArray</span><span class="p">(</span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testEncodeMapComplexValue.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testEncodeMapNullValues</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">INFO</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMarker</span><span class="p">(</span><span class="n">StenoMarker</span><span class="p">.</span><span class="na">MAP_MARKER</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;logEvent&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LinkedHashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">map</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;key1&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">map</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;key2&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">map</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setArgumentArray</span><span class="p">(</span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testEncodeMapNullValues.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testEncodeMapNullMap</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">INFO</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMarker</span><span class="p">(</span><span class="n">StenoMarker</span><span class="p">.</span><span class="na">MAP_MARKER</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;logEvent&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setArgumentArray</span><span class="p">(</span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testEncodeMapNullMap.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testEncodeMapThrowsIOException</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">INFO</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMarker</span><span class="p">(</span><span class="n">StenoMarker</span><span class="p">.</span><span class="na">MAP_MARKER</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;logEvent&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LinkedHashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">map</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;key1&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Integer</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="mi">1234</span><span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="n">map</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;key2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;foo&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">map</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setArgumentArray</span><span class="p">(</span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">objectMapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Mockito</span><span class="p">.</span><span class="na">mock</span><span class="p">(</span><span class="n">ObjectMapper</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">JsonFactory</span><span class="w"> </span><span class="n">jsonFactory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Mockito</span><span class="p">.</span><span class="na">mock</span><span class="p">(</span><span class="n">JsonFactory</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Mockito</span><span class="p">.</span><span class="na">doThrow</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">IOException</span><span class="p">(</span><span class="s">&quot;Mock Failure&quot;</span><span class="p">)).</span><span class="na">when</span><span class="p">(</span><span class="n">jsonFactory</span><span class="p">).</span><span class="na">createGenerator</span><span class="p">(</span><span class="n">Mockito</span><span class="p">.</span><span class="na">any</span><span class="p">(</span><span class="n">Writer</span><span class="p">.</span><span class="na">class</span><span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StenoEncoder</span><span class="p">(</span><span class="n">jsonFactory</span><span class="p">,</span><span class="w"> </span><span class="n">objectMapper</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testEncodeMapThrowsIOException.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testEncodeMapJson</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">INFO</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMarker</span><span class="p">(</span><span class="n">StenoMarker</span><span class="p">.</span><span class="na">MAP_JSON_MARKER</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;logEvent&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LinkedHashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">map</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;key1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;{\&quot;foo\&quot;:\&quot;bar\&quot;}&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">map</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;key2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;[\&quot;foo\&quot;,\&quot;bar\&quot;]&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">map</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setArgumentArray</span><span class="p">(</span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testEncodeMapJson.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testEncodeMapJsonNullValues</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">INFO</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMarker</span><span class="p">(</span><span class="n">StenoMarker</span><span class="p">.</span><span class="na">MAP_JSON_MARKER</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;logEvent&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LinkedHashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">map</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;key1&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">map</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;key2&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">map</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setArgumentArray</span><span class="p">(</span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testEncodeMapJsonNullValues.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testEncodeMapJsonNullMap</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">INFO</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMarker</span><span class="p">(</span><span class="n">StenoMarker</span><span class="p">.</span><span class="na">MAP_JSON_MARKER</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;logEvent&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setArgumentArray</span><span class="p">(</span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testEncodeMapJsonNullMap.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testEncodeMapJsonThrowsIOException</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">INFO</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMarker</span><span class="p">(</span><span class="n">StenoMarker</span><span class="p">.</span><span class="na">MAP_JSON_MARKER</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;logEvent&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LinkedHashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">map</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;key1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;{\&quot;foo\&quot;:\&quot;bar\&quot;}&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">map</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;key2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;[\&quot;foo\&quot;,\&quot;bar\&quot;]&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">map</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setArgumentArray</span><span class="p">(</span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">objectMapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Mockito</span><span class="p">.</span><span class="na">mock</span><span class="p">(</span><span class="n">ObjectMapper</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">JsonFactory</span><span class="w"> </span><span class="n">jsonFactory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Mockito</span><span class="p">.</span><span class="na">mock</span><span class="p">(</span><span class="n">JsonFactory</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Mockito</span><span class="p">.</span><span class="na">doThrow</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">IOException</span><span class="p">(</span><span class="s">&quot;Mock Failure&quot;</span><span class="p">)).</span><span class="na">when</span><span class="p">(</span><span class="n">jsonFactory</span><span class="p">).</span><span class="na">createGenerator</span><span class="p">(</span><span class="n">Mockito</span><span class="p">.</span><span class="na">any</span><span class="p">(</span><span class="n">Writer</span><span class="p">.</span><span class="na">class</span><span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StenoEncoder</span><span class="p">(</span><span class="n">jsonFactory</span><span class="p">,</span><span class="w"> </span><span class="n">objectMapper</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testEncodeMapJsonThrowsIOException.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testEncodeObject</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">INFO</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMarker</span><span class="p">(</span><span class="n">StenoMarker</span><span class="p">.</span><span class="na">OBJECT_MARKER</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;logEvent&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Widget</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setArgumentArray</span><span class="p">(</span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testEncodeObject.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testEncodeObjectUnsafe</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">INFO</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMarker</span><span class="p">(</span><span class="n">StenoMarker</span><span class="p">.</span><span class="na">OBJECT_MARKER</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;logEvent&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Widget</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setArgumentArray</span><span class="p">(</span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertTrue</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">isSafe</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setSafe</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertFalse</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">isSafe</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testEncodeObjectUnsafe.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testEncodeObjectWithInjectBeanIdentity</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">INFO</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMarker</span><span class="p">(</span><span class="n">StenoMarker</span><span class="p">.</span><span class="na">OBJECT_MARKER</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;logEvent&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Widget</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setArgumentArray</span><span class="p">(</span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertFalse</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">isInjectBeanIdentifier</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setInjectBeanIdentifier</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertTrue</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">isInjectBeanIdentifier</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testEncodeObjectWithInjectBeanIdentity.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testEncodeObjectWithInjectBeanIdentityUnsafe</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">INFO</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMarker</span><span class="p">(</span><span class="n">StenoMarker</span><span class="p">.</span><span class="na">OBJECT_MARKER</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;logEvent&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Widget</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setArgumentArray</span><span class="p">(</span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertFalse</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">isInjectBeanIdentifier</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setInjectBeanIdentifier</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertTrue</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">isInjectBeanIdentifier</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertTrue</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">isSafe</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setSafe</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertFalse</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">isSafe</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testEncodeObjectWithInjectBeanIdentityUnsafe.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testEncodeLoggableObject</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">INFO</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMarker</span><span class="p">(</span><span class="n">StenoMarker</span><span class="p">.</span><span class="na">OBJECT_MARKER</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;logEvent&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WidgetWithLoggable</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setArgumentArray</span><span class="p">(</span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testEncodeLoggableObject.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testEncodeLoggableObjectWithInjectBeanIdentity</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">INFO</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMarker</span><span class="p">(</span><span class="n">StenoMarker</span><span class="p">.</span><span class="na">OBJECT_MARKER</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;logEvent&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WidgetWithLoggable</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setArgumentArray</span><span class="p">(</span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertFalse</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">isInjectBeanIdentifier</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setInjectBeanIdentifier</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertTrue</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">isInjectBeanIdentifier</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testEncodeLoggableObjectWithInjectBeanIdentity.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testEncodeLogValueObject</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">INFO</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMarker</span><span class="p">(</span><span class="n">StenoMarker</span><span class="p">.</span><span class="na">OBJECT_MARKER</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;logEvent&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WidgetWithLogValue</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setArgumentArray</span><span class="p">(</span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testEncodeLogValueObject.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testEncodeLogValueObjectWithInjectBeanIdentity</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">INFO</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMarker</span><span class="p">(</span><span class="n">StenoMarker</span><span class="p">.</span><span class="na">OBJECT_MARKER</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;logEvent&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WidgetWithLogValueProvidingReference</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setArgumentArray</span><span class="p">(</span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertFalse</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">isInjectBeanIdentifier</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setInjectBeanIdentifier</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertTrue</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">isInjectBeanIdentifier</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testEncodeLogValueObjectWithInjectBeanIdentity.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testEncodeObjectThrowsIOException</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">INFO</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMarker</span><span class="p">(</span><span class="n">StenoMarker</span><span class="p">.</span><span class="na">OBJECT_MARKER</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;logEvent&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Widget</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setArgumentArray</span><span class="p">(</span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">objectMapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Mockito</span><span class="p">.</span><span class="na">mock</span><span class="p">(</span><span class="n">ObjectMapper</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Mockito</span><span class="p">.</span><span class="na">doThrow</span><span class="p">(</span><span class="w"></span>
<span class="w">                </span><span class="k">new</span><span class="w"> </span><span class="n">JsonGenerationException</span><span class="p">(</span><span class="w"></span>
<span class="w">                        </span><span class="s">&quot;Mock Failure&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">                        </span><span class="n">Mockito</span><span class="p">.</span><span class="na">mock</span><span class="p">(</span><span class="n">JsonGenerator</span><span class="p">.</span><span class="na">class</span><span class="p">)))</span><span class="w"></span>
<span class="w">                </span><span class="p">.</span><span class="na">when</span><span class="p">(</span><span class="n">objectMapper</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="p">.</span><span class="na">writeValueAsString</span><span class="p">(</span><span class="n">Mockito</span><span class="p">.</span><span class="na">any</span><span class="p">(</span><span class="n">Object</span><span class="p">.</span><span class="na">class</span><span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">JsonFactory</span><span class="w"> </span><span class="n">jsonFactory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Mockito</span><span class="p">.</span><span class="na">mock</span><span class="p">(</span><span class="n">JsonFactory</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StenoEncoder</span><span class="p">(</span><span class="n">jsonFactory</span><span class="p">,</span><span class="w"> </span><span class="n">objectMapper</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testEncodeObjectThrowsIOException.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testEncodeObjectNull</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">INFO</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMarker</span><span class="p">(</span><span class="n">StenoMarker</span><span class="p">.</span><span class="na">OBJECT_MARKER</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;logEvent&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setArgumentArray</span><span class="p">(</span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testEncodeObjectNull.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testEncodeObjectJson</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">INFO</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMarker</span><span class="p">(</span><span class="n">StenoMarker</span><span class="p">.</span><span class="na">OBJECT_JSON_MARKER</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;logEvent&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;{\&quot;key\&quot;:\&quot;value\&quot;}&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setArgumentArray</span><span class="p">(</span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testEncodeObjectJson.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testEncodeObjectJsonThrowsIOException</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">INFO</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMarker</span><span class="p">(</span><span class="n">StenoMarker</span><span class="p">.</span><span class="na">OBJECT_JSON_MARKER</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;logEvent&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;{\&quot;key\&quot;:\&quot;value\&quot;}&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setArgumentArray</span><span class="p">(</span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">objectMapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Mockito</span><span class="p">.</span><span class="na">mock</span><span class="p">(</span><span class="n">ObjectMapper</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">JsonFactory</span><span class="w"> </span><span class="n">jsonFactory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Mockito</span><span class="p">.</span><span class="na">mock</span><span class="p">(</span><span class="n">JsonFactory</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Mockito</span><span class="p">.</span><span class="na">doThrow</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">IOException</span><span class="p">(</span><span class="s">&quot;Mock Failure&quot;</span><span class="p">)).</span><span class="na">when</span><span class="p">(</span><span class="n">jsonFactory</span><span class="p">).</span><span class="na">createGenerator</span><span class="p">(</span><span class="n">Mockito</span><span class="p">.</span><span class="na">any</span><span class="p">(</span><span class="n">Writer</span><span class="p">.</span><span class="na">class</span><span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StenoEncoder</span><span class="p">(</span><span class="n">jsonFactory</span><span class="p">,</span><span class="w"> </span><span class="n">objectMapper</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testEncodeObjectJsonThrowsIOException.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testEncodeObjectJsonNull</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">INFO</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMarker</span><span class="p">(</span><span class="n">StenoMarker</span><span class="p">.</span><span class="na">OBJECT_JSON_MARKER</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;logEvent&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setArgumentArray</span><span class="p">(</span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testEncodeObjectJsonNull.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testEncodeLists</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">INFO</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMarker</span><span class="p">(</span><span class="n">StenoMarker</span><span class="p">.</span><span class="na">LISTS_MARKER</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;logEvent&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">4</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="s">&quot;key1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;key2&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="n">Integer</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="mi">1234</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;foo&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="s">&quot;CONTEXT_KEY1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;CONTEXT_KEY2&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="s">&quot;bar&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Double</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="mf">1.23</span><span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setArgumentArray</span><span class="p">(</span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testEncodeLists.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testEncodeListsThrowsIOException</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">INFO</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMarker</span><span class="p">(</span><span class="n">StenoMarker</span><span class="p">.</span><span class="na">LISTS_MARKER</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;logEvent&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">4</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="s">&quot;key1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;key2&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="n">Integer</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="mi">1234</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;foo&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="s">&quot;CONTEXT_KEY1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;CONTEXT_KEY2&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="s">&quot;bar&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Double</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="mf">1.23</span><span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setArgumentArray</span><span class="p">(</span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">objectMapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Mockito</span><span class="p">.</span><span class="na">mock</span><span class="p">(</span><span class="n">ObjectMapper</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">JsonFactory</span><span class="w"> </span><span class="n">jsonFactory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Mockito</span><span class="p">.</span><span class="na">mock</span><span class="p">(</span><span class="n">JsonFactory</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Mockito</span><span class="p">.</span><span class="na">doThrow</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">IOException</span><span class="p">(</span><span class="s">&quot;Mock Failure&quot;</span><span class="p">)).</span><span class="na">when</span><span class="p">(</span><span class="n">jsonFactory</span><span class="p">).</span><span class="na">createGenerator</span><span class="p">(</span><span class="n">Mockito</span><span class="p">.</span><span class="na">any</span><span class="p">(</span><span class="n">Writer</span><span class="p">.</span><span class="na">class</span><span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StenoEncoder</span><span class="p">(</span><span class="n">jsonFactory</span><span class="p">,</span><span class="w"> </span><span class="n">objectMapper</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testEncodeListsThrowsIOException.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testEncodeListsEmpty</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">INFO</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMarker</span><span class="p">(</span><span class="n">StenoMarker</span><span class="p">.</span><span class="na">LISTS_MARKER</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;logEvent&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">4</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Collections</span><span class="p">.</span><span class="na">emptyList</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Collections</span><span class="p">.</span><span class="na">emptyList</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Collections</span><span class="p">.</span><span class="na">emptyList</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Collections</span><span class="p">.</span><span class="na">emptyList</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setArgumentArray</span><span class="p">(</span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testEncodeListsEmpty.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testEncodeListsNull</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">INFO</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMarker</span><span class="p">(</span><span class="n">StenoMarker</span><span class="p">.</span><span class="na">LISTS_MARKER</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;logEvent&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">4</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setArgumentArray</span><span class="p">(</span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testEncodeListsEmpty.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testEncodeListsValuesWithoutKeys</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">INFO</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMarker</span><span class="p">(</span><span class="n">StenoMarker</span><span class="p">.</span><span class="na">LISTS_MARKER</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;logEvent&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">4</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Collections</span><span class="p">.</span><span class="na">singletonList</span><span class="p">(</span><span class="s">&quot;key1&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="n">Integer</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="mi">1234</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;foo&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Collections</span><span class="p">.</span><span class="na">singletonList</span><span class="p">(</span><span class="s">&quot;CONTEXT_KEY1&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="s">&quot;bar&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Double</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="mf">1.23</span><span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setArgumentArray</span><span class="p">(</span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testEncodeListsValuesWithoutKeys.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testEncodeListsNullValues</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">INFO</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMarker</span><span class="p">(</span><span class="n">StenoMarker</span><span class="p">.</span><span class="na">LISTS_MARKER</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;logEvent&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">4</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="s">&quot;key1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;key2&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="s">&quot;CONTEXT_KEY1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;CONTEXT_KEY2&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setArgumentArray</span><span class="p">(</span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testEncodeListsNullValues.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testEncodeListsComplexValue</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">INFO</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMarker</span><span class="p">(</span><span class="n">StenoMarker</span><span class="p">.</span><span class="na">LISTS_MARKER</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;logEvent&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">ZonedDateTime</span><span class="w"> </span><span class="n">date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZonedDateTime</span><span class="p">.</span><span class="na">ofInstant</span><span class="p">(</span><span class="n">Instant</span><span class="p">.</span><span class="na">ofEpochMilli</span><span class="p">(</span><span class="mi">1415737981000L</span><span class="p">),</span><span class="w"> </span><span class="n">ZoneId</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="s">&quot;UTC&quot;</span><span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">4</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Collections</span><span class="p">.</span><span class="na">singletonList</span><span class="p">(</span><span class="s">&quot;key1&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Collections</span><span class="p">.</span><span class="na">singletonList</span><span class="p">(</span><span class="n">date</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Collections</span><span class="p">.</span><span class="na">singletonList</span><span class="p">(</span><span class="s">&quot;CONTEXT_KEY1&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Collections</span><span class="p">.</span><span class="na">singletonList</span><span class="p">(</span><span class="n">date</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setArgumentArray</span><span class="p">(</span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testEncodeListsComplexValue.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testEncodeStandardEvent</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">ZonedDateTime</span><span class="w"> </span><span class="n">eventTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZonedDateTime</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="s">&quot;2011-11-11T11:11:11.000Z&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">TRACE</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;logEvent - foo = {}&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="n">eventTime</span><span class="p">.</span><span class="na">toInstant</span><span class="p">().</span><span class="na">toEpochMilli</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;bar&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setArgumentArray</span><span class="p">(</span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testEncodeStandardEvent.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testEncodeStandardEventThrowsIOException</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">ZonedDateTime</span><span class="w"> </span><span class="n">eventTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZonedDateTime</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="s">&quot;2011-11-11T11:11:11.000Z&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">TRACE</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;logEvent - foo = {}&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="n">eventTime</span><span class="p">.</span><span class="na">toInstant</span><span class="p">().</span><span class="na">toEpochMilli</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;bar&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setArgumentArray</span><span class="p">(</span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">objectMapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Mockito</span><span class="p">.</span><span class="na">mock</span><span class="p">(</span><span class="n">ObjectMapper</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">JsonFactory</span><span class="w"> </span><span class="n">jsonFactory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Mockito</span><span class="p">.</span><span class="na">mock</span><span class="p">(</span><span class="n">JsonFactory</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Mockito</span><span class="p">.</span><span class="na">doThrow</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">IOException</span><span class="p">(</span><span class="s">&quot;Mock Failure&quot;</span><span class="p">)).</span><span class="na">when</span><span class="p">(</span><span class="n">jsonFactory</span><span class="p">).</span><span class="na">createGenerator</span><span class="p">(</span><span class="n">Mockito</span><span class="p">.</span><span class="na">any</span><span class="p">(</span><span class="n">Writer</span><span class="p">.</span><span class="na">class</span><span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StenoEncoder</span><span class="p">(</span><span class="n">jsonFactory</span><span class="p">,</span><span class="w"> </span><span class="n">objectMapper</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testEncodeStandardEventThrowsIOException.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testEncodeStandardEventWithCustomEventName</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">ZonedDateTime</span><span class="w"> </span><span class="n">eventTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZonedDateTime</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="s">&quot;2011-11-11T11:11:11.000Z&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">TRACE</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;logEvent - foo = {}&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="n">eventTime</span><span class="p">.</span><span class="na">toInstant</span><span class="p">().</span><span class="na">toEpochMilli</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;bar&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setArgumentArray</span><span class="p">(</span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setLogEventName</span><span class="p">(</span><span class="s">&quot;custom.name&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="s">&quot;custom.name&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getLogEventName</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertTrue</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">isInjectContextHost</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertTrue</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">isInjectContextThread</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertTrue</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">isInjectContextProcess</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testEncodeStandardEventWithCustomEventName.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testEncodeStandardEventWithCompressedLoggerName</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">ZonedDateTime</span><span class="w"> </span><span class="n">eventTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZonedDateTime</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="s">&quot;2011-11-11T11:11:11.000Z&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">TRACE</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;logEvent - foo = {}&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerName</span><span class="p">(</span><span class="s">&quot;foo.bar.loggerName&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="n">eventTime</span><span class="p">.</span><span class="na">toInstant</span><span class="p">().</span><span class="na">toEpochMilli</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;bar&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setArgumentArray</span><span class="p">(</span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setInjectContextLogger</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setCompressLoggerName</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertTrue</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">isCompressLoggerName</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testEncodeStandardEventWithCompressedLoggerName.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testEncodeStandardEventWithSuppressDefaultContext</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">ZonedDateTime</span><span class="w"> </span><span class="n">eventTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZonedDateTime</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="s">&quot;2011-11-11T11:11:11.000Z&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">TRACE</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;logEvent - foo = {}&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="n">eventTime</span><span class="p">.</span><span class="na">toInstant</span><span class="p">().</span><span class="na">toEpochMilli</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;bar&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setArgumentArray</span><span class="p">(</span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertFalse</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">isInjectContextClass</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertFalse</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">isInjectContextFile</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertFalse</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">isInjectContextLine</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertFalse</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">isInjectContextLogger</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertFalse</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">isInjectContextMethod</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setInjectContextHost</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertFalse</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">isInjectContextHost</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setInjectContextProcess</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertFalse</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">isInjectContextProcess</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setInjectContextThread</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertFalse</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">isInjectContextThread</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testEncodeStandardEventWithSuppressDefaultContext.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testEncodeStandardEventWithMdcProperties</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">ZonedDateTime</span><span class="w"> </span><span class="n">eventTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZonedDateTime</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="s">&quot;2011-11-11T11:11:11.000Z&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">TRACE</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;logEvent - foo = {}&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="n">eventTime</span><span class="p">.</span><span class="na">toInstant</span><span class="p">().</span><span class="na">toEpochMilli</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;bar&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setArgumentArray</span><span class="p">(</span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">MDC</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;MDC_KEY&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;MDC_VALUE&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">addInjectContextMdc</span><span class="p">(</span><span class="s">&quot;MDC_KEY&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="s">&quot;MDC_KEY&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">iteratorForInjectContextMdc</span><span class="p">().</span><span class="na">next</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertTrue</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">isInjectContextMdc</span><span class="p">(</span><span class="s">&quot;MDC_KEY&quot;</span><span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertFalse</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">isInjectContextMdc</span><span class="p">(</span><span class="s">&quot;FOO_BAR&quot;</span><span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testEncodeStandardEventWithMdcProperties.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testEncodeStandardEventWithIncludeOptionalContext</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Logger</span><span class="w"> </span><span class="n">logger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_context</span><span class="p">.</span><span class="na">getLogger</span><span class="p">(</span><span class="w"></span>
<span class="w">                </span><span class="s">&quot;StenoEncoderTest.testEncodeStandardEventWithIncludeOptionalContext&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;bar&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">(</span><span class="w"></span>
<span class="w">                </span><span class="s">&quot;com.arpnetworking.logback.StenoEncoderTest&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="n">logger</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="n">Level</span><span class="p">.</span><span class="na">DEBUG</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="s">&quot;logEvent - foo = {}&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="kc">null</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">ZonedDateTime</span><span class="w"> </span><span class="n">eventTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZonedDateTime</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="s">&quot;2011-11-11T11:11:11.000Z&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerName</span><span class="p">(</span><span class="s">&quot;loggerName&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="n">eventTime</span><span class="p">.</span><span class="na">toInstant</span><span class="p">().</span><span class="na">toEpochMilli</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setInjectContextHost</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertFalse</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">isInjectContextHost</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setInjectContextProcess</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertFalse</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">isInjectContextProcess</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setInjectContextThread</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertFalse</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">isInjectContextThread</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setInjectContextClass</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertTrue</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">isInjectContextClass</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setInjectContextFile</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertTrue</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">isInjectContextFile</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setInjectContextLine</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertTrue</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">isInjectContextLine</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setInjectContextLogger</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertTrue</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">isInjectContextLogger</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setInjectContextMethod</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertTrue</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">isInjectContextMethod</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testEncodeStandardEventWithIncludeOptionalContext.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testRedactSettings</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">INFO</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMarker</span><span class="p">(</span><span class="n">StenoMarker</span><span class="p">.</span><span class="na">ARRAY_MARKER</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;logEvent&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">ZonedDateTime</span><span class="w"> </span><span class="n">date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZonedDateTime</span><span class="p">.</span><span class="na">ofInstant</span><span class="p">(</span><span class="n">Instant</span><span class="p">.</span><span class="na">ofEpochMilli</span><span class="p">(</span><span class="mi">1415737981000L</span><span class="p">),</span><span class="w"> </span><span class="n">ZoneId</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="s">&quot;UTC&quot;</span><span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="p">{</span><span class="s">&quot;key1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;redacted&quot;</span><span class="p">};</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="p">{</span><span class="n">date</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Redacted</span><span class="p">(</span><span class="s">&quot;string&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1L</span><span class="p">)};</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setArgumentArray</span><span class="p">(</span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setRedactEnabled</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setRedactNull</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setRedactNull</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setRedactEnabled</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">fullLogOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertFalse</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">isRedactEnabled</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testRedactSettings.1.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fullLogOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">fullLogOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">_baos</span><span class="p">.</span><span class="na">reset</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setRedactEnabled</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setRedactEnabled</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setRedactNull</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">nonRedactedWithNullLogOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertFalse</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">isRedactNull</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testRedactSettings.2.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">nonRedactedWithNullLogOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">nonRedactedWithNullLogOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">_baos</span><span class="p">.</span><span class="na">reset</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setRedactEnabled</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setRedactNull</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">redactedLogOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertTrue</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">isRedactEnabled</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testRedactSettings.3.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">redactedLogOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">redactedLogOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">_baos</span><span class="p">.</span><span class="na">reset</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setRedactEnabled</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setRedactNull</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">redactedLogOutput2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertTrue</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">isRedactEnabled</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testRedactSettings.4.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">redactedLogOutput2</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">redactedLogOutput2</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">_baos</span><span class="p">.</span><span class="na">reset</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setRedactEnabled</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setRedactNull</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">redactedWithNullLogOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertFalse</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">isRedactNull</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testRedactSettings.5.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">redactedWithNullLogOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">redactedWithNullLogOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testEncodeLogValue</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertTrue</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">isJacksonModule</span><span class="p">(</span><span class="n">_javaTimeModule</span><span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="n">_javaTimeModule</span><span class="p">,</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">iteratorForJacksonModule</span><span class="p">().</span><span class="na">next</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">INFO</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMarker</span><span class="p">(</span><span class="n">StenoMarker</span><span class="p">.</span><span class="na">ARRAY_MARKER</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;logEvent&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">ZonedDateTime</span><span class="w"> </span><span class="n">date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZonedDateTime</span><span class="p">.</span><span class="na">ofInstant</span><span class="p">(</span><span class="n">Instant</span><span class="p">.</span><span class="na">ofEpochMilli</span><span class="p">(</span><span class="mi">1415737981000L</span><span class="p">),</span><span class="w"> </span><span class="n">ZoneId</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="s">&quot;UTC&quot;</span><span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="p">{</span><span class="s">&quot;key1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;logValue&quot;</span><span class="p">};</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="p">{</span><span class="n">date</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WidgetWithLogValue</span><span class="p">(</span><span class="s">&quot;FooBar!&quot;</span><span class="p">)};</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setArgumentArray</span><span class="p">(</span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testEncodeLogValue.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testEncodeEnumeration</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">INFO</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMarker</span><span class="p">(</span><span class="n">StenoMarker</span><span class="p">.</span><span class="na">ARRAY_MARKER</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;logEvent&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="p">{</span><span class="s">&quot;enum&quot;</span><span class="p">};</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="p">{</span><span class="n">DayOfWeek</span><span class="p">.</span><span class="na">FRIDAY</span><span class="p">};</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setArgumentArray</span><span class="p">(</span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testEncodeEnumeration.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testEncodeJsonNode</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">ObjectNode</span><span class="w"> </span><span class="n">jsonNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OBJECT_MAPPER</span><span class="p">.</span><span class="na">createObjectNode</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">jsonNode</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;bar&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">INFO</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMarker</span><span class="p">(</span><span class="n">StenoMarker</span><span class="p">.</span><span class="na">ARRAY_MARKER</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;logEvent&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="p">{</span><span class="s">&quot;jsonNode&quot;</span><span class="p">};</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="p">{</span><span class="n">jsonNode</span><span class="p">};</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setArgumentArray</span><span class="p">(</span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testEncodeJsonNode.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testFirstNonNull</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;a&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">StenoEncoder</span><span class="p">.</span><span class="na">firstNonNull</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">StenoEncoder</span><span class="p">.</span><span class="na">firstNonNull</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">StenoEncoder</span><span class="p">.</span><span class="na">firstNonNull</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="p">(</span><span class="n">expected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NullPointerException</span><span class="p">.</span><span class="na">class</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testFirstNonNullNone</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">StenoEncoder</span><span class="p">.</span><span class="na">firstNonNull</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testSafeContextWithSuppressDefaultContext</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">INFO</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMarker</span><span class="p">(</span><span class="n">StenoMarker</span><span class="p">.</span><span class="na">ARRAY_MARKER</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;logEvent&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="p">{};</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="p">{};</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setArgumentArray</span><span class="p">(</span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">objectMapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Mockito</span><span class="p">.</span><span class="na">mock</span><span class="p">(</span><span class="n">ObjectMapper</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">JsonFactory</span><span class="w"> </span><span class="n">jsonFactory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Mockito</span><span class="p">.</span><span class="na">mock</span><span class="p">(</span><span class="n">JsonFactory</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Mockito</span><span class="p">.</span><span class="na">doThrow</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="s">&quot;Mock Failure&quot;</span><span class="p">)).</span><span class="na">when</span><span class="p">(</span><span class="n">jsonFactory</span><span class="p">).</span><span class="na">createGenerator</span><span class="p">(</span><span class="n">Mockito</span><span class="p">.</span><span class="na">any</span><span class="p">(</span><span class="n">Writer</span><span class="p">.</span><span class="na">class</span><span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StenoEncoder</span><span class="p">(</span><span class="n">jsonFactory</span><span class="p">,</span><span class="w"> </span><span class="n">objectMapper</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setInjectContextHost</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setInjectContextProcess</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setInjectContextThread</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testSafeContextWithSuppressDefaultContext.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testSafeContextWithMdcProperties</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">INFO</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMarker</span><span class="p">(</span><span class="n">StenoMarker</span><span class="p">.</span><span class="na">ARRAY_MARKER</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;logEvent&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="p">{};</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="p">{};</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setArgumentArray</span><span class="p">(</span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">objectMapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Mockito</span><span class="p">.</span><span class="na">mock</span><span class="p">(</span><span class="n">ObjectMapper</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">JsonFactory</span><span class="w"> </span><span class="n">jsonFactory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Mockito</span><span class="p">.</span><span class="na">mock</span><span class="p">(</span><span class="n">JsonFactory</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Mockito</span><span class="p">.</span><span class="na">doThrow</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="s">&quot;Mock Failure&quot;</span><span class="p">)).</span><span class="na">when</span><span class="p">(</span><span class="n">jsonFactory</span><span class="p">).</span><span class="na">createGenerator</span><span class="p">(</span><span class="n">Mockito</span><span class="p">.</span><span class="na">any</span><span class="p">(</span><span class="n">Writer</span><span class="p">.</span><span class="na">class</span><span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StenoEncoder</span><span class="p">(</span><span class="n">jsonFactory</span><span class="p">,</span><span class="w"> </span><span class="n">objectMapper</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setInjectContextHost</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setInjectContextProcess</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setInjectContextThread</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">MDC</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;MDC_KEY&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;MDC_VALUE&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">addInjectContextMdc</span><span class="p">(</span><span class="s">&quot;MDC_KEY&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testSafeContextWithMdcProperties.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">     </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testSafeContextWithIncludeOptionalContext</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Logger</span><span class="w"> </span><span class="n">logger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_context</span><span class="p">.</span><span class="na">getLogger</span><span class="p">(</span><span class="w"></span>
<span class="w">                </span><span class="s">&quot;StenoEncoderTest.testSafeContextWithIncludeOptionalContext&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;bar&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">(</span><span class="w"></span>
<span class="w">                </span><span class="s">&quot;com.arpnetworking.logback.StenoEncoderTest&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="n">logger</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="n">Level</span><span class="p">.</span><span class="na">DEBUG</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="s">&quot;logEvent - foo = {}&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="kc">null</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">ZonedDateTime</span><span class="w"> </span><span class="n">eventTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZonedDateTime</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="s">&quot;2011-11-11T11:11:11.000Z&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerName</span><span class="p">(</span><span class="s">&quot;loggerName&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="n">eventTime</span><span class="p">.</span><span class="na">toInstant</span><span class="p">().</span><span class="na">toEpochMilli</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">objectMapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Mockito</span><span class="p">.</span><span class="na">mock</span><span class="p">(</span><span class="n">ObjectMapper</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">JsonFactory</span><span class="w"> </span><span class="n">jsonFactory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Mockito</span><span class="p">.</span><span class="na">mock</span><span class="p">(</span><span class="n">JsonFactory</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Mockito</span><span class="p">.</span><span class="na">doThrow</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="s">&quot;Mock Failure&quot;</span><span class="p">)).</span><span class="na">when</span><span class="p">(</span><span class="n">jsonFactory</span><span class="p">).</span><span class="na">createGenerator</span><span class="p">(</span><span class="n">Mockito</span><span class="p">.</span><span class="na">any</span><span class="p">(</span><span class="n">Writer</span><span class="p">.</span><span class="na">class</span><span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StenoEncoder</span><span class="p">(</span><span class="n">jsonFactory</span><span class="p">,</span><span class="w"> </span><span class="n">objectMapper</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setInjectContextHost</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setInjectContextProcess</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setInjectContextThread</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setInjectContextHost</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setInjectContextClass</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setInjectContextFile</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setInjectContextLine</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setInjectContextLogger</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setInjectContextMethod</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testSafeContextWithIncludeOptionalContext.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testSafeContextWithUserDefinedContext</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">INFO</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMarker</span><span class="p">(</span><span class="n">StenoMarker</span><span class="p">.</span><span class="na">LISTS_MARKER</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;logEvent&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">4</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="s">&quot;key1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;key2&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="n">Integer</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="mi">1234</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;foo&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="w"></span>
<span class="w">                </span><span class="s">&quot;CONTEXT_KEY1&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="s">&quot;CONTEXT_KEY2&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="s">&quot;CONTEXT_KEY3&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="s">&quot;CONTEXT_KEY4&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="s">&quot;CONTEXT_KEY5&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="s">&quot;CONTEXT_KEY6&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="w"></span>
<span class="w">                </span><span class="mf">1.23f</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="k">new</span><span class="w"> </span><span class="n">WidgetWithLogValue</span><span class="p">(</span><span class="s">&quot;bar&quot;</span><span class="p">),</span><span class="w"></span>
<span class="w">                </span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;B&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;C&quot;</span><span class="p">),</span><span class="w"></span>
<span class="w">                </span><span class="n">Collections</span><span class="p">.</span><span class="na">emptyList</span><span class="p">(),</span><span class="w"></span>
<span class="w">                </span><span class="c1">// CHECKSTYLE.OFF: RegexpSingleline - Allow construction for testing purposes</span><span class="w"></span>
<span class="w">                </span><span class="n">LogValueMapFactory</span><span class="p">.</span><span class="na">builder</span><span class="p">().</span><span class="na">build</span><span class="p">(),</span><span class="w"></span>
<span class="w">                </span><span class="c1">// CHECKSTYLE.ON: RegexpSingleline</span><span class="w"></span>
<span class="w">                </span><span class="kc">null</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setArgumentArray</span><span class="p">(</span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">objectMapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Mockito</span><span class="p">.</span><span class="na">mock</span><span class="p">(</span><span class="n">ObjectMapper</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">JsonFactory</span><span class="w"> </span><span class="n">jsonFactory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Mockito</span><span class="p">.</span><span class="na">mock</span><span class="p">(</span><span class="n">JsonFactory</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Mockito</span><span class="p">.</span><span class="na">doThrow</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="s">&quot;Mock Failure&quot;</span><span class="p">)).</span><span class="na">when</span><span class="p">(</span><span class="n">jsonFactory</span><span class="p">).</span><span class="na">createGenerator</span><span class="p">(</span><span class="n">Mockito</span><span class="p">.</span><span class="na">any</span><span class="p">(</span><span class="n">Writer</span><span class="p">.</span><span class="na">class</span><span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StenoEncoder</span><span class="p">(</span><span class="n">jsonFactory</span><span class="p">,</span><span class="w"> </span><span class="n">objectMapper</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setInjectContextHost</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setInjectContextProcess</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setInjectContextThread</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setInjectContextHost</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testSafeContextWithUserDefinedContext.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="nd">@Test</span><span class="w"></span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testSafeContextWithUserDefinedContextWithEncoding</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingEvent</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLevel</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">INFO</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMarker</span><span class="p">(</span><span class="n">StenoMarker</span><span class="p">.</span><span class="na">LISTS_MARKER</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;logEvent&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setLoggerContextRemoteView</span><span class="p">(</span><span class="n">_context</span><span class="p">.</span><span class="na">getLoggerContextRemoteView</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setTimeStamp</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">argArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="mi">4</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="s">&quot;key1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;key2&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="n">Integer</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="mi">1234</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;foo&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="s">&quot;CONTEXT_KEY1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;CONTEXT_KEY2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;CONTEXT_KEY3&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">argArray</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="s">&quot;\&quot;This is quoted\&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Back \\ Slash&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;New\nLine&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">event</span><span class="p">.</span><span class="na">setArgumentArray</span><span class="p">(</span><span class="n">argArray</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">objectMapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Mockito</span><span class="p">.</span><span class="na">mock</span><span class="p">(</span><span class="n">ObjectMapper</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">JsonFactory</span><span class="w"> </span><span class="n">jsonFactory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Mockito</span><span class="p">.</span><span class="na">mock</span><span class="p">(</span><span class="n">JsonFactory</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Mockito</span><span class="p">.</span><span class="na">doThrow</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="s">&quot;Mock Failure&quot;</span><span class="p">)).</span><span class="na">when</span><span class="p">(</span><span class="n">jsonFactory</span><span class="p">).</span><span class="na">createGenerator</span><span class="p">(</span><span class="n">Mockito</span><span class="p">.</span><span class="na">any</span><span class="p">(</span><span class="n">Writer</span><span class="p">.</span><span class="na">class</span><span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StenoEncoder</span><span class="p">(</span><span class="n">jsonFactory</span><span class="p">,</span><span class="w"> </span><span class="n">objectMapper</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setInjectContextHost</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setInjectContextProcess</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setInjectContextThread</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">_encoder</span><span class="p">.</span><span class="na">setInjectContextHost</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is valid case.</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">logOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">_encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">event</span><span class="p">),</span><span class="w"> </span><span class="n">_encoder</span><span class="p">.</span><span class="na">getCharset</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="n">assertOutput</span><span class="p">(</span><span class="s">&quot;StenoEncoderTest.testSafeContextWithUserDefinedContextWithEncoding.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">assertMatchesJsonSchema</span><span class="p">(</span><span class="n">logOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">assertOutput</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">expectedResource</span><span class="p">,</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">actualOutput</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">redactedOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">actualOutput</span><span class="w"></span>
<span class="w">                </span><span class="p">.</span><span class="na">replaceAll</span><span class="p">(</span><span class="s">&quot;\&quot;id\&quot;:\&quot;[^\&quot;]+\&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;\&quot;id\&quot;:\&quot;&lt;ID&gt;\&quot;&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="p">.</span><span class="na">replaceAll</span><span class="p">(</span><span class="s">&quot;\&quot;host\&quot;:\&quot;[^\&quot;]+\&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;\&quot;host\&quot;:\&quot;&lt;HOST&gt;\&quot;&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="p">.</span><span class="na">replaceAll</span><span class="p">(</span><span class="s">&quot;\&quot;processId\&quot;:\&quot;[^\&quot;]+\&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;\&quot;processId\&quot;:\&quot;&lt;PROCESS_ID&gt;\&quot;&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="p">.</span><span class="na">replaceAll</span><span class="p">(</span><span class="s">&quot;\&quot;threadId\&quot;:\&quot;[^\&quot;]+\&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;\&quot;threadId\&quot;:\&quot;&lt;THREAD_ID&gt;\&quot;&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="p">.</span><span class="na">replaceAll</span><span class="p">(</span><span class="s">&quot;\&quot;backtrace\&quot;:\\[[^\\]]+\\]&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;\&quot;backtrace\&quot;:[]&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="p">.</span><span class="na">replaceAll</span><span class="p">(</span><span class="s">&quot;\&quot;_id\&quot;:\&quot;[^\&quot;]+\&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;\&quot;_id\&quot;:\&quot;&lt;ID&gt;\&quot;&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="kd">final</span><span class="w"> </span><span class="n">URL</span><span class="w"> </span><span class="n">resource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StenoEncoderTest</span><span class="p">.</span><span class="na">class</span><span class="p">.</span><span class="na">getResource</span><span class="p">(</span><span class="n">expectedResource</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="c1">// CHECKSTYLE.OFF: IllegalInstantiation - This is how you do it.</span><span class="w"></span>
<span class="w">            </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="w"></span>
<span class="w">                    </span><span class="s">&quot;Comparing to: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">expectedResource</span><span class="p">,</span><span class="w"></span>
<span class="w">                    </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="p">(</span><span class="n">Files</span><span class="p">.</span><span class="na">readAllBytes</span><span class="p">(</span><span class="n">Paths</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">resource</span><span class="p">.</span><span class="na">toURI</span><span class="p">())),</span><span class="w"> </span><span class="n">StandardCharsets</span><span class="p">.</span><span class="na">UTF_8</span><span class="p">),</span><span class="w"></span>
<span class="w">                    </span><span class="n">redactedOutput</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="c1">// CHECKSTYLE.ON: IllegalInstantiation</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">URISyntaxException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">Assert</span><span class="p">.</span><span class="na">fail</span><span class="p">(</span><span class="s">&quot;Failed with exception: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">e</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">assertMatchesJsonSchema</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">json</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="kd">final</span><span class="w"> </span><span class="n">ObjectNode</span><span class="w"> </span><span class="n">rootNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ObjectNode</span><span class="p">)</span><span class="w"> </span><span class="n">OBJECT_MAPPER</span><span class="p">.</span><span class="na">readTree</span><span class="p">(</span><span class="n">json</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="kd">final</span><span class="w"> </span><span class="n">ObjectNode</span><span class="w"> </span><span class="n">contextNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ObjectNode</span><span class="p">)</span><span class="w"> </span><span class="n">rootNode</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;context&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">contextNode</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="n">contextNode</span><span class="p">.</span><span class="na">remove</span><span class="p">(</span><span class="s">&quot;logger&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">                </span><span class="n">contextNode</span><span class="p">.</span><span class="na">remove</span><span class="p">(</span><span class="s">&quot;MDC_KEY&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">                </span><span class="n">contextNode</span><span class="p">.</span><span class="na">remove</span><span class="p">(</span><span class="s">&quot;CONTEXT_KEY1&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">                </span><span class="n">contextNode</span><span class="p">.</span><span class="na">remove</span><span class="p">(</span><span class="s">&quot;CONTEXT_KEY2&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">                </span><span class="n">contextNode</span><span class="p">.</span><span class="na">remove</span><span class="p">(</span><span class="s">&quot;CONTEXT_KEY3&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">                </span><span class="n">contextNode</span><span class="p">.</span><span class="na">remove</span><span class="p">(</span><span class="s">&quot;CONTEXT_KEY4&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">                </span><span class="n">contextNode</span><span class="p">.</span><span class="na">remove</span><span class="p">(</span><span class="s">&quot;CONTEXT_KEY5&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">                </span><span class="n">contextNode</span><span class="p">.</span><span class="na">remove</span><span class="p">(</span><span class="s">&quot;CONTEXT_KEY6&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="kd">final</span><span class="w"> </span><span class="n">Set</span><span class="o">&lt;</span><span class="n">ValidationMessage</span><span class="o">&gt;</span><span class="w"> </span><span class="n">report</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">STENO_SCHEMA</span><span class="p">.</span><span class="na">validate</span><span class="p">(</span><span class="n">rootNode</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="n">report</span><span class="p">.</span><span class="na">toString</span><span class="p">(),</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">report</span><span class="p">.</span><span class="na">size</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">Assert</span><span class="p">.</span><span class="na">fail</span><span class="p">(</span><span class="s">&quot;Failed with exception: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">e</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">StenoEncoder</span><span class="w"> </span><span class="n">_encoder</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Module</span><span class="w"> </span><span class="n">_javaTimeModule</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ByteArrayOutputStream</span><span class="w"> </span><span class="n">_baos</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LoggerContext</span><span class="w"> </span><span class="n">_context</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="w"> </span><span class="n">OBJECT_MAPPER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ObjectMapper</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">JsonSchema</span><span class="w"> </span><span class="n">STENO_SCHEMA</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kd">static</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">(</span><span class="n">InputStream</span><span class="w"> </span><span class="n">schemaStream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StenoMarker</span><span class="p">.</span><span class="na">class</span><span class="p">.</span><span class="na">getResourceAsStream</span><span class="p">(</span><span class="s">&quot;/steno.schema.json&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">STENO_SCHEMA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JsonSchemaFactory</span><span class="p">.</span><span class="na">getInstance</span><span class="p">(</span><span class="n">SpecVersion</span><span class="p">.</span><span class="na">VersionFlag</span><span class="p">.</span><span class="na">V4</span><span class="p">).</span><span class="na">getSchema</span><span class="p">(</span><span class="n">schemaStream</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="n">e</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">// CHECKSTYLE.OFF: MemberName - Testing field annotations requires same name as getter.</span><span class="w"></span>
<span class="w">    </span><span class="c1">// CHECKSTYLE.OFF: HiddenField - Testing field annotations requires same name as getter.</span><span class="w"></span>
<span class="w">    </span><span class="nd">@Loggable</span><span class="w"></span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Redacted</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="nf">Redacted</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">stringValue</span><span class="p">,</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">longValue</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">stringValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stringValue</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">longValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">longValue</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getStringValue</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">stringValue</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getNullValue</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">nullValue</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="nd">@LogRedact</span><span class="w"></span>
<span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="nf">getLongValue</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">longValue</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="nd">@LogRedact</span><span class="w"></span>
<span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">stringValue</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="nd">@LogRedact</span><span class="w"></span>
<span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">nullValue</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">longValue</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="c1">// CHECKSTYLE.ON: HiddenField</span><span class="w"></span>
<span class="w">    </span><span class="c1">// CHECKSTYLE.ON: MemberName</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</body>
</html>
