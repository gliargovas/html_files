<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">
<!--
generated by Pygments <https://pygments.org/>
Copyright 2006-2022 by the Pygments team.
Licensed under the BSD license, see LICENSE for details.
-->
<html>
<head>
  <title></title>
  <meta http-equiv="content-type" content="text/html; charset=None">
  <style type="text/css">
/*
generated by Pygments <https://pygments.org/>
Copyright 2006-2022 by the Pygments team.
Licensed under the BSD license, see LICENSE for details.
*/
pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
body .hll { background-color: #ffffcc }
body { background: #f8f8f8; }
body .c { color: #3D7B7B; font-style: italic } /* Comment */
body .err { border: 1px solid #FF0000 } /* Error */
body .k { color: #008000; font-weight: bold } /* Keyword */
body .o { color: #666666 } /* Operator */
body .ch { color: #3D7B7B; font-style: italic } /* Comment.Hashbang */
body .cm { color: #3D7B7B; font-style: italic } /* Comment.Multiline */
body .cp { color: #9C6500 } /* Comment.Preproc */
body .cpf { color: #3D7B7B; font-style: italic } /* Comment.PreprocFile */
body .c1 { color: #3D7B7B; font-style: italic } /* Comment.Single */
body .cs { color: #3D7B7B; font-style: italic } /* Comment.Special */
body .gd { color: #A00000 } /* Generic.Deleted */
body .ge { font-style: italic } /* Generic.Emph */
body .gr { color: #E40000 } /* Generic.Error */
body .gh { color: #000080; font-weight: bold } /* Generic.Heading */
body .gi { color: #008400 } /* Generic.Inserted */
body .go { color: #717171 } /* Generic.Output */
body .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
body .gs { font-weight: bold } /* Generic.Strong */
body .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
body .gt { color: #0044DD } /* Generic.Traceback */
body .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
body .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
body .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
body .kp { color: #008000 } /* Keyword.Pseudo */
body .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
body .kt { color: #B00040 } /* Keyword.Type */
body .m { color: #666666 } /* Literal.Number */
body .s { color: #BA2121 } /* Literal.String */
body .na { color: #687822 } /* Name.Attribute */
body .nb { color: #008000 } /* Name.Builtin */
body .nc { color: #0000FF; font-weight: bold } /* Name.Class */
body .no { color: #880000 } /* Name.Constant */
body .nd { color: #AA22FF } /* Name.Decorator */
body .ni { color: #717171; font-weight: bold } /* Name.Entity */
body .ne { color: #CB3F38; font-weight: bold } /* Name.Exception */
body .nf { color: #0000FF } /* Name.Function */
body .nl { color: #767600 } /* Name.Label */
body .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
body .nt { color: #008000; font-weight: bold } /* Name.Tag */
body .nv { color: #19177C } /* Name.Variable */
body .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
body .w { color: #bbbbbb } /* Text.Whitespace */
body .mb { color: #666666 } /* Literal.Number.Bin */
body .mf { color: #666666 } /* Literal.Number.Float */
body .mh { color: #666666 } /* Literal.Number.Hex */
body .mi { color: #666666 } /* Literal.Number.Integer */
body .mo { color: #666666 } /* Literal.Number.Oct */
body .sa { color: #BA2121 } /* Literal.String.Affix */
body .sb { color: #BA2121 } /* Literal.String.Backtick */
body .sc { color: #BA2121 } /* Literal.String.Char */
body .dl { color: #BA2121 } /* Literal.String.Delimiter */
body .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
body .s2 { color: #BA2121 } /* Literal.String.Double */
body .se { color: #AA5D1F; font-weight: bold } /* Literal.String.Escape */
body .sh { color: #BA2121 } /* Literal.String.Heredoc */
body .si { color: #A45A77; font-weight: bold } /* Literal.String.Interpol */
body .sx { color: #008000 } /* Literal.String.Other */
body .sr { color: #A45A77 } /* Literal.String.Regex */
body .s1 { color: #BA2121 } /* Literal.String.Single */
body .ss { color: #19177C } /* Literal.String.Symbol */
body .bp { color: #008000 } /* Name.Builtin.Pseudo */
body .fm { color: #0000FF } /* Name.Function.Magic */
body .vc { color: #19177C } /* Name.Variable.Class */
body .vg { color: #19177C } /* Name.Variable.Global */
body .vi { color: #19177C } /* Name.Variable.Instance */
body .vm { color: #19177C } /* Name.Variable.Magic */
body .il { color: #666666 } /* Literal.Number.Integer.Long */

  </style>
</head>
<body>
<h2></h2>

<div class="highlight"><pre><span></span><span class="cm">/* </span>
<span class="cm">GeoGebra - Dynamic Mathematics for Everyone</span>
<span class="cm">http://www.geogebra.org</span>

<span class="cm">This file is part of GeoGebra.</span>

<span class="cm">This program is free software; you can redistribute it and/or modify it </span>
<span class="cm">under the terms of the GNU General Public License as published by </span>
<span class="cm">the Free Software Foundation.</span>

<span class="cm"> */</span><span class="w"></span>

<span class="kn">package</span><span class="w"> </span><span class="nn">org.geogebra.desktop.main</span><span class="p">;</span><span class="w"></span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.awt.AWTKeyStroke</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.awt.BasicStroke</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.awt.BorderLayout</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.awt.Color</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.awt.Component</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.awt.ComponentOrientation</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.awt.Container</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.awt.Cursor</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.awt.EventQueue</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.awt.FlowLayout</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.awt.Font</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.awt.Graphics2D</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.awt.GraphicsEnvironment</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.awt.Image</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.awt.KeyEventDispatcher</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.awt.KeyboardFocusManager</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.awt.Point</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.awt.Rectangle</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.awt.RenderingHints</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.awt.SystemColor</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.awt.Toolkit</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.awt.datatransfer.Clipboard</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.awt.datatransfer.DataFlavor</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.awt.datatransfer.Transferable</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.awt.datatransfer.UnsupportedFlavorException</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.awt.event.ComponentEvent</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.awt.event.InputEvent</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.awt.event.KeyEvent</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.awt.event.MouseEvent</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.awt.event.WindowAdapter</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.awt.event.WindowEvent</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.awt.event.WindowListener</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.awt.image.BufferedImage</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.awt.image.MemoryImageSource</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.io.BufferedReader</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.io.BufferedWriter</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.io.ByteArrayInputStream</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.io.ByteArrayOutputStream</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.io.File</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.io.FileInputStream</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.io.FileNotFoundException</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.io.FileOutputStream</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.io.IOException</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.io.InputStream</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.io.InputStreamReader</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.io.OutputStreamWriter</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.io.PrintStream</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.io.UnsupportedEncodingException</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.net.URL</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.security.MessageDigest</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.security.NoSuchAlgorithmException</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.ArrayList</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.LinkedHashMap</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.LinkedList</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Locale</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Set</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.UUID</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.concurrent.Executors</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.concurrent.ScheduledExecutorService</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.concurrent.ScheduledFuture</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.concurrent.TimeUnit</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.logging.FileHandler</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.logging.Handler</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.logging.LogManager</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.logging.Logger</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.logging.SimpleFormatter</span><span class="p">;</span><span class="w"></span>

<span class="kn">import</span><span class="w"> </span><span class="nn">javax.imageio.ImageIO</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">javax.naming.OperationNotSupportedException</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">javax.swing.BorderFactory</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">javax.swing.DefaultListCellRenderer</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">javax.swing.ImageIcon</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">javax.swing.JCheckBoxMenuItem</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">javax.swing.JComboBox</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">javax.swing.JComponent</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">javax.swing.JDialog</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">javax.swing.JFrame</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">javax.swing.JLabel</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">javax.swing.JMenu</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">javax.swing.JOptionPane</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">javax.swing.JPanel</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">javax.swing.JSplitPane</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">javax.swing.JTextField</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">javax.swing.ListCellRenderer</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">javax.swing.SwingConstants</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">javax.swing.SwingUtilities</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">javax.swing.ToolTipManager</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">javax.swing.UIManager</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">javax.swing.WindowConstants</span><span class="p">;</span><span class="w"></span>

<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.GeoGebraConstants</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.GeoGebraConstants.Platform</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.awt.GDimension</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.awt.GFont</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.awt.MyImage</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.euclidian.EuclidianConstants</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.euclidian.EuclidianController</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.euclidian.EuclidianCursor</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.euclidian.EuclidianView</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.euclidian.event.AbstractEvent</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.export.pstricks.GeoGebraExport</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.factories.AwtFactory</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.factories.CASFactory</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.factories.Factory</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.factories.FormatFactory</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.factories.LaTeXFactory</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.factories.UtilFactory</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.geogebra3D.io.OFFHandler</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.geogebra3D.kernel3D.commands.CommandDispatcher3D</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.gui.toolbar.ToolBar</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.gui.view.algebra.AlgebraView</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.io.layout.DockPanelData</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.io.layout.Perspective</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.javax.swing.GImageIcon</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.jre.factory.FormatFactoryJre</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.jre.gui.MyImageJre</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.jre.headless.AppDI</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.jre.kernel.commands.CommandDispatcher3DJre</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.jre.kernel.commands.CommandDispatcherJre</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.jre.main.TemplateHelper</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.jre.util.Base64</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.kernel.Construction</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.kernel.Kernel</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.kernel.Macro</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.kernel.commands.CommandDispatcher</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.kernel.geos.AnimationExportSlider</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.kernel.geos.GeoElement</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.kernel.geos.GeoElementGraphicsAdapter</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.kernel.geos.GeoImage</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.kernel.kernelND.GeoPointND</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.main.App</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.main.DialogManager</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.main.MyError.Errors</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.main.ProverSettings</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.main.SpreadsheetTableModel</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.main.error.ErrorHandler</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.main.settings.AbstractSettings</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.main.settings.DefaultSettings</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.main.settings.SettingsBuilder</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.main.settings.updater.SettingsUpdaterBuilder</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.media.VideoManager</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.plugin.ScriptManager</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.util.AsyncOperation</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.util.Charsets</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.util.DoubleUtil</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.util.FileExtensions</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.util.GTimer</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.util.GTimerListener</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.util.LowerCaseDictionary</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.util.NormalizerMinimal</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.util.StringUtil</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.util.Util</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.util.debug.Log</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.common.util.debug.Log.LogDestination</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.CommandLineArguments</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.GeoGebra</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.awt.GBufferedImageD</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.awt.GDimensionD</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.awt.GFontD</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.euclidian.DrawEquationD</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.euclidian.EuclidianControllerD</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.euclidian.EuclidianViewD</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.euclidian.event.MouseEventD</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.euclidian.event.MouseEventND</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.euclidianND.EuclidianViewInterfaceD</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.export.GeoGebraTubeExportD</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.export.PrintPreviewD</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.export.pstricks.GeoGebraToAsymptoteD</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.export.pstricks.GeoGebraToPgfD</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.export.pstricks.GeoGebraToPstricksD</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.factories.AwtFactoryD</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.factories.CASFactoryD</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.factories.FactoryD</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.factories.LaTeXFactoryD</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.factories.UtilFactoryD</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.gui.GuiManagerD</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.gui.MyImageD</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.gui.app.GeoGebraFrame</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.gui.dialog.AxesStyleListRenderer</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.gui.dialog.DashListRenderer</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.gui.dialog.DecorationListRenderer</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.gui.dialog.PointStyleListRenderer</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.gui.dialog.options.OptionsAdvancedD</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.gui.inputbar.AlgebraInputD</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.gui.layout.DockBar</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.gui.layout.DockPanelD</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.gui.layout.LayoutD</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.gui.menubar.OptionsMenuController</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.gui.toolbar.ToolbarContainer</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.gui.util.ImageSelection</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.headless.GFileHandler</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.io.MyXMLioD</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.io.OFFReader</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.javax.swing.GImageIconD</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.kernel.geos.GeoElementGraphicsAdapterD</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.main.settings.DefaultSettingsD</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.main.settings.SettingsBuilderD</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.main.settings.updater.FontSettingsUpdaterD</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.main.undo.UndoManagerD</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.move.ggtapi.models.LoginOperationD</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.plugin.GgbAPID</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.plugin.ScriptManagerD</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.sound.SoundManagerD</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.util.CopyPasteD</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.util.FrameCollector</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.util.GTimerD</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.util.GuiResourcesD</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.util.ImageManagerD</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.util.ImageResourceD</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.util.LoggerD</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.util.Normalizer</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.util.StringUtilD</span><span class="p">;</span><span class="w"></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.geogebra.desktop.util.UtilD</span><span class="p">;</span><span class="w"></span>

<span class="kn">import</span><span class="w"> </span><span class="nn">edu.umd.cs.findbugs.annotations.SuppressFBWarnings</span><span class="p">;</span><span class="w"></span>

<span class="cm">/**</span>
<span class="cm"> * GeoGebra Application</span>
<span class="cm"> *</span>
<span class="cm"> * @author Markus Hohenwarter</span>
<span class="cm"> */</span><span class="w"></span>
<span class="nd">@SuppressWarnings</span><span class="p">(</span><span class="s">&quot;javadoc&quot;</span><span class="p">)</span><span class="w"></span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AppD</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">App</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">KeyEventDispatcher</span><span class="p">,</span><span class="w"> </span><span class="n">AppDI</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * License file</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">LICENSE_FILE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;/org/geogebra/desktop/_license.txt&quot;</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * Command line arguments</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">protected</span><span class="w"> </span><span class="n">CommandLineArguments</span><span class="w"> </span><span class="n">cmdArgs</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="n">DefaultSettings</span><span class="w"> </span><span class="n">defaultSettings</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="c1">// ==============================================================</span><span class="w"></span>
<span class="w">	</span><span class="c1">// JAR fields</span><span class="w"></span>
<span class="w">	</span><span class="c1">// ==============================================================</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * Possible alternative names for geogebra.jar. Used for 3D webstart at the</span>
<span class="cm">	 * moment.</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">GEOGEBRA_JAR_ALT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;geogebra.jar&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">			</span><span class="s">&quot;geogebra-jogl2.jar&quot;</span><span class="w"> </span><span class="p">};</span><span class="w"></span>

<span class="w">	</span><span class="c1">// ==============================================================</span><span class="w"></span>
<span class="w">	</span><span class="c1">// LOCALE fields</span><span class="w"></span>
<span class="w">	</span><span class="c1">// ==============================================================</span><span class="w"></span>

<span class="w">	</span><span class="c1">// ==============================================================</span><span class="w"></span>
<span class="w">	</span><span class="c1">// FILE fields</span><span class="w"></span>
<span class="w">	</span><span class="c1">// ==============================================================</span><span class="w"></span>

<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">File</span><span class="o">&gt;</span><span class="w"> </span><span class="n">fileList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LinkedList</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w"></span>
<span class="w">	</span><span class="kd">protected</span><span class="w"> </span><span class="n">File</span><span class="w"> </span><span class="n">currentPath</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="kd">protected</span><span class="w"> </span><span class="n">File</span><span class="w"> </span><span class="n">currentImagePath</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="kd">protected</span><span class="w"> </span><span class="n">File</span><span class="w"> </span><span class="n">currentFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * maximum number of files to (save &amp;amp;) show in File &amp;rarr; Recent</span>
<span class="cm">	 * submenu</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">MAX_RECENT_FILES</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="c1">// ==============================================================</span><span class="w"></span>
<span class="w">	</span><span class="c1">// RESOURCE fields</span><span class="w"></span>
<span class="w">	</span><span class="c1">// ==============================================================</span><span class="w"></span>

<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">LocalizationD</span><span class="w"> </span><span class="n">loc</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="c1">// ==============================================================</span><span class="w"></span>
<span class="w">	</span><span class="c1">// GUI fields</span><span class="w"></span>
<span class="w">	</span><span class="c1">// ==============================================================</span><span class="w"></span>

<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="n">JFrame</span><span class="w"> </span><span class="n">frame</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="cm">/** Main component */</span><span class="w"></span>
<span class="w">	</span><span class="kd">protected</span><span class="w"> </span><span class="n">Component</span><span class="w"> </span><span class="n">mainComp</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="cm">/** Panels that form the main content panel */</span><span class="w"></span>
<span class="w">	</span><span class="kd">protected</span><span class="w"> </span><span class="n">JPanel</span><span class="w"> </span><span class="n">centerPanel</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="kd">protected</span><span class="w"> </span><span class="n">JPanel</span><span class="w"> </span><span class="n">northPanel</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="kd">protected</span><span class="w"> </span><span class="n">JPanel</span><span class="w"> </span><span class="n">southPanel</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="kd">protected</span><span class="w"> </span><span class="n">JPanel</span><span class="w"> </span><span class="n">eastPanel</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="kd">protected</span><span class="w"> </span><span class="n">JPanel</span><span class="w"> </span><span class="n">westPanel</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * Split pane panel that holds main content panel and a slide-out sidebar</span>
<span class="cm">	 * help panel for the input bar.</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="n">JSplitPane</span><span class="w"> </span><span class="n">applicationSplitPane</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="n">DockBarInterface</span><span class="w"> </span><span class="n">dockBar</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">showDockBar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">isDockBarEast</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="kd">protected</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">showAlgebraView</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * Preferred application frame size. Used in case frame size needs updating.</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="n">GDimension</span><span class="w"> </span><span class="n">preferredSize</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="cm">/** Horizontal page margin in cm */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">PAGE_MARGIN_X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mf">1.8</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">72</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">2.54</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="cm">/** Vertical page margin in cm */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">PAGE_MARGIN_Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mf">1.8</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">72</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">2.54</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="cm">/** Default icon size */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">DEFAULT_ICON_SIZE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">32</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * made a little darker in ggb40 (problem showing on some projectors)</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Color</span><span class="w"> </span><span class="n">COLOR_SELECTION</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Color</span><span class="p">(</span><span class="mi">210</span><span class="p">,</span><span class="w"> </span><span class="mi">210</span><span class="p">,</span><span class="w"> </span><span class="mi">225</span><span class="p">);</span><span class="w"></span>

<span class="w">	</span><span class="c1">// ==============================================================</span><span class="w"></span>
<span class="w">	</span><span class="c1">// MODEL &amp; MANAGER fields</span><span class="w"></span>
<span class="w">	</span><span class="c1">// ==============================================================</span><span class="w"></span>

<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">FontManagerD</span><span class="w"> </span><span class="n">fontManager</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="cm">/** GUI manager */</span><span class="w"></span>
<span class="w">	</span><span class="kd">protected</span><span class="w"> </span><span class="n">GuiManagerInterfaceD</span><span class="w"> </span><span class="n">guiManager</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="n">GlobalKeyDispatcherD</span><span class="w"> </span><span class="n">globalKeyDispatcher</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="kd">protected</span><span class="w"> </span><span class="n">ImageManagerD</span><span class="w"> </span><span class="n">imageManager</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="n">GgbAPID</span><span class="w"> </span><span class="n">ggbapi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="n">SpreadsheetTableModelD</span><span class="w"> </span><span class="n">tableModel</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="c1">// ==============================================================</span><span class="w"></span>
<span class="w">	</span><span class="c1">// MISC FLAGS</span><span class="w"></span>
<span class="w">	</span><span class="c1">// ==============================================================</span><span class="w"></span>

<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">allowToolTips</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="kd">protected</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">isErrorDialogShowing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">macsandbox</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="n">CopyPasteD</span><span class="w"> </span><span class="n">copyPaste</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">centerX</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">centerY</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="cm">/*************************************************************</span>
<span class="cm">	 * Construct application within JFrame</span>
<span class="cm">	 * </span>
<span class="cm">	 * @param args command line arguments</span>
<span class="cm">	 * @param frame frame</span>
<span class="cm">	 * @param undoActive whether undo is active</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="nf">AppD</span><span class="p">(</span><span class="n">CommandLineArguments</span><span class="w"> </span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="n">JFrame</span><span class="w"> </span><span class="n">frame</span><span class="p">,</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">undoActive</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">this</span><span class="p">(</span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="n">frame</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="n">undoActive</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LocalizationD</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/*************************************************************</span>
<span class="cm">	 * Construct application within Container (e.g. GeoGebraPanel)</span>
<span class="cm">	 * </span>
<span class="cm">	 * @param args command line arguments</span>
<span class="cm">	 * @param comp parent panel</span>
<span class="cm">	 * @param undoActive whether undo is active</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="nf">AppD</span><span class="p">(</span><span class="n">CommandLineArguments</span><span class="w"> </span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="n">Container</span><span class="w"> </span><span class="n">comp</span><span class="p">,</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">undoActive</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">this</span><span class="p">(</span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="n">comp</span><span class="p">,</span><span class="w"> </span><span class="n">undoActive</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LocalizationD</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/*************************************************************</span>
<span class="cm">	 * GeoGebra application general constructor</span>
<span class="cm">	 *</span>
<span class="cm">	 * @param args command line arguments</span>
<span class="cm">	 * @param comp parent panel</span>
<span class="cm">	 * @param frame frame</span>
<span class="cm">	 * @param undoActive whether undo is active</span>
<span class="cm">	 * @param loc localization</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="nf">AppD</span><span class="p">(</span><span class="n">CommandLineArguments</span><span class="w"> </span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="n">JFrame</span><span class="w"> </span><span class="n">frame</span><span class="p">,</span><span class="w"> </span><span class="n">Container</span><span class="w"> </span><span class="n">comp</span><span class="p">,</span><span class="w"></span>
<span class="w">			</span><span class="kt">boolean</span><span class="w"> </span><span class="n">undoActive</span><span class="p">,</span><span class="w"></span>
<span class="w">			</span><span class="n">LocalizationD</span><span class="w"> </span><span class="n">loc</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">		</span><span class="kd">super</span><span class="p">(</span><span class="n">Platform</span><span class="p">.</span><span class="na">DESKTOP</span><span class="p">);</span><span class="w"></span>

<span class="w">		</span><span class="k">this</span><span class="p">.</span><span class="na">loc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">loc</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="n">loc</span><span class="p">.</span><span class="na">setApp</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="k">this</span><span class="p">.</span><span class="na">cmdArgs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">args</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="k">this</span><span class="p">.</span><span class="na">prerelease</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">args</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">args</span><span class="p">.</span><span class="na">containsArg</span><span class="p">(</span><span class="s">&quot;prerelease&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">args</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">args</span><span class="p">.</span><span class="na">containsArg</span><span class="p">(</span><span class="s">&quot;silent&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">LoggerD</span><span class="w"> </span><span class="n">logger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggerD</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="n">logger</span><span class="p">.</span><span class="na">setReading</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="n">Log</span><span class="p">.</span><span class="na">setLogger</span><span class="p">(</span><span class="n">logger</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="n">Log</span><span class="p">.</span><span class="na">setLogDestination</span><span class="p">(</span><span class="n">LogDestination</span><span class="p">.</span><span class="na">CONSOLE</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="na">containsArg</span><span class="p">(</span><span class="s">&quot;logLevel&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">Log</span><span class="p">.</span><span class="na">setLogLevel</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="na">getStringValue</span><span class="p">(</span><span class="s">&quot;logLevel&quot;</span><span class="p">));</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="na">containsArg</span><span class="p">(</span><span class="s">&quot;logFile&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">Log</span><span class="p">.</span><span class="na">setLogDestination</span><span class="p">(</span><span class="n">LogDestination</span><span class="p">.</span><span class="na">FILE</span><span class="p">);</span><span class="w"></span>
<span class="w">				</span><span class="n">logger</span><span class="p">.</span><span class="na">setLogFileImpl</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="na">getStringValue</span><span class="p">(</span><span class="s">&quot;logFile&quot;</span><span class="p">));</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="na">containsArg</span><span class="p">(</span><span class="s">&quot;logShowCaller&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">Log</span><span class="p">.</span><span class="na">setCallerShown</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="na">getBooleanValue</span><span class="p">(</span><span class="s">&quot;logShowCaller&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">));</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="na">containsArg</span><span class="p">(</span><span class="s">&quot;logShowTime&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">LoggerD</span><span class="p">.</span><span class="na">setTimeShown</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="na">getBooleanValue</span><span class="p">(</span><span class="s">&quot;logShowTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">));</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="na">containsArg</span><span class="p">(</span><span class="s">&quot;logShowLevel&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">Log</span><span class="p">.</span><span class="na">setLevelShown</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="na">getBooleanValue</span><span class="p">(</span><span class="s">&quot;logShowLevel&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">));</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">prerelease</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">Log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&quot;*********************************&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="n">Log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&quot;*** Running with --prerelease ***&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="n">Log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&quot;*********************************&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="n">setFileVersion</span><span class="p">(</span><span class="n">GeoGebraConstants</span><span class="p">.</span><span class="na">VERSION_STRING</span><span class="p">,</span><span class="w"></span>
<span class="w">				</span><span class="n">getConfig</span><span class="p">().</span><span class="na">getAppCode</span><span class="p">());</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">args</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">handleHelpVersionArgs</span><span class="p">(</span><span class="n">args</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">frame</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">mainComp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">frame</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">mainComp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">comp</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="n">useFullGui</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"></span>

<span class="w">		</span><span class="c1">// don&#39;t want to redirect System.out and System.err when running as</span><span class="w"></span>
<span class="w">		</span><span class="c1">// Applet</span><span class="w"></span>
<span class="w">		</span><span class="c1">// or eg from Eclipse</span><span class="w"></span>
<span class="w">		</span><span class="n">getCodeBase</span><span class="p">();</span><span class="w"> </span><span class="c1">// initialize runningFromJar</span><span class="w"></span>

<span class="w">		</span><span class="n">Log</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">&quot;runningFromJar=&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">runningFromJar</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">runningFromJar</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">setUpLogging</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">Log</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">&quot;Not setting up logging via LogManager&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="c1">// needed for JavaScript getCommandName(), getValueString() to work</span><span class="w"></span>
<span class="w">		</span><span class="c1">// (security problem running non-locally)</span><span class="w"></span>

<span class="w">		</span><span class="n">preferredSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">GDimensionD</span><span class="p">(</span><span class="mi">800</span><span class="p">,</span><span class="w"> </span><span class="mi">600</span><span class="p">);</span><span class="w"></span>

<span class="w">		</span><span class="n">fontManager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FontManagerD</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="n">initImageManager</span><span class="p">(</span><span class="n">mainComp</span><span class="p">);</span><span class="w"></span>

<span class="w">		</span><span class="c1">// set locale</span><span class="w"></span>
<span class="w">		</span><span class="n">setLocale</span><span class="p">(</span><span class="n">mainComp</span><span class="p">.</span><span class="na">getLocale</span><span class="p">());</span><span class="w"></span>

<span class="w">		</span><span class="c1">// init kernel</span><span class="w"></span>
<span class="w">		</span><span class="n">initFactories</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="n">initKernel</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="n">kernel</span><span class="p">.</span><span class="na">setPrintDecimals</span><span class="p">(</span><span class="n">getConfig</span><span class="p">().</span><span class="na">getDefaultPrintDecimals</span><span class="p">());</span><span class="w"></span>

<span class="w">		</span><span class="c1">// init settings</span><span class="w"></span>
<span class="w">		</span><span class="n">initSettings</span><span class="p">();</span><span class="w"></span>

<span class="w">		</span><span class="c1">// init euclidian view</span><span class="w"></span>
<span class="w">		</span><span class="n">initEuclidianViews</span><span class="p">();</span><span class="w"></span>

<span class="w">		</span><span class="c1">// load file on startup and set fonts</span><span class="w"></span>
<span class="w">		</span><span class="c1">// set flag to avoid multiple calls of setLabels() and</span><span class="w"></span>
<span class="w">		</span><span class="c1">// updateContentPane()</span><span class="w"></span>
<span class="w">		</span><span class="n">initing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="c1">// setFontSize(12);</span><span class="w"></span>

<span class="w">		</span><span class="c1">// This is needed because otherwise Exception might come and</span><span class="w"></span>
<span class="w">		</span><span class="c1">// GeoGebra may exit. (dockPanel not entirely defined)</span><span class="w"></span>
<span class="w">		</span><span class="c1">// This is needed before handleFileArg because</span><span class="w"></span>
<span class="w">		</span><span class="c1">// we don&#39;t want to redefine the toolbar string from the file.</span><span class="w"></span>
<span class="w">		</span><span class="kt">boolean</span><span class="w"> </span><span class="n">ggtloading</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">isLoadingTool</span><span class="p">(</span><span class="n">args</span><span class="p">);</span><span class="w"></span>

<span class="w">		</span><span class="c1">// init default preferences if necessary</span><span class="w"></span>
<span class="w">		</span><span class="n">GeoGebraPreferencesD</span><span class="p">.</span><span class="na">getPref</span><span class="p">().</span><span class="na">initDefaultXML</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ggtloading</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">GeoGebraPreferencesD</span><span class="p">.</span><span class="na">getPref</span><span class="p">().</span><span class="na">loadXMLPreferences</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="c1">// open file given by startup parameter</span><span class="w"></span>
<span class="w">		</span><span class="n">handleOptionArgsEarly</span><span class="p">(</span><span class="n">args</span><span class="p">);</span><span class="w"> </span><span class="c1">// for --regressionFile=...</span><span class="w"></span>

<span class="w">		</span><span class="kt">boolean</span><span class="w"> </span><span class="n">fileLoaded</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">handleFileArg</span><span class="p">(</span><span class="n">args</span><span class="p">);</span><span class="w"></span>

<span class="w">		</span><span class="c1">// initialize GUI</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isUsingFullGui</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">initGuiManager</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="c1">// set frame</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">frame</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">setFrame</span><span class="p">(</span><span class="n">frame</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="c1">// load XML preferences</span><span class="w"></span>
<span class="w">		</span><span class="n">currentPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GeoGebraPreferencesD</span><span class="p">.</span><span class="na">getPref</span><span class="p">().</span><span class="na">getDefaultFilePath</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="n">currentImagePath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GeoGebraPreferencesD</span><span class="p">.</span><span class="na">getPref</span><span class="p">()</span><span class="w"></span>
<span class="w">				</span><span class="p">.</span><span class="na">getDefaultImagePath</span><span class="p">();</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">fileLoaded</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">ggtloading</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">GeoGebraPreferencesD</span><span class="p">.</span><span class="na">getPref</span><span class="p">().</span><span class="na">loadXMLPreferences</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="n">imageManager</span><span class="p">.</span><span class="na">setMaxIconSizeAsPt</span><span class="p">(</span><span class="n">getFontSize</span><span class="p">());</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">MAC_OS</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">String</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">getProperty</span><span class="p">(</span><span class="s">&quot;user.home&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;/Documents&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">currentPath</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">currentPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="n">path</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">currentImagePath</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">currentImagePath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="n">path</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isUsingFullGui</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">getGuiManager</span><span class="p">().</span><span class="na">getLayout</span><span class="p">()</span><span class="w"></span>
<span class="w">					</span><span class="p">.</span><span class="na">setPerspectiveOrDefault</span><span class="p">(</span><span class="n">getTmpPerspective</span><span class="p">());</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">needsSpreadsheetTableModel</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="c1">// if tableModel==null, will create one</span><span class="w"></span>
<span class="w">			</span><span class="n">getSpreadsheetTableModel</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isUsingFullGui</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">ggtloading</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">getGuiManager</span><span class="p">().</span><span class="na">setToolBarDefinition</span><span class="p">(</span><span class="n">ToolBar</span><span class="p">.</span><span class="na">getAllTools</span><span class="p">(</span><span class="k">this</span><span class="p">));</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="n">setUndoActive</span><span class="p">(</span><span class="n">undoActive</span><span class="p">);</span><span class="w"></span>

<span class="w">		</span><span class="c1">// applet/command line options</span><span class="w"></span>
<span class="w">		</span><span class="n">handleOptionArgs</span><span class="p">(</span><span class="n">args</span><span class="p">);</span><span class="w"></span>

<span class="w">		</span><span class="n">initing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>

<span class="w">		</span><span class="c1">// for key listening</span><span class="w"></span>
<span class="w">		</span><span class="n">KeyboardFocusManager</span><span class="p">.</span><span class="na">getCurrentKeyboardFocusManager</span><span class="p">()</span><span class="w"></span>
<span class="w">				</span><span class="p">.</span><span class="na">addKeyEventDispatcher</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w"></span>

<span class="w">		</span><span class="n">getScriptManager</span><span class="p">().</span><span class="na">ggbOnInit</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="n">getFactory</span><span class="p">();</span><span class="w"></span>

<span class="w">		</span><span class="n">setSaved</span><span class="p">();</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">getCASVersionString</span><span class="p">().</span><span class="na">equals</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">setCASVersionString</span><span class="p">(</span><span class="n">loc</span><span class="p">.</span><span class="na">getMenu</span><span class="p">(</span><span class="s">&quot;CASInitializing&quot;</span><span class="p">));</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="c1">// user authentication handling</span><span class="w"></span>
<span class="w">		</span><span class="n">initSignInEventFlow</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">kernel</span><span class="p">.</span><span class="na">wantAnimationStarted</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">kernel</span><span class="p">.</span><span class="na">getAnimatonManager</span><span class="p">().</span><span class="na">startAnimation</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="n">kernel</span><span class="p">.</span><span class="na">setWantAnimationStarted</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="c1">// **************************************************************************</span><span class="w"></span>
<span class="w">	</span><span class="c1">// INIT</span><span class="w"></span>
<span class="w">	</span><span class="c1">// **************************************************************************</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">reset</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">currentFile</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">loadFile</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">currentFile</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">clearConstruction</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * @param frame app frame</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setFrame</span><span class="p">(</span><span class="n">JFrame</span><span class="w"> </span><span class="n">frame</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">mainComp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">frame</span><span class="p">;</span><span class="w"></span>

<span class="w">		</span><span class="k">this</span><span class="p">.</span><span class="na">frame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">frame</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="n">updateTitle</span><span class="p">();</span><span class="w"></span>

<span class="w">		</span><span class="c1">// Windows 7 uses this for the Toolbar icon too</span><span class="w"></span>
<span class="w">		</span><span class="c1">// (needs to be larger)</span><span class="w"></span>
<span class="w">		</span><span class="n">frame</span><span class="p">.</span><span class="na">setIconImage</span><span class="p">(</span><span class="n">getInternalImage</span><span class="p">(</span><span class="n">GuiResourcesD</span><span class="p">.</span><span class="na">GEOGEBRA64</span><span class="p">));</span><span class="w"></span>

<span class="w">		</span><span class="n">frame</span><span class="p">.</span><span class="na">setDefaultCloseOperation</span><span class="p">(</span><span class="n">WindowConstants</span><span class="p">.</span><span class="na">DO_NOTHING_ON_CLOSE</span><span class="p">);</span><span class="w"></span>

<span class="w">		</span><span class="n">WindowListener</span><span class="o">[]</span><span class="w"> </span><span class="n">wl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">frame</span><span class="p">.</span><span class="na">getWindowListeners</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">wl</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="n">wl</span><span class="p">.</span><span class="na">length</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="c1">// window closing listener</span><span class="w"></span>
<span class="w">			</span><span class="n">WindowAdapter</span><span class="w"> </span><span class="n">windowListener</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WindowAdapter</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">				</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">windowClosing</span><span class="p">(</span><span class="n">WindowEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">					</span><span class="n">exit</span><span class="p">();</span><span class="w"></span>
<span class="w">				</span><span class="p">}</span><span class="w"></span>
<span class="w">			</span><span class="p">};</span><span class="w"></span>
<span class="w">			</span><span class="n">frame</span><span class="p">.</span><span class="na">addWindowListener</span><span class="p">(</span><span class="n">windowListener</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * Sets the look and feel.</span>
<span class="cm">	 * </span>
<span class="cm">	 * @param isSystemLAF</span>
<span class="cm">	 *            true &amp;rarr; set system LAF, false &amp;rarr; set cross-platform</span>
<span class="cm">	 *            LAF</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setLAF</span><span class="p">(</span><span class="kt">boolean</span><span class="w"> </span><span class="n">isSystemLAF</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isSystemLAF</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">UIManager</span><span class="p">.</span><span class="na">setLookAndFeel</span><span class="p">(</span><span class="w"></span>
<span class="w">						</span><span class="n">UIManager</span><span class="p">.</span><span class="na">getSystemLookAndFeelClassName</span><span class="p">());</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">UIManager</span><span class="p">.</span><span class="na">setLookAndFeel</span><span class="p">(</span><span class="w"></span>
<span class="w">						</span><span class="n">UIManager</span><span class="p">.</span><span class="na">getCrossPlatformLookAndFeelClassName</span><span class="p">());</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">Log</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * Toggles between the system LAF and the cross-platform LAF</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">toggleCrossPlatformLAF</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">setLAF</span><span class="p">(</span><span class="o">!</span><span class="n">UIManager</span><span class="p">.</span><span class="na">getLookAndFeel</span><span class="p">().</span><span class="na">isNativeLookAndFeel</span><span class="p">());</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * init factories</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">initFactories</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AwtFactory</span><span class="p">.</span><span class="na">getPrototype</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">AwtFactory</span><span class="p">.</span><span class="na">setPrototypeIfNull</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">AwtFactoryD</span><span class="p">());</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">FormatFactory</span><span class="p">.</span><span class="na">getPrototype</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">FormatFactory</span><span class="p">.</span><span class="na">setPrototypeIfNull</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">FormatFactoryJre</span><span class="p">());</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">LaTeXFactory</span><span class="p">.</span><span class="na">getPrototype</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">LaTeXFactory</span><span class="p">.</span><span class="na">setPrototypeIfNull</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">LaTeXFactoryD</span><span class="p">());</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">UtilFactory</span><span class="p">.</span><span class="na">getPrototype</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">UtilFactory</span><span class="p">.</span><span class="na">setPrototypeIfNull</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">UtilFactoryD</span><span class="p">());</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">StringUtil</span><span class="p">.</span><span class="na">getPrototype</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">StringUtil</span><span class="p">.</span><span class="na">setPrototypeIfNull</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">StringUtilD</span><span class="p">());</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handleHelpVersionArgs</span><span class="p">(</span><span class="n">CommandLineArguments</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">		</span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;GeoGebra &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">GeoGebraConstants</span><span class="p">.</span><span class="na">VERSION_STRING</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="w"></span>
<span class="w">				</span><span class="o">+</span><span class="w"> </span><span class="n">GeoGebraConstants</span><span class="p">.</span><span class="na">BUILD_DATE</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; Java &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">getJavaVersion</span><span class="p">()</span><span class="w"></span>
<span class="w">				</span><span class="o">+</span><span class="w"> </span><span class="s">&quot;\n&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="na">containsArg</span><span class="p">(</span><span class="s">&quot;help&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="c1">// help message</span><span class="w"></span>
<span class="w">			</span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Usage: java -jar geogebra.jar [OPTION] [FILE]\n&quot;</span><span class="w"></span>
<span class="w">					</span><span class="o">+</span><span class="w"> </span><span class="s">&quot;Start GeoGebra with the specified OPTIONs and open the given FILE.\n&quot;</span><span class="w"></span>
<span class="w">					</span><span class="o">+</span><span class="w"> </span><span class="s">&quot;  --help\t\tprint this message\n&quot;</span><span class="w"></span>
<span class="w">					</span><span class="o">+</span><span class="w"> </span><span class="s">&quot;  --v\t\tprint version\n&quot;</span><span class="w"></span>
<span class="w">					</span><span class="o">+</span><span class="w"> </span><span class="s">&quot;  --language=LANGUAGE_CODE&quot;</span><span class="w"></span>
<span class="w">					</span><span class="c1">// here &quot;auto&quot; is also accepted</span><span class="w"></span>
<span class="w">					</span><span class="o">+</span><span class="w"> </span><span class="s">&quot;\t\tset language using locale strings, e.g. en, de, de_AT, ...\n&quot;</span><span class="w"></span>
<span class="w">					</span><span class="o">+</span><span class="w"> </span><span class="s">&quot;  --showAlgebraInput=BOOLEAN\tshow/hide algebra input field\n&quot;</span><span class="w"></span>
<span class="w">					</span><span class="o">+</span><span class="w"> </span><span class="s">&quot;  --showAlgebraInputTop=BOOLEAN\tshow algebra input at top/bottom\n&quot;</span><span class="w"></span>
<span class="w">					</span><span class="o">+</span><span class="w"> </span><span class="s">&quot;  --showAlgebraWindow=BOOLEAN\tshow/hide algebra window\n&quot;</span><span class="w"></span>
<span class="w">					</span><span class="o">+</span><span class="w"> </span><span class="s">&quot;  --showSpreadsheet=BOOLEAN\tshow/hide spreadsheet\n&quot;</span><span class="w"></span>
<span class="w">					</span><span class="c1">// here &quot;disable&quot; is also accepted</span><span class="w"></span>
<span class="w">					</span><span class="o">+</span><span class="w"> </span><span class="s">&quot;  --showCAS=BOOLEAN\tshow/hide CAS window\n&quot;</span><span class="w"></span>
<span class="w">					</span><span class="c1">// here &quot;disable&quot; is also accepted</span><span class="w"></span>
<span class="w">					</span><span class="o">+</span><span class="w"> </span><span class="s">&quot;  --show3D=BOOLEAN\tshow/hide 3D window\n&quot;</span><span class="w"></span>
<span class="w">					</span><span class="o">+</span><span class="w"> </span><span class="s">&quot;  --showSplash=BOOLEAN\tenable/disable the splash screen\n&quot;</span><span class="w"></span>
<span class="w">					</span><span class="o">+</span><span class="w"> </span><span class="s">&quot;  --enableUndo=BOOLEAN\tenable/disable Undo\n&quot;</span><span class="w"></span>
<span class="w">					</span><span class="o">+</span><span class="w"> </span><span class="s">&quot;  --fontSize=NUMBER\tset default font size\n&quot;</span><span class="w"></span>
<span class="w">					</span><span class="o">+</span><span class="w"> </span><span class="s">&quot;  --showAxes=BOOLEAN\tshow/hide coordinate axes\n&quot;</span><span class="w"></span>
<span class="w">					</span><span class="o">+</span><span class="w"> </span><span class="s">&quot;  --showGrid=BOOLEAN\tshow/hide grid\n&quot;</span><span class="w"></span>
<span class="w">					</span><span class="o">+</span><span class="w"> </span><span class="s">&quot;  --settingsFile=PATH|FILENAME\tload/save settings from/in a local file\n&quot;</span><span class="w"></span>
<span class="w">					</span><span class="o">+</span><span class="w"> </span><span class="s">&quot;  --resetSettings\treset current settings\n&quot;</span><span class="w"></span>
<span class="w">					</span><span class="o">+</span><span class="w"> </span><span class="s">&quot;  --regressionFile=FILENAME&quot;</span><span class="w"></span>
<span class="w">							</span><span class="o">+</span><span class="w"> </span><span class="s">&quot;\texport textual representations of dependent objects, then exit\n&quot;</span><span class="w"></span>
<span class="w">					</span><span class="o">+</span><span class="w"> </span><span class="s">&quot;  --versionCheckAllow=SETTING&quot;</span><span class="w"></span>
<span class="w">							</span><span class="o">+</span><span class="w"> </span><span class="s">&quot;\tallow version check (on/off or true/false for single launch)\n&quot;</span><span class="w"></span>
<span class="w">					</span><span class="o">+</span><span class="w"> </span><span class="s">&quot;  --logLevel=LEVEL\tset logging level &quot;</span><span class="w"></span>
<span class="w">							</span><span class="o">+</span><span class="w"> </span><span class="s">&quot;(EMERGENCY|ALERT|CRITICAL|ERROR|WARN|NOTICE|INFO|DEBUG|TRACE)\n&quot;</span><span class="w"></span>
<span class="w">					</span><span class="o">+</span><span class="w"> </span><span class="s">&quot;  --logFile=FILENAME\tset log file\n&quot;</span><span class="w"></span>
<span class="w">					</span><span class="o">+</span><span class="w"> </span><span class="s">&quot;  --silent\tCompletely mute logging\n&quot;</span><span class="w"></span>
<span class="w">					</span><span class="o">+</span><span class="w"> </span><span class="s">&quot;  --prover=OPTIONS\tSet options for the prover subsystem &quot;</span><span class="w"></span>
<span class="w">							</span><span class="o">+</span><span class="w"> </span><span class="s">&quot;(use --proverhelp for more information)\n&quot;</span><span class="w"></span>
<span class="w">			</span><span class="p">);</span><span class="w"></span>

<span class="w">			</span><span class="n">AppD</span><span class="p">.</span><span class="na">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="na">containsArg</span><span class="p">(</span><span class="s">&quot;proverhelp&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">ProverSettings</span><span class="w"> </span><span class="n">proverSettings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ProverSettings</span><span class="p">.</span><span class="na">get</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="c1">// help message for the prover</span><span class="w"></span>
<span class="w">			</span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="w"></span>
<span class="w">					</span><span class="s">&quot;  --prover=OPTIONS\tset options for the prover subsystem\n&quot;</span><span class="w"></span>
<span class="w">							</span><span class="o">+</span><span class="w"> </span><span class="s">&quot;    where OPTIONS is a comma separated list, formed with the &quot;</span><span class="w"></span>
<span class="w">							</span><span class="o">+</span><span class="w"> </span><span class="s">&quot;following available settings (defaults in brackets):\n&quot;</span><span class="w"></span>
<span class="w">							</span><span class="o">+</span><span class="w"> </span><span class="s">&quot;      engine:ENGINE\tset engine &quot;</span><span class="w"></span>
<span class="w">							</span><span class="o">+</span><span class="w"> </span><span class="s">&quot;(Auto|OpenGeoProver|Recio|Botana|PureSymbolic) [&quot;</span><span class="w"></span>
<span class="w">							</span><span class="o">+</span><span class="w"> </span><span class="n">proverSettings</span><span class="p">.</span><span class="na">proverEngine</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;]\n&quot;</span><span class="w"></span>
<span class="w">							</span><span class="o">+</span><span class="w"> </span><span class="s">&quot;      timeout:SECS\tset the maximum time attributed to the prover&quot;</span><span class="w"></span>
<span class="w">							</span><span class="o">+</span><span class="w"> </span><span class="s">&quot; (in seconds) [&quot;</span><span class="w"></span>
<span class="w">							</span><span class="o">+</span><span class="w"> </span><span class="n">proverSettings</span><span class="p">.</span><span class="na">proverTimeout</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;]\n&quot;</span><span class="w"></span>
<span class="w">							</span><span class="o">+</span><span class="w"> </span><span class="s">&quot;      maxterms:NUMBER\tset the maximal number of terms [&quot;</span><span class="w"></span>
<span class="w">							</span><span class="o">+</span><span class="w"> </span><span class="n">proverSettings</span><span class="p">.</span><span class="na">getMaxTerms</span><span class="p">()</span><span class="w"></span>
<span class="w">							</span><span class="o">+</span><span class="w"> </span><span class="s">&quot;] (OpenGeoProver only)\n&quot;</span><span class="w"></span>
<span class="w">							</span><span class="o">+</span><span class="w"> </span><span class="s">&quot;      method:METHOD\tset the method (Wu|Groebner|Area) [&quot;</span><span class="w"></span>
<span class="w">							</span><span class="o">+</span><span class="w"> </span><span class="n">proverSettings</span><span class="p">.</span><span class="na">proverMethod</span><span class="w"></span>
<span class="w">							</span><span class="o">+</span><span class="w"> </span><span class="s">&quot;] (OpenGeoProver/Recio only)\n&quot;</span><span class="w"></span>
<span class="w">							</span><span class="o">+</span><span class="w"> </span><span class="s">&quot;      usefixcoords:NUMBER1NUMBER2\tuse fix coordinates for the first&quot;</span><span class="w"></span>
<span class="w">							</span><span class="o">+</span><span class="w"> </span><span class="s">&quot; NUMBER1 for Prove and NUMBER2 for ProveDetails, maximum of 4 both [&quot;</span><span class="w"></span>
<span class="w">							</span><span class="o">+</span><span class="w"> </span><span class="n">proverSettings</span><span class="p">.</span><span class="na">useFixCoordinatesProve</span><span class="w"></span>
<span class="w">							</span><span class="o">+</span><span class="w"> </span><span class="n">proverSettings</span><span class="p">.</span><span class="na">useFixCoordinatesProveDetails</span><span class="w"></span>
<span class="w">							</span><span class="o">+</span><span class="w"> </span><span class="s">&quot;] (Botana only)\n&quot;</span><span class="w"></span>
<span class="w">							</span><span class="o">+</span><span class="w"> </span><span class="s">&quot;      captionalgebra:BOOLEAN\tshow algebraic debug information&quot;</span><span class="w"></span>
<span class="w">							</span><span class="o">+</span><span class="w"> </span><span class="s">&quot; in object captions [&quot;</span><span class="w"></span>
<span class="w">							</span><span class="o">+</span><span class="w"> </span><span class="n">proverSettings</span><span class="p">.</span><span class="na">captionAlgebra</span><span class="w"></span>
<span class="w">							</span><span class="o">+</span><span class="w"> </span><span class="s">&quot;] (Botana only)\n&quot;</span><span class="w"></span>
<span class="w">							</span><span class="o">+</span><span class="w"> </span><span class="s">&quot;  Example: --prover=engine:Botana,timeout:10,&quot;</span><span class="w"></span>
<span class="w">							</span><span class="o">+</span><span class="w"> </span><span class="s">&quot;fpnevercoll:true,usefixcoords:43\n&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="n">AppD</span><span class="p">.</span><span class="na">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="na">containsArg</span><span class="p">(</span><span class="s">&quot;v&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">AppD</span><span class="p">.</span><span class="na">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">EuclidianController</span><span class="w"> </span><span class="nf">newEuclidianController</span><span class="p">(</span><span class="n">Kernel</span><span class="w"> </span><span class="n">kernel1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">EuclidianControllerD</span><span class="p">(</span><span class="n">kernel1</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">protected</span><span class="w"> </span><span class="n">EuclidianView</span><span class="w"> </span><span class="nf">newEuclidianView</span><span class="p">(</span><span class="kt">boolean</span><span class="o">[]</span><span class="w"> </span><span class="n">showAxesFlags</span><span class="p">,</span><span class="w"></span>
<span class="w">			</span><span class="kt">boolean</span><span class="w"> </span><span class="n">showGridFlags</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">EuclidianViewD</span><span class="p">(</span><span class="n">getEuclidianController</span><span class="p">(),</span><span class="w"> </span><span class="n">showAxesFlags</span><span class="p">,</span><span class="w"></span>
<span class="w">				</span><span class="n">showGridFlags</span><span class="p">,</span><span class="w"> </span><span class="n">getSettings</span><span class="p">().</span><span class="na">getEuclidian</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * init the ImageManager (and ImageManager3D for 3D)</span>
<span class="cm">	 * </span>
<span class="cm">	 * @param component component</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">initImageManager</span><span class="p">(</span><span class="n">Component</span><span class="w"> </span><span class="n">component</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">imageManager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ImageManagerD</span><span class="p">(</span><span class="n">component</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * @return True if the whole GUI is available, false if just the euclidian</span>
<span class="cm">	 *         view is displayed.</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">final</span><span class="w"> </span><span class="kd">public</span><span class="w"> </span><span class="kd">synchronized</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isUsingFullGui</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">useFullGui</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * Initialize the gui manager.</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">final</span><span class="w"> </span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">initGuiManager</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">setWaitCursor</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="n">guiManager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newGuiManager</span><span class="p">();</span><span class="w"></span>

<span class="w">		</span><span class="n">newLayout</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="c1">// guiManager.setLayout(new geogebra.gui.layout.LayoutD());</span><span class="w"></span>

<span class="w">		</span><span class="n">guiManager</span><span class="p">.</span><span class="na">initialize</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="n">setDefaultCursor</span><span class="p">();</span><span class="w"></span>

<span class="w">		</span><span class="c1">// make sure mouse events are NOT consumed when a popup menu is closed,</span><span class="w"></span>
<span class="w">		</span><span class="c1">// see #2574</span><span class="w"></span>
<span class="w">		</span><span class="n">UIManager</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;PopupMenu.consumeEventOnClose&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Boolean</span><span class="p">.</span><span class="na">FALSE</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="c1">// **************************************************************************</span><span class="w"></span>
<span class="w">	</span><span class="c1">// COMMAND LINE ARGUMENTS</span><span class="w"></span>
<span class="w">	</span><span class="c1">// **************************************************************************</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * Handles command line options</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handleOptionArgs</span><span class="p">(</span><span class="n">CommandLineArguments</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="c1">// args.containsArg(&quot;help&quot;);</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">args</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="na">containsArg</span><span class="p">(</span><span class="s">&quot;showAlgebraInput&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="kt">boolean</span><span class="w"> </span><span class="n">showInputBar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">args</span><span class="p">.</span><span class="na">getBooleanValue</span><span class="p">(</span><span class="s">&quot;showAlgebraInput&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">					</span><span class="kc">true</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">showInputBar</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">setShowAlgebraInput</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="na">containsArg</span><span class="p">(</span><span class="s">&quot;showAlgebraInputTop&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="kt">boolean</span><span class="w"> </span><span class="n">showAlgebraInputTop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">args</span><span class="w"></span>
<span class="w">					</span><span class="p">.</span><span class="na">getBooleanValue</span><span class="p">(</span><span class="s">&quot;showAlgebraInputTop&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">showAlgebraInputTop</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">setInputPosition</span><span class="p">(</span><span class="n">InputPosition</span><span class="p">.</span><span class="na">top</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="n">String</span><span class="w"> </span><span class="n">fontSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">args</span><span class="p">.</span><span class="na">getStringValue</span><span class="p">(</span><span class="s">&quot;fontSize&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fontSize</span><span class="p">.</span><span class="na">length</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">setFontSize</span><span class="p">(</span><span class="n">Util</span><span class="p">.</span><span class="na">getValidFontSize</span><span class="p">(</span><span class="n">Integer</span><span class="p">.</span><span class="na">parseInt</span><span class="p">(</span><span class="n">fontSize</span><span class="p">)),</span><span class="w"></span>
<span class="w">					</span><span class="kc">true</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="kt">boolean</span><span class="w"> </span><span class="n">enableUndo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">args</span><span class="p">.</span><span class="na">getBooleanValue</span><span class="p">(</span><span class="s">&quot;enableUndo&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">enableUndo</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">setUndoActive</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="na">containsArg</span><span class="p">(</span><span class="s">&quot;showAxes&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="kt">boolean</span><span class="w"> </span><span class="n">showAxesParam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">args</span><span class="p">.</span><span class="na">getBooleanValue</span><span class="p">(</span><span class="s">&quot;showAxes&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="k">this</span><span class="p">.</span><span class="na">showAxes</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">showAxesParam</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="k">this</span><span class="p">.</span><span class="na">showAxes</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">showAxesParam</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="k">this</span><span class="p">.</span><span class="na">getSettings</span><span class="p">().</span><span class="na">getEuclidian</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="na">setShowAxes</span><span class="p">(</span><span class="n">showAxesParam</span><span class="p">,</span><span class="w"></span>
<span class="w">					</span><span class="n">showAxesParam</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="k">this</span><span class="p">.</span><span class="na">getSettings</span><span class="p">().</span><span class="na">getEuclidian</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="na">setShowAxes</span><span class="p">(</span><span class="n">showAxesParam</span><span class="p">,</span><span class="w"></span>
<span class="w">					</span><span class="n">showAxesParam</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="na">containsArg</span><span class="p">(</span><span class="s">&quot;showGrid&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="kt">boolean</span><span class="w"> </span><span class="n">showGridParam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">args</span><span class="p">.</span><span class="na">getBooleanValue</span><span class="p">(</span><span class="s">&quot;showGrid&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="k">this</span><span class="p">.</span><span class="na">showGrid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">showGridParam</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="k">this</span><span class="p">.</span><span class="na">getSettings</span><span class="p">().</span><span class="na">getEuclidian</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="na">showGrid</span><span class="p">(</span><span class="n">showGridParam</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="k">this</span><span class="p">.</span><span class="na">getSettings</span><span class="p">().</span><span class="na">getEuclidian</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="na">showGrid</span><span class="p">(</span><span class="n">showGridParam</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="kt">boolean</span><span class="w"> </span><span class="n">macSandbox</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">args</span><span class="p">.</span><span class="na">getBooleanValue</span><span class="p">(</span><span class="s">&quot;macSandbox&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">macSandbox</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">this</span><span class="p">.</span><span class="na">macsandbox</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="n">setVersionCheckAllowed</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="na">getStringValue</span><span class="p">(</span><span class="s">&quot;versionCheckAllow&quot;</span><span class="p">));</span><span class="w"></span>

<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@SuppressFBWarnings</span><span class="p">({</span><span class="w"> </span><span class="s">&quot;DM_EXIT&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="p">})</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">exit</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">System</span><span class="p">.</span><span class="na">exit</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">versionCheckAllowed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setVersionCheckAllowed</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">versionCheckAllow</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">versionCheckAllow</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;off&quot;</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">versionCheckAllow</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">GeoGebraPreferencesD</span><span class="p">.</span><span class="na">getPref</span><span class="p">().</span><span class="na">saveVersionCheckAllow</span><span class="p">(</span><span class="s">&quot;false&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">				</span><span class="n">versionCheckAllowed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>
<span class="w">				</span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;on&quot;</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">versionCheckAllow</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">GeoGebraPreferencesD</span><span class="p">.</span><span class="na">getPref</span><span class="p">().</span><span class="na">saveVersionCheckAllow</span><span class="p">(</span><span class="s">&quot;true&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">				</span><span class="n">versionCheckAllowed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"></span>
<span class="w">				</span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;false&quot;</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">versionCheckAllow</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">versionCheckAllowed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>
<span class="w">				</span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;true&quot;</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">versionCheckAllow</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">versionCheckAllowed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"></span>
<span class="w">				</span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">			</span><span class="n">Log</span><span class="p">.</span><span class="na">warn</span><span class="p">(</span><span class="s">&quot;Option versionCheckAllow not recognized : &quot;</span><span class="w"></span>
<span class="w">					</span><span class="p">.</span><span class="na">concat</span><span class="p">(</span><span class="n">versionCheckAllow</span><span class="p">));</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="n">versionCheckAllowed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GeoGebraPreferencesD</span><span class="p">.</span><span class="na">getPref</span><span class="p">()</span><span class="w"></span>
<span class="w">				</span><span class="p">.</span><span class="na">loadVersionCheckAllow</span><span class="p">(</span><span class="s">&quot;true&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setProverOption</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">option</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">option</span><span class="p">.</span><span class="na">split</span><span class="p">(</span><span class="s">&quot;:&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="n">ProverSettings</span><span class="w"> </span><span class="n">proverSettings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ProverSettings</span><span class="p">.</span><span class="na">get</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;engine&quot;</span><span class="p">.</span><span class="na">equalsIgnoreCase</span><span class="p">(</span><span class="n">str</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;OpenGeoProver&quot;</span><span class="p">.</span><span class="na">equalsIgnoreCase</span><span class="p">(</span><span class="n">str</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">)</span><span class="w"></span>
<span class="w">					</span><span class="o">||</span><span class="w"> </span><span class="s">&quot;Recio&quot;</span><span class="p">.</span><span class="na">equalsIgnoreCase</span><span class="p">(</span><span class="n">str</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">)</span><span class="w"></span>
<span class="w">					</span><span class="o">||</span><span class="w"> </span><span class="s">&quot;Botana&quot;</span><span class="p">.</span><span class="na">equalsIgnoreCase</span><span class="p">(</span><span class="n">str</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">)</span><span class="w"></span>
<span class="w">					</span><span class="o">||</span><span class="w"> </span><span class="s">&quot;alternativeBotana&quot;</span><span class="p">.</span><span class="na">equalsIgnoreCase</span><span class="p">(</span><span class="n">str</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">)</span><span class="w"></span>
<span class="w">					</span><span class="o">||</span><span class="w"> </span><span class="s">&quot;PureSymbolic&quot;</span><span class="p">.</span><span class="na">equalsIgnoreCase</span><span class="p">(</span><span class="n">str</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">)</span><span class="w"></span>
<span class="w">					</span><span class="o">||</span><span class="w"> </span><span class="s">&quot;Auto&quot;</span><span class="p">.</span><span class="na">equalsIgnoreCase</span><span class="p">(</span><span class="n">str</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">proverSettings</span><span class="p">.</span><span class="na">proverEngine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">str</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">.</span><span class="na">toLowerCase</span><span class="p">();</span><span class="w"></span>
<span class="w">				</span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">			</span><span class="n">Log</span><span class="p">.</span><span class="na">warn</span><span class="p">(</span><span class="s">&quot;Option not recognized: &quot;</span><span class="p">.</span><span class="na">concat</span><span class="p">(</span><span class="n">option</span><span class="p">));</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;timeout&quot;</span><span class="p">.</span><span class="na">equalsIgnoreCase</span><span class="p">(</span><span class="n">str</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">proverSettings</span><span class="p">.</span><span class="na">proverTimeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Integer</span><span class="p">.</span><span class="na">parseInt</span><span class="p">(</span><span class="n">str</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;maxTerms&quot;</span><span class="p">.</span><span class="na">equalsIgnoreCase</span><span class="p">(</span><span class="n">str</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">proverSettings</span><span class="p">.</span><span class="na">setMaxTerms</span><span class="p">(</span><span class="n">Integer</span><span class="p">.</span><span class="na">parseInt</span><span class="p">(</span><span class="n">str</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">));</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;method&quot;</span><span class="p">.</span><span class="na">equalsIgnoreCase</span><span class="p">(</span><span class="n">str</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Groebner&quot;</span><span class="p">.</span><span class="na">equalsIgnoreCase</span><span class="p">(</span><span class="n">str</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">)</span><span class="w"></span>
<span class="w">					</span><span class="o">||</span><span class="w"> </span><span class="s">&quot;Wu&quot;</span><span class="p">.</span><span class="na">equalsIgnoreCase</span><span class="p">(</span><span class="n">str</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">)</span><span class="w"></span>
<span class="w">					</span><span class="o">||</span><span class="w"> </span><span class="s">&quot;Area&quot;</span><span class="p">.</span><span class="na">equalsIgnoreCase</span><span class="p">(</span><span class="n">str</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">proverSettings</span><span class="p">.</span><span class="na">proverMethod</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">str</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">.</span><span class="na">toLowerCase</span><span class="p">();</span><span class="w"></span>
<span class="w">				</span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">			</span><span class="n">Log</span><span class="p">.</span><span class="na">warn</span><span class="p">(</span><span class="s">&quot;Method parameter not recognized: &quot;</span><span class="p">.</span><span class="na">concat</span><span class="p">(</span><span class="n">option</span><span class="p">));</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;fpnevercoll&quot;</span><span class="p">.</span><span class="na">equalsIgnoreCase</span><span class="p">(</span><span class="n">str</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">proverSettings</span><span class="p">.</span><span class="na">freePointsNeverCollinear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Boolean</span><span class="w"></span>
<span class="w">					</span><span class="p">.</span><span class="na">parseBoolean</span><span class="p">(</span><span class="n">str</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;usefixcoords&quot;</span><span class="p">.</span><span class="na">equalsIgnoreCase</span><span class="p">(</span><span class="n">str</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="kt">int</span><span class="w"> </span><span class="n">fixcoordsP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Integer</span><span class="p">.</span><span class="na">parseInt</span><span class="p">(</span><span class="n">str</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">.</span><span class="na">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">));</span><span class="w"></span>
<span class="w">			</span><span class="kt">int</span><span class="w"> </span><span class="n">fixcoordsPD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Integer</span><span class="p">.</span><span class="na">parseInt</span><span class="p">(</span><span class="n">str</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">.</span><span class="na">substring</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">));</span><span class="w"></span>

<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fixcoordsP</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">fixcoordsP</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">Log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="w"></span>
<span class="w">						</span><span class="s">&quot;Improper value for usefixcoords for Prove, using default instead&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">proverSettings</span><span class="p">.</span><span class="na">useFixCoordinatesProve</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fixcoordsP</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>

<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fixcoordsPD</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">fixcoordsPD</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">Log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="w"></span>
<span class="w">						</span><span class="s">&quot;Improper value for usefixcoords for ProveDetails, using default instead&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">proverSettings</span><span class="p">.</span><span class="na">useFixCoordinatesProveDetails</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fixcoordsPD</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>

<span class="w">			</span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;transcext&quot;</span><span class="p">.</span><span class="na">equalsIgnoreCase</span><span class="p">(</span><span class="n">str</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">proverSettings</span><span class="p">.</span><span class="na">transcext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Boolean</span><span class="p">.</span><span class="na">parseBoolean</span><span class="p">(</span><span class="n">str</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;captionalgebra&quot;</span><span class="p">.</span><span class="na">equalsIgnoreCase</span><span class="p">(</span><span class="n">str</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">proverSettings</span><span class="p">.</span><span class="na">captionAlgebra</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Boolean</span><span class="p">.</span><span class="na">parseBoolean</span><span class="p">(</span><span class="n">str</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="n">Log</span><span class="p">.</span><span class="na">warn</span><span class="p">(</span><span class="s">&quot;Prover option not recognized: &quot;</span><span class="p">.</span><span class="na">concat</span><span class="p">(</span><span class="n">option</span><span class="p">));</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * Reports if GeoGebra version check is allowed. The version_check_allowed</span>
<span class="cm">	 * preference is read to decide this, which can be set by the command line</span>
<span class="cm">	 * option --versionCheckAllow (off/on). For changing the behavior for a</span>
<span class="cm">	 * single run, the same command line option must be used with false/true</span>
<span class="cm">	 * parameters.</span>
<span class="cm">	 * </span>
<span class="cm">	 * @return if the check is allowed</span>
<span class="cm">	 * @author Zoltan Kovacs</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">getVersionCheckAllowed</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">versionCheckAllowed</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handleOptionArgsEarly</span><span class="p">(</span><span class="n">CommandLineArguments</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">args</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="na">containsArg</span><span class="p">(</span><span class="s">&quot;showCAS&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">String</span><span class="w"> </span><span class="n">showCASs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">args</span><span class="p">.</span><span class="na">getStringValue</span><span class="p">(</span><span class="s">&quot;showCAS&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">showCASs</span><span class="p">.</span><span class="na">equalsIgnoreCase</span><span class="p">(</span><span class="s">&quot;disable&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">disableCASView</span><span class="p">();</span><span class="w"></span>
<span class="w">				</span><span class="n">getSettings</span><span class="p">().</span><span class="na">getCasSettings</span><span class="p">().</span><span class="na">setEnabled</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="na">containsArg</span><span class="p">(</span><span class="s">&quot;show3D&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">String</span><span class="w"> </span><span class="n">show3Ds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">args</span><span class="p">.</span><span class="na">getStringValue</span><span class="p">(</span><span class="s">&quot;show3D&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">show3Ds</span><span class="p">.</span><span class="na">equalsIgnoreCase</span><span class="p">(</span><span class="s">&quot;disable&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">disable3DView</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="n">String</span><span class="w"> </span><span class="n">language</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">args</span><span class="p">.</span><span class="na">getStringValue</span><span class="p">(</span><span class="s">&quot;language&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">language</span><span class="p">.</span><span class="na">length</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Auto&quot;</span><span class="p">.</span><span class="na">equalsIgnoreCase</span><span class="p">(</span><span class="n">language</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">Locale</span><span class="w"> </span><span class="n">systemLocale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Locale</span><span class="p">.</span><span class="na">getDefault</span><span class="p">();</span><span class="w"></span>
<span class="w">				</span><span class="n">setLocale</span><span class="p">(</span><span class="n">systemLocale</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">setLocale</span><span class="p">(</span><span class="n">getLocale</span><span class="p">(</span><span class="n">language</span><span class="p">));</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="na">containsArg</span><span class="p">(</span><span class="s">&quot;prover&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">proverOptions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">args</span><span class="p">.</span><span class="na">getStringValue</span><span class="p">(</span><span class="s">&quot;prover&quot;</span><span class="p">).</span><span class="na">split</span><span class="p">(</span><span class="s">&quot;,&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">proverOptions</span><span class="p">.</span><span class="na">length</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">setProverOption</span><span class="p">(</span><span class="n">proverOptions</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="c1">// **************************************************************************</span><span class="w"></span>
<span class="w">	</span><span class="c1">// STATUS</span><span class="w"></span>
<span class="w">	</span><span class="c1">// **************************************************************************</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">final</span><span class="w"> </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isApplet</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">final</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">MEMORY_CRITICAL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1024</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="kd">static</span><span class="w"> </span><span class="n">Runtime</span><span class="w"> </span><span class="n">runtime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Runtime</span><span class="p">.</span><span class="na">getRuntime</span><span class="p">();</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">freeMemoryIsCritical</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">runtime</span><span class="p">.</span><span class="na">freeMemory</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">MEMORY_CRITICAL</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="nf">freeMemory</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">runtime</span><span class="p">.</span><span class="na">freeMemory</span><span class="p">();</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="nf">getHeapSize</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">runtime</span><span class="p">.</span><span class="na">maxMemory</span><span class="p">();</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">virtualKeyboardActive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isVirtualKeyboardActive</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">virtualKeyboardActive</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setVirtualKeyboardActive</span><span class="p">(</span><span class="kt">boolean</span><span class="w"> </span><span class="n">active</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">virtualKeyboardActive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">active</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="c1">// **************************************************************************</span><span class="w"></span>
<span class="w">	</span><span class="c1">// File Handling</span><span class="w"></span>
<span class="w">	</span><span class="c1">// **************************************************************************</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">File</span><span class="w"> </span><span class="nf">getCurrentFile</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">currentFile</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">File</span><span class="w"> </span><span class="nf">getCurrentPath</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">currentPath</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setCurrentPath</span><span class="p">(</span><span class="n">File</span><span class="w"> </span><span class="n">file</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">currentPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">file</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * @param file currently open file</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setCurrentFile</span><span class="p">(</span><span class="n">File</span><span class="w"> </span><span class="n">file</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">currentFile</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">file</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="n">currentFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">file</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">currentFile</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">currentPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">currentFile</span><span class="p">.</span><span class="na">getParentFile</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="n">addToFileList</span><span class="p">(</span><span class="n">currentFile</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">isIniting</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">isUsingFullGui</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">updateTitle</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="n">getGuiManager</span><span class="p">().</span><span class="na">updateMenuWindow</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * Add to first position in the recent file list</span>
<span class="cm">	 * @param file file</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addToFileList</span><span class="p">(</span><span class="n">File</span><span class="w"> </span><span class="n">file</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">file</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="n">file</span><span class="p">.</span><span class="na">exists</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="c1">// add or move fileName to front of list</span><span class="w"></span>
<span class="w">		</span><span class="n">fileList</span><span class="p">.</span><span class="na">remove</span><span class="p">(</span><span class="n">file</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="n">fileList</span><span class="p">.</span><span class="na">addFirst</span><span class="p">(</span><span class="n">file</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * @param i index</span>
<span class="cm">	 * @return recent file with given index</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">File</span><span class="w"> </span><span class="nf">getFromFileList</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fileList</span><span class="p">.</span><span class="na">size</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="n">fileList</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">getFileListSize</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">fileList</span><span class="p">.</span><span class="na">size</span><span class="p">();</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">createNewWindow</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">GeoGebraFrame</span><span class="p">.</span><span class="na">createNewWindow</span><span class="p">(</span><span class="n">cmdArgs</span><span class="p">.</span><span class="na">getGlobalArguments</span><span class="p">());</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">fileNew</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">		</span><span class="c1">// clear all</span><span class="w"></span>
<span class="w">		</span><span class="c1">// triggers the &quot;do you want to save&quot; dialog</span><span class="w"></span>
<span class="w">		</span><span class="c1">// so must be called first</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">clearConstruction</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="c1">// clear input bar</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isUsingFullGui</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">showAlgebraInput</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="p">((</span><span class="n">GuiManagerD</span><span class="p">)</span><span class="w"> </span><span class="n">getGuiManager</span><span class="p">()).</span><span class="na">clearInputbar</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="c1">// reset spreadsheet columns, reset trace columns</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isUsingFullGui</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">getGuiManager</span><span class="p">().</span><span class="na">resetSpreadsheet</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="n">getGuiManager</span><span class="p">().</span><span class="na">resetCasView</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="n">resetEVs</span><span class="p">();</span><span class="w"></span>

<span class="w">		</span><span class="n">resetAllToolbars</span><span class="p">();</span><span class="w"></span>

<span class="w">		</span><span class="c1">// reload the saved/(default) preferences</span><span class="w"></span>
<span class="w">		</span><span class="n">GeoGebraPreferencesD</span><span class="p">.</span><span class="na">getPref</span><span class="p">().</span><span class="na">loadXMLPreferences</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="n">getGuiManager</span><span class="p">().</span><span class="na">updateToolbarDefinition</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="n">resetUniqueId</span><span class="p">();</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">resetAllToolbars</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">		</span><span class="n">GuiManagerD</span><span class="w"> </span><span class="n">gm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">GuiManagerD</span><span class="p">)</span><span class="w"> </span><span class="n">getGuiManager</span><span class="p">();</span><span class="w"></span>

<span class="w">		</span><span class="n">DockPanelD</span><span class="o">[]</span><span class="w"> </span><span class="n">panels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gm</span><span class="p">.</span><span class="na">getLayout</span><span class="p">().</span><span class="na">getDockManager</span><span class="p">().</span><span class="na">getPanels</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">DockPanelD</span><span class="w"> </span><span class="n">panel</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">panels</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">panel</span><span class="p">.</span><span class="na">canCustomizeToolbar</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">panel</span><span class="p">.</span><span class="na">setToolbarString</span><span class="p">(</span><span class="n">panel</span><span class="p">.</span><span class="na">getDefaultToolbarString</span><span class="p">());</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="n">gm</span><span class="p">.</span><span class="na">setToolBarDefinition</span><span class="p">(</span><span class="n">gm</span><span class="p">.</span><span class="na">getDefaultToolbarString</span><span class="p">());</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * This function helps determine if a ggt file was loaded because if a ggt</span>
<span class="cm">	 * file was loaded we will need to load something instead of the ggb</span>
<span class="cm">	 * </span>
<span class="cm">	 * @return true if file is loading and is a ggt file</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isLoadingTool</span><span class="p">(</span><span class="n">CommandLineArguments</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">args</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="na">getNoOfFiles</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="n">String</span><span class="w"> </span><span class="n">fileArgument</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">args</span><span class="p">.</span><span class="na">getStringValue</span><span class="p">(</span><span class="s">&quot;file0&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="n">String</span><span class="w"> </span><span class="n">lowerCase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StringUtil</span><span class="p">.</span><span class="na">toLowerCaseUS</span><span class="p">(</span><span class="n">fileArgument</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">lowerCase</span><span class="p">.</span><span class="na">endsWith</span><span class="p">(</span><span class="n">FileExtensions</span><span class="p">.</span><span class="na">GEOGEBRA_TOOL</span><span class="p">.</span><span class="na">toString</span><span class="p">());</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * Opens a file specified as last command line argument</span>
<span class="cm">	 * </span>
<span class="cm">	 * @return true if a file was loaded successfully</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">handleFileArg</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">CommandLineArguments</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">args</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="na">getNoOfFiles</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="kt">boolean</span><span class="w"> </span><span class="n">successRet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"></span>

<span class="w">		</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">args</span><span class="p">.</span><span class="na">getNoOfFiles</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">			</span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">fileArgument</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">args</span><span class="p">.</span><span class="na">getStringValue</span><span class="p">(</span><span class="s">&quot;file&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;file0&quot;</span><span class="p">;</span><span class="w"></span>

<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// load in new Window</span><span class="w"></span>
<span class="w">				</span><span class="n">CommandLineArguments</span><span class="w"> </span><span class="n">windowArgs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">args</span><span class="p">.</span><span class="na">getGlobalArguments</span><span class="p">().</span><span class="na">add</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">fileArgument</span><span class="p">);</span><span class="w"></span>
<span class="w">				</span><span class="n">SwingUtilities</span><span class="p">.</span><span class="na">invokeLater</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">GeoGebraFrame</span><span class="p">.</span><span class="na">createNewWindow</span><span class="p">(</span><span class="n">windowArgs</span><span class="p">));</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">				</span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">					</span><span class="kt">boolean</span><span class="w"> </span><span class="n">success</span><span class="p">;</span><span class="w"></span>
<span class="w">					</span><span class="n">String</span><span class="w"> </span><span class="n">lowerCase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StringUtil</span><span class="p">.</span><span class="na">toLowerCaseUS</span><span class="p">(</span><span class="n">fileArgument</span><span class="p">);</span><span class="w"></span>
<span class="w">					</span><span class="n">FileExtensions</span><span class="w"> </span><span class="n">ext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StringUtil</span><span class="p">.</span><span class="na">getFileExtension</span><span class="p">(</span><span class="n">lowerCase</span><span class="p">);</span><span class="w"></span>

<span class="w">					</span><span class="kt">boolean</span><span class="w"> </span><span class="n">isMacroFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ext</span><span class="w"></span>
<span class="w">							</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">FileExtensions</span><span class="p">.</span><span class="na">GEOGEBRA_TOOL</span><span class="p">);</span><span class="w"></span>

<span class="w">					</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lowerCase</span><span class="p">.</span><span class="na">startsWith</span><span class="p">(</span><span class="s">&quot;http:&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">							</span><span class="o">||</span><span class="w"> </span><span class="n">lowerCase</span><span class="p">.</span><span class="na">startsWith</span><span class="p">(</span><span class="s">&quot;https:&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">							</span><span class="o">||</span><span class="w"> </span><span class="n">lowerCase</span><span class="p">.</span><span class="na">startsWith</span><span class="p">(</span><span class="s">&quot;file:&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">						</span><span class="c1">// replace all whitespace characters by %20 in URL</span><span class="w"></span>
<span class="w">						</span><span class="c1">// string</span><span class="w"></span>
<span class="w">						</span><span class="n">String</span><span class="w"> </span><span class="n">fileArgument2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fileArgument</span><span class="p">.</span><span class="na">replaceAll</span><span class="p">(</span><span class="s">&quot;\\s&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">								</span><span class="s">&quot;%20&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">						</span><span class="n">URL</span><span class="w"> </span><span class="n">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">URL</span><span class="p">(</span><span class="n">fileArgument2</span><span class="p">);</span><span class="w"></span>
<span class="w">						</span><span class="n">success</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">loadXML</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="w"> </span><span class="n">isMacroFile</span><span class="p">);</span><span class="w"></span>

<span class="w">						</span><span class="c1">// check if full GUI is necessary</span><span class="w"></span>
<span class="w">						</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">success</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">isMacroFile</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">isUsingFullGui</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">							</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">showConsProtNavigation</span><span class="p">()</span><span class="w"></span>
<span class="w">									</span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="n">isJustEuclidianVisible</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">								</span><span class="n">useFullGui</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"></span>
<span class="w">							</span><span class="p">}</span><span class="w"></span>
<span class="w">						</span><span class="p">}</span><span class="w"></span>
<span class="w">					</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lowerCase</span><span class="p">.</span><span class="na">startsWith</span><span class="p">(</span><span class="s">&quot;base64://&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">						</span><span class="c1">// substring to strip off base64://</span><span class="w"></span>
<span class="w">						</span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">zipFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Base64</span><span class="w"></span>
<span class="w">								</span><span class="p">.</span><span class="na">decode</span><span class="p">(</span><span class="n">fileArgument</span><span class="p">.</span><span class="na">substring</span><span class="p">(</span><span class="mi">9</span><span class="p">));</span><span class="w"></span>
<span class="w">						</span><span class="n">success</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">loadXML</span><span class="p">(</span><span class="n">zipFile</span><span class="p">);</span><span class="w"></span>

<span class="w">						</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">success</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">isMacroFile</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">isUsingFullGui</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">							</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">showConsProtNavigation</span><span class="p">()</span><span class="w"></span>
<span class="w">									</span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="n">isJustEuclidianVisible</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">								</span><span class="n">useFullGui</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"></span>
<span class="w">							</span><span class="p">}</span><span class="w"></span>
<span class="w">						</span><span class="p">}</span><span class="w"></span>
<span class="w">					</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ext</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">FileExtensions</span><span class="p">.</span><span class="na">HTM</span><span class="p">)</span><span class="w"></span>
<span class="w">							</span><span class="o">||</span><span class="w"> </span><span class="n">ext</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">FileExtensions</span><span class="p">.</span><span class="na">HTML</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">						</span><span class="n">loadBase64File</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="n">fileArgument</span><span class="p">));</span><span class="w"></span>
<span class="w">						</span><span class="n">success</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"></span>
<span class="w">					</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">						</span><span class="n">File</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="n">fileArgument</span><span class="p">);</span><span class="w"></span>
<span class="w">						</span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="na">getCanonicalFile</span><span class="p">();</span><span class="w"></span>
<span class="w">						</span><span class="n">success</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">loadFile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="n">isMacroFile</span><span class="p">);</span><span class="w"></span>

<span class="w">					</span><span class="p">}</span><span class="w"></span>

<span class="w">					</span><span class="n">successRet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">successRet</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">success</span><span class="p">;</span><span class="w"></span>
<span class="w">				</span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">					</span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span><span class="w"></span>
<span class="w">					</span><span class="n">successRet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>
<span class="w">				</span><span class="p">}</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">successRet</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * loads an html file with &amp;lt;param name=&quot;ggbBase64&quot;</span>
<span class="cm">	 * value=&quot;UEsDBBQACAAI...&quot;&amp;gt;</span>
<span class="cm">	 * </span>
<span class="cm">	 * @param file</span>
<span class="cm">	 *            html file</span>
<span class="cm">	 * @return success</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">loadBase64File</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">File</span><span class="w"> </span><span class="n">file</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">file</span><span class="p">.</span><span class="na">exists</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="c1">// show file not found message</span><span class="w"></span>
<span class="w">			</span><span class="n">JOptionPane</span><span class="p">.</span><span class="na">showConfirmDialog</span><span class="p">(</span><span class="n">getMainComponent</span><span class="p">(),</span><span class="w"></span>
<span class="w">					</span><span class="n">getLocalization</span><span class="p">().</span><span class="na">getError</span><span class="p">(</span><span class="s">&quot;FileNotFound&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;:\n&quot;</span><span class="w"></span>
<span class="w">							</span><span class="o">+</span><span class="w"> </span><span class="n">file</span><span class="p">.</span><span class="na">getAbsolutePath</span><span class="p">(),</span><span class="w"></span>
<span class="w">					</span><span class="n">getLocalization</span><span class="p">().</span><span class="na">getError</span><span class="p">(</span><span class="s">&quot;Error&quot;</span><span class="p">),</span><span class="w"></span>
<span class="w">					</span><span class="n">JOptionPane</span><span class="p">.</span><span class="na">DEFAULT_OPTION</span><span class="p">,</span><span class="w"> </span><span class="n">JOptionPane</span><span class="p">.</span><span class="na">WARNING_MESSAGE</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="kt">boolean</span><span class="w"> </span><span class="n">success</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>

<span class="w">		</span><span class="n">setWaitCursor</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="c1">// hide navigation bar for construction steps if visible</span><span class="w"></span>
<span class="w">		</span><span class="n">setHideConstructionProtocolNavigation</span><span class="p">();</span><span class="w"></span>

<span class="w">		</span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">success</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">loadFromHtml</span><span class="p">(</span><span class="n">file</span><span class="p">.</span><span class="na">toURI</span><span class="p">().</span><span class="na">toURL</span><span class="p">());</span><span class="w"> </span><span class="c1">// file.toURL() does</span><span class="w"></span>
<span class="w">			</span><span class="c1">// not escape</span><span class="w"></span>
<span class="w">			</span><span class="c1">// illegal</span><span class="w"></span>
<span class="w">			</span><span class="c1">// characters</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">setDefaultCursor</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="n">showError</span><span class="p">(</span><span class="n">Errors</span><span class="p">.</span><span class="na">LoadFileFailed</span><span class="p">,</span><span class="w"> </span><span class="n">file</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span><span class="w"></span>
<span class="w">			</span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>

<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="c1">// updateGUIafterLoadFile(success, false);</span><span class="w"></span>
<span class="w">		</span><span class="n">setDefaultCursor</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">success</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * Tries to load a construction from the following sources in order:</span>
<span class="cm">	 * &lt;ol&gt;</span>
<span class="cm">	 * &lt;li&gt;From embedded base64 string</span>
<span class="cm">	 * &lt;ol type=&quot;a&quot;&gt;</span>
<span class="cm">	 * &lt;li&gt;&lt;code&gt;&amp;lt;article ... data-param-ggbbase64=&quot;...&quot; /&amp;gt;&lt;/code&gt;&lt;/li&gt;</span>
<span class="cm">	 * &lt;li&gt;&lt;code&gt;&amp;lt;param name=&quot;ggbBase64&quot; value=&quot;...&quot; /&amp;gt;&lt;/code&gt;&lt;/li&gt;</span>
<span class="cm">	 * &lt;/ol&gt;</span>
<span class="cm">	 * &lt;/li&gt;</span>
<span class="cm">	 * &lt;li&gt;From relative referenced *.ggb file</span>
<span class="cm">	 * &lt;ol type=&quot;a&quot;&gt;</span>
<span class="cm">	 * &lt;li&gt;&lt;code&gt;&amp;lt;article ... data-param-filename=&quot;...&quot; /&amp;gt;&lt;/code&gt;&lt;/li&gt;</span>
<span class="cm">	 * &lt;li&gt;&lt;code&gt;&amp;lt;param name=&quot;filename&quot; value=&quot;...&quot; /&amp;gt;&lt;/code&gt;&lt;/li&gt;</span>
<span class="cm">	 * &lt;/ol&gt;</span>
<span class="cm">	 * &lt;/li&gt;</span>
<span class="cm">	 * &lt;/ol&gt;</span>
<span class="cm">	 * @return success</span>
<span class="cm">	 * @throws IOException if URL can&#39;t be opened</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">loadFromHtml</span><span class="p">(</span><span class="n">URL</span><span class="w"> </span><span class="n">htmlurl</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">URL</span><span class="w"> </span><span class="n">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">htmlurl</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="n">String</span><span class="w"> </span><span class="n">page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fetchPage</span><span class="p">(</span><span class="n">url</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="n">page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">page</span><span class="p">.</span><span class="na">replaceAll</span><span class="p">(</span><span class="s">&quot;\\s+&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// Normalize white spaces</span><span class="w"></span>
<span class="w">		</span><span class="n">page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">page</span><span class="p">.</span><span class="na">replace</span><span class="p">(</span><span class="sc">&#39;&quot;&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;\&#39;&#39;</span><span class="p">);</span><span class="w"> </span><span class="c1">// Replace double quotes (&quot;) with single</span><span class="w"></span>
<span class="w">		</span><span class="c1">// quotes (&#39;)</span><span class="w"></span>
<span class="w">		</span><span class="n">String</span><span class="w"> </span><span class="n">lowerCasedPage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StringUtil</span><span class="p">.</span><span class="na">toLowerCaseUS</span><span class="p">(</span><span class="n">page</span><span class="p">);</span><span class="w"> </span><span class="c1">// We must</span><span class="w"></span>
<span class="w">																</span><span class="c1">// preserve</span><span class="w"></span>
<span class="w">		</span><span class="c1">// casing for</span><span class="w"></span>
<span class="w">		</span><span class="c1">// base64</span><span class="w"></span>
<span class="w">		</span><span class="c1">// strings and</span><span class="w"></span>
<span class="w">		</span><span class="c1">// case sensitve</span><span class="w"></span>
<span class="w">		</span><span class="c1">// file systems</span><span class="w"></span>

<span class="w">		</span><span class="n">String</span><span class="w"> </span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getAttributeValue</span><span class="p">(</span><span class="n">page</span><span class="p">,</span><span class="w"> </span><span class="n">lowerCasedPage</span><span class="p">,</span><span class="w"></span>
<span class="w">				</span><span class="s">&quot;data-param-ggbbase64=&#39;&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">val</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">getAttributeValue</span><span class="p">(</span><span class="n">page</span><span class="p">,</span><span class="w"> </span><span class="n">lowerCasedPage</span><span class="p">,</span><span class="w"></span>
<span class="w">				</span><span class="s">&quot;name=&#39;ggbbase64&#39; value=&#39;&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">val</span><span class="p">;</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">val</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// &#39;val&#39; is the base64 string</span><span class="w"></span>
<span class="w">			</span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">zipFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Base64</span><span class="p">.</span><span class="na">decode</span><span class="p">(</span><span class="n">val</span><span class="p">);</span><span class="w"></span>

<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="n">loadXML</span><span class="p">(</span><span class="n">zipFile</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getAttributeValue</span><span class="p">(</span><span class="n">page</span><span class="p">,</span><span class="w"> </span><span class="n">lowerCasedPage</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;data-param-filename=&#39;&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">val</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">getAttributeValue</span><span class="p">(</span><span class="n">page</span><span class="p">,</span><span class="w"> </span><span class="n">lowerCasedPage</span><span class="p">,</span><span class="w"></span>
<span class="w">				</span><span class="s">&quot;name=&#39;filename&#39; value=&#39;&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">val</span><span class="p">;</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">val</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// &#39;val&#39; is the relative path to *.ggb file</span><span class="w"></span>
<span class="w">			</span><span class="n">String</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">url</span><span class="p">.</span><span class="na">getPath</span><span class="p">();</span><span class="w"> </span><span class="c1">// http://www.geogebra.org/mobile/test.html?test=true</span><span class="w"></span>
<span class="w">			</span><span class="c1">// -&gt; path would be</span><span class="w"></span>
<span class="w">			</span><span class="c1">// &#39;/mobile/test.html&#39;</span><span class="w"></span>
<span class="w">			</span><span class="kt">int</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">path</span><span class="p">.</span><span class="na">lastIndexOf</span><span class="p">(</span><span class="sc">&#39;/&#39;</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">path</span><span class="p">.</span><span class="na">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="c1">// Remove</span><span class="w"></span>
<span class="w">			</span><span class="c1">// the</span><span class="w"></span>
<span class="w">			</span><span class="c1">// &#39;test.html&#39;</span><span class="w"></span>
<span class="w">			</span><span class="c1">// part</span><span class="w"></span>
<span class="w">			</span><span class="n">path</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">val</span><span class="p">;</span><span class="w"> </span><span class="c1">// Add filename</span><span class="w"></span>
<span class="w">			</span><span class="n">URL</span><span class="w"> </span><span class="n">fileUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">URL</span><span class="p">(</span><span class="n">url</span><span class="p">.</span><span class="na">getProtocol</span><span class="p">(),</span><span class="w"> </span><span class="n">url</span><span class="p">.</span><span class="na">getHost</span><span class="p">(),</span><span class="w"> </span><span class="n">path</span><span class="p">);</span><span class="w"></span>

<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="n">loadXML</span><span class="p">(</span><span class="n">fileUrl</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">iframeURL1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&lt;iframe src=&#39;http://www.geogebratube.org/material/iframe/id/&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">iframeURL2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&lt;iframe src=&#39;http://ggbtu.be/e&quot;</span><span class="p">;</span><span class="w"></span>

<span class="w">		</span><span class="c1">// try loading from an embedded iframe</span><span class="w"></span>
<span class="w">		</span><span class="kt">int</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lowerCasedPage</span><span class="p">.</span><span class="na">indexOf</span><span class="p">(</span><span class="n">iframeURL1</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">index</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">index</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">iframeURL1</span><span class="p">.</span><span class="na">length</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lowerCasedPage</span><span class="p">.</span><span class="na">indexOf</span><span class="p">(</span><span class="n">iframeURL2</span><span class="p">);</span><span class="w"></span>

<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">index</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">index</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">iframeURL2</span><span class="p">.</span><span class="na">length</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">index</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">StringBuilder</span><span class="w"> </span><span class="n">sb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StringBuilder</span><span class="p">(</span><span class="w"></span>
<span class="w">					</span><span class="s">&quot;http://www.geogebratube.org/material/download/format/file/id/&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">index</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">lowerCasedPage</span><span class="p">.</span><span class="na">length</span><span class="p">()</span><span class="w"></span>
<span class="w">					</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">Character</span><span class="p">.</span><span class="na">isDigit</span><span class="p">(</span><span class="n">lowerCasedPage</span><span class="p">.</span><span class="na">charAt</span><span class="p">(</span><span class="n">index</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">sb</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">lowerCasedPage</span><span class="p">.</span><span class="na">charAt</span><span class="p">(</span><span class="n">index</span><span class="p">));</span><span class="w"></span>
<span class="w">				</span><span class="n">index</span><span class="o">++</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>

<span class="w">			</span><span class="n">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">URL</span><span class="p">(</span><span class="n">sb</span><span class="p">.</span><span class="na">toString</span><span class="p">());</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="n">loadXML</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getAttributeValue</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">page</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">lowerCasedPage</span><span class="p">,</span><span class="w"></span>
<span class="w">			</span><span class="n">String</span><span class="w"> </span><span class="n">attrName0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">String</span><span class="w"> </span><span class="n">attrName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">attrName0</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="kt">int</span><span class="w"> </span><span class="n">index</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="p">(</span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lowerCasedPage</span><span class="p">.</span><span class="na">indexOf</span><span class="p">(</span><span class="n">attrName</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// value=&#39;test.ggb&#39;</span><span class="w"></span>
<span class="w">			</span><span class="n">index</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">attrName</span><span class="p">.</span><span class="na">length</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="n">getAttributeValue</span><span class="p">(</span><span class="n">page</span><span class="p">,</span><span class="w"> </span><span class="n">index</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;\&#39;&#39;</span><span class="p">);</span><span class="w"> </span><span class="c1">// Search for next</span><span class="w"></span>
<span class="w">			</span><span class="c1">// single quote (&#39;)</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="n">attrName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">attrName</span><span class="p">.</span><span class="na">replaceAll</span><span class="p">(</span><span class="s">&quot;&#39;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="p">(</span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lowerCasedPage</span><span class="p">.</span><span class="na">indexOf</span><span class="p">(</span><span class="n">attrName</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// value=filename_</span><span class="w"></span>
<span class="w">			</span><span class="c1">// or</span><span class="w"></span>
<span class="w">			</span><span class="c1">// value=filename&gt;</span><span class="w"></span>
<span class="w">			</span><span class="c1">// ( ) or (&gt;)</span><span class="w"></span>
<span class="w">			</span><span class="n">index</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">attrName</span><span class="p">.</span><span class="na">length</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="n">getAttributeValue</span><span class="p">(</span><span class="n">page</span><span class="p">,</span><span class="w"> </span><span class="n">index</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39; &#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;&gt;&#39;</span><span class="p">);</span><span class="w"> </span><span class="c1">// Search for next</span><span class="w"></span>
<span class="w">			</span><span class="c1">// white space (</span><span class="w"></span>
<span class="w">			</span><span class="c1">// ) or angle</span><span class="w"></span>
<span class="w">			</span><span class="c1">// bracket (&gt;)</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getAttributeValue</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">page</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">begin</span><span class="p">,</span><span class="w"></span>
<span class="w">			</span><span class="kt">char</span><span class="p">...</span><span class="w"> </span><span class="n">attributeEndMarkers</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="kt">int</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">begin</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">end</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">page</span><span class="p">.</span><span class="na">length</span><span class="p">()</span><span class="w"></span>
<span class="w">				</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">isMarker</span><span class="p">(</span><span class="n">attributeEndMarkers</span><span class="p">,</span><span class="w"> </span><span class="n">page</span><span class="p">.</span><span class="na">charAt</span><span class="p">(</span><span class="n">end</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">end</span><span class="o">++</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">page</span><span class="p">.</span><span class="na">length</span><span class="p">()</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">begin</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="c1">// attribute value not</span><span class="w"></span>
<span class="w">		</span><span class="c1">// terminated or empty</span><span class="w"></span>
<span class="w">				</span><span class="kc">null</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">page</span><span class="p">.</span><span class="na">substring</span><span class="p">(</span><span class="n">begin</span><span class="p">,</span><span class="w"> </span><span class="n">end</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isMarker</span><span class="p">(</span><span class="kt">char</span><span class="o">[]</span><span class="w"> </span><span class="n">markers</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">character</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">markers</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">character</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">fetchPage</span><span class="p">(</span><span class="n">URL</span><span class="w"> </span><span class="n">url</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">BufferedReader</span><span class="w"> </span><span class="n">reader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">reader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BufferedReader</span><span class="p">(</span><span class="w"></span>
<span class="w">					</span><span class="k">new</span><span class="w"> </span><span class="n">InputStreamReader</span><span class="p">(</span><span class="n">url</span><span class="p">.</span><span class="na">openStream</span><span class="p">(),</span><span class="w"></span>
<span class="w">							</span><span class="n">Charsets</span><span class="p">.</span><span class="na">getUtf8</span><span class="p">()));</span><span class="w"></span>
<span class="w">			</span><span class="n">StringBuilder</span><span class="w"> </span><span class="n">page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StringBuilder</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="n">String</span><span class="w"> </span><span class="n">line</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="kc">null</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="p">(</span><span class="n">line</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reader</span><span class="p">.</span><span class="na">readLine</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">page</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">line</span><span class="p">);</span><span class="w"> </span><span class="c1">// page does not contain any line breaks</span><span class="w"></span>
<span class="w">				</span><span class="c1">// &#39;\n&#39;, &#39;\r&#39; or &quot;\r\n&quot;</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="n">page</span><span class="p">.</span><span class="na">toString</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">reader</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">reader</span><span class="p">.</span><span class="na">close</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="c1">// **************************************************************************</span><span class="w"></span>
<span class="w">	</span><span class="c1">// VIEWS</span><span class="w"></span>
<span class="w">	</span><span class="c1">// **************************************************************************</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setActiveView</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">view</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">getGuiManager</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">setActiveView</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">view</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * @return whether  just the euclidian view is visible in the document just loaded.</span>
<span class="cm">	 *</span>
<span class="cm">	 * @throws OperationNotSupportedException if perspective is not set</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isJustEuclidianVisible</span><span class="p">()</span><span class="w"></span>
<span class="w">			</span><span class="kd">throws</span><span class="w"> </span><span class="n">OperationNotSupportedException</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">Perspective</span><span class="w"> </span><span class="n">docPerspective</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getTmpPerspective</span><span class="p">();</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">docPerspective</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OperationNotSupportedException</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="kt">boolean</span><span class="w"> </span><span class="n">justEuclidianVisible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>

<span class="w">		</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">DockPanelData</span><span class="w"> </span><span class="n">panel</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">docPerspective</span><span class="p">.</span><span class="na">getDockPanelData</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">panel</span><span class="p">.</span><span class="na">getViewId</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">App</span><span class="p">.</span><span class="na">VIEW_EUCLIDIAN</span><span class="p">)</span><span class="w"></span>
<span class="w">					</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">panel</span><span class="p">.</span><span class="na">isVisible</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">justEuclidianVisible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">panel</span><span class="p">.</span><span class="na">isVisible</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">justEuclidianVisible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>
<span class="w">				</span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">justEuclidianVisible</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">EuclidianView</span><span class="w"> </span><span class="nf">createEuclidianView</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">euclidianView</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">EuclidianViewD</span><span class="w"> </span><span class="nf">getEuclidianView1</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">EuclidianViewD</span><span class="p">)</span><span class="w"> </span><span class="n">euclidianView</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">AlgebraView</span><span class="w"> </span><span class="nf">getAlgebraView</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">guiManager</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">AlgebraView</span><span class="p">)</span><span class="w"> </span><span class="n">guiManager</span><span class="p">.</span><span class="na">getAlgebraView</span><span class="p">();</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">EuclidianViewD</span><span class="w"> </span><span class="nf">getEuclidianView2</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">idx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">EuclidianViewD</span><span class="p">)</span><span class="w"> </span><span class="n">getGuiManager</span><span class="p">().</span><span class="na">getEuclidianView2</span><span class="p">(</span><span class="n">idx</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">hasEuclidianView2EitherShowingOrNot</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">idx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">guiManager</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"></span>
<span class="w">				</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">getGuiManager</span><span class="p">().</span><span class="na">hasEuclidianView2EitherShowingOrNot</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isShowingEuclidianView2</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">idx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">guiManager</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">getGuiManager</span><span class="p">().</span><span class="na">hasEuclidianView2</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span><span class="w"></span>
<span class="w">				</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">getGuiManager</span><span class="p">().</span><span class="na">getEuclidianView2</span><span class="p">(</span><span class="n">idx</span><span class="p">).</span><span class="na">isShowing</span><span class="p">();</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">EuclidianView</span><span class="w"> </span><span class="nf">getActiveEuclidianView</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">getGuiManager</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="n">getEuclidianView1</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">getGuiManager</span><span class="p">().</span><span class="na">getActiveEuclidianView</span><span class="p">();</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setShowAxesSelected</span><span class="p">(</span><span class="n">JCheckBoxMenuItem</span><span class="w"> </span><span class="n">cb</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setShowGridSelected</span><span class="p">(</span><span class="n">JCheckBoxMenuItem</span><span class="w"> </span><span class="n">cb</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="c1">// **************************************************************************</span><span class="w"></span>
<span class="w">	</span><span class="c1">// ICONS &amp; IMAGES</span><span class="w"></span>
<span class="w">	</span><span class="c1">// **************************************************************************</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">ImageManagerD</span><span class="w"> </span><span class="nf">getImageManager</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">imageManager</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setGUIFontSize</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">size</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">		</span><span class="c1">// TRAC-4770</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="c1">// set tool icon size between 32 and 64</span><span class="w"></span>
<span class="w">			</span><span class="n">imageManager</span><span class="p">.</span><span class="na">setMaxIconSize</span><span class="p">(</span><span class="n">Math</span><span class="p">.</span><span class="na">max</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="p">));</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="kd">super</span><span class="p">.</span><span class="na">setGUIFontSize</span><span class="p">(</span><span class="n">size</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * Sets the tool icon size between 32 and 64.</span>
<span class="cm">	 * @param iconSize icon size</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setMaxIconSize</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">iconSize</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">imageManager</span><span class="p">.</span><span class="na">setMaxIconSizeAsPt</span><span class="p">(</span><span class="n">iconSize</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">ImageIcon</span><span class="w"> </span><span class="nf">getImageIcon</span><span class="p">(</span><span class="n">ImageResourceD</span><span class="w"> </span><span class="n">res</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">imageManager</span><span class="p">.</span><span class="na">getImageIcon</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">ImageIcon</span><span class="w"> </span><span class="nf">getScaledIcon</span><span class="p">(</span><span class="n">ImageResourceD</span><span class="w"> </span><span class="n">res</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">getScaledIcon</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * needed for padding in Windows XP or earlier without check, checkbox isn&#39;t</span>
<span class="cm">	 * shown in Vista, Win 7</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setEmptyIcon</span><span class="p">(</span><span class="n">JCheckBoxMenuItem</span><span class="w"> </span><span class="n">cb</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">WINDOWS_VISTA_OR_LATER</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">cb</span><span class="p">.</span><span class="na">setIcon</span><span class="p">(</span><span class="n">getEmptyIcon</span><span class="p">());</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">protected</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getMenuIconPath</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="c1">// int fontSize = getGUIFontSize();</span><span class="w"></span>
<span class="w">		</span><span class="n">String</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;/gui/images/64px/&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="c1">// if (fontSize &lt; 30) {</span><span class="w"></span>
<span class="w">		</span><span class="c1">// path += &quot;20px/&quot;;</span><span class="w"></span>
<span class="w">		</span><span class="c1">// } else if (fontSize &gt;= 30 &amp;&amp; fontSize &lt; 79.5) {</span><span class="w"></span>
<span class="w">		</span><span class="c1">// path += &quot;40px/&quot;;</span><span class="w"></span>
<span class="w">		</span><span class="c1">// } else if (fontSize &gt;= 79.5) {</span><span class="w"></span>
<span class="w">		</span><span class="c1">// path += &quot;106px/&quot;;</span><span class="w"></span>
<span class="w">		</span><span class="c1">// }</span><span class="w"></span>
<span class="w">		</span><span class="c1">//</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">path</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">ptToPx</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">points</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="kt">int</span><span class="w"> </span><span class="n">px</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">points</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">case</span><span class="w"> </span><span class="mi">12</span><span class="p">:</span><span class="w"></span>
<span class="w">		</span><span class="k">case</span><span class="w"> </span><span class="mi">14</span><span class="p">:</span><span class="w"></span>
<span class="w">		</span><span class="k">case</span><span class="w"> </span><span class="mi">16</span><span class="p">:</span><span class="w"></span>
<span class="w">			</span><span class="n">px</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">16</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="k">default</span><span class="p">:</span><span class="w"></span>
<span class="w">		</span><span class="k">case</span><span class="w"> </span><span class="mi">18</span><span class="p">:</span><span class="w"></span>
<span class="w">		</span><span class="k">case</span><span class="w"> </span><span class="mi">20</span><span class="p">:</span><span class="w"></span>
<span class="w">		</span><span class="k">case</span><span class="w"> </span><span class="mi">24</span><span class="p">:</span><span class="w"></span>
<span class="w">		</span><span class="k">case</span><span class="w"> </span><span class="mi">28</span><span class="p">:</span><span class="w"></span>
<span class="w">			</span><span class="n">px</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">24</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="k">case</span><span class="w"> </span><span class="mi">32</span><span class="p">:</span><span class="w"></span>
<span class="w">		</span><span class="k">case</span><span class="w"> </span><span class="mi">48</span><span class="p">:</span><span class="w"></span>
<span class="w">			</span><span class="n">px</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">48</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="k">break</span><span class="p">;</span><span class="w"></span>

<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">px</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">getScaledIconSize</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">ptToPx</span><span class="p">(</span><span class="n">getFontSize</span><span class="p">());</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * @param res resource</span>
<span class="cm">	 * @param borderColor border color</span>
<span class="cm">	 * @return scaled icon</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">ImageIcon</span><span class="w"> </span><span class="nf">getScaledIcon</span><span class="p">(</span><span class="n">ImageResourceD</span><span class="w"> </span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">Color</span><span class="w"> </span><span class="n">borderColor</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">ImageIcon</span><span class="w"> </span><span class="n">icon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">imageManager</span><span class="p">.</span><span class="na">getImageIcon</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">borderColor</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">scaleIcon</span><span class="p">(</span><span class="n">icon</span><span class="p">,</span><span class="w"> </span><span class="n">getScaledIconSize</span><span class="p">());</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * @param res resource</span>
<span class="cm">	 * @return scaled icon</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">ImageIcon</span><span class="w"> </span><span class="nf">getScaledIconCommon</span><span class="p">(</span><span class="n">ImageResourceD</span><span class="w"> </span><span class="n">res</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">ImageIcon</span><span class="w"> </span><span class="n">icon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">imageManager</span><span class="p">.</span><span class="na">getImageIcon</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">scaleIcon</span><span class="p">(</span><span class="n">icon</span><span class="p">,</span><span class="w"> </span><span class="n">getScaledIconSize</span><span class="p">());</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * @param res resource</span>
<span class="cm">	 * @param iconSize icon size</span>
<span class="cm">	 * @return scaled icon</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">ImageIcon</span><span class="w"> </span><span class="nf">getScaledIcon</span><span class="p">(</span><span class="n">ImageResourceD</span><span class="w"> </span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">iconSize</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">ImageIcon</span><span class="w"> </span><span class="n">icon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">imageManager</span><span class="p">.</span><span class="na">getImageIcon</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">scaleIcon</span><span class="p">(</span><span class="n">icon</span><span class="p">,</span><span class="w"> </span><span class="n">iconSize</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">ImageIcon</span><span class="w"> </span><span class="nf">scaleIcon</span><span class="p">(</span><span class="n">ImageIcon</span><span class="w"> </span><span class="n">icon</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">iconSize</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">icon</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">iconSize</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="n">Image</span><span class="w"> </span><span class="n">img</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">icon</span><span class="p">.</span><span class="na">getImage</span><span class="p">().</span><span class="na">getScaledInstance</span><span class="p">(</span><span class="n">iconSize</span><span class="p">,</span><span class="w"> </span><span class="n">iconSize</span><span class="p">,</span><span class="w"></span>
<span class="w">				</span><span class="n">Image</span><span class="p">.</span><span class="na">SCALE_SMOOTH</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ImageIcon</span><span class="p">(</span><span class="n">img</span><span class="p">);</span><span class="w"></span>

<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * @param fileName filename</span>
<span class="cm">	 * @return scaled image</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">Image</span><span class="w"> </span><span class="nf">getScaledInternalImage</span><span class="p">(</span><span class="n">ImageResourceD</span><span class="w"> </span><span class="n">fileName</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">MyImageD</span><span class="w"> </span><span class="n">img</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">imageManager</span><span class="p">.</span><span class="na">getInternalImage</span><span class="p">(</span><span class="n">fileName</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="kt">int</span><span class="w"> </span><span class="n">iconSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getScaledIconSize</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">img</span><span class="p">.</span><span class="na">getImage</span><span class="p">().</span><span class="na">getScaledInstance</span><span class="p">(</span><span class="n">iconSize</span><span class="p">,</span><span class="w"> </span><span class="n">iconSize</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 *</span>
<span class="cm">	 * @param modeText mode name</span>
<span class="cm">	 * @param borderColor border color</span>
<span class="cm">	 * @return tool icon</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">ImageIcon</span><span class="w"> </span><span class="nf">getToolBarImage</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">modeText</span><span class="p">,</span><span class="w"> </span><span class="n">Color</span><span class="w"> </span><span class="n">borderColor</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">		</span><span class="n">ImageIcon</span><span class="w"> </span><span class="n">icon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">imageManager</span><span class="p">.</span><span class="na">getImageIcon</span><span class="p">(</span><span class="w"></span>
<span class="w">				</span><span class="n">imageManager</span><span class="p">.</span><span class="na">getToolImageResource</span><span class="p">(</span><span class="n">modeText</span><span class="p">),</span><span class="w"> </span><span class="n">borderColor</span><span class="p">,</span><span class="w"></span>
<span class="w">				</span><span class="n">Color</span><span class="p">.</span><span class="na">WHITE</span><span class="p">);</span><span class="w"></span>

<span class="w">		</span><span class="cm">/*</span>
<span class="cm">		 * mathieu 2010-04-10 see ImageManager3D.getImageResourceGeoGebra() if</span>
<span class="cm">		 * (icon == null) { // load3DJar(); // try to find this image in 3D</span>
<span class="cm">		 * extension path = &quot;org/geogebra/desktop/geogebra3D/images/&quot; +</span>
<span class="cm">		 * filename; icon = imageManager.getImageIcon(path, borderColor); }</span>
<span class="cm">		 */</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">icon</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">icon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getToolIcon</span><span class="p">(</span><span class="n">borderColor</span><span class="p">);</span><span class="w"></span>

<span class="w">			</span><span class="n">Log</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">&quot;icon missing for mode &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">modeText</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="c1">// scale icon if necessary</span><span class="w"></span>
<span class="w">		</span><span class="n">icon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ImageManagerD</span><span class="p">.</span><span class="na">getScaledIcon</span><span class="p">(</span><span class="n">icon</span><span class="p">,</span><span class="w"></span>
<span class="w">				</span><span class="n">Math</span><span class="p">.</span><span class="na">min</span><span class="p">(</span><span class="n">icon</span><span class="p">.</span><span class="na">getIconWidth</span><span class="p">(),</span><span class="w"> </span><span class="n">imageManager</span><span class="p">.</span><span class="na">getMaxIconSize</span><span class="p">()),</span><span class="w"></span>
<span class="w">				</span><span class="n">Math</span><span class="p">.</span><span class="na">min</span><span class="p">(</span><span class="n">icon</span><span class="p">.</span><span class="na">getIconHeight</span><span class="p">(),</span><span class="w"> </span><span class="n">imageManager</span><span class="p">.</span><span class="na">getMaxIconSize</span><span class="p">()));</span><span class="w"></span>

<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">icon</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * @param border border color</span>
<span class="cm">	 * @return tool icon</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">ImageIcon</span><span class="w"> </span><span class="nf">getToolIcon</span><span class="p">(</span><span class="n">Color</span><span class="w"> </span><span class="n">border</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">ImageResourceD</span><span class="w"> </span><span class="n">res</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">imageManager</span><span class="p">.</span><span class="na">getMaxIconSize</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">32</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GuiResourcesD</span><span class="p">.</span><span class="na">TOOL_MODE32</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GuiResourcesD</span><span class="p">.</span><span class="na">TOOL_MODE64</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">imageManager</span><span class="p">.</span><span class="na">getImageIcon</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">border</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">ImageIcon</span><span class="w"> </span><span class="nf">getEmptyIcon</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">imageManager</span><span class="p">.</span><span class="na">getImageIcon</span><span class="p">(</span><span class="n">GuiResourcesD</span><span class="p">.</span><span class="na">EMPTY</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">Image</span><span class="w"> </span><span class="nf">getInternalImage</span><span class="p">(</span><span class="n">ImageResourceD</span><span class="w"> </span><span class="n">filename</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">imageManager</span><span class="p">.</span><span class="na">getInternalImage</span><span class="p">(</span><span class="n">filename</span><span class="p">).</span><span class="na">getImage</span><span class="p">();</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">Image</span><span class="w"> </span><span class="nf">getRefreshViewImage</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="c1">// don&#39;t need to load gui jar as reset image is in main jar</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">getMenuInternalImage</span><span class="p">(</span><span class="n">GuiResourcesD</span><span class="p">.</span><span class="na">VIEW_REFRESH</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">Image</span><span class="w"> </span><span class="nf">getPlayImage</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="c1">// don&#39;t need to load gui jar as reset image is in main jar</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">imageManager</span><span class="p">.</span><span class="na">getInternalImage</span><span class="p">(</span><span class="n">GuiResourcesD</span><span class="p">.</span><span class="na">NAV_PLAY</span><span class="p">).</span><span class="na">getImage</span><span class="p">();</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">Image</span><span class="w"> </span><span class="nf">getPlayImageCircle</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="c1">// don&#39;t need to load gui jar as reset image is in main jar</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">imageManager</span><span class="p">.</span><span class="na">getInternalImage</span><span class="p">(</span><span class="n">GuiResourcesD</span><span class="p">.</span><span class="na">NAV_PLAY_CIRCLE</span><span class="p">)</span><span class="w"></span>
<span class="w">				</span><span class="p">.</span><span class="na">getImage</span><span class="p">();</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">Image</span><span class="w"> </span><span class="nf">getPlayImageCircleHover</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="c1">// don&#39;t need to load gui jar as reset image is in main jar</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">imageManager</span><span class="p">.</span><span class="na">getInternalImage</span><span class="p">(</span><span class="n">GuiResourcesD</span><span class="p">.</span><span class="na">NAV_PLAY_HOVER</span><span class="p">)</span><span class="w"></span>
<span class="w">				</span><span class="p">.</span><span class="na">getImage</span><span class="p">();</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">Image</span><span class="w"> </span><span class="nf">getPauseImageCircle</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="c1">// don&#39;t need to load gui jar as reset image is in main jar</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">imageManager</span><span class="p">.</span><span class="na">getInternalImage</span><span class="p">(</span><span class="n">GuiResourcesD</span><span class="p">.</span><span class="na">NAV_PAUSE_CIRCLE</span><span class="p">)</span><span class="w"></span>
<span class="w">				</span><span class="p">.</span><span class="na">getImage</span><span class="p">();</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">Image</span><span class="w"> </span><span class="nf">getPauseImageCircleHover</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="c1">// don&#39;t need to load gui jar as reset image is in main jar</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">imageManager</span><span class="w"></span>
<span class="w">				</span><span class="p">.</span><span class="na">getInternalImage</span><span class="p">(</span><span class="n">GuiResourcesD</span><span class="p">.</span><span class="na">NAV_PAUSE_CIRCLE_HOVER</span><span class="p">)</span><span class="w"></span>
<span class="w">				</span><span class="p">.</span><span class="na">getImage</span><span class="p">();</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">Image</span><span class="w"> </span><span class="nf">getPauseImage</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="c1">// don&#39;t need to load gui jar as reset image is in main jar</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">imageManager</span><span class="p">.</span><span class="na">getInternalImage</span><span class="p">(</span><span class="n">GuiResourcesD</span><span class="p">.</span><span class="na">NAV_PAUSE</span><span class="p">)</span><span class="w"></span>
<span class="w">				</span><span class="p">.</span><span class="na">getImage</span><span class="p">();</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">MyImageD</span><span class="w"> </span><span class="nf">getExternalImage</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">filename</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">ImageManagerD</span><span class="p">.</span><span class="na">getExternalImage</span><span class="p">(</span><span class="n">filename</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">MyImage</span><span class="w"> </span><span class="nf">getExternalImageAdapter</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">filename</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">width</span><span class="p">,</span><span class="w"></span>
<span class="w">			</span><span class="kt">int</span><span class="w"> </span><span class="n">height</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">MyImageD</span><span class="w"> </span><span class="n">im</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ImageManagerD</span><span class="p">.</span><span class="na">getExternalImage</span><span class="p">(</span><span class="n">filename</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">im</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addExternalImage</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">filename</span><span class="p">,</span><span class="w"> </span><span class="n">MyImageJre</span><span class="w"> </span><span class="n">image</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">imageManager</span><span class="p">.</span><span class="na">addExternalImage</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="w"> </span><span class="n">image</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">GImageIcon</span><span class="w"> </span><span class="nf">wrapGetModeIcon</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">mode</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">GImageIconD</span><span class="p">(</span><span class="n">getModeIcon</span><span class="p">(</span><span class="n">mode</span><span class="p">));</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">ImageIcon</span><span class="w"> </span><span class="nf">getModeIcon</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">mode</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">ImageIcon</span><span class="w"> </span><span class="n">icon</span><span class="p">;</span><span class="w"></span>

<span class="w">		</span><span class="n">Color</span><span class="w"> </span><span class="n">border</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Color</span><span class="p">.</span><span class="na">lightGray</span><span class="p">;</span><span class="w"></span>

<span class="w">		</span><span class="c1">// macro</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mode</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">EuclidianConstants</span><span class="p">.</span><span class="na">MACRO_MODE_ID_OFFSET</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="kt">int</span><span class="w"> </span><span class="n">macroID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">EuclidianConstants</span><span class="p">.</span><span class="na">MACRO_MODE_ID_OFFSET</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">Macro</span><span class="w"> </span><span class="n">macro</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kernel</span><span class="p">.</span><span class="na">getMacro</span><span class="p">(</span><span class="n">macroID</span><span class="p">);</span><span class="w"></span>
<span class="w">				</span><span class="n">String</span><span class="w"> </span><span class="n">iconName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">macro</span><span class="p">.</span><span class="na">getIconFileName</span><span class="p">();</span><span class="w"></span>
<span class="w">				</span><span class="n">MyImageD</span><span class="w"> </span><span class="n">img</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getExternalImage</span><span class="p">(</span><span class="n">iconName</span><span class="p">);</span><span class="w"></span>
<span class="w">				</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">img</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">img</span><span class="p">.</span><span class="na">isSVG</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">					</span><span class="c1">// default icon</span><span class="w"></span>
<span class="w">					</span><span class="n">icon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getToolIcon</span><span class="p">(</span><span class="n">border</span><span class="p">);</span><span class="w"></span>
<span class="w">				</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">					</span><span class="c1">// use image as icon</span><span class="w"></span>
<span class="w">					</span><span class="kt">int</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">imageManager</span><span class="p">.</span><span class="na">getMaxIconSize</span><span class="p">();</span><span class="w"></span>
<span class="w">					</span><span class="n">icon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ImageIcon</span><span class="p">(</span><span class="n">ImageManagerD</span><span class="p">.</span><span class="na">addBorder</span><span class="p">(</span><span class="n">img</span><span class="p">.</span><span class="na">getImage</span><span class="p">()</span><span class="w"></span>
<span class="w">							</span><span class="p">.</span><span class="na">getScaledInstance</span><span class="p">(</span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">Image</span><span class="p">.</span><span class="na">SCALE_SMOOTH</span><span class="p">),</span><span class="w"></span>
<span class="w">							</span><span class="n">border</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">));</span><span class="w"></span>
<span class="w">				</span><span class="p">}</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">Log</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">&quot;macro does not exist: ID = &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">macroID</span><span class="p">);</span><span class="w"></span>
<span class="w">				</span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="c1">// standard case</span><span class="w"></span>
<span class="w">			</span><span class="n">String</span><span class="w"> </span><span class="n">modeText</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EuclidianConstants</span><span class="p">.</span><span class="na">getModeTextSimple</span><span class="p">(</span><span class="n">mode</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="c1">// bugfix for Turkish locale added Locale.US</span><span class="w"></span>
<span class="w">			</span><span class="n">icon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getToolBarImage</span><span class="p">(</span><span class="n">modeText</span><span class="p">,</span><span class="w"> </span><span class="n">border</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">icon</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * stores an image in the application&#39;s imageManager.</span>
<span class="cm">	 * </span>
<span class="cm">	 * @return fileName of image stored in imageManager</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">createImage</span><span class="p">(</span><span class="n">MyImageD</span><span class="w"> </span><span class="n">image</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">imageFileName</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">imageManager</span><span class="p">.</span><span class="na">createImage</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="w"> </span><span class="n">imageFileName</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="c1">// **************************************************************************</span><span class="w"></span>
<span class="w">	</span><span class="c1">// PRINTING &amp; EXPORT</span><span class="w"></span>
<span class="w">	</span><span class="c1">// **************************************************************************</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">File</span><span class="w"> </span><span class="nf">getCurrentImagePath</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">currentImagePath</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setCurrentImagePath</span><span class="p">(</span><span class="n">File</span><span class="w"> </span><span class="n">currentImagePath</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">this</span><span class="p">.</span><span class="na">currentImagePath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">currentImagePath</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * Loads text file and returns content as String.</span>
<span class="cm">	 * @return file content</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">loadTextFile</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">StringBuilder</span><span class="w"> </span><span class="n">sb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StringBuilder</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="n">BufferedReader</span><span class="w"> </span><span class="n">br</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">InputStream</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AppD</span><span class="p">.</span><span class="na">class</span><span class="p">.</span><span class="na">getResourceAsStream</span><span class="p">(</span><span class="n">s</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="n">br</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BufferedReader</span><span class="p">(</span><span class="w"></span>
<span class="w">					</span><span class="k">new</span><span class="w"> </span><span class="n">InputStreamReader</span><span class="p">(</span><span class="n">is</span><span class="p">,</span><span class="w"> </span><span class="n">Charsets</span><span class="p">.</span><span class="na">getUtf8</span><span class="p">()));</span><span class="w"></span>
<span class="w">			</span><span class="n">String</span><span class="w"> </span><span class="n">thisLine</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="k">while</span><span class="w"> </span><span class="p">((</span><span class="n">thisLine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">br</span><span class="p">.</span><span class="na">readLine</span><span class="p">())</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">sb</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">thisLine</span><span class="p">);</span><span class="w"></span>
<span class="w">				</span><span class="n">sb</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="sc">&#39;\n&#39;</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">br</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">					</span><span class="n">br</span><span class="p">.</span><span class="na">close</span><span class="p">();</span><span class="w"></span>
<span class="w">				</span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">					</span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span><span class="w"></span>
<span class="w">				</span><span class="p">}</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">sb</span><span class="p">.</span><span class="na">toString</span><span class="p">();</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">copyGraphicsViewToClipboard</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">		</span><span class="n">copyGraphicsViewToClipboard</span><span class="p">(</span><span class="n">getActiveEuclidianView</span><span class="p">());</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">copyGraphicsViewToClipboard</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">EuclidianView</span><span class="w"> </span><span class="n">copyView</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">		</span><span class="n">getSelectionManager</span><span class="p">().</span><span class="na">clearSelectedGeos</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="n">updateSelection</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w"></span>

<span class="w">		</span><span class="n">Thread</span><span class="w"> </span><span class="n">runner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">			</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">setWaitCursor</span><span class="p">();</span><span class="w"></span>

<span class="w">				</span><span class="n">simpleExportToClipboard</span><span class="p">(</span><span class="n">copyView</span><span class="p">);</span><span class="w"></span>

<span class="w">				</span><span class="cm">/*</span>
<span class="cm">				 * doesn&#39;t work in Win7, XP pasting into eg Paint pasting into</span>
<span class="cm">				 * eg Office 2010 is OK</span>
<span class="cm">				 * </span>
<span class="cm">				 * </span>
<span class="cm">				 * if (!WINDOWS_VISTA_OR_LATER) {</span>
<span class="cm">				 * </span>
<span class="cm">				 * // use other method for WinXP or earlier //</span>
<span class="cm">				 * GraphicExportDialog.exportPNG() doesn&#39;t work well on XP // eg</span>
<span class="cm">				 * paste into Paint</span>
<span class="cm">				 * </span>
<span class="cm">				 * simpleExportToClipboard(ev);</span>
<span class="cm">				 * </span>
<span class="cm">				 * } else {</span>
<span class="cm">				 * </span>
<span class="cm">				 * GraphicExportDialog export = new GraphicExportDialog(app);</span>
<span class="cm">				 * export.setDPI(&quot;300&quot;);</span>
<span class="cm">				 * </span>
<span class="cm">				 * if (!export.exportPNG(true, false)) { // if there&#39;s an error</span>
<span class="cm">				 * (eg memory) just do a simple // export</span>
<span class="cm">				 * simpleExportToClipboard(ev);</span>
<span class="cm">				 * </span>
<span class="cm">				 * } }</span>
<span class="cm">				 */</span><span class="w"></span>

<span class="w">				</span><span class="n">setDefaultCursor</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="p">};</span><span class="w"></span>
<span class="w">		</span><span class="n">runner</span><span class="p">.</span><span class="na">start</span><span class="p">();</span><span class="w"></span>

<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">simpleExportToClipboard</span><span class="p">(</span><span class="n">EuclidianView</span><span class="w"> </span><span class="n">ev</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="kt">double</span><span class="w"> </span><span class="n">scale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getMaxScaleForClipBoard</span><span class="p">(</span><span class="n">ev</span><span class="p">);</span><span class="w"></span>

<span class="w">		</span><span class="c1">// copy drawing pad to the system clipboard</span><span class="w"></span>
<span class="w">		</span><span class="n">Image</span><span class="w"> </span><span class="n">img</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GBufferedImageD</span><span class="p">.</span><span class="na">getAwtBufferedImage</span><span class="p">(</span><span class="w"></span>
<span class="w">				</span><span class="p">((</span><span class="n">EuclidianViewD</span><span class="p">)</span><span class="w"> </span><span class="n">ev</span><span class="p">).</span><span class="na">getExportImage</span><span class="p">(</span><span class="n">scale</span><span class="p">));</span><span class="w"></span>
<span class="w">		</span><span class="n">copyImageToClipboard</span><span class="p">(</span><span class="n">img</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * Copy image to system clipboard</span>
<span class="cm">	 * </span>
<span class="cm">	 * @param dataURI data URI of image to copy</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">copyImageToClipboard</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">dataURI</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">		</span><span class="n">String</span><span class="w"> </span><span class="n">base64Image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dataURI</span><span class="p">;</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">base64Image</span><span class="p">.</span><span class="na">startsWith</span><span class="p">(</span><span class="n">StringUtil</span><span class="p">.</span><span class="na">pngMarker</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">base64Image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StringUtil</span><span class="p">.</span><span class="na">removePngMarker</span><span class="p">(</span><span class="n">base64Image</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="n">handleImageExport</span><span class="p">(</span><span class="n">base64Image</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Rectangle</span><span class="w"> </span><span class="n">screenSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="cm">/*</span>
<span class="cm">	 * gets the screensize (taking into account toolbars etc)</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Rectangle</span><span class="w"> </span><span class="nf">getScreenSize</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">screenSize</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">GraphicsEnvironment</span><span class="w"> </span><span class="n">env</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GraphicsEnvironment</span><span class="w"></span>
<span class="w">					</span><span class="p">.</span><span class="na">getLocalGraphicsEnvironment</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="n">screenSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">env</span><span class="p">.</span><span class="na">getMaximumWindowBounds</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">screenSize</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * @param maxX</span>
<span class="cm">	 *            maximum width</span>
<span class="cm">	 * @param maxY</span>
<span class="cm">	 *            maximum height</span>
<span class="cm">	 * @return preview image</span>
<span class="cm">	 * @throws OutOfMemoryError</span>
<span class="cm">	 *             error</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">MyImageJre</span><span class="w"> </span><span class="nf">getExportImage</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">maxX</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">maxY</span><span class="p">)</span><span class="w"></span>
<span class="w">			</span><span class="kd">throws</span><span class="w"> </span><span class="n">OutOfMemoryError</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MyImageD</span><span class="p">(</span><span class="n">GBufferedImageD</span><span class="p">.</span><span class="na">getAwtBufferedImage</span><span class="p">(</span><span class="w"></span>
<span class="w">				</span><span class="n">getActiveEuclidianViewExportImage</span><span class="p">(</span><span class="n">maxX</span><span class="p">,</span><span class="w"> </span><span class="n">maxY</span><span class="p">)));</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="c1">// **************************************************************************</span><span class="w"></span>
<span class="w">	</span><span class="c1">// LOCALES</span><span class="w"></span>
<span class="w">	</span><span class="c1">// **************************************************************************</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * Creates a Locale object according to the given language code. The</span>
<span class="cm">	 * languageCode string should consist of two letters for the language, two</span>
<span class="cm">	 * letters for the country and two letters for the variant. E.g. &quot;en&quot; ...</span>
<span class="cm">	 * language: English , no country specified, &quot;deAT&quot; or &quot;de_AT&quot; ... language:</span>
<span class="cm">	 * German , country: Austria, &quot;noNONY&quot; or &quot;no_NO_NY&quot; ... language: Norwegian</span>
<span class="cm">	 * , country: Norway, variant: Nynorsk</span>
<span class="cm">	 * </span>
<span class="cm">	 * @param languageISOCode</span>
<span class="cm">	 *            locale iso code (may contain _ or not)</span>
<span class="cm">	 * @return locale</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Locale</span><span class="w"> </span><span class="nf">getLocale</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">languageISOCode</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="c1">// remove &quot;_&quot; from string</span><span class="w"></span>
<span class="w">		</span><span class="n">String</span><span class="w"> </span><span class="n">languageCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">languageISOCode</span><span class="p">.</span><span class="na">replaceAll</span><span class="p">(</span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">		</span><span class="n">Locale</span><span class="w"> </span><span class="n">loc</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">languageCode</span><span class="p">.</span><span class="na">length</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="c1">// language, country, variant</span><span class="w"></span>
<span class="w">			</span><span class="n">loc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Locale</span><span class="p">(</span><span class="n">languageCode</span><span class="p">.</span><span class="na">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">),</span><span class="w"></span>
<span class="w">					</span><span class="n">languageCode</span><span class="p">.</span><span class="na">substring</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="n">languageCode</span><span class="p">.</span><span class="na">substring</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">));</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">languageCode</span><span class="p">.</span><span class="na">length</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="c1">// language, country</span><span class="w"></span>
<span class="w">			</span><span class="n">loc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Locale</span><span class="p">(</span><span class="n">languageCode</span><span class="p">.</span><span class="na">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">),</span><span class="w"></span>
<span class="w">					</span><span class="n">languageCode</span><span class="p">.</span><span class="na">substring</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">));</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="c1">// language only</span><span class="w"></span>
<span class="w">			</span><span class="n">loc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Locale</span><span class="p">(</span><span class="n">languageCode</span><span class="p">.</span><span class="na">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">));</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">loc</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setTooltipLanguage</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">		</span><span class="kt">boolean</span><span class="w"> </span><span class="n">updateNeeded</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">loc</span><span class="p">.</span><span class="na">setTooltipLanguage</span><span class="p">(</span><span class="n">s</span><span class="p">);</span><span class="w"></span>

<span class="w">		</span><span class="n">updateNeeded</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">updateNeeded</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="n">loc</span><span class="p">.</span><span class="na">getTooltipLocale</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">updateNeeded</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">setLabels</span><span class="p">();</span><span class="w"> </span><span class="c1">// update eg Tooltips for Toolbar</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">getTooltipTimeout</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="kt">int</span><span class="w"> </span><span class="n">dmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ToolTipManager</span><span class="p">.</span><span class="na">sharedInstance</span><span class="p">().</span><span class="na">getDismissDelay</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">dmd</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="n">dmd</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Integer</span><span class="p">.</span><span class="na">MAX_VALUE</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="n">dmd</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">1000</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">OptionsAdvancedD</span><span class="p">.</span><span class="na">tooltipTimeoutsLength</span><span class="p">()</span><span class="w"></span>
<span class="w">				</span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Integer</span><span class="p">.</span><span class="na">parseInt</span><span class="p">(</span><span class="n">OptionsAdvancedD</span><span class="p">.</span><span class="na">tooltipTimeouts</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">dmd</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="k">return</span><span class="w"> </span><span class="n">Integer</span><span class="p">.</span><span class="na">parseInt</span><span class="p">(</span><span class="n">OptionsAdvancedD</span><span class="p">.</span><span class="na">tooltipTimeouts</span><span class="p">(</span><span class="n">i</span><span class="p">));</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">Integer</span><span class="p">.</span><span class="na">parseInt</span><span class="p">(</span><span class="n">OptionsAdvancedD</span><span class="w"></span>
<span class="w">				</span><span class="p">.</span><span class="na">tooltipTimeouts</span><span class="p">(</span><span class="n">OptionsAdvancedD</span><span class="p">.</span><span class="na">tooltipTimeoutsLength</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">2</span><span class="p">));</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setLanguage</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">parts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="na">split</span><span class="p">(</span><span class="s">&quot;_&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="n">String</span><span class="w"> </span><span class="n">language</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parts</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="n">String</span><span class="w"> </span><span class="n">country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parts</span><span class="p">.</span><span class="na">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">parts</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="n">Locale</span><span class="w"> </span><span class="n">locale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">language</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">country</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">locale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Locale</span><span class="p">(</span><span class="n">language</span><span class="p">,</span><span class="w"> </span><span class="n">country</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">locale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Locale</span><span class="p">(</span><span class="n">language</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="n">setLocale</span><span class="p">(</span><span class="n">locale</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * set language via iso language string</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setLanguage</span><span class="p">(</span><span class="n">Locale</span><span class="w"> </span><span class="n">locale</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">locale</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"></span>
<span class="w">				</span><span class="o">||</span><span class="w"> </span><span class="n">loc</span><span class="p">.</span><span class="na">getLocale</span><span class="p">().</span><span class="na">toString</span><span class="p">().</span><span class="na">equals</span><span class="p">(</span><span class="n">locale</span><span class="p">.</span><span class="na">toString</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">initing</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">setMoveMode</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="c1">// load resource files</span><span class="w"></span>
<span class="w">		</span><span class="n">setLocale</span><span class="p">(</span><span class="n">locale</span><span class="p">);</span><span class="w"></span>

<span class="w">		</span><span class="c1">// update right angle style in euclidian view (different for German)</span><span class="w"></span>
<span class="w">		</span><span class="c1">// if (euclidianView != null)</span><span class="w"></span>
<span class="w">		</span><span class="c1">// euclidianView.updateRightAngleStyle(locale);</span><span class="w"></span>

<span class="w">		</span><span class="c1">// make sure digits are updated in all numbers</span><span class="w"></span>
<span class="w">		</span><span class="n">getKernel</span><span class="p">().</span><span class="na">updateConstructionLanguage</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="n">setUnsaved</span><span class="p">();</span><span class="w"></span>

<span class="w">		</span><span class="n">setLabels</span><span class="p">();</span><span class="w"> </span><span class="c1">// update display</span><span class="w"></span>
<span class="w">		</span><span class="n">setOrientation</span><span class="p">();</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="n">StringBuilder</span><span class="w"> </span><span class="n">testCharacters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StringBuilder</span><span class="p">();</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setLocale</span><span class="p">(</span><span class="n">Locale</span><span class="w"> </span><span class="n">locale</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">locale</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">loc</span><span class="p">.</span><span class="na">getLocale</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="n">Locale</span><span class="w"> </span><span class="n">oldLocale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">loc</span><span class="p">.</span><span class="na">getLocale</span><span class="p">();</span><span class="w"></span>

<span class="w">		</span><span class="c1">// only allow special locales due to some weird server</span><span class="w"></span>
<span class="w">		</span><span class="c1">// problems with the naming of the property files</span><span class="w"></span>
<span class="w">		</span><span class="n">loc</span><span class="p">.</span><span class="na">setLocale</span><span class="p">(</span><span class="n">locale</span><span class="p">);</span><span class="w"></span>

<span class="w">		</span><span class="c1">// update font for new language (needed for e.g. chinese)</span><span class="w"></span>
<span class="w">		</span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">fontManager</span><span class="p">.</span><span class="na">setLanguage</span><span class="p">(</span><span class="n">loc</span><span class="p">.</span><span class="na">getLocale</span><span class="p">());</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">showGenericError</span><span class="p">(</span><span class="n">e</span><span class="p">);</span><span class="w"></span>

<span class="w">			</span><span class="c1">// go back to previous locale</span><span class="w"></span>
<span class="w">			</span><span class="n">loc</span><span class="p">.</span><span class="na">setLocale</span><span class="p">(</span><span class="n">oldLocale</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="n">getLocalization</span><span class="p">().</span><span class="na">updateLanguageFlags</span><span class="p">(</span><span class="n">locale</span><span class="p">.</span><span class="na">getLanguage</span><span class="p">());</span><span class="w"></span>

<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * @return current locale</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">Locale</span><span class="w"> </span><span class="nf">getLocale</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">loc</span><span class="p">.</span><span class="na">getLocale</span><span class="p">();</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * Shows localized help message</span>
<span class="cm">	 * </span>
<span class="cm">	 * @param key</span>
<span class="cm">	 *            key (for plain) to be localized</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">showHelp</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">key</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">loc</span><span class="p">.</span><span class="na">getMenu</span><span class="p">(</span><span class="n">key</span><span class="p">);</span><span class="w"></span>

<span class="w">		</span><span class="n">JOptionPane</span><span class="p">.</span><span class="na">showConfirmDialog</span><span class="p">(</span><span class="n">mainComp</span><span class="p">,</span><span class="w"> </span><span class="n">text</span><span class="p">,</span><span class="w"></span>
<span class="w">				</span><span class="n">GeoGebraConstants</span><span class="p">.</span><span class="na">APPLICATION_NAME</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; - &quot;</span><span class="w"></span>
<span class="w">						</span><span class="o">+</span><span class="w"> </span><span class="n">loc</span><span class="p">.</span><span class="na">getMenu</span><span class="p">(</span><span class="s">&quot;Help&quot;</span><span class="p">),</span><span class="w"></span>
<span class="w">				</span><span class="n">JOptionPane</span><span class="p">.</span><span class="na">DEFAULT_OPTION</span><span class="p">,</span><span class="w"> </span><span class="n">JOptionPane</span><span class="p">.</span><span class="na">PLAIN_MESSAGE</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="c1">// **************************************************************************</span><span class="w"></span>
<span class="w">	</span><span class="c1">// GUI Updates</span><span class="w"></span>
<span class="w">	</span><span class="c1">// **************************************************************************</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * Updates the GUI of the main component.</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">updateContentPane</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">updateContentPane</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * Updates the GUI of the frame and its size.</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">updateContentPaneAndSize</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">initing</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="n">updateContentPane</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">frame</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">frame</span><span class="p">.</span><span class="na">isShowing</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">getGuiManager</span><span class="p">().</span><span class="na">updateFrameSize</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="n">updateComponentTreeUI</span><span class="p">();</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">updateContentPane</span><span class="p">(</span><span class="kt">boolean</span><span class="w"> </span><span class="n">updateComponentTreeUI</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">initing</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="n">Container</span><span class="w"> </span><span class="n">cp</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">frame</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">frame</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">mainComp</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">cp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">frame</span><span class="p">.</span><span class="na">getContentPane</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">cp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Container</span><span class="p">)</span><span class="w"> </span><span class="n">mainComp</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="n">addMacroCommands</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="n">cp</span><span class="p">.</span><span class="na">removeAll</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="n">cp</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">buildApplicationPanel</span><span class="p">());</span><span class="w"></span>
<span class="w">		</span><span class="n">fontManager</span><span class="p">.</span><span class="na">setFontSize</span><span class="p">(</span><span class="n">getGUIFontSize</span><span class="p">());</span><span class="w"></span>

<span class="w">		</span><span class="c1">// update sizes</span><span class="w"></span>
<span class="w">		</span><span class="n">euclidianView</span><span class="p">.</span><span class="na">updateSize</span><span class="p">();</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">hasEuclidianView2</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">getEuclidianView2</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="na">updateSize</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="c1">// update layout</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">updateComponentTreeUI</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">updateComponentTreeUI</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="c1">// reset mode and focus</span><span class="w"></span>
<span class="w">		</span><span class="n">setMoveMode</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mainComp</span><span class="p">.</span><span class="na">isShowing</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">euclidianView</span><span class="p">.</span><span class="na">requestFocusInWindow</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">updateUI</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">initing</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">frame</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">SwingUtilities</span><span class="p">.</span><span class="na">updateComponentTreeUI</span><span class="p">(</span><span class="n">frame</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setLabels</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">initing</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">guiManager</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">getGuiManager</span><span class="p">().</span><span class="na">setLabels</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="n">kernel</span><span class="p">.</span><span class="na">setViewsLabels</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">loc</span><span class="p">.</span><span class="na">propertiesFilesPresent</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">kernel</span><span class="p">.</span><span class="na">updateLocalAxesNames</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="n">updateCommandDictionary</span><span class="p">();</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setOrientation</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">initing</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">guiManager</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">kernel</span><span class="p">.</span><span class="na">setViewsOrientation</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">updateComponentTreeUI</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">frame</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">frame</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">mainComp</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">SwingUtilities</span><span class="p">.</span><span class="na">updateComponentTreeUI</span><span class="p">(</span><span class="n">frame</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mainComp</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">SwingUtilities</span><span class="p">.</span><span class="na">updateComponentTreeUI</span><span class="p">(</span><span class="n">mainComp</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * Builds a panel with all components that should be shown on screen (like</span>
<span class="cm">	 * toolbar, input field, algebra view).</span>
<span class="cm">	 * </span>
<span class="cm">	 * @return application panel</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">JPanel</span><span class="w"> </span><span class="nf">buildApplicationPanel</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">		</span><span class="n">JPanel</span><span class="w"> </span><span class="n">applicationPanel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JPanel</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">BorderLayout</span><span class="p">());</span><span class="w"></span>

<span class="w">		</span><span class="c1">// remove existing elements</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">centerPanel</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">centerPanel</span><span class="p">.</span><span class="na">removeAll</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">centerPanel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JPanel</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">BorderLayout</span><span class="p">());</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="n">centerPanel</span><span class="p">.</span><span class="na">setBorder</span><span class="p">(</span><span class="n">BorderFactory</span><span class="p">.</span><span class="na">createMatteBorder</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"></span>
<span class="w">				</span><span class="n">SystemColor</span><span class="p">.</span><span class="na">controlShadow</span><span class="p">));</span><span class="w"></span>
<span class="w">		</span><span class="n">updateCenterPanel</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w"></span>

<span class="w">		</span><span class="c1">// full GUI =&gt; use layout manager, add other GUI elements as requested</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isUsingFullGui</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">			</span><span class="c1">// create panels if empty</span><span class="w"></span>

<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">northPanel</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">northPanel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JPanel</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">BorderLayout</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">));</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">southPanel</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">southPanel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JPanel</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">BorderLayout</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">));</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">eastPanel</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">eastPanel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JPanel</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">BorderLayout</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">));</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">westPanel</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">westPanel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JPanel</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">BorderLayout</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">));</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>

<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">dockBar</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">dockBar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newDockBar</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w"></span>
<span class="w">				</span><span class="n">dockBar</span><span class="p">.</span><span class="na">setEastOrientation</span><span class="p">(</span><span class="n">isDockBarEast</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>

<span class="w">			</span><span class="c1">// clear the panels</span><span class="w"></span>
<span class="w">			</span><span class="n">northPanel</span><span class="p">.</span><span class="na">removeAll</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="n">southPanel</span><span class="p">.</span><span class="na">removeAll</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="n">eastPanel</span><span class="p">.</span><span class="na">removeAll</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="n">westPanel</span><span class="p">.</span><span class="na">removeAll</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="n">northPanel</span><span class="p">.</span><span class="na">removeAll</span><span class="p">();</span><span class="w"></span>

<span class="w">			</span><span class="c1">// create a JSplitPane with the center panel as the left component.</span><span class="w"></span>
<span class="w">			</span><span class="c1">// The right component is null initially, but can be used for</span><span class="w"></span>
<span class="w">			</span><span class="c1">// sliding a</span><span class="w"></span>
<span class="w">			</span><span class="c1">// help panel in/out of the center application panel.</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">applicationSplitPane</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">applicationSplitPane</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JSplitPane</span><span class="p">(</span><span class="w"></span>
<span class="w">						</span><span class="n">JSplitPane</span><span class="p">.</span><span class="na">HORIZONTAL_SPLIT</span><span class="p">,</span><span class="w"> </span><span class="n">centerPanel</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span><span class="w"></span>
<span class="w">				</span><span class="n">applicationSplitPane</span><span class="w"></span>
<span class="w">						</span><span class="p">.</span><span class="na">setBorder</span><span class="p">(</span><span class="n">BorderFactory</span><span class="p">.</span><span class="na">createEmptyBorder</span><span class="p">());</span><span class="w"></span>
<span class="w">				</span><span class="c1">// set all resize weight to the left pane</span><span class="w"></span>
<span class="w">				</span><span class="n">applicationSplitPane</span><span class="p">.</span><span class="na">setResizeWeight</span><span class="p">(</span><span class="mf">1.0</span><span class="p">);</span><span class="w"></span>
<span class="w">				</span><span class="n">applicationSplitPane</span><span class="p">.</span><span class="na">setDividerSize</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>

<span class="w">			</span><span class="c1">// add north/south panels to center panel</span><span class="w"></span>
<span class="w">			</span><span class="n">JPanel</span><span class="w"> </span><span class="n">northSouthCenter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JPanel</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">BorderLayout</span><span class="p">());</span><span class="w"></span>
<span class="w">			</span><span class="n">northSouthCenter</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">applicationSplitPane</span><span class="p">,</span><span class="w"> </span><span class="n">BorderLayout</span><span class="p">.</span><span class="na">CENTER</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="n">northSouthCenter</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">northPanel</span><span class="p">,</span><span class="w"> </span><span class="n">BorderLayout</span><span class="p">.</span><span class="na">NORTH</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="n">northSouthCenter</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">southPanel</span><span class="p">,</span><span class="w"> </span><span class="n">BorderLayout</span><span class="p">.</span><span class="na">SOUTH</span><span class="p">);</span><span class="w"></span>

<span class="w">			</span><span class="c1">// add east/west panels to the northSouthCenter panel</span><span class="w"></span>
<span class="w">			</span><span class="c1">// (this puts them outside, not sandwiched between north/south)</span><span class="w"></span>
<span class="w">			</span><span class="n">JPanel</span><span class="w"> </span><span class="n">mainPanel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JPanel</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">BorderLayout</span><span class="p">());</span><span class="w"></span>
<span class="w">			</span><span class="n">mainPanel</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">northSouthCenter</span><span class="p">,</span><span class="w"> </span><span class="n">BorderLayout</span><span class="p">.</span><span class="na">CENTER</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="n">mainPanel</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">eastPanel</span><span class="p">,</span><span class="w"> </span><span class="n">getLocalization</span><span class="p">().</span><span class="na">borderEast</span><span class="p">());</span><span class="w"></span>
<span class="w">			</span><span class="n">mainPanel</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">westPanel</span><span class="p">,</span><span class="w"> </span><span class="n">getLocalization</span><span class="p">().</span><span class="na">borderWest</span><span class="p">());</span><span class="w"></span>

<span class="w">			</span><span class="n">applicationPanel</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">mainPanel</span><span class="p">,</span><span class="w"> </span><span class="n">BorderLayout</span><span class="p">.</span><span class="na">CENTER</span><span class="p">);</span><span class="w"></span>

<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">showDockBar</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">dockBar</span><span class="p">.</span><span class="na">isEastOrientation</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">					</span><span class="n">applicationPanel</span><span class="p">.</span><span class="na">add</span><span class="p">((</span><span class="n">Component</span><span class="p">)</span><span class="w"> </span><span class="n">dockBar</span><span class="p">,</span><span class="w"></span>
<span class="w">							</span><span class="n">getLocalization</span><span class="p">().</span><span class="na">borderEast</span><span class="p">());</span><span class="w"></span>
<span class="w">				</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">					</span><span class="n">applicationPanel</span><span class="p">.</span><span class="na">add</span><span class="p">((</span><span class="n">Component</span><span class="p">)</span><span class="w"> </span><span class="n">dockBar</span><span class="p">,</span><span class="w"></span>
<span class="w">							</span><span class="n">getLocalization</span><span class="p">().</span><span class="na">borderWest</span><span class="p">());</span><span class="w"></span>
<span class="w">				</span><span class="p">}</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>

<span class="w">			</span><span class="c1">// configure the panel components (adds toolbar, input bar, dockbar)</span><span class="w"></span>
<span class="w">			</span><span class="n">updateApplicationLayout</span><span class="p">();</span><span class="w"></span>

<span class="w">			</span><span class="c1">// init labels</span><span class="w"></span>
<span class="w">			</span><span class="n">setLabels</span><span class="p">();</span><span class="w"></span>

<span class="w">			</span><span class="c1">// Special case: return application panel with menubar</span><span class="w"></span>
<span class="w">			</span><span class="c1">// If the main component is a JPanel, we need to add the</span><span class="w"></span>
<span class="w">			</span><span class="c1">// menubar manually to the north</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">showMenuBar</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">mainComp</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">JPanel</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="k">return</span><span class="w"> </span><span class="n">getMenuBarPanel</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">applicationPanel</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>

<span class="w">			</span><span class="n">getSettingsUpdater</span><span class="p">().</span><span class="na">getFontSettingsUpdater</span><span class="p">().</span><span class="na">resetFonts</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="c1">// Standard case: return application panel</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="n">applicationPanel</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="c1">// Minimal applet case: return only the center panel with the EV</span><span class="w"></span>
<span class="w">		</span><span class="n">applicationPanel</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="w"></span>
<span class="w">				</span><span class="p">((</span><span class="n">EuclidianViewInterfaceD</span><span class="p">)</span><span class="w"> </span><span class="n">euclidianView</span><span class="p">).</span><span class="na">getJPanel</span><span class="p">(),</span><span class="w"></span>
<span class="w">				</span><span class="n">BorderLayout</span><span class="p">.</span><span class="na">CENTER</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="n">centerPanel</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">applicationPanel</span><span class="p">,</span><span class="w"> </span><span class="n">BorderLayout</span><span class="p">.</span><span class="na">CENTER</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">applicationPanel</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * Open/close the sidebar help panel for the input bar</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setShowInputHelpPanel</span><span class="p">(</span><span class="kt">boolean</span><span class="w"> </span><span class="n">isVisible</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isVisible</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">applicationSplitPane</span><span class="w"></span>
<span class="w">					</span><span class="p">.</span><span class="na">setRightComponent</span><span class="p">((</span><span class="n">getGuiManager</span><span class="p">()).</span><span class="na">getInputHelpPanel</span><span class="p">());</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">applicationSplitPane</span><span class="p">.</span><span class="na">getLastDividerLocation</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">applicationSplitPane</span><span class="w"></span>
<span class="w">						</span><span class="p">.</span><span class="na">setLastDividerLocation</span><span class="p">(</span><span class="n">applicationSplitPane</span><span class="p">.</span><span class="na">getWidth</span><span class="p">()</span><span class="w"></span>
<span class="w">								</span><span class="o">-</span><span class="w"> </span><span class="p">(((</span><span class="n">GuiManagerD</span><span class="p">)</span><span class="w"> </span><span class="n">getGuiManager</span><span class="p">()))</span><span class="w"></span>
<span class="w">										</span><span class="p">.</span><span class="na">getInputHelpPanelMinimumWidth</span><span class="p">());</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">			</span><span class="n">applicationSplitPane</span><span class="p">.</span><span class="na">setDividerLocation</span><span class="p">(</span><span class="w"></span>
<span class="w">					</span><span class="n">applicationSplitPane</span><span class="p">.</span><span class="na">getLastDividerLocation</span><span class="p">());</span><span class="w"></span>
<span class="w">			</span><span class="n">applicationSplitPane</span><span class="p">.</span><span class="na">setDividerSize</span><span class="p">(</span><span class="mi">8</span><span class="p">);</span><span class="w"></span>

<span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">applicationSplitPane</span><span class="p">.</span><span class="na">setLastDividerLocation</span><span class="p">(</span><span class="w"></span>
<span class="w">					</span><span class="n">applicationSplitPane</span><span class="p">.</span><span class="na">getDividerLocation</span><span class="p">());</span><span class="w"></span>
<span class="w">			</span><span class="n">applicationSplitPane</span><span class="p">.</span><span class="na">setRightComponent</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="n">applicationSplitPane</span><span class="p">.</span><span class="na">setDividerSize</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * Updates the configuration of the panels surrounding the main panel</span>
<span class="cm">	 * (toolbar, input bar etc.). This method should be called when the</span>
<span class="cm">	 * visibility or arrangement of these components is changed.</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">updateApplicationLayout</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">northPanel</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="n">southPanel</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="n">eastPanel</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"></span>
<span class="w">				</span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="n">westPanel</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="n">northPanel</span><span class="p">.</span><span class="na">removeAll</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="n">southPanel</span><span class="p">.</span><span class="na">removeAll</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="n">eastPanel</span><span class="p">.</span><span class="na">removeAll</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="n">westPanel</span><span class="p">.</span><span class="na">removeAll</span><span class="p">();</span><span class="w"></span>

<span class="w">		</span><span class="c1">// handle input bar</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">showAlgebraInput</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">initInputBar</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">getInputPosition</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">InputPosition</span><span class="p">.</span><span class="na">top</span><span class="p">,</span><span class="w"></span>
<span class="w">					</span><span class="n">northPanel</span><span class="p">,</span><span class="w"> </span><span class="n">southPanel</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">showToolBar</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">initToolbar</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">getToolbarPosition</span><span class="p">(),</span><span class="w"> </span><span class="n">showToolBarHelp</span><span class="p">,</span><span class="w"> </span><span class="n">northPanel</span><span class="p">,</span><span class="w"></span>
<span class="w">					</span><span class="n">eastPanel</span><span class="p">,</span><span class="w"> </span><span class="n">southPanel</span><span class="p">,</span><span class="w"> </span><span class="n">westPanel</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">frame</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">frame</span><span class="p">.</span><span class="na">getContentPane</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">frame</span><span class="p">.</span><span class="na">getContentPane</span><span class="p">().</span><span class="na">validate</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">updateCenterPanel</span><span class="p">(</span><span class="kt">boolean</span><span class="w"> </span><span class="n">updateUI</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">centerPanel</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="n">centerPanel</span><span class="p">.</span><span class="na">removeAll</span><span class="p">();</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isUsingFullGui</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">centerPanel</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">getRootComponent</span><span class="p">(</span><span class="k">this</span><span class="p">),</span><span class="w"> </span><span class="n">BorderLayout</span><span class="p">.</span><span class="na">CENTER</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">centerPanel</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">getEuclidianView1</span><span class="p">().</span><span class="na">getJPanel</span><span class="p">(),</span><span class="w"></span>
<span class="w">					</span><span class="n">BorderLayout</span><span class="p">.</span><span class="na">CENTER</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">updateUI</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">SwingUtilities</span><span class="p">.</span><span class="na">updateComponentTreeUI</span><span class="p">(</span><span class="n">centerPanel</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">validateComponent</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">frame</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">frame</span><span class="p">.</span><span class="na">validate</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">updateToolBar</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">showToolBar</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">isIniting</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="n">getGuiManager</span><span class="p">().</span><span class="na">updateToolbar</span><span class="p">();</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">initing</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">frame</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">SwingUtilities</span><span class="p">.</span><span class="na">updateComponentTreeUI</span><span class="p">(</span><span class="n">frame</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="n">setMoveMode</span><span class="p">();</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">updateMenubar</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">showMenuBar</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="n">isUsingFullGui</span><span class="p">()</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">isIniting</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="n">getGuiManager</span><span class="p">().</span><span class="na">updateMenubar</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="n">getGuiManager</span><span class="p">().</span><span class="na">updateActions</span><span class="p">();</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">updateStyleBars</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">isUsingFullGui</span><span class="p">()</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">isIniting</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">getEuclidianView1</span><span class="p">().</span><span class="na">hasStyleBar</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">getEuclidianView1</span><span class="p">().</span><span class="na">getStyleBar</span><span class="p">().</span><span class="na">updateStyleBar</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">hasEuclidianView2</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">getEuclidianView2</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="na">hasStyleBar</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">getEuclidianView2</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="na">getStyleBar</span><span class="p">().</span><span class="na">updateStyleBar</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">updateDynamicStyleBars</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="c1">// not implemented here</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">updateMenuWindow</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">showMenuBar</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="n">isUsingFullGui</span><span class="p">()</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">isIniting</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="n">getGuiManager</span><span class="p">().</span><span class="na">updateMenuWindow</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="n">getGuiManager</span><span class="p">().</span><span class="na">updateMenuFile</span><span class="p">();</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">updateTitle</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">frame</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="n">getGuiManager</span><span class="p">().</span><span class="na">updateFrameTitle</span><span class="p">();</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setShowToolBar</span><span class="p">(</span><span class="kt">boolean</span><span class="w"> </span><span class="n">toolbar</span><span class="p">,</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">help</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="kd">super</span><span class="p">.</span><span class="na">setShowToolBar</span><span class="p">(</span><span class="n">toolbar</span><span class="p">,</span><span class="w"> </span><span class="n">help</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">toolbar</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">getGuiManager</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">getGuiManager</span><span class="p">().</span><span class="na">setShowToolBarHelp</span><span class="p">(</span><span class="n">help</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="c1">// **************************************************************************</span><span class="w"></span>
<span class="w">	</span><span class="c1">// GUI Getters/Setters</span><span class="w"></span>
<span class="w">	</span><span class="c1">// **************************************************************************</span><span class="w"></span>

<span class="w">	</span><span class="kd">protected</span><span class="w"> </span><span class="n">GuiManagerInterfaceD</span><span class="w"> </span><span class="nf">newGuiManager</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">newGuiManager</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * @return this application&#39;s GUI manager.</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">final</span><span class="w"> </span><span class="kd">public</span><span class="w"> </span><span class="kd">synchronized</span><span class="w"> </span><span class="n">GuiManagerInterfaceD</span><span class="w"> </span><span class="nf">getGuiManager</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">guiManager</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kd">synchronized</span><span class="w"> </span><span class="n">JFrame</span><span class="w"> </span><span class="nf">getFrame</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">frame</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">getGuiManager</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">frame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="n">GuiManagerD</span><span class="p">)</span><span class="w"> </span><span class="n">getGuiManager</span><span class="p">()).</span><span class="na">createFrame</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">frame</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">Component</span><span class="w"> </span><span class="nf">getMainComponent</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">mainComp</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">GDimension</span><span class="w"> </span><span class="nf">getPreferredSize</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">preferredSize</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setPreferredSize</span><span class="p">(</span><span class="n">GDimension</span><span class="w"> </span><span class="n">size</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">preferredSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">size</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">Container</span><span class="w"> </span><span class="nf">getContentPane</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mainComp</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">frame</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="n">frame</span><span class="p">.</span><span class="na">getContentPane</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">JPanel</span><span class="w"> </span><span class="nf">getCenterPanel</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">centerPanel</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">showAlgebraInput</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">showAlgebraInput</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setToolbarPosition</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">update</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">toolbarPosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">position</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">update</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">updateApplicationLayout</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="n">updateMenubar</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">showToolBarHelp</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">showToolBarHelp</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">updateToolBarLayout</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">isIniting</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">updateApplicationLayout</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="n">updateMenubar</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">showMenuBar</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">showMenuBar</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">hideDockBarPopup</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">getDockBar</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">getDockBar</span><span class="p">().</span><span class="na">hidePopup</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">DockBarInterface</span><span class="w"> </span><span class="nf">getDockBar</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">dockBar</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isShowDockBar</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">showDockBar</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isDockBarEast</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">isDockBarEast</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setDockBarEast</span><span class="p">(</span><span class="kt">boolean</span><span class="w"> </span><span class="n">isDockBarEast</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">this</span><span class="p">.</span><span class="na">isDockBarEast</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">isDockBarEast</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">getDockBar</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">dockBar</span><span class="p">.</span><span class="na">setEastOrientation</span><span class="p">(</span><span class="n">isDockBarEast</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * Set show dockBar with GUI update</span>
<span class="cm">	 * </span>
<span class="cm">	 * @param showDockBar whether to show the dockbar</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setShowDockBar</span><span class="p">(</span><span class="kt">boolean</span><span class="w"> </span><span class="n">showDockBar</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">setShowDockBar</span><span class="p">(</span><span class="n">showDockBar</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setShowDockBar</span><span class="p">(</span><span class="kt">boolean</span><span class="w"> </span><span class="n">showDockBar</span><span class="p">,</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">update</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">this</span><span class="p">.</span><span class="na">showDockBar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">showDockBar</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">update</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">updateContentPane</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="c1">// ***************************************************************************</span><span class="w"></span>
<span class="w">	</span><span class="c1">// TOOL TIPS</span><span class="w"></span>
<span class="w">	</span><span class="c1">// **************************************************************************</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">getAllowToolTips</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">allowToolTips</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * Sets allowToolTips flag and toggles tooltips for the application.</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setAllowToolTips</span><span class="p">(</span><span class="kt">boolean</span><span class="w"> </span><span class="n">allowToolTips</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">this</span><span class="p">.</span><span class="na">allowToolTips</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">allowToolTips</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="n">ToolTipManager</span><span class="p">.</span><span class="na">sharedInstance</span><span class="p">().</span><span class="na">setEnabled</span><span class="p">(</span><span class="n">allowToolTips</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * Returns the tool name and tool help text for the given tool as an HTML</span>
<span class="cm">	 * text that is useful for tooltips.</span>
<span class="cm">	 * </span>
<span class="cm">	 * @param mode</span>
<span class="cm">	 *            : tool ID</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getToolTooltipHTML</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">mode</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">loc</span><span class="p">.</span><span class="na">getTooltipLocale</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">loc</span><span class="p">.</span><span class="na">setTooltipFlag</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="n">String</span><span class="w"> </span><span class="n">toolTipHtml</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">super</span><span class="p">.</span><span class="na">getToolTooltipHTML</span><span class="p">(</span><span class="n">mode</span><span class="p">);</span><span class="w"></span>

<span class="w">		</span><span class="n">loc</span><span class="p">.</span><span class="na">clearTooltipFlag</span><span class="p">();</span><span class="w"></span>

<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">toolTipHtml</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="c1">// ***************************************************************************</span><span class="w"></span>
<span class="w">	</span><span class="c1">// FONTS</span><span class="w"></span>
<span class="w">	</span><span class="c1">// **************************************************************************</span><span class="w"></span>

<span class="w">	</span><span class="kd">final</span><span class="w"> </span><span class="kd">public</span><span class="w"> </span><span class="n">Font</span><span class="w"> </span><span class="nf">getBoldFont</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="p">((</span><span class="n">GFontD</span><span class="p">)</span><span class="w"> </span><span class="n">fontManager</span><span class="p">.</span><span class="na">getBoldFont</span><span class="p">()).</span><span class="na">getAwtFont</span><span class="p">();</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">final</span><span class="w"> </span><span class="kd">public</span><span class="w"> </span><span class="n">Font</span><span class="w"> </span><span class="nf">getItalicFont</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="p">((</span><span class="n">GFontD</span><span class="p">)</span><span class="w"> </span><span class="n">fontManager</span><span class="p">.</span><span class="na">getItalicFont</span><span class="p">()).</span><span class="na">getAwtFont</span><span class="p">();</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">final</span><span class="w"> </span><span class="kd">public</span><span class="w"> </span><span class="n">Font</span><span class="w"> </span><span class="nf">getPlainFont</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="p">((</span><span class="n">GFontD</span><span class="p">)</span><span class="w"> </span><span class="n">fontManager</span><span class="p">.</span><span class="na">getPlainFont</span><span class="p">()).</span><span class="na">getAwtFont</span><span class="p">();</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">final</span><span class="w"> </span><span class="kd">public</span><span class="w"> </span><span class="n">GFont</span><span class="w"> </span><span class="nf">getPlainFontCommon</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">fontManager</span><span class="p">.</span><span class="na">getPlainFont</span><span class="p">();</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">final</span><span class="w"> </span><span class="kd">public</span><span class="w"> </span><span class="n">Font</span><span class="w"> </span><span class="nf">getSerifFont</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="p">((</span><span class="n">GFontD</span><span class="p">)</span><span class="w"> </span><span class="n">fontManager</span><span class="p">.</span><span class="na">getSerifFont</span><span class="p">()).</span><span class="na">getAwtFont</span><span class="p">();</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">final</span><span class="w"> </span><span class="kd">public</span><span class="w"> </span><span class="n">Font</span><span class="w"> </span><span class="nf">getSmallFont</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="p">((</span><span class="n">GFontD</span><span class="p">)</span><span class="w"> </span><span class="n">fontManager</span><span class="p">.</span><span class="na">getSmallFont</span><span class="p">()).</span><span class="na">getAwtFont</span><span class="p">();</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">final</span><span class="w"> </span><span class="kd">public</span><span class="w"> </span><span class="n">GFont</span><span class="w"> </span><span class="nf">getFont</span><span class="p">(</span><span class="kt">boolean</span><span class="w"> </span><span class="n">serif</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">style</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">size</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">fontManager</span><span class="p">.</span><span class="na">getFont</span><span class="p">(</span><span class="n">serif</span><span class="p">,</span><span class="w"> </span><span class="n">style</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * @return the font manager to access fonts for different tasks</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">final</span><span class="w"> </span><span class="kd">public</span><span class="w"> </span><span class="n">FontManagerD</span><span class="w"> </span><span class="nf">getFontManager</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">fontManager</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="c1">// ***************************************************************************</span><span class="w"></span>
<span class="w">	</span><span class="c1">// CURSORS</span><span class="w"></span>
<span class="w">	</span><span class="c1">// **************************************************************************</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setWaitCursor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">Cursor</span><span class="w"> </span><span class="n">waitCursor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Cursor</span><span class="p">.</span><span class="na">getPredefinedCursor</span><span class="p">(</span><span class="n">Cursor</span><span class="p">.</span><span class="na">WAIT_CURSOR</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="n">mainComp</span><span class="p">.</span><span class="na">setCursor</span><span class="p">(</span><span class="n">waitCursor</span><span class="p">);</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">euclidianView</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="p">((</span><span class="n">EuclidianViewInterfaceD</span><span class="p">)</span><span class="w"> </span><span class="n">getActiveEuclidianView</span><span class="p">())</span><span class="w"></span>
<span class="w">					</span><span class="p">.</span><span class="na">setCursor</span><span class="p">(</span><span class="n">waitCursor</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">guiManager</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">guiManager</span><span class="p">.</span><span class="na">allowGUIToRefresh</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setDefaultCursor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">mainComp</span><span class="p">.</span><span class="na">setCursor</span><span class="p">(</span><span class="n">Cursor</span><span class="p">.</span><span class="na">getDefaultCursor</span><span class="p">());</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">guiManager</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">guiManager</span><span class="p">.</span><span class="na">getEuclidianViewCount</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">guiManager</span><span class="p">.</span><span class="na">hasEuclidianView2EitherShowingOrNot</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">					</span><span class="n">guiManager</span><span class="p">.</span><span class="na">getEuclidianView2</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"></span>
<span class="w">									</span><span class="p">.</span><span class="na">setCursor</span><span class="p">(</span><span class="n">EuclidianCursor</span><span class="p">.</span><span class="na">DEFAULT</span><span class="p">);</span><span class="w"></span>
<span class="w">				</span><span class="p">}</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">euclidianView</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">getEuclidianView1</span><span class="p">().</span><span class="na">setCursor</span><span class="p">(</span><span class="n">Cursor</span><span class="p">.</span><span class="na">getDefaultCursor</span><span class="p">());</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="n">Cursor</span><span class="w"> </span><span class="n">transparentCursor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">Cursor</span><span class="w"> </span><span class="nf">getTransparentCursor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">transparentCursor</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="kt">int</span><span class="o">[]</span><span class="w"> </span><span class="n">pixels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="o">[</span><span class="mi">16</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">16</span><span class="o">]</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="n">Image</span><span class="w"> </span><span class="n">image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Toolkit</span><span class="p">.</span><span class="na">getDefaultToolkit</span><span class="p">()</span><span class="w"></span>
<span class="w">					</span><span class="p">.</span><span class="na">createImage</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">MemoryImageSource</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="n">pixels</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">));</span><span class="w"></span>

<span class="w">			</span><span class="n">transparentCursor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Toolkit</span><span class="p">.</span><span class="na">getDefaultToolkit</span><span class="p">().</span><span class="na">createCustomCursor</span><span class="p">(</span><span class="w"></span>
<span class="w">					</span><span class="n">image</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;invisibleCursor&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">transparentCursor</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="n">Cursor</span><span class="w"> </span><span class="n">eraserCursor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">Cursor</span><span class="w"> </span><span class="nf">getEraserCursor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">eraserCursor</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">			</span><span class="kt">int</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">32</span><span class="p">;</span><span class="w"></span>

<span class="w">			</span><span class="cm">/*</span>
<span class="cm">			 * we need two buffered images as the cursor only supports on/off</span>
<span class="cm">			 * for alpha</span>
<span class="cm">			 * </span>
<span class="cm">			 * so we need to draw to an image without alpha support then draw</span>
<span class="cm">			 * that to one with alpha support then make &quot;white&quot; transparent</span>
<span class="cm">			 */</span><span class="w"></span>
<span class="w">			</span><span class="n">BufferedImage</span><span class="w"> </span><span class="n">image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BufferedImage</span><span class="p">(</span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"></span>
<span class="w">					</span><span class="n">BufferedImage</span><span class="p">.</span><span class="na">TYPE_INT_RGB</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="n">BufferedImage</span><span class="w"> </span><span class="n">image2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BufferedImage</span><span class="p">(</span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"></span>
<span class="w">					</span><span class="n">BufferedImage</span><span class="p">.</span><span class="na">TYPE_INT_ARGB</span><span class="p">);</span><span class="w"></span>

<span class="w">			</span><span class="n">Graphics2D</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">image</span><span class="p">.</span><span class="na">createGraphics</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="n">Graphics2D</span><span class="w"> </span><span class="n">g2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">image2</span><span class="p">.</span><span class="na">createGraphics</span><span class="p">();</span><span class="w"></span>

<span class="w">			</span><span class="n">g</span><span class="p">.</span><span class="na">setColor</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="na">white</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="n">g</span><span class="p">.</span><span class="na">fillRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">);</span><span class="w"></span>

<span class="w">			</span><span class="c1">// turn on anti-aliasing.</span><span class="w"></span>
<span class="w">			</span><span class="n">g</span><span class="p">.</span><span class="na">setStroke</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">BasicStroke</span><span class="p">(</span><span class="mf">4.0f</span><span class="p">));</span><span class="w"> </span><span class="c1">// 4-pixel lines</span><span class="w"></span>
<span class="w">			</span><span class="n">g</span><span class="p">.</span><span class="na">setRenderingHint</span><span class="p">(</span><span class="n">RenderingHints</span><span class="p">.</span><span class="na">KEY_ANTIALIASING</span><span class="p">,</span><span class="w"></span>
<span class="w">					</span><span class="n">RenderingHints</span><span class="p">.</span><span class="na">VALUE_ANTIALIAS_ON</span><span class="p">);</span><span class="w"></span>

<span class="w">			</span><span class="n">g</span><span class="p">.</span><span class="na">setColor</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Color</span><span class="p">(</span><span class="mf">0.5f</span><span class="p">,</span><span class="w"> </span><span class="mf">0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0f</span><span class="p">));</span><span class="w"></span>
<span class="w">			</span><span class="n">g</span><span class="p">.</span><span class="na">drawOval</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">7</span><span class="p">);</span><span class="w"></span>

<span class="w">			</span><span class="n">g2</span><span class="p">.</span><span class="na">drawImage</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">Color</span><span class="p">.</span><span class="na">white</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span><span class="w"></span>

<span class="w">			</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">size</span><span class="p">;</span><span class="w"> </span><span class="n">y</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">size</span><span class="p">;</span><span class="w"> </span><span class="n">x</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">					</span><span class="kt">int</span><span class="w"> </span><span class="n">rgb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">image</span><span class="p">.</span><span class="na">getRGB</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">);</span><span class="w"></span>

<span class="w">					</span><span class="kt">int</span><span class="w"> </span><span class="n">blue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rgb</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0xff</span><span class="p">;</span><span class="w"></span>
<span class="w">					</span><span class="kt">int</span><span class="w"> </span><span class="n">green</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">rgb</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0xff00</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">8</span><span class="p">;</span><span class="w"></span>
<span class="w">					</span><span class="kt">int</span><span class="w"> </span><span class="n">red</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">rgb</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0xff0000</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">16</span><span class="p">;</span><span class="w"></span>
<span class="w">					</span><span class="c1">// int alpha = (rgb &amp; 0xff000000) &gt;&gt; 24;</span><span class="w"></span>

<span class="w">					</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">red</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">255</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">green</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">255</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">blue</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">						</span><span class="c1">// make white transparent</span><span class="w"></span>
<span class="w">						</span><span class="n">image2</span><span class="p">.</span><span class="na">setRGB</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">					</span><span class="p">}</span><span class="w"></span>

<span class="w">				</span><span class="p">}</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>

<span class="w">			</span><span class="n">eraserCursor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Toolkit</span><span class="p">.</span><span class="na">getDefaultToolkit</span><span class="p">().</span><span class="na">createCustomCursor</span><span class="p">(</span><span class="w"></span>
<span class="w">					</span><span class="n">image2</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Point</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;eraserCursor&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">eraserCursor</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="c1">// **************************************************************************</span><span class="w"></span>
<span class="w">	</span><span class="c1">// EXIT</span><span class="w"></span>
<span class="w">	</span><span class="c1">// **************************************************************************</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * // think about this Downloads the latest jar files from the GeoGebra</span>
<span class="cm">	 * server.</span>
<span class="cm">	 * </span>
<span class="cm">	 * private void updateGeoGebra() { try { File dest = new File(codebase +</span>
<span class="cm">	 * Application.JAR_FILE); URL jarURL = new URL(Application.UPDATE_URL +</span>
<span class="cm">	 * Application.JAR_FILE);</span>
<span class="cm">	 * </span>
<span class="cm">	 * if (dest.exists()) { // check if jarURL is newer then dest try {</span>
<span class="cm">	 * URLConnection connection = jarURL.openConnection(); if</span>
<span class="cm">	 * (connection.getLastModified() &lt;= dest.lastModified()) { showMessage(&quot;No</span>
<span class="cm">	 * update available&quot;); return; } } catch (Exception e) { // we don&#39;t know if</span>
<span class="cm">	 * the file behind jarURL is newer than dest // so don&#39;t do anything</span>
<span class="cm">	 * showMessage(&quot;No update available: &quot; + (e.getMessage())); return; } } //</span>
<span class="cm">	 * copy JAR_FILE if (!CopyURLToFile.copyURLToFile(this, jarURL, dest))</span>
<span class="cm">	 * return; // copy properties file dest = new File(codebase +</span>
<span class="cm">	 * Application.PROPERTIES_FILE); jarURL = new URL(Application.UPDATE_URL +</span>
<span class="cm">	 * Application.PROPERTIES_FILE); if (!CopyURLToFile.copyURLToFile(this,</span>
<span class="cm">	 * jarURL, dest)) return; // copy jscl file dest = new File(codebase +</span>
<span class="cm">	 * Application.JSCL_FILE); jarURL = new URL(Application.UPDATE_URL +</span>
<span class="cm">	 * Application.JSCL_FILE); if (!CopyURLToFile.copyURLToFile(this, jarURL,</span>
<span class="cm">	 * dest)) return;</span>
<span class="cm">	 * </span>
<span class="cm">	 * </span>
<span class="cm">	 * showMessage(&quot;Update finished. Please restart GeoGebra.&quot;); } catch</span>
<span class="cm">	 * (Exception e) { showError(&quot;Update failed: &quot;+ e.getMessage()); } }</span>
<span class="cm">	 */</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * Clears the current construction. Used for File-New.</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">clearConstruction</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isSaved</span><span class="p">()</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">saveCurrentFile</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">			</span><span class="n">kernel</span><span class="p">.</span><span class="na">clearConstruction</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w"></span>

<span class="w">			</span><span class="n">kernel</span><span class="p">.</span><span class="na">initUndoInfo</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="n">resetMaxLayerUsed</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="n">setCurrentFile</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="n">setMoveMode</span><span class="p">();</span><span class="w"></span>

<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">exit</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="c1">// glassPane is active: don&#39;t exit now!</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">glassPaneListener</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="c1">// stop sound thread if currently playing</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">getSoundManager</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">getSoundManager</span><span class="p">().</span><span class="na">stopCurrentSound</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isSaved</span><span class="p">()</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">saveCurrentFile</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">exitFrame</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">exitFrame</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">frame</span><span class="p">.</span><span class="na">setVisible</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">getGuiManager</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">getGuiManager</span><span class="p">().</span><span class="na">exitAllCurrent</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kd">synchronized</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">exitAll</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="c1">// glassPane is active: don&#39;t exit now!</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">glassPaneListener</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="n">GuiManagerD</span><span class="p">.</span><span class="na">exitAll</span><span class="p">();</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="c1">// returns true for YES or NO and false for CANCEL</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">saveCurrentFile</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">getGuiManager</span><span class="p">().</span><span class="na">saveCurrentFile</span><span class="p">();</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="c1">// **************************************************************************</span><span class="w"></span>
<span class="w">	</span><span class="c1">// SAVE / LOAD</span><span class="w"></span>
<span class="w">	</span><span class="c1">// **************************************************************************</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * Load file</span>
<span class="cm">	 * @return success</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">loadFile</span><span class="p">(</span><span class="n">File</span><span class="w"> </span><span class="n">file</span><span class="p">,</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">isMacroFile</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">checkFileExistsAndShowFileNotFound</span><span class="p">(</span><span class="n">file</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">loadExistingFile</span><span class="p">(</span><span class="n">file</span><span class="p">,</span><span class="w"> </span><span class="n">isMacroFile</span><span class="p">);</span><span class="w"></span>

<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="n">OFFHandler</span><span class="w"> </span><span class="n">offHandler</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">loadOffFile</span><span class="p">(</span><span class="n">File</span><span class="w"> </span><span class="n">file</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">checkFileExistsAndShowFileNotFound</span><span class="p">(</span><span class="n">file</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="kt">boolean</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">OFFReader</span><span class="w"> </span><span class="n">reader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OFFReader</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">initing</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">initing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"></span>
<span class="w">				</span><span class="n">reader</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="n">file</span><span class="p">,</span><span class="w"> </span><span class="n">getOFFHandler</span><span class="p">());</span><span class="w"></span>
<span class="w">				</span><span class="n">initing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">reader</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="n">file</span><span class="p">,</span><span class="w"> </span><span class="n">getOFFHandler</span><span class="p">());</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">ex</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="n">ex</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="n">showError</span><span class="p">(</span><span class="n">Errors</span><span class="p">.</span><span class="na">LoadFileFailed</span><span class="p">,</span><span class="w"> </span><span class="n">file</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">status</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">protected</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">checkFileExistsAndShowFileNotFound</span><span class="p">(</span><span class="n">File</span><span class="w"> </span><span class="n">file</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="c1">// show file not found message</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">file</span><span class="p">.</span><span class="na">exists</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="cm">/*</span>
<span class="cm">			 * First parameter can not be the main component of the application,</span>
<span class="cm">			 * otherwise that component would be validated too early if a</span>
<span class="cm">			 * missing file was loaded through the command line, which causes</span>
<span class="cm">			 * some nasty rendering problems.</span>
<span class="cm">			 */</span><span class="w"></span>
<span class="w">			</span><span class="n">JOptionPane</span><span class="p">.</span><span class="na">showConfirmDialog</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span><span class="w"></span>
<span class="w">					</span><span class="n">getLocalization</span><span class="p">().</span><span class="na">getError</span><span class="p">(</span><span class="s">&quot;FileNotFound&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;:\n&quot;</span><span class="w"></span>
<span class="w">							</span><span class="o">+</span><span class="w"> </span><span class="n">file</span><span class="p">.</span><span class="na">getAbsolutePath</span><span class="p">(),</span><span class="w"></span>
<span class="w">					</span><span class="n">getLocalization</span><span class="p">().</span><span class="na">getError</span><span class="p">(</span><span class="s">&quot;Error&quot;</span><span class="p">),</span><span class="w"></span>
<span class="w">					</span><span class="n">JOptionPane</span><span class="p">.</span><span class="na">DEFAULT_OPTION</span><span class="p">,</span><span class="w"> </span><span class="n">JOptionPane</span><span class="p">.</span><span class="na">WARNING_MESSAGE</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">loadExistingFile</span><span class="p">(</span><span class="n">File</span><span class="w"> </span><span class="n">file</span><span class="p">,</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">isMacroFile</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">		</span><span class="n">setWaitCursor</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">isMacroFile</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="c1">// hide navigation bar for construction steps if visible</span><span class="w"></span>
<span class="w">			</span><span class="n">setHideConstructionProtocolNavigation</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">loadXML</span><span class="p">(</span><span class="n">file</span><span class="p">,</span><span class="w"> </span><span class="n">isMacroFile</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * Loads construction file</span>
<span class="cm">	 * </span>
<span class="cm">	 * @return true if successful</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">final</span><span class="w"> </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">loadXML</span><span class="p">(</span><span class="n">File</span><span class="w"> </span><span class="n">file</span><span class="p">,</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">isMacroFile</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">FileInputStream</span><span class="w"> </span><span class="n">fis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">fis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FileInputStream</span><span class="p">(</span><span class="n">file</span><span class="p">);</span><span class="w"></span>

<span class="w">			</span><span class="kt">boolean</span><span class="w"> </span><span class="n">success</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>

<span class="w">			</span><span class="c1">// pretend we&#39;re initializing the application to prevent unnecessary</span><span class="w"></span>
<span class="w">			</span><span class="c1">// update</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">initing</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">initing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"></span>
<span class="w">				</span><span class="n">success</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GFileHandler</span><span class="p">.</span><span class="na">loadXML</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">fis</span><span class="p">,</span><span class="w"> </span><span class="n">isMacroFile</span><span class="p">);</span><span class="w"></span>
<span class="w">				</span><span class="n">initing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">success</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GFileHandler</span><span class="p">.</span><span class="na">loadXML</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">fis</span><span class="p">,</span><span class="w"> </span><span class="n">isMacroFile</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>

<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">success</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">isMacroFile</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">setCurrentFile</span><span class="p">(</span><span class="n">file</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>

<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="n">success</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">setCurrentFile</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="n">showError</span><span class="p">(</span><span class="n">Errors</span><span class="p">.</span><span class="na">LoadFileFailed</span><span class="p">,</span><span class="w"> </span><span class="n">file</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">initing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fis</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">					</span><span class="n">fis</span><span class="p">.</span><span class="na">close</span><span class="p">();</span><span class="w"></span>
<span class="w">				</span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">					</span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span><span class="w"></span>
<span class="w">				</span><span class="p">}</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * Loads construction file from URL</span>
<span class="cm">	 * </span>
<span class="cm">	 * @return true if successful</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">final</span><span class="w"> </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">loadXML</span><span class="p">(</span><span class="n">URL</span><span class="w"> </span><span class="n">url</span><span class="p">,</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">isMacroFile</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">		</span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="kt">boolean</span><span class="w"> </span><span class="n">success</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GFileHandler</span><span class="p">.</span><span class="na">loadXML</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">url</span><span class="p">.</span><span class="na">openStream</span><span class="p">(),</span><span class="w"></span>
<span class="w">					</span><span class="n">isMacroFile</span><span class="p">);</span><span class="w"></span>

<span class="w">			</span><span class="c1">// don&#39;t clear JavaScript here -- we may have just read one from the</span><span class="w"></span>
<span class="w">			</span><span class="c1">// file.</span><span class="w"></span>
<span class="w">			</span><span class="c1">// MyXMLio.readZip() handles script resetting</span><span class="w"></span>

<span class="w">			</span><span class="c1">// set current file</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">isMacroFile</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">url</span><span class="p">.</span><span class="na">toExternalForm</span><span class="p">().</span><span class="na">startsWith</span><span class="p">(</span><span class="s">&quot;file&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">String</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">url</span><span class="p">.</span><span class="na">getPath</span><span class="p">();</span><span class="w"></span>
<span class="w">				</span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">path</span><span class="p">.</span><span class="na">replaceAll</span><span class="p">(</span><span class="s">&quot;%20&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">				</span><span class="n">File</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="n">path</span><span class="p">);</span><span class="w"></span>
<span class="w">				</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="na">exists</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">					</span><span class="n">setCurrentFile</span><span class="p">(</span><span class="n">f</span><span class="p">);</span><span class="w"></span>
<span class="w">				</span><span class="p">}</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>

<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="n">success</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">showError</span><span class="p">(</span><span class="n">Errors</span><span class="p">.</span><span class="na">LoadFileFailed</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span><span class="w"></span>
<span class="w">			</span><span class="n">setCurrentFile</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/*</span>
<span class="cm">	 * loads an XML file as a String</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">loadXML</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">xml</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">			</span><span class="c1">// make sure objects are displayed in the correct View</span><span class="w"></span>
<span class="w">			</span><span class="n">setActiveView</span><span class="p">(</span><span class="n">App</span><span class="p">.</span><span class="na">VIEW_EUCLIDIAN</span><span class="p">);</span><span class="w"></span>

<span class="w">			</span><span class="n">getXMLio</span><span class="p">().</span><span class="na">processXMLString</span><span class="p">(</span><span class="n">xml</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span><span class="w"></span>

<span class="w">			</span><span class="n">kernel</span><span class="p">.</span><span class="na">initUndoInfo</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="n">setSaved</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="n">setCurrentFile</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="c1">// command list may have changed due to macros</span><span class="w"></span>
<span class="w">			</span><span class="n">updateCommandDictionary</span><span class="p">();</span><span class="w"></span>

<span class="w">			</span><span class="n">hideDockBarPopup</span><span class="p">();</span><span class="w"></span>

<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">setCurrentFile</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="n">err</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">storeFrameCenter</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">centerX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getWindowCenterX</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="n">centerY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getWindowCenterY</span><span class="p">();</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">centerFrame</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="c1">// re-center window</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">frame</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="kt">int</span><span class="w"> </span><span class="n">x0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">centerX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">frame</span><span class="p">.</span><span class="na">getWidth</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x0</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">x0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">			</span><span class="kt">int</span><span class="w"> </span><span class="n">y0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">centerY</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">frame</span><span class="p">.</span><span class="na">getHeight</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">y0</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">y0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">			</span><span class="n">frame</span><span class="p">.</span><span class="na">setLocation</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span><span class="w"> </span><span class="n">y0</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * Saves all objects.</span>
<span class="cm">	 * </span>
<span class="cm">	 * @return true if successful</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">saveGeoGebraFile</span><span class="p">(</span><span class="n">File</span><span class="w"> </span><span class="n">file</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">setWaitCursor</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="n">getXMLio</span><span class="p">().</span><span class="na">writeGeoGebraFile</span><span class="p">(</span><span class="n">file</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="n">setSaved</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="n">setDefaultCursor</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">setDefaultCursor</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="n">showError</span><span class="p">(</span><span class="n">Errors</span><span class="p">.</span><span class="na">SaveFileFailed</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * Saves given macros to file.</span>
<span class="cm">	 * </span>
<span class="cm">	 * @return true if successful</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">final</span><span class="w"> </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">saveMacroFile</span><span class="p">(</span><span class="n">File</span><span class="w"> </span><span class="n">file</span><span class="p">,</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Macro</span><span class="o">&gt;</span><span class="w"> </span><span class="n">macros</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">setWaitCursor</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="n">getXMLio</span><span class="p">().</span><span class="na">writeMacroFile</span><span class="p">(</span><span class="n">file</span><span class="p">,</span><span class="w"> </span><span class="n">macros</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="n">setDefaultCursor</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">setDefaultCursor</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="n">showError</span><span class="p">(</span><span class="n">Errors</span><span class="p">.</span><span class="na">SaveFileFailed</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="nf">getMacroFileAsByteArray</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">getMacroFileAsByteArray</span><span class="p">(</span><span class="n">kernel</span><span class="p">.</span><span class="na">getAllMacros</span><span class="p">());</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * @param untilMacro first macro not to be serialized (null to serialize all)</span>
<span class="cm">	 * @return first several macros serialized to byte array, until given macro</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="nf">getMacrosBefore</span><span class="p">(</span><span class="n">Macro</span><span class="w"> </span><span class="n">untilMacro</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Macro</span><span class="o">&gt;</span><span class="w"> </span><span class="n">previousMacros</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Macro</span><span class="w"> </span><span class="n">macro</span><span class="p">:</span><span class="w"> </span><span class="n">kernel</span><span class="p">.</span><span class="na">getAllMacros</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">macro</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">untilMacro</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">			</span><span class="n">previousMacros</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">macro</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">getMacroFileAsByteArray</span><span class="p">(</span><span class="n">previousMacros</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="nf">getMacroFileAsByteArray</span><span class="p">(</span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Macro</span><span class="o">&gt;</span><span class="w"> </span><span class="n">macros</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">ByteArrayOutputStream</span><span class="w"> </span><span class="n">os</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ByteArrayOutputStream</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="n">getXMLio</span><span class="p">().</span><span class="na">writeMacroStream</span><span class="p">(</span><span class="n">os</span><span class="p">,</span><span class="w"> </span><span class="n">macros</span><span class="p">,</span><span class="w"> </span><span class="n">kernel</span><span class="p">.</span><span class="na">getAllMacros</span><span class="p">());</span><span class="w"></span>
<span class="w">			</span><span class="n">os</span><span class="p">.</span><span class="na">flush</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="n">os</span><span class="p">.</span><span class="na">toByteArray</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">loadMacroFileFromByteArray</span><span class="p">(</span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">byteArray</span><span class="p">,</span><span class="w"></span>
<span class="w">			</span><span class="kt">boolean</span><span class="w"> </span><span class="n">removeOldMacros</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">removeOldMacros</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">kernel</span><span class="p">.</span><span class="na">removeAllMacros</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>

<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">byteArray</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">ByteArrayInputStream</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ByteArrayInputStream</span><span class="p">(</span><span class="n">byteArray</span><span class="p">);</span><span class="w"></span>
<span class="w">				</span><span class="n">getXMLio</span><span class="p">().</span><span class="na">readZipFromInputStream</span><span class="p">(</span><span class="n">is</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span><span class="w"></span>
<span class="w">				</span><span class="n">is</span><span class="p">.</span><span class="na">close</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">final</span><span class="w"> </span><span class="kd">public</span><span class="w"> </span><span class="n">MyXMLioD</span><span class="w"> </span><span class="nf">getXMLio</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">MyXMLioD</span><span class="p">)</span><span class="w"> </span><span class="kd">super</span><span class="p">.</span><span class="na">getXMLio</span><span class="p">();</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">OFFHandler</span><span class="w"> </span><span class="nf">getOFFHandler</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">offHandler</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">offHandler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OFFHandler</span><span class="p">(</span><span class="n">kernel</span><span class="p">.</span><span class="na">getConstruction</span><span class="p">());</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">offHandler</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">MyXMLioD</span><span class="w"> </span><span class="nf">createXMLio</span><span class="p">(</span><span class="n">Construction</span><span class="w"> </span><span class="n">cons</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MyXMLioD</span><span class="p">(</span><span class="n">cons</span><span class="p">.</span><span class="na">getKernel</span><span class="p">(),</span><span class="w"> </span><span class="n">cons</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">storeUndoInfo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isUndoActive</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">kernel</span><span class="p">.</span><span class="na">storeUndoInfo</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="n">setUnsaved</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">restoreCurrentUndoInfo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isUndoActive</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">kernel</span><span class="p">.</span><span class="na">restoreCurrentUndoInfo</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="n">setUnsaved</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">protected</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">getWindowWidth</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">frame</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">frame</span><span class="p">.</span><span class="na">getWidth</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="n">frame</span><span class="p">.</span><span class="na">getWidth</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="mi">800</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">protected</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">getWindowHeight</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">frame</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">frame</span><span class="p">.</span><span class="na">getHeight</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="n">frame</span><span class="p">.</span><span class="na">getHeight</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="mi">600</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">getWindowCenterX</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">frame</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="n">frame</span><span class="p">.</span><span class="na">getX</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">frame</span><span class="p">.</span><span class="na">getWidth</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="mi">400</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">getWindowCenterY</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">frame</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="n">frame</span><span class="p">.</span><span class="na">getY</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">frame</span><span class="p">.</span><span class="na">getHeight</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="mi">300</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/*</span>
<span class="cm">	 * final public void clearAll() { // load preferences</span>
<span class="cm">	 * GeoGebraPreferences.loadXMLPreferences(this); updateContentPane(); //</span>
<span class="cm">	 * clear construction kernel.clearConstruction(); kernel.initUndoInfo();</span>
<span class="cm">	 * </span>
<span class="cm">	 * isSaved = true; System.gc(); }</span>
<span class="cm">	 */</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">getLayoutXML</span><span class="p">(</span><span class="n">StringBuilder</span><span class="w"> </span><span class="n">sb</span><span class="p">,</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">asPreference</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">guiManager</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">initGuiManager</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="n">getGuiManager</span><span class="p">().</span><span class="na">getLayout</span><span class="p">().</span><span class="na">getXml</span><span class="p">(</span><span class="n">sb</span><span class="p">,</span><span class="w"> </span><span class="n">asPreference</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * @return the CodeBase URL.</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">URL</span><span class="w"> </span><span class="nf">getCodeBase</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">codebase</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">initCodeBase</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">codebase</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">URL</span><span class="w"> </span><span class="n">codebase</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">runningFromJar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="kd">final</span><span class="w"> </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">packgz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;.pack.gz&quot;</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">initCodeBase</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="c1">// application codebase</span><span class="w"></span>
<span class="w">			</span><span class="n">String</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GeoGebra</span><span class="p">.</span><span class="na">class</span><span class="p">.</span><span class="na">getProtectionDomain</span><span class="p">().</span><span class="na">getCodeSource</span><span class="p">()</span><span class="w"></span>
<span class="w">					</span><span class="p">.</span><span class="na">getLocation</span><span class="p">().</span><span class="na">toExternalForm</span><span class="p">();</span><span class="w"></span>

<span class="w">			</span><span class="c1">// remove .pack.gz from end</span><span class="w"></span>
<span class="w">			</span><span class="c1">// not sure why we&#39;ve started getting this (maybe when using the</span><span class="w"></span>
<span class="w">			</span><span class="c1">// mirror servers?)</span><span class="w"></span>
<span class="w">			</span><span class="c1">// eg Codebase:</span><span class="w"></span>
<span class="w">			</span><span class="c1">// http://jars.geogebra.org/webstart/4.2/jnlp/geogebra.jar.pack.gz</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">path</span><span class="p">.</span><span class="na">endsWith</span><span class="p">(</span><span class="n">packgz</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">path</span><span class="p">.</span><span class="na">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">path</span><span class="p">.</span><span class="na">length</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">packgz</span><span class="p">.</span><span class="na">length</span><span class="p">());</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>

<span class="w">			</span><span class="c1">// remove &quot;geogebra.jar&quot; from end of codebase string</span><span class="w"></span>
<span class="w">			</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">GEOGEBRA_JAR_ALT</span><span class="p">.</span><span class="na">length</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">path</span><span class="p">.</span><span class="na">endsWith</span><span class="p">(</span><span class="n">GEOGEBRA_JAR_ALT</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">					</span><span class="n">runningFromJar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"></span>
<span class="w">					</span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">path</span><span class="p">.</span><span class="na">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"></span>
<span class="w">							</span><span class="n">path</span><span class="p">.</span><span class="na">length</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">GEOGEBRA_JAR_ALT</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">.</span><span class="na">length</span><span class="p">());</span><span class="w"></span>
<span class="w">				</span><span class="p">}</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>

<span class="w">			</span><span class="c1">// set codebase</span><span class="w"></span>
<span class="w">			</span><span class="n">codebase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">URL</span><span class="p">(</span><span class="n">path</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">Log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;GeoGebra is running with restricted permissions.&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">			</span><span class="c1">// make sure temporary files not used</span><span class="w"></span>
<span class="w">			</span><span class="c1">// eg ggbApi.getPNGBase64()</span><span class="w"></span>
<span class="w">			</span><span class="n">ImageIO</span><span class="p">.</span><span class="na">setUseCache</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="c1">// **************************************************************************</span><span class="w"></span>
<span class="w">	</span><span class="c1">// EVENT DISPATCHING</span><span class="w"></span>
<span class="w">	</span><span class="c1">// **************************************************************************</span><span class="w"></span>

<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="n">GlassPaneListener</span><span class="w"> </span><span class="n">glassPaneListener</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="n">ErrorHandler</span><span class="w"> </span><span class="n">defaultErrorHandler</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">startDispatchingEventsTo</span><span class="p">(</span><span class="n">JComponent</span><span class="w"> </span><span class="n">comp</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">guiManager</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">getDialogManager</span><span class="p">().</span><span class="na">closeAll</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">glassPaneListener</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">Component</span><span class="w"> </span><span class="n">glassPane</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getGlassPane</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="n">glassPaneListener</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">GlassPaneListener</span><span class="p">(</span><span class="n">glassPane</span><span class="p">,</span><span class="w"></span>
<span class="w">					</span><span class="n">getContentPane</span><span class="p">(),</span><span class="w"> </span><span class="n">comp</span><span class="p">);</span><span class="w"></span>

<span class="w">			</span><span class="c1">// mouse</span><span class="w"></span>
<span class="w">			</span><span class="n">glassPane</span><span class="p">.</span><span class="na">addMouseListener</span><span class="p">(</span><span class="n">glassPaneListener</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="n">glassPane</span><span class="p">.</span><span class="na">addMouseMotionListener</span><span class="p">(</span><span class="n">glassPaneListener</span><span class="p">);</span><span class="w"></span>

<span class="w">			</span><span class="c1">// keys</span><span class="w"></span>
<span class="w">			</span><span class="n">KeyboardFocusManager</span><span class="p">.</span><span class="na">getCurrentKeyboardFocusManager</span><span class="p">()</span><span class="w"></span>
<span class="w">					</span><span class="p">.</span><span class="na">addKeyEventDispatcher</span><span class="p">(</span><span class="n">glassPaneListener</span><span class="p">);</span><span class="w"></span>

<span class="w">			</span><span class="n">glassPane</span><span class="p">.</span><span class="na">setVisible</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">stopDispatchingEvents</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">glassPaneListener</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">Component</span><span class="w"> </span><span class="n">glassPane</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getGlassPane</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="n">glassPane</span><span class="p">.</span><span class="na">removeMouseListener</span><span class="p">(</span><span class="n">glassPaneListener</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="n">glassPane</span><span class="p">.</span><span class="na">removeMouseMotionListener</span><span class="p">(</span><span class="n">glassPaneListener</span><span class="p">);</span><span class="w"></span>

<span class="w">			</span><span class="n">KeyboardFocusManager</span><span class="p">.</span><span class="na">getCurrentKeyboardFocusManager</span><span class="p">()</span><span class="w"></span>
<span class="w">					</span><span class="p">.</span><span class="na">removeKeyEventDispatcher</span><span class="p">(</span><span class="n">glassPaneListener</span><span class="p">);</span><span class="w"></span>

<span class="w">			</span><span class="n">glassPane</span><span class="p">.</span><span class="na">setVisible</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="n">glassPaneListener</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">Component</span><span class="w"> </span><span class="nf">getGlassPane</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mainComp</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">frame</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="n">frame</span><span class="p">.</span><span class="na">getGlassPane</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setGlassPane</span><span class="p">(</span><span class="n">Component</span><span class="w"> </span><span class="n">component</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mainComp</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">frame</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">frame</span><span class="p">.</span><span class="na">setGlassPane</span><span class="p">(</span><span class="n">component</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="c1">// **************************************************************************</span><span class="w"></span>
<span class="w">	</span><span class="c1">// KEY EVENTS</span><span class="w"></span>
<span class="w">	</span><span class="c1">// **************************************************************************</span><span class="w"></span>

<span class="w">	</span><span class="cm">/*</span>
<span class="cm">	 * KeyEventDispatcher implementation to handle key events globally for the</span>
<span class="cm">	 * application</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">dispatchKeyEvent</span><span class="p">(</span><span class="n">KeyEvent</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="c1">// make sure the event is not consumed</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">isConsumed</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="n">controlDown</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">isControlDown</span><span class="p">(</span><span class="n">e</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="n">shiftDown</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">isShiftDown</span><span class="p">();</span><span class="w"></span>

<span class="w">		</span><span class="c1">// check if key event came from this main component</span><span class="w"></span>
<span class="w">		</span><span class="c1">// (needed to take care of multiple application windows or applets)</span><span class="w"></span>
<span class="w">		</span><span class="n">Component</span><span class="w"> </span><span class="n">eventPane</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SwingUtilities</span><span class="p">.</span><span class="na">getRootPane</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getComponent</span><span class="p">());</span><span class="w"></span>
<span class="w">		</span><span class="n">Component</span><span class="w"> </span><span class="n">mainPane</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SwingUtilities</span><span class="p">.</span><span class="na">getRootPane</span><span class="p">(</span><span class="n">mainComp</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">eventPane</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">mainPane</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">			</span><span class="c1">// ESC from dialog: close it</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getKeyCode</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">KeyEvent</span><span class="p">.</span><span class="na">VK_ESCAPE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">Component</span><span class="w"> </span><span class="n">rootComp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SwingUtilities</span><span class="p">.</span><span class="na">getRoot</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getComponent</span><span class="p">());</span><span class="w"></span>
<span class="w">				</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rootComp</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">JDialog</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">					</span><span class="p">((</span><span class="n">JDialog</span><span class="p">)</span><span class="w"> </span><span class="n">rootComp</span><span class="p">).</span><span class="na">setVisible</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w"></span>
<span class="w">					</span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"></span>
<span class="w">				</span><span class="p">}</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>

<span class="w">			</span><span class="c1">// key event came from another window or applet: ignore it</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">inExternalWindow</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">eventPane</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getKeyCode</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">KeyEvent</span><span class="p">.</span><span class="na">VK_SHIFT</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">handleShiftEvent</span><span class="p">(</span><span class="n">shiftDown</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="c1">// if the glass pane is visible, don&#39;t do anything</span><span class="w"></span>
<span class="w">		</span><span class="c1">// (there might be an animation running)</span><span class="w"></span>
<span class="w">		</span><span class="n">Component</span><span class="w"> </span><span class="n">glassPane</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getGlassPane</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">glassPane</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">glassPane</span><span class="p">.</span><span class="na">isVisible</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="c1">// handle global keys like ESC and function keys</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">getGlobalKeyDispatcher</span><span class="p">().</span><span class="na">dispatchKeyEvent</span><span class="p">(</span><span class="n">e</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * handle shift key pressed or released</span>
<span class="cm">	 * </span>
<span class="cm">	 * @param isShiftDown</span>
<span class="cm">	 *            whether shift is pressed</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handleShiftEvent</span><span class="p">(</span><span class="kt">boolean</span><span class="w"> </span><span class="n">isShiftDown</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="c1">// we may overwrite in subclasses</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">final</span><span class="w"> </span><span class="kd">public</span><span class="w"> </span><span class="n">GlobalKeyDispatcherD</span><span class="w"> </span><span class="nf">getGlobalKeyDispatcher</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">globalKeyDispatcher</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">globalKeyDispatcher</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newGlobalKeyDispatcher</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">globalKeyDispatcher</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">protected</span><span class="w"> </span><span class="n">GlobalKeyDispatcherD</span><span class="w"> </span><span class="nf">newGlobalKeyDispatcher</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">GlobalKeyDispatcherD</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/*</span>
<span class="cm">	 * check for alt pressed (but not ctrl) (or ctrl but not alt on MacOS)</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isAltDown</span><span class="p">(</span><span class="n">InputEvent</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="c1">// we don&#39;t want to act when AltGr is down</span><span class="w"></span>
<span class="w">		</span><span class="c1">// as it is used eg for entering {[}] is some locales</span><span class="w"></span>
<span class="w">		</span><span class="c1">// NB e.isAltGraphDown() doesn&#39;t work</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">isAltDown</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">isControlDown</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">MAC_OS</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">isControlDown</span><span class="p">()</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">isAltDown</span><span class="p">();</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="c1">// global controlDown, shiftDown flags</span><span class="w"></span>
<span class="w">	</span><span class="c1">// Application.dispatchKeyEvent sets these on every keyEvent.</span><span class="w"></span>

<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">controlDown</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">shiftDown</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">getControlDown</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">controlDown</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">getShiftDown</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">shiftDown</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isControlDown</span><span class="p">(</span><span class="n">InputEvent</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">isControlDown</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">isMetaDown</span><span class="p">(),</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">isControlDown</span><span class="p">());</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * @param isMetaDown whether meta key is down</span>
<span class="cm">	 * @param isControlDown whether ctrl key is down</span>
<span class="cm">	 * @return whether to treat event as ctrl key down (depends on OS)</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isControlDown</span><span class="p">(</span><span class="kt">boolean</span><span class="w"> </span><span class="n">isMetaDown</span><span class="p">,</span><span class="w"></span>
<span class="w">			</span><span class="kt">boolean</span><span class="w"> </span><span class="n">isControlDown</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fakeRightClick</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="c1">// multiple selection</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">MAC_OS</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">isMetaDown</span><span class="p">)</span><span class="w"> </span><span class="c1">// Mac: meta down for</span><span class="w"></span>
<span class="w">				</span><span class="c1">// multiple selection, Ctrl for other OS</span><span class="w"></span>
<span class="w">				</span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">MAC_OS</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">isControlDown</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">fakeRightClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isMiddleClick</span><span class="p">(</span><span class="n">MouseEventND</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">isMiddleClick</span><span class="p">();</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isRightClick</span><span class="p">(</span><span class="n">MouseEvent</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">		</span><span class="c1">// right-click returns isMetaDown on MAC_OS</span><span class="w"></span>
<span class="w">		</span><span class="c1">// so we want to return true for isMetaDown</span><span class="w"></span>
<span class="w">		</span><span class="c1">// if it occurred first at the same time as</span><span class="w"></span>
<span class="w">		</span><span class="c1">// a popup trigger</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">MAC_OS</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">e</span><span class="p">.</span><span class="na">isMetaDown</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">fakeRightClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">MAC_OS</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">isPopupTrigger</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">isMetaDown</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">fakeRightClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="cm">/*</span>
<span class="cm">		 * debug(&quot;MAC_OS = &quot;+MAC_OS); debug(&quot;isMetaDown = &quot;+e.isMetaDown());</span>
<span class="cm">		 * debug(&quot;isControlDown =&quot;+e.isControlDown()); debug(&quot;isShiftDown = &quot;</span>
<span class="cm">		 * +e.isShiftDown()); debug(&quot;isAltDown = &quot;+e.isAltDown()); debug(</span>
<span class="cm">		 * &quot;isAltGrDown =&quot;+e.isAltGraphDown()); debug(&quot;isPopupTrigger = &quot;</span>
<span class="cm">		 * +e.isPopupTrigger()); debug(&quot;fakeRightClick = &quot;+fakeRightClick);</span>
<span class="cm">		 */</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fakeRightClick</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="kt">boolean</span><span class="w"> </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">				</span><span class="c1">// e.isPopupTrigger() ||</span><span class="w"></span>
<span class="w">				</span><span class="p">(</span><span class="n">MAC_OS</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">isControlDown</span><span class="p">())</span><span class="w"> </span><span class="c1">// Mac: ctrl click = right click</span><span class="w"></span>
<span class="w">						</span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">MAC_OS</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">isMetaDown</span><span class="p">());</span><span class="w"> </span><span class="c1">// non-Mac: right click</span><span class="w"></span>
<span class="w">														</span><span class="c1">// = meta</span><span class="w"></span>
<span class="w">		</span><span class="c1">// click</span><span class="w"></span>

<span class="w">		</span><span class="c1">// debug(&quot;ret = &quot; + ret);</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="c1">// return e.isMetaDown();</span><span class="w"></span>

<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isRightClickForceMetaDown</span><span class="p">(</span><span class="n">MouseEvent</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">MAC_OS</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">isControlDown</span><span class="p">())</span><span class="w"> </span><span class="c1">// Mac: ctrl click = right click</span><span class="w"></span>
<span class="w">						</span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">isMetaDown</span><span class="p">());</span><span class="w"> </span><span class="c1">// non-Mac: right click = meta click</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">removeTraversableKeys</span><span class="p">(</span><span class="n">JPanel</span><span class="w"> </span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">Set</span><span class="o">&lt;</span><span class="n">AWTKeyStroke</span><span class="o">&gt;</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="na">getFocusTraversalKeys</span><span class="p">(</span><span class="w"></span>
<span class="w">				</span><span class="n">KeyboardFocusManager</span><span class="p">.</span><span class="na">UP_CYCLE_TRAVERSAL_KEYS</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="n">set</span><span class="p">.</span><span class="na">clear</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="n">p</span><span class="p">.</span><span class="na">setFocusTraversalKeys</span><span class="p">(</span><span class="n">KeyboardFocusManager</span><span class="p">.</span><span class="na">UP_CYCLE_TRAVERSAL_KEYS</span><span class="p">,</span><span class="w"></span>
<span class="w">				</span><span class="n">set</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="n">p</span><span class="p">.</span><span class="na">setFocusTraversalKeys</span><span class="p">(</span><span class="n">KeyboardFocusManager</span><span class="p">.</span><span class="na">DOWN_CYCLE_TRAVERSAL_KEYS</span><span class="p">,</span><span class="w"></span>
<span class="w">				</span><span class="n">set</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="n">p</span><span class="p">.</span><span class="na">setFocusTraversalKeys</span><span class="p">(</span><span class="n">KeyboardFocusManager</span><span class="p">.</span><span class="na">BACKWARD_TRAVERSAL_KEYS</span><span class="p">,</span><span class="w"></span>
<span class="w">				</span><span class="n">set</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="n">p</span><span class="p">.</span><span class="na">setFocusTraversalKeys</span><span class="p">(</span><span class="n">KeyboardFocusManager</span><span class="p">.</span><span class="na">FORWARD_TRAVERSAL_KEYS</span><span class="p">,</span><span class="w"></span>
<span class="w">				</span><span class="n">set</span><span class="p">);</span><span class="w"></span>

<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="c1">// **************************************************************************</span><span class="w"></span>
<span class="w">	</span><span class="c1">// ERROR HANDLING</span><span class="w"></span>
<span class="w">	</span><span class="c1">// **************************************************************************</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">showError</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">key</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">showErrorDialog</span><span class="p">(</span><span class="n">key</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">showError</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">showErrorDialog</span><span class="p">(</span><span class="n">getLocalization</span><span class="p">().</span><span class="na">getError</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;:\n&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">error</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * Show error dialog with given message</span>
<span class="cm">	 * </span>
<span class="cm">	 * @param msg</span>
<span class="cm">	 *            (localized) message</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">showErrorDialog</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">msg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">isErrorDialogsActive</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">getErrorHandler</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">this</span><span class="p">.</span><span class="na">getErrorHandler</span><span class="p">().</span><span class="na">showError</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">ErrorHandler</span><span class="w"> </span><span class="nf">getDefaultErrorHandler</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">defaultErrorHandler</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">defaultErrorHandler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ErrorHandler</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">				</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">				</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">showError</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">msg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">					</span><span class="c1">// don&#39;t remove, useful</span><span class="w"></span>
<span class="w">					</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">msg</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">						</span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">					</span><span class="p">}</span><span class="w"></span>
<span class="w">					</span><span class="n">Log</span><span class="p">.</span><span class="na">trace</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">msg</span><span class="p">);</span><span class="w"></span>

<span class="w">					</span><span class="c1">// make sure splash screen not showing (will be in front)</span><span class="w"></span>
<span class="w">					</span><span class="n">GeoGebra</span><span class="p">.</span><span class="na">hideSplash</span><span class="p">();</span><span class="w"></span>

<span class="w">					</span><span class="n">isErrorDialogShowing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"></span>
<span class="w">					</span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">msgDisplay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">msg</span><span class="p">.</span><span class="na">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"></span>
<span class="w">							</span><span class="n">Math</span><span class="p">.</span><span class="na">min</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="na">length</span><span class="p">(),</span><span class="w"> </span><span class="mi">1000</span><span class="p">));</span><span class="w"></span>
<span class="w">					</span><span class="c1">// use SwingUtilities to make sure this gets executed in the</span><span class="w"></span>
<span class="w">					</span><span class="c1">// correct</span><span class="w"></span>
<span class="w">					</span><span class="c1">// (=GUI) thread.</span><span class="w"></span>
<span class="w">					</span><span class="n">SwingUtilities</span><span class="p">.</span><span class="na">invokeLater</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">						</span><span class="c1">// TODO investigate why this freezes Firefox</span><span class="w"></span>
<span class="w">						</span><span class="c1">// sometimes</span><span class="w"></span>
<span class="w">						</span><span class="n">JOptionPane</span><span class="p">.</span><span class="na">showConfirmDialog</span><span class="p">(</span><span class="n">mainComp</span><span class="p">,</span><span class="w"> </span><span class="n">msgDisplay</span><span class="p">,</span><span class="w"></span>
<span class="w">								</span><span class="n">GeoGebraConstants</span><span class="p">.</span><span class="na">APPLICATION_NAME</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; - &quot;</span><span class="w"></span>
<span class="w">										</span><span class="o">+</span><span class="w"> </span><span class="n">getLocalization</span><span class="p">()</span><span class="w"></span>
<span class="w">												</span><span class="p">.</span><span class="na">getError</span><span class="p">(</span><span class="s">&quot;Error&quot;</span><span class="p">),</span><span class="w"></span>
<span class="w">								</span><span class="n">JOptionPane</span><span class="p">.</span><span class="na">DEFAULT_OPTION</span><span class="p">,</span><span class="w"></span>
<span class="w">								</span><span class="n">JOptionPane</span><span class="p">.</span><span class="na">WARNING_MESSAGE</span><span class="p">);</span><span class="w"></span>
<span class="w">						</span><span class="n">isErrorDialogShowing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>
<span class="w">					</span><span class="p">});</span><span class="w"></span>

<span class="w">				</span><span class="p">}</span><span class="w"></span>

<span class="w">				</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">				</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">resetError</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">					</span><span class="n">showError</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span><span class="w"></span>
<span class="w">				</span><span class="p">}</span><span class="w"></span>

<span class="w">				</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">				</span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">onUndefinedVariables</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">string</span><span class="p">,</span><span class="w"></span>
<span class="w">						</span><span class="n">AsyncOperation</span><span class="o">&lt;</span><span class="n">String</span><span class="o">[]&gt;</span><span class="w"> </span><span class="n">callback</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">					</span><span class="k">return</span><span class="w"> </span><span class="n">getGuiManager</span><span class="p">().</span><span class="na">checkAutoCreateSliders</span><span class="p">(</span><span class="n">string</span><span class="p">,</span><span class="w"></span>
<span class="w">							</span><span class="n">callback</span><span class="p">);</span><span class="w"></span>
<span class="w">				</span><span class="p">}</span><span class="w"></span>

<span class="w">				</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">				</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">showCommandError</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">command</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">message</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">					</span><span class="c1">// make sure splash screen not showing (will be in front)</span><span class="w"></span>
<span class="w">					</span><span class="n">GeoGebra</span><span class="p">.</span><span class="na">hideSplash</span><span class="p">();</span><span class="w"></span>

<span class="w">					</span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">getLocalization</span><span class="p">().</span><span class="na">getMenu</span><span class="p">(</span><span class="s">&quot;OK&quot;</span><span class="p">),</span><span class="w"></span>
<span class="w">							</span><span class="n">getLocalization</span><span class="p">().</span><span class="na">getMenu</span><span class="p">(</span><span class="s">&quot;ShowOnlineHelp&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
<span class="w">					</span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JOptionPane</span><span class="p">.</span><span class="na">showOptionDialog</span><span class="p">(</span><span class="n">mainComp</span><span class="p">,</span><span class="w"> </span><span class="n">message</span><span class="p">,</span><span class="w"></span>
<span class="w">							</span><span class="n">GeoGebraConstants</span><span class="p">.</span><span class="na">APPLICATION_NAME</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; - &quot;</span><span class="w"></span>
<span class="w">									</span><span class="o">+</span><span class="w"> </span><span class="n">getLocalization</span><span class="p">().</span><span class="na">getError</span><span class="p">(</span><span class="s">&quot;Error&quot;</span><span class="p">),</span><span class="w"></span>
<span class="w">							</span><span class="n">JOptionPane</span><span class="p">.</span><span class="na">YES_NO_OPTION</span><span class="p">,</span><span class="w"></span>
<span class="w">							</span><span class="n">JOptionPane</span><span class="p">.</span><span class="na">QUESTION_MESSAGE</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="c1">// do</span><span class="w"></span>
<span class="w">																</span><span class="c1">// not</span><span class="w"></span>
<span class="w">																</span><span class="c1">// use</span><span class="w"></span>
<span class="w">																</span><span class="c1">// a</span><span class="w"></span>
<span class="w">																</span><span class="c1">// custom</span><span class="w"></span>
<span class="w">																</span><span class="c1">// Icon</span><span class="w"></span>
<span class="w">							</span><span class="n">options</span><span class="p">,</span><span class="w"> </span><span class="c1">// the titles of buttons</span><span class="w"></span>
<span class="w">							</span><span class="n">options</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">);</span><span class="w"> </span><span class="c1">// default button title</span><span class="w"></span>

<span class="w">					</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">						</span><span class="n">getGuiManager</span><span class="p">().</span><span class="na">openCommandHelp</span><span class="p">(</span><span class="n">command</span><span class="p">);</span><span class="w"></span>
<span class="w">					</span><span class="p">}</span><span class="w"></span>

<span class="w">				</span><span class="p">}</span><span class="w"></span>

<span class="w">				</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">				</span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getCurrentCommand</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">					</span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>
<span class="w">				</span><span class="p">}</span><span class="w"></span>

<span class="w">			</span><span class="p">};</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">defaultErrorHandler</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * @return whether there is an open error dialog</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isErrorDialogShowing</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">isErrorDialogShowing</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * @param message message to show in confirm dialog</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">showMessage</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">message</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="c1">// use SwingUtilities to make sure this gets executed in the correct</span><span class="w"></span>
<span class="w">		</span><span class="c1">// (=GUI) thread.</span><span class="w"></span>
<span class="w">		</span><span class="n">SwingUtilities</span><span class="p">.</span><span class="na">invokeLater</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">JOptionPane</span><span class="p">.</span><span class="na">showConfirmDialog</span><span class="p">(</span><span class="n">mainComp</span><span class="p">,</span><span class="w"> </span><span class="n">message</span><span class="p">,</span><span class="w"></span>
<span class="w">				</span><span class="n">GeoGebraConstants</span><span class="p">.</span><span class="na">APPLICATION_NAME</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; - &quot;</span><span class="w"></span>
<span class="w">						</span><span class="o">+</span><span class="w"> </span><span class="n">getLocalization</span><span class="p">().</span><span class="na">getMenu</span><span class="p">(</span><span class="s">&quot;Info&quot;</span><span class="p">),</span><span class="w"></span>
<span class="w">				</span><span class="n">JOptionPane</span><span class="p">.</span><span class="na">DEFAULT_OPTION</span><span class="p">,</span><span class="w"></span>
<span class="w">				</span><span class="n">JOptionPane</span><span class="p">.</span><span class="na">INFORMATION_MESSAGE</span><span class="p">));</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="c1">// **************************************************************************</span><span class="w"></span>
<span class="w">	</span><span class="c1">// SCRIPTING: GgbAPI</span><span class="w"></span>
<span class="w">	</span><span class="c1">// **************************************************************************</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * PluginManager gets API with this H-P Ulven 2008-04-16</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">GgbAPID</span><span class="w"> </span><span class="nf">getGgbApi</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ggbapi</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">ggbapi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">GgbAPID</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">ggbapi</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">ScriptManager</span><span class="w"> </span><span class="nf">newScriptManager</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ScriptManagerD</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="c1">// **************************************************************************</span><span class="w"></span>
<span class="w">	</span><span class="c1">// LOGGING</span><span class="w"></span>
<span class="w">	</span><span class="c1">// **************************************************************************</span><span class="w"></span>

<span class="w">	</span><span class="n">LogManager</span><span class="w"> </span><span class="n">logManager</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="c1">// String logFile = DownloadManager.getTempDir()+&quot;GeoGebraLog.txt&quot;;</span><span class="w"></span>
<span class="w">	</span><span class="c1">// public String logFile = &quot;c:\\GeoGebraLog.txt&quot;;</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">StringBuilder</span><span class="w"> </span><span class="n">logFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="cm">/*</span>
<span class="cm">	 * code from</span>
<span class="cm">	 * http://blogs.sun.com/nickstephen/entry/java_redirecting_system_out_and</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setUpLogging</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">Log</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">&quot;Setting up logging&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Log</span><span class="p">.</span><span class="na">getLogDestination</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">LogDestination</span><span class="p">.</span><span class="na">FILE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="c1">// File logging already set up, don&#39;t override:</span><span class="w"></span>
<span class="w">			</span><span class="n">Log</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="w"></span>
<span class="w">					</span><span class="s">&quot;Logging into explicitly defined file, not using LogManager&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="c1">// initialize logging to go to rolling log file</span><span class="w"></span>
<span class="w">		</span><span class="n">logManager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LogManager</span><span class="p">.</span><span class="na">getLogManager</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="n">logManager</span><span class="p">.</span><span class="na">reset</span><span class="p">();</span><span class="w"></span>

<span class="w">		</span><span class="n">logFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StringBuilder</span><span class="p">(</span><span class="mi">30</span><span class="p">);</span><span class="w"></span>

<span class="w">		</span><span class="n">logFile</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">UtilD</span><span class="p">.</span><span class="na">getTempDir</span><span class="p">());</span><span class="w"></span>
<span class="w">		</span><span class="n">logFile</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">&quot;GeoGebraLog_&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="c1">// randomize filename</span><span class="w"></span>
<span class="w">		</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">logFile</span><span class="p">.</span><span class="na">append</span><span class="p">((</span><span class="kt">char</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="sc">&#39;a&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Math</span><span class="p">.</span><span class="na">round</span><span class="p">(</span><span class="n">Math</span><span class="p">.</span><span class="na">random</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">25</span><span class="p">)));</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="n">logFile</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">&quot;.txt&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">		</span><span class="n">Log</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">&quot;Logging is redirected to &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">logFile</span><span class="p">.</span><span class="na">toString</span><span class="p">());</span><span class="w"></span>
<span class="w">		</span><span class="n">LoggerD</span><span class="p">.</span><span class="na">setTimeShown</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w"> </span><span class="c1">// do not print the time twice</span><span class="w"></span>

<span class="w">		</span><span class="c1">// log file max size 10K, 1 file, append-on-open</span><span class="w"></span>
<span class="w">		</span><span class="n">Handler</span><span class="w"> </span><span class="n">fileHandler</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">fileHandler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FileHandler</span><span class="p">(</span><span class="n">logFile</span><span class="p">.</span><span class="na">toString</span><span class="p">(),</span><span class="w"></span>
<span class="w">					</span><span class="n">Log</span><span class="p">.</span><span class="na">LOGFILE_MAXLENGTH</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">logFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="p">;</span><span class="w"></span>

<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="n">fileHandler</span><span class="p">.</span><span class="na">setFormatter</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">SimpleFormatter</span><span class="p">());</span><span class="w"></span>
<span class="w">		</span><span class="n">Logger</span><span class="p">.</span><span class="na">getLogger</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">).</span><span class="na">addHandler</span><span class="p">(</span><span class="n">fileHandler</span><span class="p">);</span><span class="w"></span>

<span class="w">		</span><span class="c1">// preserve old stdout/stderr streams in case they might be useful</span><span class="w"></span>
<span class="w">		</span><span class="c1">// PrintStream stdout = System.out;</span><span class="w"></span>
<span class="w">		</span><span class="c1">// PrintStream stderr = System.err;</span><span class="w"></span>

<span class="w">		</span><span class="c1">// now rebind stdout/stderr to logger</span><span class="w"></span>
<span class="w">		</span><span class="n">Logger</span><span class="w"> </span><span class="n">logger</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="n">LoggingOutputStream</span><span class="w"> </span><span class="n">los</span><span class="p">;</span><span class="w"></span>

<span class="w">		</span><span class="n">logger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Logger</span><span class="p">.</span><span class="na">getLogger</span><span class="p">(</span><span class="s">&quot;stdout&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="n">los</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingOutputStream</span><span class="p">(</span><span class="n">logger</span><span class="p">,</span><span class="w"> </span><span class="n">StdOutErrLevel</span><span class="p">.</span><span class="na">STDOUT</span><span class="p">);</span><span class="w"></span>

<span class="w">		</span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">System</span><span class="p">.</span><span class="na">setOut</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">PrintStream</span><span class="p">(</span><span class="n">los</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="n">Charsets</span><span class="p">.</span><span class="na">UTF_8</span><span class="p">));</span><span class="w"></span>
<span class="w">			</span><span class="n">logger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Logger</span><span class="p">.</span><span class="na">getLogger</span><span class="p">(</span><span class="s">&quot;stderr&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="n">los</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoggingOutputStream</span><span class="p">(</span><span class="n">logger</span><span class="p">,</span><span class="w"> </span><span class="n">StdOutErrLevel</span><span class="p">.</span><span class="na">STDERR</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="n">System</span><span class="p">.</span><span class="na">setErr</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">PrintStream</span><span class="p">(</span><span class="n">los</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="n">Charsets</span><span class="p">.</span><span class="na">UTF_8</span><span class="p">));</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">UnsupportedEncodingException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="c1">// do nothing</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="c1">// show stdout going to logger</span><span class="w"></span>
<span class="w">		</span><span class="c1">// System.out.println(&quot;Hello world!&quot;);</span><span class="w"></span>

<span class="w">		</span><span class="c1">// now log a message using a normal logger</span><span class="w"></span>
<span class="w">		</span><span class="c1">// logger = Logger.getLogger(&quot;test&quot;);</span><span class="w"></span>
<span class="w">		</span><span class="c1">// logger.info(&quot;This is a test log message&quot;);</span><span class="w"></span>

<span class="w">		</span><span class="c1">// now show stderr stack trace going to logger</span><span class="w"></span>
<span class="w">		</span><span class="c1">// try {</span><span class="w"></span>
<span class="w">		</span><span class="c1">// throw new RuntimeException(&quot;Test&quot;);</span><span class="w"></span>
<span class="w">		</span><span class="c1">// } catch (Exception e) {</span><span class="w"></span>
<span class="w">		</span><span class="c1">// e.printStackTrace();</span><span class="w"></span>
<span class="w">		</span><span class="c1">// }</span><span class="w"></span>

<span class="w">		</span><span class="c1">// and output on the original stdout</span><span class="w"></span>
<span class="w">		</span><span class="c1">// stdout.println(&quot;Hello on old stdout&quot;);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/*</span>
<span class="cm">	 * gets a String from the clipboard</span>
<span class="cm">	 * </span>
<span class="cm">	 * @return null if not possible</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getStringFromClipboard</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">Clipboard</span><span class="w"> </span><span class="n">clipboard</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Toolkit</span><span class="p">.</span><span class="na">getDefaultToolkit</span><span class="p">().</span><span class="na">getSystemClipboard</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="n">Transferable</span><span class="w"> </span><span class="n">contents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">clipboard</span><span class="p">.</span><span class="na">getContents</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="n">String</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">String</span><span class="p">)</span><span class="w"> </span><span class="n">contents</span><span class="p">.</span><span class="na">getTransferData</span><span class="p">(</span><span class="n">DataFlavor</span><span class="p">.</span><span class="na">stringFlavor</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">UnsupportedFlavorException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">contents</span><span class="p">.</span><span class="na">getTransferDataFlavors</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"></span>
<span class="w">					</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">contents</span><span class="p">.</span><span class="na">getTransferDataFlavors</span><span class="p">().</span><span class="na">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">Log</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="n">contents</span><span class="p">.</span><span class="na">getTransferDataFlavors</span><span class="p">()</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">str</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="c1">// **************************************************************************</span><span class="w"></span>
<span class="w">	</span><span class="c1">// SOUNDS</span><span class="w"></span>
<span class="w">	</span><span class="c1">// **************************************************************************</span><span class="w"></span>

<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="n">SoundManagerD</span><span class="w"> </span><span class="n">soundManager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">SoundManagerD</span><span class="w"> </span><span class="nf">getSoundManager</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">soundManager</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">soundManager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SoundManagerD</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">soundManager</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">VideoManager</span><span class="w"> </span><span class="nf">getVideoManager</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="c1">// not implemented here.</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/*</span>
<span class="cm">	 * public void checkCommands(HashMap&lt;String, CommandProcessor&gt; map) {</span>
<span class="cm">	 * initTranslatedCommands();</span>
<span class="cm">	 * </span>
<span class="cm">	 * if (rbcommand == null) { return; // eg applet with no properties jar }</span>
<span class="cm">	 * </span>
<span class="cm">	 * Enumeration&lt;String&gt; e = rbcommand.getKeys(); while (e.hasMoreElements())</span>
<span class="cm">	 * { String s = e.nextElement(); if (!s.contains(syntaxStr) &amp;&amp; (map.get(s)</span>
<span class="cm">	 * == null)) { boolean write = true; try { rbcommand.getString(s +</span>
<span class="cm">	 * syntaxStr); } catch (Exception ex) { write = false; } if (write) { debug(</span>
<span class="cm">	 * &quot;checkCommands: &quot; + s); } } } }</span>
<span class="cm">	 */</span><span class="w"></span>

<span class="w">	</span><span class="n">DrawEquationD</span><span class="w"> </span><span class="n">drawEquation</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">DrawEquationD</span><span class="w"> </span><span class="nf">getDrawEquation</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">drawEquation</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">drawEquation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DrawEquationD</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">drawEquation</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="c1">// random id to identify ggb files</span><span class="w"></span>
<span class="w">	</span><span class="c1">// eg so that GeoGebraTube can notice it&#39;s a version of the same file</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">resetUniqueId</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">uniqueId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">UUID</span><span class="p">.</span><span class="na">randomUUID</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="n">setTubeId</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="c1">// //////////////////////////////////</span><span class="w"></span>
<span class="w">	</span><span class="c1">// FILE VERSION HANDLING</span><span class="w"></span>
<span class="w">	</span><span class="c1">// //////////////////////////////////</span><span class="w"></span>

<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="n">DialogManager</span><span class="w"> </span><span class="n">dialogManager</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">callAppletJavaScript</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="c1">// not needed in desktop</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">showView</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">view</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">getGuiManager</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="n">view</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">App</span><span class="p">.</span><span class="na">VIEW_EUCLIDIAN</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">getGuiManager</span><span class="p">().</span><span class="na">showView</span><span class="p">(</span><span class="n">view</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">evalJavaScript</span><span class="p">(</span><span class="n">App</span><span class="w"> </span><span class="n">app</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">script</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">arg</span><span class="p">)</span><span class="w"></span>
<span class="w">			</span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="p">((</span><span class="n">ScriptManagerD</span><span class="p">)</span><span class="w"> </span><span class="n">getScriptManager</span><span class="p">()).</span><span class="na">evalJavaScript</span><span class="p">(</span><span class="n">app</span><span class="p">,</span><span class="w"> </span><span class="n">script</span><span class="p">,</span><span class="w"> </span><span class="n">arg</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="c1">// TODO: should be moved to ApplicationSettings</span><span class="w"></span>
<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setTooltipTimeout</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">ttt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ttt</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">ToolTipManager</span><span class="p">.</span><span class="na">sharedInstance</span><span class="p">().</span><span class="na">setDismissDelay</span><span class="p">(</span><span class="n">ttt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1000</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="c1">// make it fit into tooltipTimeouts array:</span><span class="w"></span>
<span class="w">			</span><span class="n">ToolTipManager</span><span class="p">.</span><span class="na">sharedInstance</span><span class="p">()</span><span class="w"></span>
<span class="w">					</span><span class="p">.</span><span class="na">setDismissDelay</span><span class="p">(</span><span class="n">getTooltipTimeout</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1000</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">ToolTipManager</span><span class="p">.</span><span class="na">sharedInstance</span><span class="p">().</span><span class="na">setDismissDelay</span><span class="p">(</span><span class="n">Integer</span><span class="p">.</span><span class="na">MAX_VALUE</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="nf">getWidth</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">JPanel</span><span class="w"> </span><span class="n">appCP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getCenterPanel</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">appCP</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">appCP</span><span class="p">.</span><span class="na">getWidth</span><span class="p">()</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="nf">getHeight</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">JPanel</span><span class="w"> </span><span class="n">appCP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getCenterPanel</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">appCP</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">appCP</span><span class="p">.</span><span class="na">getHeight</span><span class="p">()</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">GFont</span><span class="w"> </span><span class="nf">getFontCommon</span><span class="p">(</span><span class="kt">boolean</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">size</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">getFont</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">GFont</span><span class="w"> </span><span class="nf">getBoldFontCommon</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">fontManager</span><span class="p">.</span><span class="na">getBoldFont</span><span class="p">();</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">repaintSpreadsheet</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">getGuiManager</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">getGuiManager</span><span class="p">().</span><span class="na">hasSpreadsheetView</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">getGuiManager</span><span class="p">().</span><span class="na">getSpreadsheetView</span><span class="p">().</span><span class="na">repaintView</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">UndoManagerD</span><span class="w"> </span><span class="nf">getUndoManager</span><span class="p">(</span><span class="n">Construction</span><span class="w"> </span><span class="n">cons</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UndoManagerD</span><span class="p">(</span><span class="n">cons</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">GeoElementGraphicsAdapter</span><span class="w"> </span><span class="nf">newGeoElementGraphicsAdapter</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">GeoElementGraphicsAdapterD</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">SpreadsheetTableModel</span><span class="w"> </span><span class="nf">getSpreadsheetTableModel</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tableModel</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">tableModel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SpreadsheetTableModelD</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">SPREADSHEET_INI_ROWS</span><span class="p">,</span><span class="w"></span>
<span class="w">					</span><span class="n">SPREADSHEET_INI_COLS</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">tableModel</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isRightClick</span><span class="p">(</span><span class="n">AbstractEvent</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">isRightClick</span><span class="p">(</span><span class="n">MouseEventD</span><span class="p">.</span><span class="na">getEvent</span><span class="p">(</span><span class="n">e</span><span class="p">));</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isControlDown</span><span class="p">(</span><span class="n">AbstractEvent</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">isControlDown</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">isMetaDown</span><span class="p">(),</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">isControlDown</span><span class="p">());</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isMiddleClick</span><span class="p">(</span><span class="n">AbstractEvent</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">isMiddleClick</span><span class="p">((</span><span class="n">MouseEventND</span><span class="p">)</span><span class="w"> </span><span class="n">e</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">Font</span><span class="w"> </span><span class="nf">getFontCanDisplayAwt</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">plain</span><span class="p">,</span><span class="w"></span>
<span class="w">			</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="p">((</span><span class="n">GFontD</span><span class="p">)</span><span class="w"> </span><span class="n">getFontManager</span><span class="p">().</span><span class="na">getFontCanDisplay</span><span class="p">(</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">plain</span><span class="p">,</span><span class="w"></span>
<span class="w">				</span><span class="n">i</span><span class="p">)).</span><span class="na">getAwtFont</span><span class="p">();</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">Font</span><span class="w"> </span><span class="nf">getFontCanDisplayAwt</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">GFontD</span><span class="p">.</span><span class="na">getAwtFont</span><span class="p">(</span><span class="n">getFontCanDisplay</span><span class="p">(</span><span class="n">string</span><span class="p">));</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">Font</span><span class="w"> </span><span class="nf">getFontCanDisplayAwt</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">plain</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="kt">int</span><span class="w"> </span><span class="n">fontSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">settings</span><span class="p">.</span><span class="na">getFontSettings</span><span class="p">().</span><span class="na">getAppFontSize</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="n">GFont</span><span class="w"> </span><span class="n">font</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getFontCreator</span><span class="p">().</span><span class="na">newSansSerifFont</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">plain</span><span class="p">,</span><span class="w"> </span><span class="n">fontSize</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">GFontD</span><span class="p">.</span><span class="na">getAwtFont</span><span class="p">(</span><span class="n">font</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isMacOS</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">MAC_OS</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isWindows</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">WINDOWS</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/*</span>
<span class="cm">	 * current possible values http://mindprod.com/jgloss/properties.html AIX</span>
<span class="cm">	 * Digital Unix FreeBSD HP UX Irix Linux Mac OS Mac OS X MPE/iX Netware 4.11</span>
<span class="cm">	 * OS/2 Solaris Windows 2000 Windows 7 Windows 95 Windows 98 Windows NT</span>
<span class="cm">	 * Windows Vista Windows XP</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">OS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StringUtil</span><span class="w"></span>
<span class="w">			</span><span class="p">.</span><span class="na">toLowerCaseUS</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">getProperty</span><span class="p">(</span><span class="s">&quot;os.name&quot;</span><span class="p">));</span><span class="w"></span>
<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">VERSION</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StringUtil</span><span class="w"></span>
<span class="w">			</span><span class="p">.</span><span class="na">toLowerCaseUS</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">getProperty</span><span class="p">(</span><span class="s">&quot;os.version&quot;</span><span class="p">));</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">MAC_OS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OS</span><span class="p">.</span><span class="na">startsWith</span><span class="p">(</span><span class="s">&quot;mac&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">WINDOWS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OS</span><span class="p">.</span><span class="na">startsWith</span><span class="p">(</span><span class="s">&quot;windows&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">LINUX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OS</span><span class="p">.</span><span class="na">startsWith</span><span class="p">(</span><span class="s">&quot;linux&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">	</span><span class="c1">// make sure still works in the future on eg Windows 10/11</span><span class="w"></span>
<span class="w">	</span><span class="c1">// note Java 7u40 returns &quot;Windows 8&quot; for Windows 8.1 and Windows 10</span><span class="w"></span>
<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">WINDOWS_XP_OR_EARLIER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OS</span><span class="w"></span>
<span class="w">			</span><span class="p">.</span><span class="na">startsWith</span><span class="p">(</span><span class="s">&quot;windows 2000&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">OS</span><span class="p">.</span><span class="na">startsWith</span><span class="p">(</span><span class="s">&quot;windows 95&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">			</span><span class="o">||</span><span class="w"> </span><span class="n">OS</span><span class="p">.</span><span class="na">startsWith</span><span class="p">(</span><span class="s">&quot;windows 98&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">OS</span><span class="p">.</span><span class="na">startsWith</span><span class="p">(</span><span class="s">&quot;windows nt&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">			</span><span class="o">||</span><span class="w"> </span><span class="n">OS</span><span class="p">.</span><span class="na">startsWith</span><span class="p">(</span><span class="s">&quot;windows xp&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">WINDOWS_VISTA_OR_LATER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WINDOWS</span><span class="w"></span>
<span class="w">			</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">WINDOWS_XP_OR_EARLIER</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">WINDOWS_VISTA_OR_EARLIER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WINDOWS_XP_OR_EARLIER</span><span class="w"></span>
<span class="w">			</span><span class="o">||</span><span class="w"> </span><span class="n">OS</span><span class="p">.</span><span class="na">startsWith</span><span class="p">(</span><span class="s">&quot;windows vista&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * @return true if running on Mac OS Big Sur or later versions.</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isMacOsBigSurOrLater</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">MAC_OS</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="kt">double</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Double</span><span class="p">.</span><span class="na">parseDouble</span><span class="p">(</span><span class="n">VERSION</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">10.15</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">NumberFormatException</span><span class="w"> </span><span class="n">exception</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isHTML5Applet</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">DialogManagerMinimal</span><span class="w"> </span><span class="nf">getDialogManager</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">dialogManager</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">getGuiManager</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">dialogManager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DialogManagerMinimal</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">dialogManager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getGuiManager</span><span class="p">().</span><span class="na">getDialogManager</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">DialogManagerMinimal</span><span class="p">)</span><span class="w"> </span><span class="n">dialogManager</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">showURLinBrowser</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">strURL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">getGuiManager</span><span class="p">().</span><span class="na">showURLinBrowser</span><span class="p">(</span><span class="n">strURL</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">uploadToGeoGebraTube</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">GeoGebraTubeExportD</span><span class="w"> </span><span class="n">ggbtube</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">GeoGebraTubeExportD</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="n">ggbtube</span><span class="p">.</span><span class="na">uploadWorksheet</span><span class="p">();</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">LowerCaseDictionary</span><span class="w"> </span><span class="nf">newLowerCaseDictionary</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LowerCaseDictionary</span><span class="p">(</span><span class="n">Normalizer</span><span class="p">.</span><span class="na">getInstance</span><span class="p">());</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">CommandLineArguments</span><span class="w"> </span><span class="nf">getCommandLineArgs</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">cmdArgs</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * </span>
<span class="cm">	 * @return Left/Right as appropriate for eg Hebrew / Arabic</span>
<span class="cm">	 * </span>
<span class="cm">	 * return int rather than FlowLayout.LEFT so we&#39;re not dependent on awt</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">flowLeft</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">getLocalization</span><span class="p">().</span><span class="na">isRightToLeftReadingOrder</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// left</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="c1">// right</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * </span>
<span class="cm">	 * @return Left/Right as appropriate for eg Hebrew / Arabic</span>
<span class="cm">	 * </span>
<span class="cm">	 * return int rather than FlowLayout.RIGHT so we&#39;re not dependent on awt</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">flowRight</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">getLocalization</span><span class="p">().</span><span class="na">isRightToLeftReadingOrder</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// left</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="c1">// right</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * @param c</span>
<span class="cm">	 *            component calling for repaint</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">repaintEuclidianViews</span><span class="p">(</span><span class="n">Component</span><span class="w"> </span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">		</span><span class="n">ComponentEvent</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ComponentEvent</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="w"></span>
<span class="w">				</span><span class="n">ComponentEvent</span><span class="p">.</span><span class="na">COMPONENT_RESIZED</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="n">getEuclidianView1</span><span class="p">().</span><span class="na">dispatchEvent</span><span class="p">(</span><span class="n">event</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="n">getEuclidianView2</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="na">dispatchEvent</span><span class="p">(</span><span class="n">event</span><span class="p">);</span><span class="w"></span>

<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * </span>
<span class="cm">	 * @return eg Java 1.7.0_03-64bit</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getJavaVersion</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">appendJavaVersion</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">StringBuilder</span><span class="p">(</span><span class="mi">19</span><span class="p">)).</span><span class="na">toString</span><span class="p">();</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * </span>
<span class="cm">	 * @param sb</span>
<span class="cm">	 *            StringBuilder</span>
<span class="cm">	 * @return StringBuilder with eg &quot;Java 1.7.0_03-64bit&quot; added</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">StringBuilder</span><span class="w"> </span><span class="nf">appendJavaVersion</span><span class="p">(</span><span class="n">StringBuilder</span><span class="w"> </span><span class="n">sb</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">sb</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">getProperty</span><span class="p">(</span><span class="s">&quot;java.version&quot;</span><span class="p">));</span><span class="w"></span>

<span class="w">		</span><span class="n">String</span><span class="w"> </span><span class="n">arch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">getProperty</span><span class="p">(</span><span class="s">&quot;os.arch&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">arch</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">arch</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="n">sb</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="n">sb</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="sc">&#39;-&#39;</span><span class="p">);</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;x86&quot;</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">arch</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s">&quot;ppc&quot;</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">arch</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s">&quot;i386&quot;</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">arch</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">sb</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">&quot;32bit&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;amd64&quot;</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">arch</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s">&quot;x86_64&quot;</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">arch</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">sb</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">&quot;64bit&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">sb</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">arch</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">sb</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">NormalizerMinimal</span><span class="w"> </span><span class="nf">getNormalizer</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">Normalizer</span><span class="p">.</span><span class="na">getInstance</span><span class="p">();</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">runScripts</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">GeoElement</span><span class="w"> </span><span class="n">geo1</span><span class="p">,</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">SwingUtilities</span><span class="p">.</span><span class="na">invokeLater</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">geo1</span><span class="p">.</span><span class="na">runClickScripts</span><span class="p">(</span><span class="n">string</span><span class="p">));</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">CASFactory</span><span class="w"> </span><span class="nf">getCASFactory</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">CASFactory</span><span class="w"> </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CASFactory</span><span class="p">.</span><span class="na">getPrototype</span><span class="p">();</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">CASFactory</span><span class="p">.</span><span class="na">isInitialized</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CASFactoryD</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="n">CASFactory</span><span class="p">.</span><span class="na">setPrototype</span><span class="p">(</span><span class="n">ret</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">Factory</span><span class="w"> </span><span class="nf">getFactory</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">Factory</span><span class="w"> </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Factory</span><span class="p">.</span><span class="na">getPrototype</span><span class="p">();</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FactoryD</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="n">Factory</span><span class="p">.</span><span class="na">setPrototype</span><span class="p">(</span><span class="n">ret</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="c1">// **************************************************************************</span><span class="w"></span>
<span class="w">	</span><span class="c1">// COMPONENT ORIENTATION</span><span class="w"></span>
<span class="w">	</span><span class="c1">// **************************************************************************</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">ComponentOrientation</span><span class="w"> </span><span class="nf">getComponentOrientation</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">getLocalization</span><span class="p">().</span><span class="na">isRightToLeftReadingOrder</span><span class="p">()</span><span class="w"></span>
<span class="w">				</span><span class="o">?</span><span class="w"> </span><span class="n">ComponentOrientation</span><span class="p">.</span><span class="na">RIGHT_TO_LEFT</span><span class="w"></span>
<span class="w">				</span><span class="p">:</span><span class="w"> </span><span class="n">ComponentOrientation</span><span class="p">.</span><span class="na">LEFT_TO_RIGHT</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@SuppressWarnings</span><span class="p">({</span><span class="w"> </span><span class="s">&quot;rawtypes&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;unchecked&quot;</span><span class="w"> </span><span class="p">})</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setComponentOrientation</span><span class="p">(</span><span class="n">Component</span><span class="w"> </span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="kt">boolean</span><span class="w"> </span><span class="n">rtl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getLocalization</span><span class="p">().</span><span class="na">isRightToLeftReadingOrder</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="n">ComponentOrientation</span><span class="w"> </span><span class="n">orientation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rtl</span><span class="w"></span>
<span class="w">				</span><span class="o">?</span><span class="w"> </span><span class="n">ComponentOrientation</span><span class="p">.</span><span class="na">RIGHT_TO_LEFT</span><span class="w"></span>
<span class="w">				</span><span class="p">:</span><span class="w"> </span><span class="n">ComponentOrientation</span><span class="p">.</span><span class="na">LEFT_TO_RIGHT</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="n">c</span><span class="p">.</span><span class="na">setComponentOrientation</span><span class="p">(</span><span class="n">orientation</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="c1">// c.applyComponentOrientation(orientation);</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">JMenu</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">JMenu</span><span class="w"> </span><span class="n">menu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">JMenu</span><span class="p">)</span><span class="w"> </span><span class="n">c</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="kt">int</span><span class="w"> </span><span class="n">ncomponents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">menu</span><span class="p">.</span><span class="na">getMenuComponentCount</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">ncomponents</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">setComponentOrientation</span><span class="p">(</span><span class="n">menu</span><span class="p">.</span><span class="na">getMenuComponent</span><span class="p">(</span><span class="n">i</span><span class="p">));</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">JTextField</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="p">((</span><span class="n">JTextField</span><span class="p">)</span><span class="w"> </span><span class="n">c</span><span class="p">).</span><span class="na">setHorizontalAlignment</span><span class="p">(</span><span class="w"></span>
<span class="w">					</span><span class="n">rtl</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">SwingConstants</span><span class="p">.</span><span class="na">RIGHT</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">SwingConstants</span><span class="p">.</span><span class="na">LEFT</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">JComboBox</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">JComboBox</span><span class="w"> </span><span class="n">cb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">JComboBox</span><span class="p">)</span><span class="w"> </span><span class="n">c</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="n">ListCellRenderer</span><span class="w"> </span><span class="n">renderer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cb</span><span class="p">.</span><span class="na">getRenderer</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">renderer</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">DashListRenderer</span><span class="w"></span>
<span class="w">					</span><span class="o">||</span><span class="w"> </span><span class="n">renderer</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">DecorationListRenderer</span><span class="w"></span>
<span class="w">					</span><span class="o">||</span><span class="w"> </span><span class="n">renderer</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">AxesStyleListRenderer</span><span class="w"></span>
<span class="w">					</span><span class="o">||</span><span class="w"> </span><span class="n">renderer</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">PointStyleListRenderer</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="c1">// if we didn&#39;t load GUI yet, assume there is no tool creation</span><span class="w"></span>
<span class="w">				</span><span class="c1">// dialog</span><span class="w"></span>
<span class="w">				</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">getGuiManager</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"></span>
<span class="w">						</span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="n">getGuiManager</span><span class="p">().</span><span class="na">belongsToToolCreator</span><span class="p">(</span><span class="n">renderer</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">					</span><span class="n">renderer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DefaultListCellRenderer</span><span class="p">();</span><span class="w"></span>
<span class="w">					</span><span class="n">cb</span><span class="p">.</span><span class="na">setRenderer</span><span class="p">(</span><span class="n">renderer</span><span class="p">);</span><span class="w"></span>
<span class="w">				</span><span class="p">}</span><span class="w"></span>
<span class="w">				</span><span class="p">((</span><span class="n">JLabel</span><span class="p">)</span><span class="w"> </span><span class="n">renderer</span><span class="p">).</span><span class="na">setHorizontalAlignment</span><span class="p">(</span><span class="w"></span>
<span class="w">						</span><span class="n">rtl</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">SwingConstants</span><span class="p">.</span><span class="na">RIGHT</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">SwingConstants</span><span class="p">.</span><span class="na">LEFT</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">Container</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">Container</span><span class="w"> </span><span class="n">container</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Container</span><span class="p">)</span><span class="w"> </span><span class="n">c</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="kt">int</span><span class="w"> </span><span class="n">ncomponents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">container</span><span class="p">.</span><span class="na">getComponentCount</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">ncomponents</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">setComponentOrientation</span><span class="p">(</span><span class="n">container</span><span class="p">.</span><span class="na">getComponent</span><span class="p">(</span><span class="n">i</span><span class="p">));</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * set a flow layout for the panel with correct orientation</span>
<span class="cm">	 * </span>
<span class="cm">	 * @param panel panel</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setFlowLayoutOrientation</span><span class="p">(</span><span class="n">JPanel</span><span class="w"> </span><span class="n">panel</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">getLocalization</span><span class="p">().</span><span class="na">isRightToLeftReadingOrder</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">panel</span><span class="p">.</span><span class="na">setLayout</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">FlowLayout</span><span class="p">(</span><span class="n">FlowLayout</span><span class="p">.</span><span class="na">RIGHT</span><span class="p">));</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">panel</span><span class="p">.</span><span class="na">setLayout</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">FlowLayout</span><span class="p">(</span><span class="n">FlowLayout</span><span class="p">.</span><span class="na">LEFT</span><span class="p">));</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="c1">// **************************************************************************</span><span class="w"></span>
<span class="w">	</span><span class="c1">// ConstructionProtocol</span><span class="w"></span>
<span class="w">	</span><span class="c1">// **************************************************************************</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">exportAnimatedGIF</span><span class="p">(</span><span class="n">EuclidianView</span><span class="w"> </span><span class="n">ev</span><span class="p">,</span><span class="w"> </span><span class="n">FrameCollector</span><span class="w"> </span><span class="n">gifEncoder</span><span class="p">,</span><span class="w"></span>
<span class="w">			</span><span class="n">AnimationExportSlider</span><span class="w"> </span><span class="n">num</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">initVal</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">min</span><span class="p">,</span><span class="w"></span>
<span class="w">			</span><span class="kt">double</span><span class="w"> </span><span class="n">max</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">stepSize</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="kt">double</span><span class="w"> </span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">initVal</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="kt">double</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stepSize</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">			</span><span class="c1">// avoid values like 14.399999999999968</span><span class="w"></span>
<span class="w">			</span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DoubleUtil</span><span class="p">.</span><span class="na">checkDecimalFraction</span><span class="p">(</span><span class="n">val</span><span class="p">);</span><span class="w"></span>

<span class="w">			</span><span class="n">num</span><span class="p">.</span><span class="na">setValue</span><span class="p">(</span><span class="n">val</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="n">num</span><span class="p">.</span><span class="na">updateRepaint</span><span class="p">();</span><span class="w"></span>

<span class="w">			</span><span class="n">BufferedImage</span><span class="w"> </span><span class="n">img</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GBufferedImageD</span><span class="p">.</span><span class="na">getAwtBufferedImage</span><span class="p">(</span><span class="w"></span>
<span class="w">					</span><span class="n">ev</span><span class="p">.</span><span class="na">getExportImage</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">img</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">Log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&quot;image null&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">gifEncoder</span><span class="p">.</span><span class="na">addFrame</span><span class="p">(</span><span class="n">img</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>

<span class="w">			</span><span class="n">val</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">step</span><span class="p">;</span><span class="w"></span>

<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">val</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">max</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Kernel</span><span class="p">.</span><span class="na">STANDARD_PRECISION</span><span class="w"></span>
<span class="w">					</span><span class="o">||</span><span class="w"> </span><span class="n">val</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">min</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Kernel</span><span class="p">.</span><span class="na">STANDARD_PRECISION</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">val</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">step</span><span class="p">;</span><span class="w"></span>
<span class="w">				</span><span class="n">step</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="n">gifEncoder</span><span class="p">.</span><span class="na">finish</span><span class="p">();</span><span class="w"></span>

<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">LocalizationD</span><span class="w"> </span><span class="nf">getLocalization</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">loc</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * Initializes the sign in Operation and tries to login in the user with the</span>
<span class="cm">	 * stored token</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">initSignInEventFlow</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="c1">// Inizialize the login operation</span><span class="w"></span>
<span class="w">		</span><span class="n">loginOperation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LoginOperationD</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w"></span>

<span class="w">		</span><span class="c1">// Try to login the stored user</span><span class="w"></span>
<span class="w">		</span><span class="n">loginOperation</span><span class="p">.</span><span class="na">performTokenLogin</span><span class="p">();</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">CommandDispatcher</span><span class="w"> </span><span class="nf">newCommandDispatcher</span><span class="p">(</span><span class="n">Kernel</span><span class="w"> </span><span class="n">kernel</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CommandDispatcherJre</span><span class="p">(</span><span class="n">kernel</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">CommandDispatcher3D</span><span class="w"> </span><span class="nf">newCommand3DDispatcher</span><span class="p">(</span><span class="n">Kernel</span><span class="w"> </span><span class="n">kernel</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CommandDispatcher3DJre</span><span class="p">(</span><span class="n">kernel</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * only for 3D so thumbnail can be generated. Overridden in App3D</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">uploadToGeoGebraTubeOnCallback</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">		</span><span class="n">uploadToGeoGebraTube</span><span class="p">();</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">set1rstMode</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">setMode</span><span class="p">(((</span><span class="n">GuiManagerD</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">getGuiManager</span><span class="p">()).</span><span class="na">getToolbarPanel</span><span class="p">()</span><span class="w"></span>
<span class="w">				</span><span class="p">.</span><span class="na">getFirstToolbar</span><span class="p">().</span><span class="na">getFirstMode</span><span class="p">());</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * @param file file to insert</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">final</span><span class="w"> </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">insertFile</span><span class="p">(</span><span class="n">File</span><span class="w"> </span><span class="n">file</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">		</span><span class="c1">// using code from newWindowAction, combined with</span><span class="w"></span>
<span class="w">		</span><span class="c1">// Michael&#39;s suggestion</span><span class="w"></span>
<span class="w">		</span><span class="n">AppD</span><span class="w"> </span><span class="n">ad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newAppForTemplateOrInsertFile</span><span class="p">();</span><span class="w"></span>

<span class="w">		</span><span class="c1">// now, we have to load the file into AppD</span><span class="w"></span>
<span class="w">		</span><span class="n">ad</span><span class="p">.</span><span class="na">getGuiManager</span><span class="p">().</span><span class="na">loadFile</span><span class="p">(</span><span class="n">file</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span><span class="w"></span>

<span class="w">		</span><span class="c1">// now we have to copy the macros from ad to app</span><span class="w"></span>
<span class="w">		</span><span class="c1">// in order to make some advanced constructions work</span><span class="w"></span>
<span class="w">		</span><span class="c1">// as it was hard to copy macro classes, let&#39;s use</span><span class="w"></span>
<span class="w">		</span><span class="c1">// strings, but how to load them into the application?</span><span class="w"></span>
<span class="w">		</span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">getXMLio</span><span class="p">().</span><span class="na">processXMLString</span><span class="p">(</span><span class="n">ad</span><span class="p">.</span><span class="na">getAllMacrosXML</span><span class="p">(),</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span><span class="w"></span>

<span class="w">			</span><span class="c1">// alternative solution</span><span class="w"></span>
<span class="w">			</span><span class="c1">// app.addMacroXML(ad.getKernel().getMacroXML(</span><span class="w"></span>
<span class="w">			</span><span class="c1">// ad.getKernel().getAllMacros()));</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">ex</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">Log</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">&quot;Could not load any macros at \&quot;Insert File\&quot;&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="n">ex</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="c1">// afterwards, the file is loaded into &quot;ad&quot; in theory,</span><span class="w"></span>
<span class="w">		</span><span class="c1">// so we have to use the CopyPaste class to copy it</span><span class="w"></span>

<span class="w">		</span><span class="n">getCopyPaste</span><span class="p">()</span><span class="w"></span>
<span class="w">				</span><span class="p">.</span><span class="na">copyToXML</span><span class="p">(</span><span class="n">ad</span><span class="p">,</span><span class="w"></span>
<span class="w">						</span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">ad</span><span class="p">.</span><span class="na">getKernel</span><span class="p">()</span><span class="w"></span>
<span class="w">				</span><span class="p">.</span><span class="na">getConstruction</span><span class="p">().</span><span class="na">getGeoSetWithCasCellsConstructionOrder</span><span class="p">()),</span><span class="w"></span>
<span class="w">				</span><span class="kc">true</span><span class="p">);</span><span class="w"></span>

<span class="w">		</span><span class="c1">// and paste</span><span class="w"></span>
<span class="w">		</span><span class="n">getCopyPaste</span><span class="p">().</span><span class="na">pasteFromXML</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span><span class="w"></span>

<span class="w">		</span><span class="c1">// forgotten something important!</span><span class="w"></span>
<span class="w">		</span><span class="c1">// ad should be closed!</span><span class="w"></span>
<span class="w">		</span><span class="n">ad</span><span class="p">.</span><span class="na">exit</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="c1">// this is also needed to make it possible</span><span class="w"></span>
<span class="w">		</span><span class="c1">// to load the same file once again</span><span class="w"></span>
<span class="w">		</span><span class="n">ad</span><span class="p">.</span><span class="na">getFrame</span><span class="p">().</span><span class="na">dispose</span><span class="p">();</span><span class="w"></span>

<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">protected</span><span class="w"> </span><span class="n">AppD</span><span class="w"> </span><span class="nf">newAppForTemplateOrInsertFile</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AppD</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">CommandLineArguments</span><span class="p">(</span><span class="kc">null</span><span class="p">),</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JPanel</span><span class="p">(),</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * @param file template file</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">final</span><span class="w"> </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">applyTemplate</span><span class="p">(</span><span class="n">File</span><span class="w"> </span><span class="n">file</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">		</span><span class="c1">// using code from newWindowAction, combined with</span><span class="w"></span>
<span class="w">		</span><span class="c1">// Michael&#39;s suggestion</span><span class="w"></span>
<span class="w">		</span><span class="c1">// true as undo info is necessary for copy-paste!</span><span class="w"></span>
<span class="w">		</span><span class="n">AppD</span><span class="w"> </span><span class="n">ad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newAppForTemplateOrInsertFile</span><span class="p">();</span><span class="w"></span>

<span class="w">		</span><span class="c1">// now, we have to load the file into AppD</span><span class="w"></span>
<span class="w">		</span><span class="n">ad</span><span class="p">.</span><span class="na">loadFile</span><span class="p">(</span><span class="n">file</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span><span class="w"></span>

<span class="w">		</span><span class="k">new</span><span class="w"> </span><span class="n">TemplateHelper</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="na">applyTemplate</span><span class="p">(</span><span class="n">ad</span><span class="p">);</span><span class="w"></span>

<span class="w">		</span><span class="c1">// almost forgotten something important!</span><span class="w"></span>
<span class="w">		</span><span class="c1">// ad should be closed!</span><span class="w"></span>
<span class="w">		</span><span class="n">ad</span><span class="p">.</span><span class="na">exit</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="c1">// this is also needed to make it possible</span><span class="w"></span>
<span class="w">		</span><span class="c1">// to load the same style file once again</span><span class="w"></span>
<span class="w">		</span><span class="n">ad</span><span class="p">.</span><span class="na">getFrame</span><span class="p">().</span><span class="na">dispose</span><span class="p">();</span><span class="w"></span>

<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">popupsDone</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">showPopUps</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">LoginOperationD</span><span class="w"> </span><span class="n">signIn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">LoginOperationD</span><span class="p">)</span><span class="w"> </span><span class="n">getLoginOperation</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">signIn</span><span class="p">.</span><span class="na">isTubeCheckDone</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isAllowPopups</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">			</span><span class="c1">// Show login popup</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">popupsDone</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">popupsDone</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"></span>

<span class="w">				</span><span class="n">EventQueue</span><span class="p">.</span><span class="na">invokeLater</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">					</span><span class="kt">boolean</span><span class="w"> </span><span class="n">showDockPopup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"></span>

<span class="w">					</span><span class="n">LoginOperationD</span><span class="w"> </span><span class="n">signInOp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">LoginOperationD</span><span class="p">)</span><span class="w"> </span><span class="n">getLoginOperation</span><span class="p">();</span><span class="w"></span>
<span class="w">					</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">signInOp</span><span class="p">.</span><span class="na">isTubeAvailable</span><span class="p">()</span><span class="w"></span>
<span class="w">							</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">signInOp</span><span class="p">.</span><span class="na">isLoggedIn</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">						</span><span class="n">showDockPopup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">showTubeLogin</span><span class="p">();</span><span class="w"></span>
<span class="w">					</span><span class="p">}</span><span class="w"></span>

<span class="w">					</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">showDockPopup</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">isShowDockBar</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">						</span><span class="n">showPerspectivePopup</span><span class="p">();</span><span class="w"></span>
<span class="w">					</span><span class="p">}</span><span class="w"></span>
<span class="w">				</span><span class="p">});</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">protected</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">showTubeLogin</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="c1">// for debugging only</span><span class="w"></span>
<span class="w">		</span><span class="c1">// force sign-in popup if not logged in</span><span class="w"></span>
<span class="w">		</span><span class="c1">// GeoGebraPreferencesD.getPref().savePreference(</span><span class="w"></span>
<span class="w">		</span><span class="c1">// GeoGebraPreferencesD.USER_LOGIN_SKIP,</span><span class="w"></span>
<span class="w">		</span><span class="c1">// &quot;false&quot;);</span><span class="w"></span>

<span class="w">		</span><span class="kt">boolean</span><span class="w"> </span><span class="n">showDockPopup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"></span>

<span class="w">		</span><span class="n">String</span><span class="w"> </span><span class="n">skipLogin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GeoGebraPreferencesD</span><span class="p">.</span><span class="na">getPref</span><span class="p">()</span><span class="w"></span>
<span class="w">				</span><span class="p">.</span><span class="na">loadPreference</span><span class="p">(</span><span class="n">GeoGebraPreferencesD</span><span class="p">.</span><span class="na">USER_LOGIN_SKIP</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;false&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="s">&quot;true&quot;</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">skipLogin</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">showDockPopup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>
<span class="w">			</span><span class="n">GeoGebraPreferencesD</span><span class="p">.</span><span class="na">getPref</span><span class="p">().</span><span class="na">savePreference</span><span class="p">(</span><span class="w"></span>
<span class="w">					</span><span class="n">GeoGebraPreferencesD</span><span class="p">.</span><span class="na">USER_LOGIN_SKIP</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;true&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">			</span><span class="n">getGuiManager</span><span class="p">().</span><span class="na">login</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">showDockPopup</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">showPerspectivePopup</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">getDockBar</span><span class="p">().</span><span class="na">showPopup</span><span class="p">();</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * resume 3D openGL renderer</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">resume3DRenderer</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="c1">// used in 3D</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">showCustomizeToolbarGUI</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">getDialogManager</span><span class="p">().</span><span class="na">showToolbarConfigDialog</span><span class="p">();</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isSelectionRectangleAllowed</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">ImageIcon</span><span class="w"> </span><span class="nf">getMenuIcon</span><span class="p">(</span><span class="n">ImageResourceD</span><span class="w"> </span><span class="n">res</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isMacOS</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="c1">// fixed-size, 16x16 icons for mac menu</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="n">getScaledIcon</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">getScaledIcon</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">Image</span><span class="w"> </span><span class="nf">getMenuInternalImage</span><span class="p">(</span><span class="n">ImageResourceD</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isMacOS</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="c1">// no scaling for mac menu</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="n">getInternalImage</span><span class="p">(</span><span class="n">name</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">getScaledInternalImage</span><span class="p">(</span><span class="n">name</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">needThumbnailFor3D</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="c1">// nothing to do here</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">useHugeGuiForInput3D</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * huge size for undo/redo/etc. buttons when huge GUI is needed for some 3D</span>
<span class="cm">	 * inputs</span>
<span class="cm">	 * </span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">HUGE_UNDO_BUTTON_SIZE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">36</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">closePopups</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="c1">// TODO Auto-generated method stub</span><span class="w"></span>

<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">GTimer</span><span class="w"> </span><span class="nf">newTimer</span><span class="p">(</span><span class="n">GTimerListener</span><span class="w"> </span><span class="n">listener</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">delay</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">GTimerD</span><span class="p">(</span><span class="n">listener</span><span class="p">,</span><span class="w"> </span><span class="n">delay</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">ScheduledExecutorService</span><span class="w"> </span><span class="n">scheduler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Executors</span><span class="w"></span>
<span class="w">			</span><span class="p">.</span><span class="na">newScheduledThreadPool</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>

<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="n">ScheduledFuture</span><span class="o">&lt;?&gt;</span><span class="w"> </span><span class="n">handler</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="n">PrintPreviewD</span><span class="w"> </span><span class="n">printPreview</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="n">OptionsMenuController</span><span class="w"> </span><span class="n">optionsMenu</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">volatile</span><span class="w"> </span><span class="n">MessageDigest</span><span class="w"> </span><span class="n">md5EncrypterD</span><span class="p">;</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">schedulePreview</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">Runnable</span><span class="w"> </span><span class="n">scheduledPreview</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">		</span><span class="n">cancelPreview</span><span class="p">();</span><span class="w"></span>

<span class="w">		</span><span class="n">Runnable</span><span class="w"> </span><span class="n">threadSafeCallback</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">SwingUtilities</span><span class="p">.</span><span class="na">invokeLater</span><span class="p">(</span><span class="n">scheduledPreview</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="n">handler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scheduler</span><span class="p">.</span><span class="na">schedule</span><span class="p">(</span><span class="n">threadSafeCallback</span><span class="p">,</span><span class="w"></span>
<span class="w">				</span><span class="n">SCHEDULE_PREVIEW_DELAY_IN_MILLISECONDS</span><span class="p">,</span><span class="w"> </span><span class="n">TimeUnit</span><span class="p">.</span><span class="na">MILLISECONDS</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">cancelPreview</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">handler</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">handler</span><span class="p">.</span><span class="na">cancel</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">GuiManagerD</span><span class="w"> </span><span class="nf">getGuiManager</span><span class="p">(</span><span class="n">AppD</span><span class="w"> </span><span class="n">app</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">GuiManagerD</span><span class="p">)</span><span class="w"> </span><span class="n">app</span><span class="p">.</span><span class="na">getGuiManager</span><span class="p">();</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">initToolbar</span><span class="p">(</span><span class="n">AppD</span><span class="w"> </span><span class="n">app</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">toolbarPosition</span><span class="p">,</span><span class="w"></span>
<span class="w">			</span><span class="kt">boolean</span><span class="w"> </span><span class="n">showToolBarHelp</span><span class="p">,</span><span class="w"> </span><span class="n">JPanel</span><span class="w"> </span><span class="n">northPanel</span><span class="p">,</span><span class="w"> </span><span class="n">JPanel</span><span class="w"> </span><span class="n">eastPanel</span><span class="p">,</span><span class="w"></span>
<span class="w">			</span><span class="n">JPanel</span><span class="w"> </span><span class="n">southPanel</span><span class="p">,</span><span class="w"> </span><span class="n">JPanel</span><span class="w"> </span><span class="n">westPanel</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">		</span><span class="n">GuiManagerD</span><span class="w"> </span><span class="n">guiManager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getGuiManager</span><span class="p">(</span><span class="n">app</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="n">LocalizationD</span><span class="w"> </span><span class="n">loc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">app</span><span class="p">.</span><span class="na">getLocalization</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="c1">// initialize toolbar panel even if it&#39;s not used (hack)</span><span class="w"></span>
<span class="w">		</span><span class="n">guiManager</span><span class="p">.</span><span class="na">getToolbarPanelContainer</span><span class="p">();</span><span class="w"></span>

<span class="w">		</span><span class="n">ToolbarContainer</span><span class="w"> </span><span class="n">toolBarContainer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ToolbarContainer</span><span class="p">)</span><span class="w"> </span><span class="n">guiManager</span><span class="w"></span>
<span class="w">				</span><span class="p">.</span><span class="na">getToolbarPanelContainer</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="n">JComponent</span><span class="w"> </span><span class="n">helpPanel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">toolBarContainer</span><span class="p">.</span><span class="na">getToolbarHelpPanel</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="n">toolBarContainer</span><span class="p">.</span><span class="na">setOrientation</span><span class="p">(</span><span class="n">toolbarPosition</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="n">ToolbarContainer</span><span class="p">.</span><span class="na">setShowHelp</span><span class="p">(</span><span class="n">showToolBarHelp</span><span class="p">);</span><span class="w"></span>

<span class="w">		</span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">toolbarPosition</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">default</span><span class="p">:</span><span class="w"></span>
<span class="w">		</span><span class="k">case</span><span class="w"> </span><span class="n">SwingConstants</span><span class="p">.</span><span class="na">NORTH</span><span class="p">:</span><span class="w"></span>
<span class="w">			</span><span class="n">northPanel</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">toolBarContainer</span><span class="p">,</span><span class="w"> </span><span class="n">BorderLayout</span><span class="p">.</span><span class="na">NORTH</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="k">case</span><span class="w"> </span><span class="n">SwingConstants</span><span class="p">.</span><span class="na">SOUTH</span><span class="p">:</span><span class="w"></span>
<span class="w">			</span><span class="n">southPanel</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">toolBarContainer</span><span class="p">,</span><span class="w"> </span><span class="n">BorderLayout</span><span class="p">.</span><span class="na">NORTH</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="k">case</span><span class="w"> </span><span class="n">SwingConstants</span><span class="p">.</span><span class="na">EAST</span><span class="p">:</span><span class="w"></span>
<span class="w">			</span><span class="n">eastPanel</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">toolBarContainer</span><span class="p">,</span><span class="w"> </span><span class="n">loc</span><span class="p">.</span><span class="na">borderEast</span><span class="p">());</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">showToolBarHelp</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">helpPanel</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">northPanel</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">helpPanel</span><span class="p">,</span><span class="w"> </span><span class="n">BorderLayout</span><span class="p">.</span><span class="na">NORTH</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">			</span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="k">case</span><span class="w"> </span><span class="n">SwingConstants</span><span class="p">.</span><span class="na">WEST</span><span class="p">:</span><span class="w"></span>
<span class="w">			</span><span class="n">westPanel</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">toolBarContainer</span><span class="p">,</span><span class="w"> </span><span class="n">loc</span><span class="p">.</span><span class="na">borderWest</span><span class="p">());</span><span class="w"></span>
<span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">showToolBarHelp</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">helpPanel</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">northPanel</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">helpPanel</span><span class="p">,</span><span class="w"> </span><span class="n">BorderLayout</span><span class="p">.</span><span class="na">NORTH</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">			</span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="n">northPanel</span><span class="p">.</span><span class="na">revalidate</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="n">southPanel</span><span class="p">.</span><span class="na">revalidate</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="n">westPanel</span><span class="p">.</span><span class="na">revalidate</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="n">eastPanel</span><span class="p">.</span><span class="na">revalidate</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="n">toolBarContainer</span><span class="p">.</span><span class="na">buildGui</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">helpPanel</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">helpPanel</span><span class="p">.</span><span class="na">revalidate</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">initInputBar</span><span class="p">(</span><span class="n">AppD</span><span class="w"> </span><span class="n">app</span><span class="p">,</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">showInputTop</span><span class="p">,</span><span class="w"></span>
<span class="w">			</span><span class="n">JPanel</span><span class="w"> </span><span class="n">northPanel</span><span class="p">,</span><span class="w"> </span><span class="n">JPanel</span><span class="w"> </span><span class="n">southPanel</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">GuiManagerD</span><span class="w"> </span><span class="n">gui</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">GuiManagerD</span><span class="p">)</span><span class="w"> </span><span class="n">app</span><span class="p">.</span><span class="na">getGuiManager</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">showInputTop</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">northPanel</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="na">getAlgebraInput</span><span class="p">(),</span><span class="w"> </span><span class="n">BorderLayout</span><span class="p">.</span><span class="na">SOUTH</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">southPanel</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">gui</span><span class="p">.</span><span class="na">getAlgebraInput</span><span class="p">(),</span><span class="w"> </span><span class="n">BorderLayout</span><span class="p">.</span><span class="na">SOUTH</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="p">((</span><span class="n">AlgebraInputD</span><span class="p">)</span><span class="w"> </span><span class="n">gui</span><span class="p">.</span><span class="na">getAlgebraInput</span><span class="p">()).</span><span class="na">updateOrientation</span><span class="p">(</span><span class="n">showInputTop</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">JPanel</span><span class="w"> </span><span class="nf">getMenuBarPanel</span><span class="p">(</span><span class="n">AppD</span><span class="w"> </span><span class="n">appD</span><span class="p">,</span><span class="w"> </span><span class="n">JPanel</span><span class="w"> </span><span class="n">applicationPanel</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">JPanel</span><span class="w"> </span><span class="n">menuBarPanel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JPanel</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">BorderLayout</span><span class="p">());</span><span class="w"></span>
<span class="w">		</span><span class="n">menuBarPanel</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">appD</span><span class="p">.</span><span class="na">getGuiManager</span><span class="p">().</span><span class="na">getMenuBar</span><span class="p">(),</span><span class="w"> </span><span class="n">BorderLayout</span><span class="p">.</span><span class="na">NORTH</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="n">menuBarPanel</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">applicationPanel</span><span class="p">,</span><span class="w"> </span><span class="n">BorderLayout</span><span class="p">.</span><span class="na">CENTER</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">menuBarPanel</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">GuiManagerD</span><span class="w"> </span><span class="nf">newGuiManager</span><span class="p">(</span><span class="n">AppD</span><span class="w"> </span><span class="n">appD</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">GuiManagerD</span><span class="p">(</span><span class="n">appD</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">loadFile</span><span class="p">(</span><span class="n">AppD</span><span class="w"> </span><span class="n">app</span><span class="p">,</span><span class="w"> </span><span class="n">File</span><span class="w"> </span><span class="n">currentFile</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">app</span><span class="p">.</span><span class="na">getGuiManager</span><span class="p">().</span><span class="na">loadFile</span><span class="p">(</span><span class="n">currentFile</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setActiveView</span><span class="p">(</span><span class="n">AppD</span><span class="w"> </span><span class="n">app</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">view</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">getGuiManager</span><span class="p">(</span><span class="n">app</span><span class="p">).</span><span class="na">getLayout</span><span class="p">().</span><span class="na">getDockManager</span><span class="p">().</span><span class="na">setFocusedPanel</span><span class="p">(</span><span class="n">view</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">inExternalWindow</span><span class="p">(</span><span class="n">AppD</span><span class="w"> </span><span class="n">app</span><span class="p">,</span><span class="w"> </span><span class="n">Component</span><span class="w"> </span><span class="n">eventPane</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">getGuiManager</span><span class="p">(</span><span class="n">app</span><span class="p">).</span><span class="na">getLayout</span><span class="p">().</span><span class="na">inExternalWindow</span><span class="p">(</span><span class="n">eventPane</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Component</span><span class="w"> </span><span class="nf">getRootComponent</span><span class="p">(</span><span class="n">AppD</span><span class="w"> </span><span class="n">app</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">getGuiManager</span><span class="p">(</span><span class="n">app</span><span class="p">).</span><span class="na">getLayout</span><span class="p">().</span><span class="na">getRootComponent</span><span class="p">();</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">newLayout</span><span class="p">(</span><span class="n">AppD</span><span class="w"> </span><span class="n">app</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">app</span><span class="p">.</span><span class="na">guiManager</span><span class="p">.</span><span class="na">setLayout</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">LayoutD</span><span class="p">(</span><span class="n">app</span><span class="p">));</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">DockBarInterface</span><span class="w"> </span><span class="nf">newDockBar</span><span class="p">(</span><span class="n">AppD</span><span class="w"> </span><span class="n">app</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DockBar</span><span class="p">(</span><span class="n">app</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">isDesktop</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">CopyPasteD</span><span class="w"> </span><span class="nf">getCopyPaste</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">copyPaste</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">copyPaste</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CopyPasteD</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">copyPaste</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">invokeLater</span><span class="p">(</span><span class="n">Runnable</span><span class="w"> </span><span class="n">runnable</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">SwingUtilities</span><span class="p">.</span><span class="na">invokeLater</span><span class="p">(</span><span class="n">runnable</span><span class="p">);</span><span class="w"></span>

<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">newGeoGebraToPstricks</span><span class="p">(</span><span class="n">AsyncOperation</span><span class="o">&lt;</span><span class="n">GeoGebraExport</span><span class="o">&gt;</span><span class="w"> </span><span class="n">callback</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">callback</span><span class="p">.</span><span class="na">callback</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">GeoGebraToPstricksD</span><span class="p">(</span><span class="k">this</span><span class="p">));</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">newGeoGebraToAsymptote</span><span class="p">(</span><span class="w"></span>
<span class="w">			</span><span class="n">AsyncOperation</span><span class="o">&lt;</span><span class="n">GeoGebraExport</span><span class="o">&gt;</span><span class="w"> </span><span class="n">callback</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">callback</span><span class="p">.</span><span class="na">callback</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">GeoGebraToAsymptoteD</span><span class="p">(</span><span class="k">this</span><span class="p">));</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">newGeoGebraToPgf</span><span class="p">(</span><span class="n">AsyncOperation</span><span class="o">&lt;</span><span class="n">GeoGebraExport</span><span class="o">&gt;</span><span class="w"> </span><span class="n">callback</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">callback</span><span class="p">.</span><span class="na">callback</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">GeoGebraToPgfD</span><span class="p">(</span><span class="k">this</span><span class="p">));</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setPrintPreview</span><span class="p">(</span><span class="n">PrintPreviewD</span><span class="w"> </span><span class="n">printPreviewD</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">printPreview</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">printPreviewD</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">PrintPreviewD</span><span class="w"> </span><span class="nf">getPrintPreview</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">printPreview</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * @param url online image URL</span>
<span class="cm">	 * @return url converted to a data URI if possible. If not, returns the URL</span>
<span class="cm">	 *         unaltered</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">protected</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">convertImageToDataURIIfPossible</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">url</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">		</span><span class="c1">// hard-code in desktop</span><span class="w"></span>
<span class="w">		</span><span class="c1">// * don&#39;t need to worry about download size</span><span class="w"></span>
<span class="w">		</span><span class="c1">// * works offline</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">GeoGebraConstants</span><span class="p">.</span><span class="na">GEOGEBRA_LOADING_PNG</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">url</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="n">StringUtil</span><span class="p">.</span><span class="na">pngMarker</span><span class="w"></span>
<span class="w">					</span><span class="o">+</span><span class="w"> </span><span class="s">&quot;iVBORw0KGgoAAAANSUhEUgAAAWgAAAA+CAMAAAAxm3G5AAACPVBMVEUAAAD////Ly8v///+UlJT////////////z8/P///+wsLDi4uJubm78/Pz4+Pj///////////96enrs7Oy+vr7////////////////X19eGhoaUlJT///////+hoaH///////////////////////////////////////9vb2////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////96enqHh4f////////////////////////////////////////////////////////////////////////////////////////////////////////////////////Gxsb///////+0tLT///+ampofHx/X19fb29sBAQEHBwcODg7l5eWJiYn///////9DQ0O9vb2jo6P29vaqqqpwcHBJSUnLy8uAgIBFRUU0NDR/f3+enp4yMjIpKSmdnZ3u7u6qqqrKysoFBQV1dXUkJCT///9lZWWYmP8AAACoqKhMTID29vbPz89ubm4KCg8GBgYdHTDw8PDf398TEyDs7OwmJkA/Pz9ycsBfX6CRkZGPj/B8fNCfn5+BgYF4eHg5OWAwMFA4ODgqKioQEBCFheBycr9NTU0wMDBeXl4YGBj6+vpCQnBoaGhXV1d7e89VVZBpabB5IoDqAAAAk3RSTlMA/b/50Pzw98/7w8Px49ja7fPkyMAJ5+TpwNnP9gTI9ahHsfLFlPEi1/DSzUQGAr9sUBYNGBHct97KmmfU0LShe0A3HqWLcY9+eFhKKSDj2FU9u2M6Gw8L4MfCdSa5gKyXh2BNhFo0MS0rE+td/qqd/p7+/fz9/PTn/PwQB/37yPPu6Ofm9/Dv7eXk49/d3djDoJ3CiGq2AAAXqElEQVR42u1cBXcbRxDW6nR3OsmyJNsCO6pBZtmO7ZiZGWJK4thO4nCapE2ZmZnkXCkpMzO3v623vEdu2r6m7WunfW0iLcx8Ozs7MzsrjzM1VB89lu7rjEciyURNxUDTSpvnb6aWocGOcCSqSpKaKk+2N040t/7pMevXksZ4Su+Y5++hWH13e4kGRJIiXVMbV3j+LtrT06VAhrKIMEtatG+y+s/BHJVB1vgHSH8L1NWVcQkwobJcNrV3apfn76Ch/ipZZIejnerr2fuHh51IaoAMpfR5LjedSpdQjO2iycrAnOdyU32Xyhiyg60ljrX+wXGTfPWAeplVuro0imF2k0yuqmzxXE7a6CjBDLlira2Ox/6QQqtAkOuyqnRL06rGJ/cXegM+SAVef0hgKdHjuWwUG49ztcstLPAVbUEq8hUU5nKWUmvDf2DsA7LR1weHg2NEPJePdm1GqVChQsQBp5zioMK2WceVnstDu0oZR/mBnC0LCSzFxxt+9+A1QAA6q3ouG83tl4hUQYyyTTA/EUsLH70sDsipJcKRUpi35UiBEF38q3+3AxL+m4Ae3k+scz4Vyk4+CnVkyvPXU32dTBaeKrM71EDrGv53AH0ig2EOwandqZjIVVL5l3t6V/bKDhztgFQrGjUvWfz2+n8D0NX7iTpz5dntzceo+vMLdnPBColOT7R6/lKaW5KBWZ1rA/n0BFT8AktF+FOtt+yfD3RLWkPMFlDm5wtDWZFC3nmm1Ao+f1b+7Jwnzo43NVe7WPsrrsYceZkq52fNFCqopUpdiO305D8f6IPYpwxQZeZCccrfQeXKhWKVdzuo9L6NoebmlZHYJZiqa1ejkiSlkksLjq2nolmRox1+B46UIF39APyrVGdT6Ya5+qaxc9dWDi6carkEoNsWmyYGBirXj87t3I73K0aap8aOLZ+wBKU7206ePdZ9beVU88YdbjFuRMS5tjDrTPnzBGk/1J++WbPLe2KyMV4iQVKjif7xU9s5XLPnFJxLyQI5tbRiF2skCQR9rg26cKRQhfcZ20xONJs5mhlYLZFkTDBZU70d0LGh7nAUttaMf9Vk/9nT5sGmx9IVFemxhdjp8S5F1Qwxy8Nj1Rz84bG+KklD3WU12dgzRzvVrJUepJu4D1tDos4hIeaWNAQIlauACK5kgZYRgW6dqlGBKetTkhl3zfidPJASGks1zbYWHSJHOxTOkKokIykhrMrdjTnKNb40AT3XfUZGc3CWUl0LDW5Ay6sSMMfAkdFTAsybSVUGcL1qIjS7BQzOx3dhmJvCUHxhLi2Srp9ORxAoUhWBel1CLJNdyELbxOjxjTt27hqarFBkFjfUYqmyBtcc6NOH43R2TkCLH9vnnIvbbxEqVbpoth+LKWSFc8wcqZn1k6hd69mOCGVJCRCOsuKCjQyU2/JQUOReDjUHGn/rkG4Y3aC+QkaB4gHUCgiMty/Dr3sSmlMSrlwln4LoKoq/EgAynGeSKloqhH+xo41RwDRoN7bRY3upbWoOS5Z5mK4uOAFdiU+EB6+/+eaHXiMt491iuIl9IJ+Jo2Rlq7iVj9fRXEXh1jzyO6TuGDXNy51E6W1Yp0pHnIF25L99eR+abD2qubQ4tMszvJRyFF/4TFahSk8hpryCVEBNV1utaj+RS/Fir6OTAtNyOMKHDPkNEmxP5KDdfsyVw/Y33qzrb76u60/QptHGFXZmlABmOHZQpd+wjjPTS6TPxxwlqULvOqbwBEm+16CgX6EfaOFFd6Bz/bB1vp8JEJ2A/FeHLUgqVEp5tac5rHHpC43uhX7FDrqh0jE0YwjbZ+K6TTsctTMZTeh4ZpAo9J7KFFX2giIWQhbk0ti42xLZxM7GEau36N+/d/782xf0p9myKwNE2/r5FqslIJ51Ov0nFWEbK+sxMsMA5ShYnMO9bcbS6nSDBWh7OsUXVGhiZ4/hIlUhVTTIjwQtxiPmw5VIJ6n4gTw+WSHBGi0cWjEj0pUA8zjQOACtuZ1GRtkWAUrTFVQqoulBS+SeFySbq79FxGaR7Phn9U/OQ3pfv/625196g7StG4LD7olwhc7HHJ1y5GjncJ8M6Nk1Tj5su1YCeOvlOGcQQOKIDWg7/zlk50qjIwZE8I/wU68YbAThQUTE91sj6gDq7qXjax7PKFIf/CWWatbjQlNJgIinSlu6JbycVJlFqP2Y0wGu020TVWSpntHfP4/ok4uo8TWvcgx6kC3LY4YDJBfdOBpZU2XIkBzvofo8ifU5VwTOEmwl6k1Au2QecnA0IZXGZmQOtIJaUt6IC6AUO3QPmoFuQUdhIfpOQZ3ccwYNR5cSUSmaOLBA47nBKPfD7OTF5vUgg6WRHmA3fK2fx/SCThp/8B2yWj37PI2wkZ9vsZJpjyu1NXWdiUbD55jD0VO1HUd5uYilzB4RaFPmQVyfAnL7clTjQPMVIUeRfVF5dw605BlGshcxhdYmYfjgDvVE5QSD2TOcBKbI3WecBH4vt9UBrJBHSZqon/gCt3609an+Ewb6zYsfkcYvv4YPiP5yZMu4Qo96tqO248ePz/BDux2IkXtOAJ6DBk9FYlib1dIxEeggwbjAr+AbhiIT/5FJbjqQqAF/Vsln0TNfpiLjHM31+4PU2AdEoNcBoEdhLjIc+zyXTjiRWShaNZJAZlOhMfGx2Yhxlq4xvviR2Ogv9c+yL770wcuo9Q3ULaKWA9n5yMilM7SzA3LEkBMiylBARDq6IAAdNDVmJpfzv8qAhiuAnUlOuTxjyyhYhHVaADrNDp55NOjy78D5CDp28slGUZyCYy+a5ZjHU9ZRjhF88Tb0xWf6J1+cP//OBf0l9OE16MMbGdAhZstA9+/JYUeR2aFzc+J2OA8NGr6dAc0bi1SYI/CPWKJJRO69YpxzeA5R7I8/ZUDjG50CZpGU33P32gl4/Cbqg8iAH22++j5qnV9FyvvuG69+pkO6+Dxpfiv+/N1X8V+fRN4mYnHWnrsaOTVUZqGhE9VtO3fWoZPdkSPmWhWjI3qZAs0PPnf+swLQ3MnGHxeRY9a5Pwc6ieZjjDXaleRAIqraKNJbGTui8fiNOHOYxJnycOBCY8d7IJ4vIy2+7uvPr99CuGJN/+ibry8a0F+P1PoGtvRJG8z1a3FVspKmJiuah1SqNhxnoMkyZSnAses1Ae2nuZSUEtUs/FOypCiiccADvWKejRHlF4GOorOQzT9ug1lxjGZh3iDJt6mXRtL7OzrqaGFKrrgEWY7zh29YkyKIias+19/8+Z2P9QvwUHyJjgoqrDcv/cb4jixpyTiPvYqJf53MdO2v60TFKhRYH/IlEgLQhTTKr4aR68FVEhqYbYrga2gDU8cmK2S2n4uwPsuJw8OnW+sHFOJbm4BW2RhormFr9UNccqunifKERB7NwxAiXbxmlXhq/t7bIM4vsiHwiu1va4Z741P9HRTCXHjL+MvzZOntPsfZuOqEMwIPMH8lh0R2jIidpvoLgMKB9qHv1NERGsOTmo9iE/9bzJqBCcMziyW4QmOnsfP4FWTPTahYfneg5b0WhY7L7qUrnHOnfDEzlsT83XeTrusX7sQ4S4moTErolM02z5ES4zP9TepZvyQCXWlR6D4NuLLEJ/W6NAnQ7Q8kDrQf4Sxu5vESLhw131z3IxDQE8gVyeG+SdcGD4CPVCFW8gSgJbNGn3Ys53GnAr7o7mJBul9//YW3X3hdf+tWOO1iQ1kaXhOUxDvqDa4HDamv01/AQL+tfyACvWnmaCHyGxzlE3/FmfxI3ZGeMKCLkIodjIlu4qQs8I+J2/cBFKtxjysEP6y5XWSzCeHqdTcdJ6zlPLi5ncjsRXiZ7cSt9CNZaID1V94zQHzvFeTOxaEsrWXLPQtXwlsfN6CDkKO0JQ0gYbjs5BeWvjjrRkjJchnQjP12S2SWQTjSZTGDtMjuJvhk6pA5d5YmxwU/DOH/5tliNZnn6wW/ATS2HH4XwoDAMb7Rv0AofqG/BXNSHjMtGxvnVdF08MMwG7Yks+XtgKbYFXvdiAdCDOiQU/zQLDPLELIALbXxpBQbbc2aV0YqLfjREdY+H85nce/C2wMtSuxO0Ci/9cp5TK9/DstCrHdbkIuv8WH4E1yK7A1MVUrMly+bMtge6EtgiFtwnwCeRaXL8fd8YHZsRlGDMyzzFWJaLtIq2l4c6HZ2UBegQcxi1bkBPf9ngJaj1tKDLkN/XruI3buLr0Gvmtl+sGC+sHc1HaFLBzrAgKbg2Ysce5mRzWcDi23LgUnLbf3TCDr+/QGWvCtyCMEPQf0J7jDRbjIjP3nciaUwXmam41OYp7RyNQ59xddQwHLLA4gPnn3pMof9UMCQ10xmY7Y9MU/aBHTCBlQjA9orAs24R7dATB0Ue1kwMvIc6GPw77nC4Wly8Kawp2+P4gOip+zblh6F8cmN7DC8ytDoA7a60TWc8v3qqx+IvzDPNpk6Y6oR7LRX//uZh0tl925PMGX/W0AvATeg2x2ArrL1H0PhHAd6UQMmsbR10/1exh6vBATP2Y/7bU/MvXvh+wv6FsxQN9krEKIkHLzO5jeCcINoO4+Va8B56TFhR8GdeKwMgaY7udy5rNcryMpi1Rr0fdRsOmwVV6MW0xGLIDeFR1PxYZNKr9puuHPwpuZA+y4F6KrnoF24+BGUsd1eIdkSIeEg9P4s8btcGRNVukux6nQxa8pl356AHI2arrK0PdYLySg/DC1AZ1ADhFseyzEOWSXKmIEmN6Eh4UakRpxzbjIT1QAhbpbnRTjyspdCym0/fvUyLkW1vRnYexJ5bS+jk5PQDpbTzKpih4bFiURKYxzxlKro2ef+FtCpDM6msZPgsIWlHsCVygJ0HWrQbnbXOiz9T5OF5EDPaEgp+MENllo9JqiNB4ft7e3hTomZNW4tuIzAQrYKh+uo8lgTzCNjNVUoqwQTIbA5SXPziaJNMRPU4939HQY1VvHrlGKTZcNlj+4sgchypzlgibSaD42wY8Di5aczD1gCyAu1ZIkOk4XiQDfE+XFYhLmoOelU2VsBuEMXsu9arTMsUHs5l4qI+DzR1zpr5V9vSgYoT0pS/2paxirN922qssHh5UUjYAVNPEkY5B5UplSkME6FkALvGRxw8JMgbbpa6ubViMVWoPdjPxMAuhIK03MuVBXd/dz9m9TwmFyBQHLQlv9frCN5bn6XxxxDH94IbYKFw2VmoSIcg6EZriIWOBWpincdnmUhWAQORBbiI9i6byNC1p6n4WR79XNZAvC1nmcrqnBNqJoRtsGgilNOPj/aNPvbLUkleZMj3TIp2TNmlsTtItp3OdzkHhJOnlOdbPdzoBuQtVJqxeyxlJk23dG2HSQ51gKeWklqsBvnFJS2MUY3JRoP5AXhcBCBW+FVN8FDK6HVYiuoqu2qd9+9Cw4EYxV1wTOg8bmKFGJVG8sErd45ezW5GitkfINIBFDgi7GBYCan7ZzEVsWXawgeJ6aDHzLygVZqLftJY77SdqBbEpacrNx4kjK3nGS7XwxopiQh9gjSYznevUJc6n1Do1ACngu/G18ERthOyKOVKUiu0+sJGWNAlUtGJYLwrHuDGhNZOUtsIcg+/7lu0GffbF1H9uAsVtbdBGl2QTBw9DQ2Y+O08k4sHJMHOvhVBCnKqJgxWIqd3Dwj5vLz4Z0PA5pvZLV/6PYr9kx3RF0T/+JVxDnbLUP56IoxW9uRjJTlWVIxcsyIV/QF3AVSkzV1dRmYaDdJVasgVO84xGcKZMlUNfvr4hQDP/0KaMi7vwZeCgp1eYswRyQZOOsXvn/7l0/0z3/4Dio0LE7A+zxUSy6ueSdNrYqUq7KVo1ykvxszKkGPdwKqoqRkQC9SeXjHgRbvvWSNtOWmyw3oUyX83sxLu5dEyiXA4nsr0GURsbzex046q/fg3eLKIk15hqM8E1LIzz3Abicpo0DtgEHGd/DvV13z1Vs/voQfUm2UocLSixdQ1dI7+p0sRrsdn3O5tTQJ5EIFAk7SOU+sF/DrpRBvZuYIfiGPssPQ5erCn8OEBY5Aexp5iaA9U8yrl8RcyBh/WiEWaNiv63mOsW6fMZPMjkd7eBgUGK2aTRKV/uZ6HdKn2CqiGO9dmoh+RUdHIX56EReQxpbeTv4isSKq3fD/zyJBCslGcK4gKESHUD0HGt+SCDJb9jeQgSPQKyX8zBb7syI5O9Cn+2Wi065QhwLm6p16OFMVIHqCjxixebFgiKRSz5gMe3249a3+8fvn3/9E/4w72G/pb9NE9KsQL3KelGOk51nRpGKF2WfKxUWhzd+3JGqMV3GriZErYhxoKABfS1byyM/UuOQItOdql2odmPUiJazW7N5shtp//gA4JPQLIty4PqcmUWw/IJlKdfLprsHNeaVStWcf0tDInUR7P9ZpPccbd31qAlpupx4/PpKUHZylQn+Wv3/LM+96qbsBXSlGTHuTsuQvzDPryQlTSRhrnQuFzWdj+xR08Bx2Abq1k9T5sZIyjFY+mb5I8drSqMO9QHgTQib2BbwGBXy8BLAWDyUdwn72nj7LW0DYoxhvGi5V1XGYCEUtb76AMX1P/+yN7Is3vHTNh1tbX1HT8fpNohhtYyXEfzO93/RBEhPj2LXU+vfinbCuIsuJRSW5RYIb5yg6uNO5yJETb6xWlrkA7TkeYfLz2Yz/smWyA+0ZCtMaAVEux6JfoJXuYrfkrEbWqXAVM3oYOX2I2ZvepPn/b3m7b/UvsZY/BseuZIUyUKeJ1XKlAsyRfGCW7WeJ2ljXSlx1wNiP3OtAFtWN/ax29R5XoD1TiEV7d9JWBJrRySWNbEs3qO/204cb/OHFdMRe9c2K/sh7eBxxoePw5tcJ0Pr1vOEPuv7xCy+8ot+CYuMhHl42wT4YakeWamldodQ4yzMnaQ3gPm6rIsEnkiLQkGwCBEjjxl2eFRPQ8pJwB3uwHNi7c9/N6/RgtLo/xR5f2QXbXRCiia9D4t3AOgFD8eaZ1CEQIq3pq/E12O4WqLzIlfuUFute80b2qm91gx5GmyUjpiqP9mqcpXnrugcVytGomBHaoI++QszWis8dACmU6UJesM8gWgErqGWel7AvjRpKNRthTyvQOokhM912StAndKcaECTjA3Nh2/oZIPwMiXfHbvrQvSCf+9aK+f1PbDnBHOdggQ9RwOunravGUCxH3yQ9oF+ASH954eIHzxt01WskK/rqdc+TKMZ8Qzgn/iROyO/17kAU8AaFICa+bi772XO1CngXTH6FcUQeb5XarzQU0ppJC6Ln4BK2khcchEXztUVTHLDuhbh7rj39vWbJ0HU4v+TiPaSMLbkzU6MBl9ZaoocrGsqW3Kfrr7z5iq7f63zrkdy0jt7cywFx7KNWDFv7nB48IwMX/lePxIjRS7iwLRYF4qc6V/TwcA+UVJwy3xAMddEv3VGrOm57e1UHH7W6A9fksdPeTZdf8SpJzwlpIKxCd91yk37T4685/xLVmYP2B+axJv6M0d5FCi87vVBYWaJKbXkOO8A5KlVkQMSKSjKwDS1HD41QP66CrJwhU40Ngj0TsOzSNoCkqgCQSkuu0Bzq+v6IzLEWZ1bDeA47zTGmRT4PmFVtAxlc+6jxvkQU192mF6EC2aFuPlAl2yUxKLo27fbkvKyRGR2uoNeKr0anRxMSgIyWJAZnNpOCWqJPlfRJQf8q4/iJslIxeMohV79p/gk7qGQVM0cOlEtwpFS88rgjj7uOLBnTIuLzqu3dKx532jXeVWWoBSWtvG9yxPrs4bjZxhhLXt5+dY9x2LSsrJ8rrVze5hcMT08fShiSiqRGGnv2cG12kH58LSKh2lYDIS0VT09Tp5RDXRGu2V86eAJuy4V0XNVkRJoaX+pptWz1sf66jNH2lPNkLUdHEyV4NlmTquomq1Gt4+ZSb+YAhtml3/B4aSahwAr0VPmZzrXK6REXmTgrrWWTh7pq2jvDdf2Hm+ecQFsx/AG6m6SanpOtDmO6jz9y9HB/XbgzkVgN9zVe2zTccgl9qpsHr02nD50bbJ6N/WbrBtx64Nj0lS2eP0CtM+vdh9KHKptgfvnvpb2D4ZQkG3qjJoyU/P/0F9Lehe61vsaJsv8czL8Ck63xcekdb0wAAAAASUVORK5CYII=&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">GeoGebraConstants</span><span class="p">.</span><span class="na">APPLET_PLAY_PNG</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">url</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="n">StringUtil</span><span class="p">.</span><span class="na">pngMarker</span><span class="w"></span>
<span class="w">					</span><span class="o">+</span><span class="w"> </span><span class="s">&quot;iVBORw0KGgoAAAANSUhEUgAAAFAAAABQCAMAAAC5zwKfAAAAhFBMVEUAAABmZmb///9qampsbGz+/v6qqqpvb29ubm6enp6rq6t3d3d1dXVxcXH6+vqCgoJ+fn719fXv7+/n5+eTk5N0dHSXl5eNjY2KioqIiIji4uLe3t6UlJSQkJDr6+vW1tbCwsK5ubmioqK7u7uzs7OmpqaFhYXk5OR7e3vNzc3Jycmvr6833NujAAAAAXRSTlMAQObYZgAAAlhJREFUWMPVmNuW2jAMRS2Ogk0JCZBwvzPATNv//7/SdrqyBoxl2U/dH7DXUeSLYvP/czrPAPAdgG+DTNsCRKAvMJKlQwLIA4BWb2st02tAQ13OFcloSncUR2wnmGKZG5k3gKIBRN8H6YAQ0pGacchHKawEnxo4wadn5vdZSmbr37rpYOcRgjKA4NMzevQtBaF68TBlgogOQ5Wavxww/ta1I4e0iOQBx6poTmwpFtf5BuShnPTuNH2GvmbrPeF7f6jWu1jlLNhi/lb0PpVNbaH6iqW3gH7R+8fk+9BSBG3XEn/Cjv0RHB+RpIR3iubMiBS2QWGn3LSOo64DhEvuqN5XFhERSUrYMT3MHAVgSehRnsCCUCj5ieYMDpa8lRM+dmduERigakHoYbKvnV+4vAuXJJTsVR4An7C+C8dSQj9rfnE+LJ0o9PMT/jYPZonCDfuF1zJR+PZC2E8UNsNX1/MtRVhtxnh1Oiz0y6ZYDxgv1+FCnbC5gkMDslI4PQp7WSecrJ+ulxxhNV1YiOchYoXFumUmEoUc1+Vi3xdvvrqbNcWE0x/MJGGihZPDeASKFQ6lkqtp7UAypfkEwYTV+9ZBN34hlHB/YdYO7lePEdvi776wluLAxQQjYvO7Fx8WKUP2HPSMPV1KBkWzFP8bmUmBe3gYoEyQ9Gcmr8GOEWXB5pFzXkbzTEkZ1J1HXbTc4fzGIOPVRv6A+VXDBOBEXyAjSMfYSOTEy30QgjNRrEBRsOaBOIKb0TAWwmFrtOwgFJvAyuLBCiKUA5PDrp4xs3PsmO1wrpXl8wsCuyePXN5O7AAAAABJRU5ErkJggg==&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">url</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">resetCurrentFile</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">setCurrentFile</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">exportStringToFile</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">ext</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">content</span><span class="p">,</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">showDialog</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">StringBuilder</span><span class="w"> </span><span class="n">fileName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StringBuilder</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="n">fileName</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">&quot;test.&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="n">fileName</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">ext</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="n">BufferedWriter</span><span class="w"> </span><span class="n">objBufferedWriter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BufferedWriter</span><span class="p">(</span><span class="w"></span>
<span class="w">					</span><span class="k">new</span><span class="w"> </span><span class="n">OutputStreamWriter</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">FileOutputStream</span><span class="p">(</span><span class="n">fileName</span><span class="p">.</span><span class="na">toString</span><span class="p">()),</span><span class="w"> </span><span class="s">&quot;UTF-8&quot;</span><span class="p">));</span><span class="w"></span>
<span class="w">			</span><span class="n">Log</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">&quot;Export to &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">fileName</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="n">objBufferedWriter</span><span class="p">.</span><span class="na">write</span><span class="p">(</span><span class="n">content</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="n">objBufferedWriter</span><span class="p">.</span><span class="na">close</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">UnsupportedEncodingException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">FileNotFoundException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span>
<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handleImageExport</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">base64image</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">base64image</span><span class="p">.</span><span class="na">startsWith</span><span class="p">(</span><span class="s">&quot;&lt;svg&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">base64image</span><span class="p">.</span><span class="na">startsWith</span><span class="p">(</span><span class="s">&quot;&lt;?xml&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">				</span><span class="o">||</span><span class="w"> </span><span class="n">base64image</span><span class="p">.</span><span class="na">startsWith</span><span class="p">(</span><span class="s">&quot;%PDF&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">getCopyPaste</span><span class="p">().</span><span class="na">copyTextToSystemClipboard</span><span class="p">(</span><span class="n">base64image</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">png</span><span class="p">;</span><span class="w"></span>
<span class="w">		</span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">png</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Base64</span><span class="p">.</span><span class="na">decode</span><span class="p">(</span><span class="n">base64image</span><span class="p">.</span><span class="na">getBytes</span><span class="p">(</span><span class="n">Charsets</span><span class="p">.</span><span class="na">getUtf8</span><span class="p">()));</span><span class="w"></span>
<span class="w">			</span><span class="n">ByteArrayInputStream</span><span class="w"> </span><span class="n">bis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ByteArrayInputStream</span><span class="p">(</span><span class="n">png</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="n">BufferedImage</span><span class="w"> </span><span class="n">image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ImageIO</span><span class="p">.</span><span class="na">read</span><span class="p">(</span><span class="n">bis</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="n">copyImageToClipboard</span><span class="p">(</span><span class="n">image</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">copyImageToClipboard</span><span class="p">(</span><span class="n">Image</span><span class="w"> </span><span class="n">img</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">ImageSelection</span><span class="w"> </span><span class="n">imgSel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ImageSelection</span><span class="p">(</span><span class="n">img</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="n">Toolkit</span><span class="p">.</span><span class="na">getDefaultToolkit</span><span class="p">().</span><span class="na">getSystemClipboard</span><span class="p">().</span><span class="na">setContents</span><span class="p">(</span><span class="n">imgSel</span><span class="p">,</span><span class="w"></span>
<span class="w">				</span><span class="kc">null</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">GeoImage</span><span class="w"> </span><span class="nf">createImageFromString</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">imgFileName</span><span class="p">,</span><span class="w"></span>
<span class="w">			</span><span class="n">String</span><span class="w"> </span><span class="n">imgBase64</span><span class="p">,</span><span class="w"> </span><span class="n">GeoImage</span><span class="w"> </span><span class="n">imageOld</span><span class="p">,</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">autoCorners</span><span class="p">,</span><span class="w"> </span><span class="n">GeoPointND</span><span class="w"> </span><span class="n">c1</span><span class="p">,</span><span class="w"></span>
<span class="w">			</span><span class="n">GeoPointND</span><span class="w"> </span><span class="n">c2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">GeoImage</span><span class="w"> </span><span class="n">geoImage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">imageOld</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">imageOld</span><span class="w"></span>
<span class="w">				</span><span class="p">:</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">GeoImage</span><span class="p">(</span><span class="n">getKernel</span><span class="p">().</span><span class="na">getConstruction</span><span class="p">());</span><span class="w"></span>

<span class="w">		</span><span class="n">kernel</span><span class="p">.</span><span class="na">getApplication</span><span class="p">().</span><span class="na">getImageManager</span><span class="p">().</span><span class="na">addExternalImage</span><span class="p">(</span><span class="n">imgFileName</span><span class="p">,</span><span class="w"></span>
<span class="w">				</span><span class="n">imgBase64</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="n">geoImage</span><span class="p">.</span><span class="na">setImageFileName</span><span class="p">(</span><span class="n">imgFileName</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="n">geoImage</span><span class="p">.</span><span class="na">setCorner</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="n">geoImage</span><span class="p">.</span><span class="na">setCorner</span><span class="p">(</span><span class="n">c2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">geoImage</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">md5Encrypt</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">md5EncryptStatic</span><span class="p">(</span><span class="n">s</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * @param s string to hash</span>
<span class="cm">	 * @return md5 hash</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">md5EncryptStatic</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">getMd5Encrypter</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="n">UUID</span><span class="p">.</span><span class="na">randomUUID</span><span class="p">().</span><span class="na">toString</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="n">getMd5Encrypter</span><span class="p">().</span><span class="na">update</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="na">getBytes</span><span class="p">(</span><span class="n">Charsets</span><span class="p">.</span><span class="na">getUtf8</span><span class="p">()));</span><span class="w"></span>
<span class="w">		</span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">md5hash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">md5EncrypterD</span><span class="p">.</span><span class="na">digest</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">StringUtil</span><span class="p">.</span><span class="na">convertToHex</span><span class="p">(</span><span class="n">md5hash</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * @return md5 encrypter</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">synchronized</span><span class="w"> </span><span class="n">MessageDigest</span><span class="w"> </span><span class="nf">getMd5Encrypter</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">md5EncrypterD</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">md5EncrypterD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MessageDigest</span><span class="p">.</span><span class="na">getInstance</span><span class="p">(</span><span class="s">&quot;MD5&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">NoSuchAlgorithmException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">				</span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>

<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">md5EncrypterD</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">isShowingLogInDialog</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="c1">// for 3D</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getModeIconBase64</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">m</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">ImageIcon</span><span class="w"> </span><span class="n">icon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getModeIcon</span><span class="p">(</span><span class="n">m</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="n">Image</span><span class="w"> </span><span class="n">img1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">icon</span><span class="p">.</span><span class="na">getImage</span><span class="p">();</span><span class="w"></span>

<span class="w">		</span><span class="n">BufferedImage</span><span class="w"> </span><span class="n">img2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ImageManagerD</span><span class="p">.</span><span class="na">toBufferedImage</span><span class="p">(</span><span class="n">img1</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">StringUtil</span><span class="p">.</span><span class="na">pngMarker</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">GgbAPID</span><span class="p">.</span><span class="na">base64encode</span><span class="p">(</span><span class="n">img2</span><span class="p">,</span><span class="w"> </span><span class="mi">72</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="cm">/**</span>
<span class="cm">	 * Append XML describing the keyboard to given string builder</span>
<span class="cm">	 *</span>
<span class="cm">	 * @param sb</span>
<span class="cm">	 *            string builder</span>
<span class="cm">	 */</span><span class="w"></span>
<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">getKeyboardXML</span><span class="p">(</span><span class="n">StringBuilder</span><span class="w"> </span><span class="n">sb</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="n">sb</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">&quot;&lt;keyboard width=\&quot;&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="n">sb</span><span class="p">.</span><span class="na">append</span><span class="p">(((</span><span class="n">KeyboardSettings</span><span class="p">)</span><span class="w"> </span><span class="n">getSettings</span><span class="p">().</span><span class="na">getKeyboard</span><span class="p">())</span><span class="w"></span>
<span class="w">				</span><span class="p">.</span><span class="na">getKeyboardWidth</span><span class="p">());</span><span class="w"></span>
<span class="w">		</span><span class="n">sb</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">&quot;\&quot; height=\&quot;&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="n">sb</span><span class="p">.</span><span class="na">append</span><span class="p">(((</span><span class="n">KeyboardSettings</span><span class="p">)</span><span class="w"> </span><span class="n">getSettings</span><span class="p">().</span><span class="na">getKeyboard</span><span class="p">())</span><span class="w"></span>
<span class="w">				</span><span class="p">.</span><span class="na">getKeyboardHeight</span><span class="p">());</span><span class="w"></span>
<span class="w">		</span><span class="n">sb</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">&quot;\&quot; opacity=\&quot;&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="n">sb</span><span class="p">.</span><span class="na">append</span><span class="p">(((</span><span class="n">KeyboardSettings</span><span class="p">)</span><span class="w"> </span><span class="n">getSettings</span><span class="p">().</span><span class="na">getKeyboard</span><span class="p">())</span><span class="w"></span>
<span class="w">				</span><span class="p">.</span><span class="na">getKeyboardOpacity</span><span class="p">());</span><span class="w"></span>
<span class="w">		</span><span class="n">sb</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">&quot;\&quot; language=\&quot;&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="n">sb</span><span class="p">.</span><span class="na">append</span><span class="p">(((</span><span class="n">KeyboardSettings</span><span class="p">)</span><span class="w"> </span><span class="n">getSettings</span><span class="p">().</span><span class="na">getKeyboard</span><span class="p">())</span><span class="w"></span>
<span class="w">				</span><span class="p">.</span><span class="na">getKeyboardLocale</span><span class="p">());</span><span class="w"></span>
<span class="w">		</span><span class="n">sb</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">&quot;\&quot; show=\&quot;&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="n">sb</span><span class="p">.</span><span class="na">append</span><span class="p">(((</span><span class="n">KeyboardSettings</span><span class="p">)</span><span class="w"> </span><span class="n">getSettings</span><span class="p">().</span><span class="na">getKeyboard</span><span class="p">())</span><span class="w"></span>
<span class="w">				</span><span class="p">.</span><span class="na">isShowKeyboardOnStart</span><span class="p">());</span><span class="w"></span>
<span class="w">		</span><span class="n">sb</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="s">&quot;\&quot;/&gt;&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">AbstractSettings</span><span class="w"> </span><span class="nf">getKeyboardSettings</span><span class="p">(</span><span class="w"></span>
<span class="w">			</span><span class="n">AbstractSettings</span><span class="w"> </span><span class="n">keyboardSettings</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">keyboardSettings</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">KeyboardSettings</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">KeyboardSettings</span><span class="p">(</span><span class="n">keyboardSettings</span><span class="p">.</span><span class="na">getListeners</span><span class="p">());</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">updateKeyboardSettings</span><span class="p">(</span><span class="n">LinkedHashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">attrs</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="kt">int</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Integer</span><span class="p">.</span><span class="na">parseInt</span><span class="p">(</span><span class="n">attrs</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;width&quot;</span><span class="p">));</span><span class="w"></span>
<span class="w">			</span><span class="n">KeyboardSettings</span><span class="w"> </span><span class="n">kbs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">KeyboardSettings</span><span class="p">)</span><span class="w"> </span><span class="n">getSettings</span><span class="p">()</span><span class="w"></span>
<span class="w">					</span><span class="p">.</span><span class="na">getKeyboard</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="n">kbs</span><span class="p">.</span><span class="na">setKeyboardWidth</span><span class="p">(</span><span class="n">width</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="kt">int</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Integer</span><span class="p">.</span><span class="na">parseInt</span><span class="p">(</span><span class="n">attrs</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;height&quot;</span><span class="p">));</span><span class="w"></span>
<span class="w">			</span><span class="n">kbs</span><span class="p">.</span><span class="na">setKeyboardHeight</span><span class="p">(</span><span class="n">height</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="kt">double</span><span class="w"> </span><span class="n">opacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Double</span><span class="p">.</span><span class="na">parseDouble</span><span class="p">(</span><span class="n">attrs</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;opacity&quot;</span><span class="p">));</span><span class="w"></span>
<span class="w">			</span><span class="n">kbs</span><span class="p">.</span><span class="na">setKeyboardOpacity</span><span class="p">(</span><span class="n">opacity</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="kt">boolean</span><span class="w"> </span><span class="n">showOnStart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Boolean</span><span class="p">.</span><span class="na">parseBoolean</span><span class="p">(</span><span class="n">attrs</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;show&quot;</span><span class="p">));</span><span class="w"></span>
<span class="w">			</span><span class="n">kbs</span><span class="p">.</span><span class="na">setShowKeyboardOnStart</span><span class="p">(</span><span class="n">showOnStart</span><span class="p">);</span><span class="w"></span>
<span class="w">			</span><span class="n">kbs</span><span class="p">.</span><span class="na">setKeyboardLocale</span><span class="p">(</span><span class="n">attrs</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;language&quot;</span><span class="p">));</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">RuntimeException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span><span class="w"></span>
<span class="w">			</span><span class="n">Log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&quot;error in element &lt;keyboard&gt;&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">SettingsBuilder</span><span class="w"> </span><span class="nf">newSettingsBuilder</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SettingsBuilderD</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">protected</span><span class="w"> </span><span class="n">SettingsUpdaterBuilder</span><span class="w"> </span><span class="nf">newSettingsUpdaterBuilder</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SettingsUpdaterBuilder</span><span class="p">(</span><span class="k">this</span><span class="p">)</span><span class="w"></span>
<span class="w">				</span><span class="p">.</span><span class="na">withFontSettingsUpdater</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">FontSettingsUpdaterD</span><span class="p">(</span><span class="k">this</span><span class="p">));</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>

<span class="w">	</span><span class="nd">@Override</span><span class="w"></span>
<span class="w">	</span><span class="kd">public</span><span class="w"> </span><span class="n">DefaultSettings</span><span class="w"> </span><span class="nf">getDefaultSettings</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">defaultSettings</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">			</span><span class="n">defaultSettings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DefaultSettingsD</span><span class="p">();</span><span class="w"></span>
<span class="w">		</span><span class="p">}</span><span class="w"></span>
<span class="w">		</span><span class="k">return</span><span class="w"> </span><span class="n">defaultSettings</span><span class="p">;</span><span class="w"></span>
<span class="w">	</span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</body>
</html>
